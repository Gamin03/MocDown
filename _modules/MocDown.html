

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MocDown &mdash; MocDown 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MocDown 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">MocDown 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for MocDown</h1><div class="highlight"><pre>
<span class="c">#! /usr/bin/env python3</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;Jeffrey Seifried&#39;</span><span class="p">;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s">&#39;jeffrey.seifried@gmail.com&#39;</span><span class="p">;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;1.0&#39;</span><span class="p">;</span>
<span class="n">__year__</span> <span class="o">=</span> <span class="s">&#39;2014&#39;</span><span class="p">;</span>

<span class="c">###</span>
<span class="c">### Imports</span>
<span class="c">###</span>

<span class="c">###</span>
<span class="c"># Standard library</span>
<span class="c">###</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">concurrent</span> <span class="kn">import</span> <span class="n">futures</span> <span class="k">as</span> <span class="n">Futures</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">csv</span> <span class="kn">import</span> <span class="n">reader</span> <span class="k">as</span> <span class="n">CsvReader</span><span class="p">,</span>\
                <span class="n">writer</span> <span class="k">as</span> <span class="n">CsvWriter</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span> <span class="k">as</span> <span class="n">Glob</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">gzip</span> <span class="kn">import</span> <span class="nb">open</span> <span class="k">as</span> <span class="n">GzipOpen</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">Array</span><span class="p">,</span>\
                  <span class="n">concatenate</span> <span class="k">as</span> <span class="n">Concatenate</span><span class="p">,</span>\
                  <span class="n">diff</span> <span class="k">as</span> <span class="n">Difference</span><span class="p">,</span>\
                  <span class="n">empty</span> <span class="k">as</span> <span class="n">Empty</span><span class="p">,</span>\
                  <span class="n">exp</span> <span class="k">as</span> <span class="n">Exponent</span><span class="p">,</span>\
                  <span class="n">interp</span> <span class="k">as</span> <span class="n">LinearInterpolate</span><span class="p">,</span>\
                  <span class="n">log</span> <span class="k">as</span> <span class="n">NaturalLogarithm</span><span class="p">,</span>\
                  <span class="n">logspace</span> <span class="k">as</span> <span class="n">LogSpace</span><span class="p">,</span>\
                  <span class="n">nan_to_num</span> <span class="k">as</span> <span class="n">Nan2Num</span><span class="p">,</span>\
                  <span class="n">nonzero</span> <span class="k">as</span> <span class="n">NonZero</span><span class="p">,</span>\
                  <span class="n">seterr</span> <span class="k">as</span> <span class="n">SetNumpyError</span><span class="p">,</span>\
                  <span class="n">zeros</span> <span class="k">as</span> <span class="n">Zeros</span><span class="p">;</span>
<span class="n">SetNumpyError</span><span class="p">(</span><span class="n">invalid</span> <span class="o">=</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">divide</span> <span class="o">=</span> <span class="s">&#39;ignore&#39;</span><span class="p">);</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">getcwd</span> <span class="k">as</span> <span class="n">GetCurrentWorkingDirectory</span><span class="p">,</span>\
               <span class="n">mkdir</span> <span class="k">as</span> <span class="n">LibMakeDirectory</span><span class="p">,</span>\
               <span class="n">remove</span> <span class="k">as</span> <span class="n">LibRemoveFile</span><span class="p">,</span>\
               <span class="n">rmdir</span> <span class="k">as</span> <span class="n">LibRemoveDirectory</span><span class="p">,</span>\
               <span class="n">stat</span> <span class="k">as</span> <span class="n">FileStatus</span><span class="p">,</span>\
               <span class="n">symlink</span> <span class="k">as</span> <span class="n">LibSymbolicLink</span><span class="p">,</span>\
               <span class="n">system</span> <span class="k">as</span> <span class="n">SystemCall</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">exists</span> <span class="k">as</span> <span class="n">Exists</span><span class="p">,</span>\
                    <span class="n">getmtime</span> <span class="k">as</span> <span class="n">GetModificationTime</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">pickle</span> <span class="kn">import</span> <span class="n">dump</span> <span class="k">as</span> <span class="n">Pickle</span><span class="p">,</span>\
                   <span class="n">dumps</span> <span class="k">as</span> <span class="n">PickleString</span><span class="p">,</span>\
                   <span class="n">load</span> <span class="k">as</span> <span class="n">UnPickle</span><span class="p">,</span>\
                   <span class="n">UnpicklingError</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span> <span class="k">as</span> <span class="n">RandomInteger</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span> <span class="k">as</span> <span class="n">ReCompile</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span> <span class="k">as</span> <span class="n">LibCopyFile</span><span class="p">,</span>\
                   <span class="n">move</span> <span class="k">as</span> <span class="n">LibMoveFile</span><span class="p">,</span>\
                   <span class="n">rmtree</span> <span class="k">as</span> <span class="n">LibRemoveTree</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">modules</span> <span class="k">as</span> <span class="n">Modules</span><span class="p">,</span>\
                <span class="n">stdout</span> <span class="k">as</span> <span class="n">StdOut</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">mkdtemp</span> <span class="k">as</span> <span class="n">LibMakeTemporaryDirectory</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span> <span class="k">as</span> <span class="n">Sleep</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Physical constants</span>
<span class="c">###</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="kn">import</span> <span class="n">day</span> <span class="k">as</span> <span class="n">secondsPerDay</span><span class="p">,</span>\
                            <span class="n">eV</span> <span class="k">as</span> <span class="n">joulePerEv</span><span class="p">,</span>\
                            <span class="n">Julian_year</span> <span class="k">as</span> <span class="n">secondsPerYear</span><span class="p">,</span>\
                            <span class="n">k</span> <span class="k">as</span> <span class="n">boltzmannsConstant</span><span class="p">,</span>\
                            <span class="n">m_u</span> <span class="k">as</span> <span class="n">kgPerAmu</span><span class="p">,</span>\
                            <span class="n">m_n</span> <span class="k">as</span> <span class="n">neutronMass</span><span class="p">,</span>\
                            <span class="n">N_A</span> <span class="k">as</span> <span class="n">avogadrosNumber</span><span class="p">,</span>\
                            <span class="n">pi</span> <span class="k">as</span> <span class="n">pi</span><span class="p">;</span>
<span class="c">###</span>
<span class="n">avogadrosNumber</span> <span class="o">/=</span> <span class="mf">1e24</span><span class="p">;</span>
<span class="c">###</span>
<span class="n">neutronMass</span> <span class="o">/=</span> <span class="n">kgPerAmu</span><span class="p">;</span>
<span class="k">del</span> <span class="n">kgPerAmu</span><span class="p">;</span>
<span class="c">###</span>
<span class="n">joulePerMev</span> <span class="o">=</span> <span class="n">joulePerEv</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">;</span>
<span class="n">mevPerJoule</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">joulePerMev</span><span class="p">;</span>
<span class="n">kelvinPerMev</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">boltzmannsConstant</span> <span class="o">/</span> <span class="n">mevPerJoule</span><span class="p">;</span>
<span class="k">del</span><span class="p">(</span><span class="n">joulePerEv</span><span class="p">);</span>
<span class="c">###</span>
<span class="n">daysPerYear</span> <span class="o">=</span> <span class="n">secondsPerYear</span> <span class="o">/</span> <span class="n">secondsPerDay</span><span class="p">;</span>
<span class="k">del</span><span class="p">(</span><span class="n">secondsPerDay</span><span class="p">,</span> <span class="n">secondsPerYear</span><span class="p">);</span>

<span class="c">###</span>
<span class="c">### Constants</span>
<span class="c">###</span>

<span class="c">###</span>
<span class="c"># Computer epsilon</span>
<span class="c">###</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># ORIGEN2.2 input file template</span>
<span class="c">### # FIXME absorption rate (19) and fission rate (21) now; radioactivity (7) and ingestion hazard (15) later?</span>
<span class="n">origenInputFileTemplate</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s"> -1</span>
<span class="s"> -1</span>
<span class="s"> -1</span>
<span class="s"> TIT</span>
<span class="s"> BAS</span>
<span class="s"> LIP    1 1 0</span>
<span class="s"> LIB    0 1 2 3 -{xsLibs[0]:d} -{xsLibs[1]:d} -{xsLibs[2]:d} 9 50 0 4 0</span>
<span class="s"> OPTL   8 8 8 8 8  8 8 8 8 8  8 8 8 8 8  8 8 8 5 8  5 8 8 8</span>
<span class="s"> OPTA   8 8 8 8 8  8 8 8 8 8  8 8 8 8 8  8 8 8 5 8  5 8 8 8</span>
<span class="s"> OPTF   8 8 8 8 8  8 8 8 8 8  8 8 8 8 8  8 8 8 5 8  5 8 8 8</span>
<span class="s"> CUT    3 1.0E-24 28 1.0E-75 -1</span>
<span class="s"> INP    1 -2 0 0 1 1</span>
<span class="s"> BUP</span>
<span class="s"> {burnMode}    {timeEnds[0]:.5E} {cellBurnRate:.5E}  1  2 4 2</span>
<span class="s"> {burnMode}    {timeEnds[1]:.5E} {cellBurnRate:.5E}  2  3 4 0</span>
<span class="s"> {burnMode}    {timeEnds[2]:.5E} {cellBurnRate:.5E}  3  4 4 0</span>
<span class="s"> {burnMode}    {timeEnds[3]:.5E} {cellBurnRate:.5E}  4  5 4 0</span>
<span class="s"> {burnMode}    {timeEnds[4]:.5E} {cellBurnRate:.5E}  5  6 4 0</span>
<span class="s"> {burnMode}    {timeEnds[5]:.5E} {cellBurnRate:.5E}  6  7 4 0</span>
<span class="s"> {burnMode}    {timeEnds[6]:.5E} {cellBurnRate:.5E}  7  8 4 0</span>
<span class="s"> {burnMode}    {timeEnds[7]:.5E} {cellBurnRate:.5E}  8  9 4 0</span>
<span class="s"> {burnMode}    {timeEnds[8]:.5E} {cellBurnRate:.5E}  9 10 4 0</span>
<span class="s"> {burnMode}    {timeEnds[9]:.5E} {cellBurnRate:.5E} 10 11 4 0</span>
<span class="s"> {burnMode}    {timeEnds[10]:.5E} {cellBurnRate:.5E} 11  1 4 0</span>
<span class="s"> {burnMode}    {timeEnds[11]:.5E} {cellBurnRate:.5E}  1  2 4 0</span>
<span class="s"> {burnMode}    {timeEnds[12]:.5E} {cellBurnRate:.5E}  2  3 4 0</span>
<span class="s"> {burnMode}    {timeEnds[13]:.5E} {cellBurnRate:.5E}  3  4 4 0</span>
<span class="s"> {burnMode}    {timeEnds[14]:.5E} {cellBurnRate:.5E}  4  5 4 0</span>
<span class="s"> {burnMode}    {timeEnds[15]:.5E} {cellBurnRate:.5E}  5  6 4 0</span>
<span class="s"> {burnMode}    {timeEnds[16]:.5E} {cellBurnRate:.5E}  6  7 4 0</span>
<span class="s"> {burnMode}    {timeEnds[17]:.5E} {cellBurnRate:.5E}  7  8 4 0</span>
<span class="s"> {burnMode}    {timeEnds[18]:.5E} {cellBurnRate:.5E}  8  9 4 0</span>
<span class="s"> {burnMode}    {timeEnds[19]:.5E} {cellBurnRate:.5E}  9 10 4 0</span>
<span class="s"> BUP</span>
<span class="s"> PCH    10 10 10</span>
<span class="s"> OUT    10 1 0 0</span>
<span class="s"> STP    4</span>
<span class="s">0&#39;&#39;&#39;</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># ORIGEN2.2 punch card template</span>
<span class="c">###</span>
<span class="n">origenPunchCardTemplate</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">{lib:d} {zam:d} {moles:.9E} 0 0 0 0 0 0&#39;&#39;&#39;</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># ORIGEN2.2 cross-section library template</span>
<span class="c">###</span>
<span class="n">origenXsLibraryTemplate</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">{lib:&gt;3d} {zam:&gt;7d} {sigma[0]:.4E} {sigma[1]:.4E} {sigma[2]:.4E} {sigma[3]:.4E} {sigma[4]:.4E} {sigma[5]:.4E} -1&#39;&#39;&#39;</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Regular expression for numeric strings</span>
<span class="c">###</span>
<span class="n">reNumber</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;[0-9]+&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>

<span class="c">###</span>
<span class="c">### Custom classes</span>
<span class="c">###</span>

<span class="c">###</span>
<span class="c">###</span>
<span class="c">###</span>
<div class="viewcode-block" id="Coordinate"><a class="viewcode-back" href="../src.html#MocDown.Coordinate">[docs]</a><span class="k">class</span> <span class="nc">Coordinate</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Contain an abscissa and ordinate.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
<div class="viewcode-block" id="Coordinate.GetX"><a class="viewcode-back" href="../src.html#MocDown.Coordinate.GetX">[docs]</a>    <span class="k">def</span> <span class="nf">GetX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return abscissa.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="Coordinate.GetY"><a class="viewcode-back" href="../src.html#MocDown.Coordinate.GetY">[docs]</a>    <span class="k">def</span> <span class="nf">GetY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ordinate.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Empty Class</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="Class"><a class="viewcode-back" href="../src.html#MocDown.Class">[docs]</a><span class="k">class</span> <span class="nc">Class</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Empty class.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">pass</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Depletion calculation</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation">[docs]</a><span class="k">class</span> <span class="nc">DepletionCalculation</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Depletion calculation, held in memory during operation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">isPickleTransmute</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Set argument attributes</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Set isPickleTransmute</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isPickleTransmute</span> <span class="o">=</span> <span class="n">isPickleTransmute</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Parse transport file</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">originalTransportFile</span> <span class="o">=</span> <span class="n">ReadTransportFile</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">transportFileName</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Maybe populate depletion steps</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopulateDepletionSteps</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Run depletion calculation</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Deplete</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Collate pickles</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depletionCalculationPickle</span> <span class="o">=</span> <span class="n">DepletionCalculationPickle</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return number of depletion steps.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">mocDownInputFile</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="DepletionCalculation.GetArguments"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetArguments">[docs]</a>    <span class="k">def</span> <span class="nf">GetArguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return MocDown.py input arguments.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetBurnCells"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetBurnCells">[docs]</a>    <span class="k">def</span> <span class="nf">GetBurnCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cells which are depleted.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;burnCells&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetBurnMode"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetBurnMode">[docs]</a>    <span class="k">def</span> <span class="nf">GetBurnMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN2 string for flux or power mode.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;IRF&#39;</span><span class="p">,</span> <span class="s">&#39;IRP&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isPowerMode&#39;</span><span class="p">)];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetBurnRate"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetBurnRate">[docs]</a>    <span class="k">def</span> <span class="nf">GetBurnRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return system total flux or power for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isPowerMode&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPower</span><span class="p">();</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepFlux</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetCellNumberBurnRate"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetCellNumberBurnRate">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberBurnRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell flux or power for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumber2BurnRate</span><span class="p">()[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetCellNumber2BurnRate"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetCellNumber2BurnRate">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumber2BurnRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping cell to flux or power for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2BurnRate</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetCellNumberDecayPower"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetCellNumberDecayPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberDecayPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell decay power for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep2CellNumber2DecayPower</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">(</span><span class="n">offset</span><span class="p">)][</span><span class="n">cellNumber</span><span class="p">];</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetCellNumberThermalPower"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetCellNumberThermalPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberThermalPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transportOutputFile</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">includeDecayHeat</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell thermal power for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">GetIsCoupled</span><span class="p">():</span>
            <span class="c">###</span>
            <span class="c"># This is a coupled neutron/photon transport calculation;</span>
            <span class="c"># F6:np tallies are a good estimate for thermal power</span>
            <span class="c">###</span>
            <span class="n">thermalPower</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">transportOutputFile</span><span class="o">.</span><span class="n">GetCellNumberParticlePower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;f6&#39;</span><span class="p">));</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># This is a neuton-only transport calculation;</span>
            <span class="c"># A Q-value estimate must be made for thermal power</span>
            <span class="c">###</span>
            <span class="n">thermalPower</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">transportOutputFile</span><span class="o">.</span><span class="n">GetCellNumberQPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;qValueMethod&#39;</span><span class="p">)));</span>
        <span class="c">###</span>
        <span class="c"># If requested, add decay heat</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">includeDecayHeat</span><span class="p">:</span>
            <span class="n">thermalPower</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberDecayPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">thermalPower</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetCellNumber2Micros"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetCellNumber2Micros">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumber2Micros</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping cell to one-group microscopic cross-sections for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Micros</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetCellNumber2OrigenCalculation"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetCellNumber2OrigenCalculation">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumber2OrigenCalculation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell ORIGEN calculuation for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenCalculation</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetCellNumber2Zam2Moles"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetCellNumber2Zam2Moles">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumber2Zam2Moles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping cell to isotope to moles for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zam2Moles</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetCoolantDensityCalculations"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetCoolantDensityCalculations">[docs]</a>    <span class="k">def</span> <span class="nf">GetCoolantDensityCalculations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell coolant density calculuations for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coolantDensityCalculations</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetDefaultDecayLibrary"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetDefaultDecayLibrary">[docs]</a>    <span class="k">def</span> <span class="nf">GetDefaultDecayLibrary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN2 default decay library.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultDecayLibrary</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetDefaultPhotonLibrary"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetDefaultPhotonLibrary">[docs]</a>    <span class="k">def</span> <span class="nf">GetDefaultPhotonLibrary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN2 default photon library.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultPhotonLibrary</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetDefaultXsLibrary"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetDefaultXsLibrary">[docs]</a>    <span class="k">def</span> <span class="nf">GetDefaultXsLibrary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN2 default one-group microscopic cross-section library.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultXsLibrary</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetDepletionCalculationPickle"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetDepletionCalculationPickle">[docs]</a>    <span class="k">def</span> <span class="nf">GetDepletionCalculationPickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return depletion I/O object for entire calculation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">depletionCalculationPickle</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetDepletionStepFlux"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetDepletionStepFlux">[docs]</a>    <span class="k">def</span> <span class="nf">GetDepletionStepFlux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return system total flux for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepFluxes&#39;</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetDepletionStepPickle"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetDepletionStepPickle">[docs]</a>    <span class="k">def</span> <span class="nf">GetDepletionStepPickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return depletion I/O object for current step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep2DepletionStepPickle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">(</span><span class="n">offset</span><span class="p">)];</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetDepletionStepPower"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetDepletionStepPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetDepletionStepPower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return system total power for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetDepletionStepTimeInterval"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetDepletionStepTimeInterval">[docs]</a>    <span class="k">def</span> <span class="nf">GetDepletionStepTimeInterval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return time duration of current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetDepletionStep"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetDepletionStep">[docs]</a>    <span class="k">def</span> <span class="nf">GetDepletionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return index of current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep</span> <span class="o">+</span> <span class="n">offset</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetDepletionString"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetDepletionString">[docs]</a>    <span class="k">def</span> <span class="nf">GetDepletionString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return string for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="s">&#39;DS #{:d} of {:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">));</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetEitherUpdate"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetEitherUpdate">[docs]</a>    <span class="k">def</span> <span class="nf">GetEitherUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if coolant densities or fuel temperatures are coupled.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;updateCoolantDensities&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;updateFuelTemperatures&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetFileName"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetFileName">[docs]</a>    <span class="k">def</span> <span class="nf">GetFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">withoutTH</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return MCNP input filename for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetOriginalTransportFile</span><span class="p">()</span><span class="o">.</span><span class="n">GetNewputFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">());</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEitherUpdate</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">withoutTH</span><span class="p">:</span>
            <span class="n">fileName</span> <span class="o">+=</span> <span class="s">&#39;-{:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTransportIteration</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fileName</span> <span class="o">+=</span> <span class="s">&#39;.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extension</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">fileName</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetFuelTemperatureCalculations"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetFuelTemperatureCalculations">[docs]</a>    <span class="k">def</span> <span class="nf">GetFuelTemperatureCalculations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell fuel temperature calculuations for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuelTemperatureCalculations</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetDisplayFiles"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetDisplayFiles">[docs]</a>    <span class="k">def</span> <span class="nf">GetDisplayFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if file operations are verbose.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetArguments</span><span class="p">()</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetForceDecayTransport"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetForceDecayTransport">[docs]</a>    <span class="k">def</span> <span class="nf">GetForceDecayTransport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if transport is to be performed even when it is not needed for transmutation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;forceDecayTransport&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetIncludeDecayHeat"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetIncludeDecayHeat">[docs]</a>    <span class="k">def</span> <span class="nf">GetIncludeDecayHeat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if decay heat is to be considered.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;includeDecayHeat&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetIsDecayStep"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetIsDecayStep">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsDecayStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if current depletion step entails decay.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isPowerMode&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPower</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isPowerMode&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepFlux</span><span class="p">());</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetIsLesserMcnp"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetIsLesserMcnp">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsLesserMcnp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if MCNP version is 5.1.51 or earlier.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># This is specific to the berkelium.nuc.berkeley.edu and hopper.nersc.gov clusters (circa November, 2012)!</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">dir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;mcnpExecutablePath&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;MCNP5-1.60&#39;</span><span class="p">,</span> <span class="s">&#39;MCNP6&#39;</span><span class="p">,</span> <span class="s">&#39;MCNPX&#39;</span><span class="p">,</span> <span class="s">&#39;m1537&#39;</span><span class="p">));</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetIsOrigen2"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetIsOrigen2">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsOrigen2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if ORIGEN version is 2.2.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">executable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;origenExecutablePath&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">executable</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;o2_fast&#39;</span><span class="p">,</span> <span class="s">&#39;o2_thermal&#39;</span><span class="p">));</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetIsPickleTransmute"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetIsPickleTransmute">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsPickleTransmute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if current depletion step is to be transmuted using pickles.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isPickleTransmute</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetIsRestart"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetIsRestart">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsRestart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if current depletion step is in restart mode.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetArguments</span><span class="p">()</span><span class="o">.</span><span class="n">isRestart</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetIsVerbose"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetIsVerbose">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsVerbose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if warnings are verbose.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetArguments</span><span class="p">()</span><span class="o">.</span><span class="n">isVerbose</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetLibZams"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetLibZams">[docs]</a>    <span class="k">def</span> <span class="nf">GetLibZams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return isotopes present in a ORIGEN2 sub-library.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetLib2Zams</span><span class="p">()[</span><span class="n">lib</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetLib2Zams"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetLib2Zams">[docs]</a>    <span class="k">def</span> <span class="nf">GetLib2Zams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping ORIGEN2 sub-library to its isotopes present.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib2Zams</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetLibZamExcite"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetLibZamExcite">[docs]</a>    <span class="k">def</span> <span class="nf">GetLibZamExcite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">zam</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return excited fraction states for isotope of a ORIGEN2 sublibrary.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib2Zam2Excite</span><span class="p">[</span><span class="n">lib</span><span class="p">][</span><span class="n">zam</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetMaterialNumberZaid"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetMaterialNumberZaid">[docs]</a>    <span class="k">def</span> <span class="nf">GetMaterialNumberZaid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materialNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return isotope for a single-isotope material.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMaterialNumber2Zaid</span><span class="p">()[</span><span class="n">materialNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetMaterialNumber2Zaid"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetMaterialNumber2Zaid">[docs]</a>    <span class="k">def</span> <span class="nf">GetMaterialNumber2Zaid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping single-isotope material to isotope.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materialNumber2Zaid</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetTransmuteTallyNumber"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetTransmuteTallyNumber">[docs]</a>    <span class="k">def</span> <span class="nf">GetTransmuteTallyNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return MCNP tally number used for transmutation constants.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transmuteTallyNumber</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetOrigen2LibMts"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetOrigen2LibMts">[docs]</a>    <span class="k">def</span> <span class="nf">GetOrigen2LibMts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN2 sub-library MT #s.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetOrigen2Lib2Mts</span><span class="p">()[</span><span class="n">lib</span> <span class="o">%</span> <span class="mi">10</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetOrigen2Lib2Mts"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetOrigen2Lib2Mts">[docs]</a>    <span class="k">def</span> <span class="nf">GetOrigen2Lib2Mts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping ORIGEN2 sub-library to MT #s.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">origen2Lib2Mts</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetOriginalTransportFile"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetOriginalTransportFile">[docs]</a>    <span class="k">def</span> <span class="nf">GetOriginalTransportFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return object for initial MCNP input file.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">originalTransportFile</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetParameter"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetParameter">[docs]</a>    <span class="k">def</span> <span class="nf">GetParameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return mocdown input file parameter for a key.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">()[</span><span class="n">key</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetParameters"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetParameters">[docs]</a>    <span class="k">def</span> <span class="nf">GetParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return mocdown input file parameters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetPreviousCoolantDensityCalculations"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetPreviousCoolantDensityCalculations">[docs]</a>    <span class="k">def</span> <span class="nf">GetPreviousCoolantDensityCalculations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return previously performed coolant density calculations.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previousCoolantDensityCalculations</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetPreviousFuelTemperatureCalculations"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetPreviousFuelTemperatureCalculations">[docs]</a>    <span class="k">def</span> <span class="nf">GetPreviousFuelTemperatureCalculations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return previously performed fuel temperature calculations.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previousFuelTemperatureCalculations</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetTransportIteration"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetTransportIteration">[docs]</a>    <span class="k">def</span> <span class="nf">GetTransportIteration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return index of transport iterations.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;transportIteration&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transportIteration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transportIteration</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetXsDirZaids"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetXsDirZaids">[docs]</a>    <span class="k">def</span> <span class="nf">GetXsDirZaids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of isotopes present in MCNP xsdir.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xsDirZaids</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.GetZa2WattsPerMole"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.GetZa2WattsPerMole">[docs]</a>    <span class="k">def</span> <span class="nf">GetZa2WattsPerMole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionarty mapping isotope to its decay heat per mole.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">za2WattsPerMole</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Depletion methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.PopulateDepletionSteps"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.PopulateDepletionSteps">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateDepletionSteps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate derived depletion parameters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Populate depletion step time intervals, fluxes, and powers if the total depletion time is provided</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTime&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionFlux&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionFlux&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTime&#39;</span><span class="p">):</span>
                    <span class="c">###</span>
                    <span class="c"># Determine days -&gt; fluence conversion</span>
                    <span class="c">###</span>
                    <span class="n">days2Fluence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionFlux&#39;</span><span class="p">);</span>
                    <span class="n">fluenceLeft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTime&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">days2Fluence</span><span class="p">;</span>
                    <span class="c">###</span>
                    <span class="c"># Populate fluence steps</span>
                    <span class="c">###</span>
                    <span class="n">fluenceStep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;minimumFluenceStep&#39;</span><span class="p">);</span>
                    <span class="n">depletionStepFluences</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="k">while</span> <span class="n">fluenceLeft</span><span class="p">:</span>
                        <span class="c">###</span>
                        <span class="c"># Don&#39;t burn beyond what is left!</span>
                        <span class="c">###</span>
                        <span class="n">fluenceStep</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">fluenceStep</span><span class="p">,</span> <span class="n">fluenceLeft</span><span class="p">);</span>
                        <span class="c">###</span>
                        <span class="c"># Append fluenceStep</span>
                        <span class="c">###</span>
                        <span class="n">depletionStepFluences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fluenceStep</span><span class="p">);</span>
                        <span class="n">fluenceLeft</span> <span class="o">-=</span> <span class="n">fluenceStep</span><span class="p">;</span>
                        <span class="c">###</span>
                        <span class="c"># Double fluenceStep</span>
                        <span class="c"># Limit to maximumFluenceStep</span>
                        <span class="c">###</span>
                        <span class="n">fluenceStep</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>
                        <span class="n">fluenceStep</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">fluenceStep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;maximumFluenceStep&#39;</span><span class="p">));</span>
                    <span class="c">###</span>
                    <span class="c"># Convert fluence steps -&gt; time steps</span>
                    <span class="c">###</span>
                    <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">SafeDivide</span><span class="p">(</span><span class="n">depletionStepFluence</span><span class="p">,</span> <span class="n">days2Fluence</span><span class="p">)</span> <span class="k">for</span> <span class="n">depletionStepFluence</span> <span class="ow">in</span> <span class="n">depletionStepFluences</span><span class="p">];</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="c"># Decay step or transport-only</span>
                    <span class="c">###</span>
                    <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTime&#39;</span><span class="p">)];</span>
                <span class="c">###</span>
                <span class="c"># Repeat the power for each time step</span>
                <span class="c">###</span>
                <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepFluxes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionFlux&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTime&#39;</span><span class="p">):</span>
                    <span class="c">###</span>
                    <span class="c"># Determine days -&gt; BU conversion</span>
                    <span class="c">###</span>
                    <span class="n">days2Burnup</span> <span class="o">=</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetOriginalTransportFile</span><span class="p">()</span><span class="o">.</span><span class="n">GetHeavyMetalMT</span><span class="p">());</span>
                    <span class="n">burnupLeft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTime&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">days2Burnup</span><span class="p">;</span>
                    <span class="c">###</span>
                    <span class="c"># Populate burnup steps</span>
                    <span class="c">###</span>
                    <span class="n">burnupStep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;minimumBurnupStep&#39;</span><span class="p">);</span>
                    <span class="n">depletionStepBurnups</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="k">while</span> <span class="n">burnupLeft</span><span class="p">:</span>
                        <span class="c">###</span>
                        <span class="c"># Don&#39;t burn beyond what is left!</span>
                        <span class="c">###</span>
                        <span class="n">burnupStep</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">burnupStep</span><span class="p">,</span> <span class="n">burnupLeft</span><span class="p">);</span>
                        <span class="c">###</span>
                        <span class="c"># Append burnupStep</span>
                        <span class="c">###</span>
                        <span class="n">depletionStepBurnups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">burnupStep</span><span class="p">);</span>
                        <span class="n">burnupLeft</span> <span class="o">-=</span> <span class="n">burnupStep</span><span class="p">;</span>
                        <span class="c">###</span>
                        <span class="c"># Double burnupStep;</span>
                        <span class="c"># Limit it to maximumBurnupStep</span>
                        <span class="c">###</span>
                        <span class="n">burnupStep</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>
                        <span class="n">burnupStep</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">burnupStep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;maximumBurnupStep&#39;</span><span class="p">));</span>
                    <span class="c">###</span>
                    <span class="c"># Convert burnup steps -&gt; time steps</span>
                    <span class="c">###</span>
                    <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">SafeDivide</span><span class="p">(</span><span class="n">depletionStepBurnup</span><span class="p">,</span> <span class="n">days2Burnup</span><span class="p">)</span> <span class="k">for</span> <span class="n">depletionStepBurnup</span> <span class="ow">in</span> <span class="n">depletionStepBurnups</span><span class="p">];</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="c"># Decay step or transport-only</span>
                    <span class="c">###</span>
                    <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTime&#39;</span><span class="p">)];</span>
                <span class="c">###</span>
                <span class="c"># Repeat the power for each time step</span>
                <span class="c">###</span>
                <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Erase depletion time;</span>
            <span class="c"># For iteration purposes, this can be modified and the depletion steps will be regenerated</span>
            <span class="c">###</span>
            <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Maybe append decay step</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTerminalDecayTime&#39;</span><span class="p">)):</span>
                <span class="c">###</span>
                <span class="c"># Decay time</span>
                <span class="c">###</span>
                <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTerminalDecayTime&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">daysPerYear</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="c"># Power or flux</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isPowerMode&#39;</span><span class="p">):</span>
                    <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepFluxes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Calculate depletion step time ends</span>
        <span class="c">###</span>
        <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepTimeEnds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">)[</span> <span class="p">:</span> <span class="n">index</span><span class="p">])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)];</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.Deplete"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.Deplete">[docs]</a>    <span class="k">def</span> <span class="nf">Deplete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Execute MocDown depletion.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; {} will perform {} depletion step(s)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__file__</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)));</span>
        <span class="c">###</span>
        <span class="c"># Prepare depletion</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrepareDepletion</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Iterate over depletion steps</span>
        <span class="c">###</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Try to unpickle depletion step</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TryUnpickle</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># If this is a restart step, unpickle files and skip</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsRestart</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; This is a restart step ... skipping {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionString</span><span class="p">()));</span>
                <span class="n">depletionStepPickle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">();</span>
                <span class="c">###</span>
                <span class="c"># Maybe write the unpickled transport input</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetTransportInputRaw</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">WriteFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">withoutTH</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetTransportInputRaw</span><span class="p">(),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
                <span class="c">###</span>
                <span class="c"># Maybe write the unpickled transport output</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;o&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetTransportOutputRaw</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">WriteFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">withoutTH</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetTransportOutputRaw</span><span class="p">(),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
                <span class="c">###</span>
                <span class="c"># Grab the pickle&#39;d ORIGEN calculations and decay powers</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenCalculation</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberOrigenCalculation</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">()};</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep2CellNumber2DecayPower</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumber2NextDecayPower</span><span class="p">();</span>
                <span class="c">###</span>
                <span class="c"># Increment depletion step</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IncrementDepletionStep</span><span class="p">();</span>
                <span class="c">###</span>
                <span class="c"># Kick out of depletion step</span>
                <span class="c">###</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Transport calculation with possible iterations on densities or temperatures</span>
            <span class="c">###</span>
            <span class="n">transportFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TransportConvergence</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># Transmute calculation</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TransmuteThreads</span><span class="p">(</span><span class="n">transportFile</span><span class="p">,</span> <span class="n">GetCurrentWorkingDirectory</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Pickle depletion object after every depletion step for restarts, recycles, and plotting</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PickleDepletionStep</span><span class="p">(</span><span class="n">transportFile</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Increment depletion step</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IncrementDepletionStep</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Prepare end-of-depletion transport input</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrepareTransport</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Pickle depletion object -- post-transmute, but pre-transport</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickleDepletionStep</span><span class="p">(</span><span class="n">McnpInputFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">withoutTH</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))));</span>
        <span class="c">###</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; {} has completed all {} depletion step(s)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__file__</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)));</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.PrepareDepletion"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.PrepareDepletion">[docs]</a>    <span class="k">def</span> <span class="nf">PrepareDepletion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate default depletion parameters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Set depletion step</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Set coolant density / fuel temperature calculations</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coolantDensityCalculations</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previousCoolantDensityCalculations</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuelTemperatureCalculations</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previousFuelTemperatureCalculations</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="c">###</span>
        <span class="c"># Set DS -&gt; pickle</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep2DepletionStepPickle</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="c">###</span>
        <span class="c"># Define MT #&#39;s for each ORIGEN library group (1 = Activation products, 2 = Actinides, and 3 = Fission Products)</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origen2Lib2Mts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">1</span> <span class="p">:</span> <span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">103</span><span class="p">),</span>
            <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span>
            <span class="mi">3</span> <span class="p">:</span> <span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">103</span><span class="p">),</span>
        <span class="p">};</span>
        <span class="c">###</span>
        <span class="c"># Read default decay, photon, and cross-section libraries</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">defaultLibrary</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;defaultDecayLibrary&#39;</span><span class="p">,</span> <span class="s">&#39;defaultPhotonLibrary&#39;</span><span class="p">,</span> <span class="s">&#39;defaultXsLibrary&#39;</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defaultLibrary</span><span class="p">,</span> <span class="n">ReadFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;origenLibraryPathTemplate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="n">defaultLibrary</span><span class="p">)),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">()));</span>
        <span class="c">###</span>
        <span class="c"># Maybe populate molar decay heat conversions</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">za2WattsPerMole</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIncludeDecayHeat</span><span class="p">():</span>
            <span class="n">iuConversion</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;1&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s">&#39;2&#39;</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span>
                <span class="s">&#39;3&#39;</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span>
                <span class="s">&#39;4&#39;</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span>
                <span class="s">&#39;5&#39;</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">/</span> <span class="n">daysPerYear</span><span class="p">,</span>
                <span class="s">&#39;6&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s">&#39;7&#39;</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">/</span> <span class="n">daysPerYear</span> <span class="o">/</span> <span class="mf">1e3</span><span class="p">,</span>
                <span class="s">&#39;8&#39;</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">/</span> <span class="n">daysPerYear</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span>
                <span class="s">&#39;9&#39;</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">/</span> <span class="n">daysPerYear</span> <span class="o">/</span> <span class="mf">1e9</span><span class="p">,</span>
            <span class="p">};</span>
            <span class="n">logOfTwo</span> <span class="o">=</span> <span class="n">NaturalLogarithm</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^ *\d {2,3}([\d]{5,7}) +(\d) +([\d\.e+\- ]{9}).+\n[\d ]{20}([\d\.e+\- ]{9} ){3}&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDefaultDecayLibrary</span><span class="p">()):</span>
                <span class="n">zam</span><span class="p">,</span> <span class="n">iu</span><span class="p">,</span> <span class="n">thalf</span><span class="p">,</span> <span class="n">qrec</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">();</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">za2WattsPerMole</span><span class="p">[</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">Zam2Zaid</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">zam</span><span class="p">)),</span> <span class="s">&#39;&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="n">logOfTwo</span> <span class="o">*</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="n">iuConversion</span><span class="p">[</span><span class="n">iu</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">thalf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)))</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">qrec</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span> <span class="o">*</span> <span class="n">joulePerMev</span> <span class="o">*</span> <span class="p">(</span><span class="n">avogadrosNumber</span> <span class="o">*</span> <span class="mf">1e24</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Initiate cell # -&gt; decay powers (delayed β&#39;s and γ&#39;s);</span>
        <span class="c"># Assume that only burn cells have appreciable decay heat</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep2CellNumber2DecayPower</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetOriginalTransportFile</span><span class="p">()</span><span class="o">.</span><span class="n">GetCellNumberDecayPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZa2WattsPerMole</span><span class="p">())</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">()}};</span>
        <span class="c">###</span>
        <span class="c"># Populate cross-section library metastable fractions</span>
        <span class="c">###</span>
        <span class="k">def</span> <span class="nf">HelperExcited</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
        <span class="c">###</span>
        <span class="n">libs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lib</span><span class="p">))</span> <span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^ *(\d{1,3}) +&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDefaultXsLibrary</span><span class="p">()));</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib2Zams</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib2Zam2Excite</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="n">libs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lib2Zams</span><span class="p">[</span><span class="n">lib</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lib2Zam2Excite</span><span class="p">[</span><span class="n">lib</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^ *{} +(\d{{5,7}}) +([\d\.e+\-]+) +([\d\.e+\-]+) +[\d\.e+\-]+ +[\d\.e+\-]+ +([\d\.e+\-]+) +([\d\.e+\-]+) + [\d\.e+\-]+ *$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lib</span><span class="p">),</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDefaultXsLibrary</span><span class="p">()):</span>
                <span class="n">zam</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lib2Zams</span><span class="p">[</span><span class="n">lib</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zam</span><span class="p">);</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lib2Zam2Excite</span><span class="p">[</span><span class="n">lib</span><span class="p">][</span><span class="n">zam</span><span class="p">]</span> <span class="o">=</span> <span class="n">HelperExcited</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">]));</span>
        <span class="c">###</span>
        <span class="c"># Populate xsdir cross-section zaids</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xsDirZaids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;\d{4,6}\.\d{2}c&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">xsDir</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Maybe remove transport and trasmute log files</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsRestart</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">logFileName</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;transport.log&#39;</span><span class="p">,</span> <span class="s">&#39;transmute.log&#39;</span><span class="p">):</span>
                <span class="n">RemoveFile</span><span class="p">(</span><span class="n">logFileName</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># Set transmutation results to None</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenCalculation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zam2Moles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Micros</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Set transmutation constant tally number</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transmuteTallyNumber</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.TryUnpickle"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.TryUnpickle">[docs]</a>    <span class="k">def</span> <span class="nf">TryUnpickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Attempt to read a pickle file for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># If a restart is requested, attempt to load the depletion step pickle;</span>
        <span class="c"># If the pickle doesn&#39;t exist, fail to as if the restart was not requested (for that depletion step)</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep2DepletionStepPickle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsRestart</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">():</span>
            <span class="c">###</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="s">&#39;pkl&#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;compressPickles&#39;</span><span class="p">):</span>
                <span class="n">extension</span> <span class="o">+=</span> <span class="s">&#39;.gz&#39;</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">Exists</span><span class="p">(</span><span class="s">&#39;{}.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="n">withoutTH</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span> <span class="n">extension</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep2DepletionStepPickle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UnpickleDepletionStep</span><span class="p">();</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">()</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">():</span>
                    <span class="ne">Warning</span><span class="p">(</span><span class="s">&#39;{} input parameters do not match that of the pickle&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__file__</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.TransportConvergence"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.TransportConvergence">[docs]</a>    <span class="k">def</span> <span class="nf">TransportConvergence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Iterate transport calculations until convergence for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">transportFile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Archive the most relevant coolant density calculation:</span>
        <span class="c"># First, for restarts, during the first non-pickle step (before any have been performed), unpickle the most recent one;</span>
        <span class="c"># Second, for recycles, during transmute-only cycles (when none are performed), unpickle the current one</span>
        <span class="c"># Third, if any have been performed, archive the most recent one;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsRestart</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">GetCoolantDensityCalculations</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previousCoolantDensityCalculations</span> <span class="o">=</span> <span class="p">[</span><span class="n">coolantDensityCalculation</span> <span class="k">for</span> <span class="n">coolantDensityCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">GetCoolantDensityCalculations</span><span class="p">()</span> <span class="k">if</span> <span class="n">coolantDensityCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetCoolantDensityCalculations</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previousCoolantDensityCalculations</span> <span class="o">=</span> <span class="p">[</span><span class="n">coolantDensityCalculation</span> <span class="k">for</span> <span class="n">coolantDensityCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetCoolantDensityCalculations</span><span class="p">()</span> <span class="k">if</span> <span class="n">coolantDensityCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCoolantDensityCalculations</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previousCoolantDensityCalculations</span> <span class="o">=</span> <span class="p">[</span><span class="n">coolantDensityCalculation</span> <span class="k">for</span> <span class="n">coolantDensityCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCoolantDensityCalculations</span><span class="p">()</span> <span class="k">if</span> <span class="n">coolantDensityCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coolantDensityCalculations</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="c">###</span>
        <span class="c"># Archive the most relevant fuel temperature calculation:</span>
        <span class="c"># First, for restarts, during the first non-pickle step (before any have been performed), unpickle the most recent one;</span>
        <span class="c"># Second, for recycles, during transmute-only cycles (when none are performed), unpickle the current one</span>
        <span class="c"># Third, if any have been performed, archive the most recent one;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsRestart</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">GetFuelTemperatureCalculations</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previousFuelTemperatureCalculations</span> <span class="o">=</span> <span class="p">[</span><span class="n">fuelTemperatureCalculation</span> <span class="k">for</span> <span class="n">fuelTemperatureCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">GetFuelTemperatureCalculations</span><span class="p">()</span> <span class="k">if</span> <span class="n">fuelTemperatureCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetFuelTemperatureCalculations</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previousFuelTemperatureCalculations</span> <span class="o">=</span> <span class="p">[</span><span class="n">fuelTemperatureCalculation</span> <span class="k">for</span> <span class="n">fuelTemperatureCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetFuelTemperatureCalculations</span><span class="p">()</span> <span class="k">if</span> <span class="n">fuelTemperatureCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFuelTemperatureCalculations</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previousFuelTemperatureCalculations</span> <span class="o">=</span> <span class="p">[</span><span class="n">fuelTemperatureCalculation</span> <span class="k">for</span> <span class="n">fuelTemperatureCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFuelTemperatureCalculations</span><span class="p">()</span> <span class="k">if</span> <span class="n">fuelTemperatureCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuelTemperatureCalculations</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="c">###</span>
        <span class="c"># Fixed-point iteration, rotating between transport, coolant density updates, and fuel temperature updates;</span>
        <span class="c"># Convergence is signified by transportFile&#39;s input file not having a newputRaw</span>
        <span class="c">###</span>
        <span class="k">while</span> <span class="n">transportFile</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetIsUpdated</span><span class="p">():</span>
            <span class="c">###</span>
            <span class="c"># Write transport input with necessary tallies</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PrepareTransport</span><span class="p">(</span><span class="n">transportFile</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Run tranport calculation;</span>
            <span class="c"># Parse results</span>
            <span class="c">###</span>
            <span class="n">transportFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Transport</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># Clean up files</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CleanUpFiles</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># Maybe update material densities;</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coolantDensityCalculations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UpdateCoolantDensitys</span><span class="p">(</span><span class="n">transportFile</span><span class="p">));</span>
            <span class="c">###</span>
            <span class="c"># Maybe update material temperatures</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fuelTemperatureCalculations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UpdateFuelTemperatures</span><span class="p">(</span><span class="n">transportFile</span><span class="p">));</span>
            <span class="c">###</span>
            <span class="c"># Increment transport iteration</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IncrementTransportIteration</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Transport iterations are complete!</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ResetTransportIteration</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">transportFile</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.PrepareTransport"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.PrepareTransport">[docs]</a>    <span class="k">def</span> <span class="nf">PrepareTransport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transportFile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write MCNP input file for current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Writing MCNP input for {}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionString</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;; transport iteration #{:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTransportIteration</span><span class="p">())][</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTransportIteration</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]));</span>
        <span class="c">###</span>
        <span class="c"># If this is the first transport iteration, then grab the original transport input file;</span>
        <span class="c"># Otherwise, the correct tallies and burned cell densities</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTransportIteration</span><span class="p">():</span>
            <span class="n">transportFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetOriginalTransportFile</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># We want a clean input file to work with</span>
            <span class="c">###</span>
            <span class="n">transportFile</span><span class="o">.</span><span class="n">ResetNewput</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># Determine zaids;</span>
            <span class="c"># Maybe replace burned cells and materials</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumber2OrigenCalculation</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># This is the first depletion step</span>
                <span class="c">###</span>
                <span class="n">zaids</span> <span class="o">=</span> <span class="p">{</span><span class="n">zaid</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">()</span> <span class="k">for</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">FindCellMaterial</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetZaids</span><span class="p">()};</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumber2OrigenCalculation</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># This is the nth depletion step</span>
                <span class="c">###</span>
                <span class="n">zaids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">();</span>
                <span class="k">for</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">origenCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumber2OrigenCalculation</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c">###</span>
                    <span class="c"># Kick out insignificant zaids and zaids without xsdir entries</span>
                    <span class="c">###</span>
                    <span class="n">minimumIsotopeCutoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;minimumIsotopeCutoff&#39;</span><span class="p">);</span>
                    <span class="n">zaid2AbsorptionFraction</span> <span class="o">=</span> <span class="p">{</span><span class="n">zaid</span> <span class="p">:</span> <span class="n">absorptionFraction</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">absorptionFraction</span> <span class="ow">in</span> <span class="n">origenCalculation</span><span class="o">.</span><span class="n">GetZaid2AbsorptionFraction</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">absorptionFraction</span> <span class="o">&gt;</span> <span class="n">minimumIsotopeCutoff</span> <span class="k">if</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetXsDirZaids</span><span class="p">()};</span>
                    <span class="n">zaid2AtomFraction</span> <span class="o">=</span> <span class="p">{</span><span class="n">zaid</span> <span class="p">:</span> <span class="n">atomFraction</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">atomFraction</span> <span class="ow">in</span> <span class="n">origenCalculation</span><span class="o">.</span><span class="n">GetZaid2AtomFraction</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">atomFraction</span> <span class="o">&gt;</span> <span class="n">minimumIsotopeCutoff</span> <span class="k">if</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetXsDirZaids</span><span class="p">()};</span>
                    <span class="n">zaid2FissionFraction</span> <span class="o">=</span> <span class="p">{</span><span class="n">zaid</span> <span class="p">:</span> <span class="n">fissionFraction</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">fissionFraction</span> <span class="ow">in</span> <span class="n">origenCalculation</span><span class="o">.</span><span class="n">GetZaid2FissionFraction</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">fissionFraction</span> <span class="o">&gt;</span> <span class="n">minimumIsotopeCutoff</span> <span class="k">if</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetXsDirZaids</span><span class="p">()};</span>
                    <span class="n">zaid2WeightFraction</span> <span class="o">=</span> <span class="p">{</span><span class="n">zaid</span> <span class="p">:</span> <span class="n">weightFraction</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">weightFraction</span> <span class="ow">in</span> <span class="n">origenCalculation</span><span class="o">.</span><span class="n">GetZaid2WeightFraction</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">weightFraction</span> <span class="o">&gt;</span> <span class="n">minimumIsotopeCutoff</span> <span class="k">if</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetXsDirZaids</span><span class="p">()};</span>
                    <span class="c">###</span>
                    <span class="c"># Take the union of absorption-, atom-, fission-, and weight-fraction-sufficient zaids</span>
                    <span class="c">###</span>
                    <span class="k">for</span> <span class="n">zaid2Fraction</span> <span class="ow">in</span> <span class="p">(</span><span class="n">zaid2AbsorptionFraction</span><span class="p">,</span> <span class="n">zaid2FissionFraction</span><span class="p">,</span> <span class="n">zaid2WeightFraction</span><span class="p">):</span>
                        <span class="n">zaid2AtomFraction</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">zaid</span> <span class="p">:</span> <span class="n">origenCalculation</span><span class="o">.</span><span class="n">GetZaid2AtomFraction</span><span class="p">()[</span><span class="n">zaid</span><span class="p">]</span> <span class="k">for</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">zaid2Fraction</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">zaid2AtomFraction</span><span class="p">)});</span>
                    <span class="c">###</span>
                    <span class="c"># Update zaids set</span>
                    <span class="c">###</span>
                    <span class="n">zaids</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">zaid2AtomFraction</span><span class="p">);</span>
                    <span class="c">###</span>
                    <span class="c"># Replace original cell with burned cell</span>
                    <span class="c">###</span>
                    <span class="n">cell</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
                    <span class="n">cellCard</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMaterialDensityRegex</span><span class="p">()</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;{:+10.7f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origenCalculation</span><span class="o">.</span><span class="n">GetNumberDensity</span><span class="p">()),</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">());</span>
                    <span class="n">transportFile</span><span class="o">.</span><span class="n">ReplaceNewputCard</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">cellCard</span><span class="p">);</span>
                    <span class="c">###</span>
                    <span class="c"># Replace original material with burned material</span>
                    <span class="c">###</span>
                    <span class="n">material</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">FindCellMaterial</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
                    <span class="n">materialCard</span> <span class="o">=</span> <span class="n">WordArrange</span><span class="p">(</span><span class="n">words</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;{:&gt;10} {:+.5E}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zaid</span><span class="p">,</span> <span class="n">atomFraction</span><span class="p">)</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">atomFraction</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">zaid2AtomFraction</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)),</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">m{:&lt;6d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">material</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()),</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">8</span><span class="p">);</span>
                    <span class="n">transportFile</span><span class="o">.</span><span class="n">ReplaceNewputCard</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="n">materialCard</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># If this is not the last depletion step, attach single-zaid materials and tallys</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># Determine existing (and therefore unavailable) material and tally numbers</span>
                <span class="c">###</span>
                <span class="n">unavailable</span> <span class="o">=</span> <span class="p">{</span><span class="n">mnemonic</span> <span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">mnemonic</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;f1&#39;</span><span class="p">,</span> <span class="s">&#39;f2&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;fm4&#39;</span><span class="p">,</span> <span class="s">&#39;f5&#39;</span><span class="p">,</span> <span class="s">&#39;f6&#39;</span><span class="p">,</span> <span class="s">&#39;f7&#39;</span><span class="p">,</span> <span class="s">&#39;f8&#39;</span><span class="p">)};</span>
                <span class="n">unavailable</span><span class="p">[</span><span class="s">&#39;m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">material</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()</span> <span class="k">for</span> <span class="n">material</span> <span class="ow">in</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetMaterials</span><span class="p">()};</span>
                <span class="n">unavailable</span><span class="p">[</span><span class="s">&#39;m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="p">));</span>
                <span class="c">###</span>
                <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">():</span>
                    <span class="n">tallyNumber</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">();</span>
                    <span class="n">unavailable</span><span class="p">[</span><span class="s">&#39;f{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tallyNumber</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)]</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">tallyNumber</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="p">));</span>
                <span class="c">###</span>
                <span class="n">mnemonic2NewLines</span> <span class="o">=</span> <span class="p">{};</span>
                <span class="c">###</span>
                <span class="c"># Single-za materials;</span>
                <span class="c"># Find unique material number for each zaid;</span>
                <span class="c"># Material numbers limits in MCNP5-1.51 are 5-digits; those of later versions are 8-digits</span>
                <span class="c">###</span>
                <span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">;</span>
                <span class="n">numberOfDigits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">GetIsLesserMcnp</span><span class="p">()];</span>
                <span class="n">zaid2MaterialNumber</span> <span class="o">=</span> <span class="p">{};</span>
                <span class="c">###</span>
                <span class="k">for</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="n">zaids</span><span class="p">:</span>
                    <span class="n">za</span> <span class="o">=</span> <span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">);</span>
                    <span class="k">if</span> <span class="n">za</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unavailable</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span> <span class="ow">and</span> <span class="n">NaturalLogarithm</span><span class="p">(</span><span class="n">za</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">NaturalLogarithm</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">numberOfDigits</span><span class="p">:</span>
                        <span class="n">materialNumber</span> <span class="o">=</span> <span class="n">za</span><span class="p">;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">materialNumber</span> <span class="o">=</span> <span class="n">UniqueDigits</span><span class="p">(</span><span class="n">numberOfDigits</span><span class="p">,</span> <span class="n">unavailable</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]);</span>
                    <span class="c">###</span>
                    <span class="n">unavailable</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">materialNumber</span><span class="p">,</span> <span class="p">));</span>
                    <span class="c">###</span>
                    <span class="n">zaid2MaterialNumber</span><span class="p">[</span><span class="n">zaid</span><span class="p">]</span> <span class="o">=</span> <span class="n">materialNumber</span><span class="p">;</span>
                <span class="n">mnemonic2NewLines</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;m{:&lt;6} {:&gt;10} +1.0&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">materialNumber</span><span class="p">,</span> <span class="n">zaid</span><span class="p">)</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">materialNumber</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">zaid2MaterialNumber</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">NumericStringKey</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])));</span>
                <span class="c">###</span>
                <span class="c"># Invert and attach zaid -&gt; material #</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">materialNumber2Zaid</span> <span class="o">=</span> <span class="p">{</span><span class="n">materialNumber</span> <span class="p">:</span> <span class="n">zaid</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">materialNumber</span> <span class="ow">in</span> <span class="n">zaid2MaterialNumber</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
                <span class="c">###</span>
                <span class="c"># Burn cell flux and reaction rate tallies;</span>
                <span class="c"># Find unique tally number</span>
                <span class="c"># Tally numbers limits in MCNP5-1.51 are 3-digits; those of later versions are 4-digits</span>
                <span class="c">###</span>
                <span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;f4&#39;</span><span class="p">;</span>
                <span class="n">numberOfDigits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">GetIsLesserMcnp</span><span class="p">()];</span>
                <span class="k">for</span> <span class="n">tallyNumber</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">tallyNumber</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unavailable</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]:</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="n">tallyNumber</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
                <span class="k">if</span> <span class="n">tallyNumber</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">tallyNumber</span> <span class="o">=</span> <span class="n">UniqueDigits</span><span class="p">(</span><span class="n">numberOfDigits</span><span class="p">,</span> <span class="n">unavailable</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]);</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transmuteTallyNumber</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">tallyNumber</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="n">unavailable</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">tallyNumber</span><span class="p">,</span> <span class="p">));</span>
                <span class="c">###</span>
                <span class="c"># Tally cards</span>
                <span class="c">###</span>
                <span class="n">mnemonic2NewLines</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">WordArrange</span><span class="p">(</span><span class="n">words</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">()),</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;f{}:n&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">tallyNumber</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))))];</span>
                <span class="c">###</span>
                <span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;fm4&#39;</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="k">def</span> <span class="nf">Zaid2Mts</span><span class="p">(</span><span class="n">zaid</span><span class="p">):</span>
                    <span class="n">zam</span> <span class="o">=</span> <span class="n">Zaid2Zam</span><span class="p">(</span><span class="n">zaid</span><span class="p">);</span>
                    <span class="n">mts</span> <span class="o">=</span> <span class="p">{</span><span class="n">mt</span> <span class="k">for</span> <span class="n">lib</span><span class="p">,</span> <span class="n">zams</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetLib2Zams</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">zam</span> <span class="ow">in</span> <span class="n">zams</span> <span class="k">for</span> <span class="n">mt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetOrigen2LibMts</span><span class="p">(</span><span class="n">lib</span><span class="p">)};</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="n">mts</span><span class="p">:</span>
                        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mts</span><span class="p">);</span>
                    <span class="c">###</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetOrigen2LibMts</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;(1)&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;(1 {} ({}))&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">materialNumber</span><span class="p">,</span> <span class="s">&#39;) (&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reactionNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">reactionNumber</span> <span class="ow">in</span> <span class="n">Zaid2Mts</span><span class="p">(</span><span class="n">zaid</span><span class="p">)))</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">materialNumber</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">zaid2MaterialNumber</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">NumericStringKey</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]))];</span>
                <span class="n">mnemonic2NewLines</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">WordArrange</span><span class="p">(</span><span class="n">words</span> <span class="o">=</span> <span class="n">bins</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;fm{}:n&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">tallyNumber</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))))];</span>
                <span class="c">###</span>
                <span class="c"># Thermal power tallies;</span>
                <span class="c"># Only include them when coupled neutron/photon transport is performed</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetIsCoupled</span><span class="p">():</span>
                    <span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;f6&#39;</span><span class="p">;</span>
                    <span class="n">mnemonic2NewLines</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">WordArrange</span><span class="p">(</span><span class="n">words</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">(),</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;f{}:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">tallyNumber</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetMode</span><span class="p">()))];</span>
                <span class="c">###</span>
                <span class="c"># Append new lines to input raw</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="n">mnemonic2NewLines</span><span class="p">:</span>
                    <span class="n">transportFile</span><span class="o">.</span><span class="n">AppendNewputCard</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">newLines</span><span class="p">)</span> <span class="k">for</span> <span class="n">mnemonic</span><span class="p">,</span> <span class="n">newLines</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mnemonic2NewLines</span><span class="o">.</span><span class="n">items</span><span class="p">())));</span>
        <span class="c">###</span>
        <span class="c"># Grab the most relevant coolant density calculation</span>
        <span class="c">###</span>
        <span class="n">coolantDensityCalculation</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetPreviousCoolantDensityCalculations</span><span class="p">()):</span>
            <span class="n">coolantDensityCalculation</span> <span class="o">=</span> <span class="p">[</span><span class="n">coolantDensityCalculation</span> <span class="k">for</span> <span class="n">coolantDensityCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPreviousCoolantDensityCalculations</span><span class="p">()</span> <span class="k">if</span> <span class="n">coolantDensityCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCoolantDensityCalculations</span><span class="p">()):</span>
            <span class="n">coolantDensityCalculation</span> <span class="o">=</span> <span class="p">[</span><span class="n">coolantDensityCalculation</span> <span class="k">for</span> <span class="n">coolantDensityCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCoolantDensityCalculations</span><span class="p">()</span> <span class="k">if</span> <span class="n">coolantDensityCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># If a coolant density update exist, implement it</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">coolantDensityCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Iterate over assemblies</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">assemblyCalculation</span> <span class="ow">in</span> <span class="n">coolantDensityCalculation</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="c">###</span>
                <span class="c"># Iterate over coolant cells</span>
                <span class="c">###</span>
                <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">assemblyCalculation</span><span class="o">.</span><span class="n">GetUpdateCellNumbers</span><span class="p">():</span>
                    <span class="c">###</span>
                    <span class="c"># Replace original cell with transport-updated cell</span>
                    <span class="c">###</span>
                    <span class="n">cell</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
                    <span class="n">cellCard</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMaterialDensityRegex</span><span class="p">()</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;{:+10.7f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">assemblyCalculation</span><span class="o">.</span><span class="n">GetCellNumberMassDensity</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">))),</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">());</span>
                    <span class="n">transportFile</span><span class="o">.</span><span class="n">ReplaceNewputCard</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">cellCard</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Grab the most relevant coolant density calculation</span>
        <span class="c">###</span>
        <span class="n">fuelTemperatureCalculation</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetPreviousFuelTemperatureCalculations</span><span class="p">()):</span>
            <span class="n">fuelTemperatureCalculation</span> <span class="o">=</span> <span class="p">[</span><span class="n">fuelTemperatureCalculation</span> <span class="k">for</span> <span class="n">fuelTemperatureCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPreviousFuelTemperatureCalculations</span><span class="p">()</span> <span class="k">if</span> <span class="n">fuelTemperatureCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFuelTemperatureCalculations</span><span class="p">()):</span>
            <span class="n">fuelTemperatureCalculation</span> <span class="o">=</span> <span class="p">[</span><span class="n">fuelTemperatureCalculation</span> <span class="k">for</span> <span class="n">fuelTemperatureCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFuelTemperatureCalculations</span><span class="p">()</span> <span class="k">if</span> <span class="n">fuelTemperatureCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># If a fuel temperature update exist, implement it</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">fuelTemperatureCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># FIXME Implement this</span>
            <span class="k">pass</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Write new input</span>
        <span class="c">###</span>
        <span class="n">WriteFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">withoutTH</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))),</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetNewputRaw</span><span class="p">(),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.Transport"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.Transport">[docs]</a>    <span class="k">def</span> <span class="nf">Transport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Execute transport.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Ensure necessary files do/don&#39;t exist</span>
        <span class="c">###</span>
        <span class="n">AssertFileExists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">));</span>
        <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="s">&#39;tpe&#39;</span><span class="p">):</span>
            <span class="n">RemoveFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="n">extension</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># Maybe copy MCNP source to .src</span>
        <span class="c">###</span>
        <span class="n">sourceFileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;mcnpSourceFileName&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="n">Exists</span><span class="p">(</span><span class="n">sourceFileName</span><span class="p">):</span>
            <span class="n">CopyFile</span><span class="p">(</span><span class="n">sourceFileName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;src&#39;</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsDecayStep</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">():</span>
            <span class="c">###</span>
            <span class="c"># Transport is not requested;</span>
            <span class="c"># Return the input file</span>
            <span class="c">###</span>
            <span class="k">return</span> <span class="n">McnpInputFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">));</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">SystemCall</span><span class="p">(</span><span class="s">&#39;tar -xvf {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;tar&#39;</span><span class="p">)));</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Executing MCNP for {}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionString</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;; transport iteration #{:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTransportIteration</span><span class="p">())][</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTransportIteration</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]));</span>
                <span class="c">###</span>
                <span class="c"># Transport is requested;</span>
                <span class="c"># Execute MCNP</span>
                <span class="c">###</span>
                <span class="n">SystemCall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;mcnpRunCommand&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">executable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;mcnpExecutablePath&#39;</span><span class="p">),</span> <span class="n">baseName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(),</span> <span class="n">xsdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;mcnpXsdirPath&#39;</span><span class="p">)));</span>
            <span class="c">###</span>
            <span class="c"># Parse transport output file</span>
            <span class="c">###</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Parsing MCNP output for {}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionString</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;; transport iteration #{:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTransportIteration</span><span class="p">())][</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTransportIteration</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]));</span>
            <span class="c">###</span>
            <span class="n">transportOutputFile</span> <span class="o">=</span> <span class="n">McnpOutputFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;o&#39;</span><span class="p">));</span>
            <span class="c">###</span>
            <span class="c"># Populate transport source rate</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isPowerMode&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># Pth = Pd + Tth * S -&gt; S = (Pth - Pd) / Tth</span>
                <span class="c">###</span>
                <span class="n">totalThermalPower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnRate</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">;</span>
                <span class="n">delayedThermalPower</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberDecayPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">());</span>
                <span class="n">promptThermalPower</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberThermalPower</span><span class="p">(</span><span class="n">transportOutputFile</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">includeDecayHeat</span> <span class="o">=</span> <span class="bp">False</span><span class="p">))</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">());</span>
                <span class="c">###</span>
                <span class="n">sourceRate</span> <span class="o">=</span> <span class="p">(</span><span class="n">totalThermalPower</span> <span class="o">-</span> <span class="n">delayedThermalPower</span><span class="p">)</span> <span class="o">/</span> <span class="n">promptThermalPower</span><span class="p">;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trackLengthVolumes</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberTrackLengthVolume</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallyIndices</span><span class="p">(</span><span class="s">&#39;f4&#39;</span><span class="p">)}</span><span class="o">.</span><span class="n">values</span><span class="p">());</span>
                <span class="c">###</span>
                <span class="n">sourceRate</span> <span class="o">=</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="n">SafeDivide</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">trackLengthVolume</span><span class="p">))</span> <span class="k">for</span> <span class="n">trackLengthVolume</span> <span class="ow">in</span> <span class="n">trackLengthVolumes</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnRate</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">PopulateSourceRate</span><span class="p">(</span><span class="n">sourceRate</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Maybe print transport output report</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsVerbose</span><span class="p">():</span>
                <span class="n">PrintNow</span><span class="p">(</span><span class="n">transportOutputFile</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="k">return</span> <span class="n">transportOutputFile</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.UpdateCoolantDensitys"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.UpdateCoolantDensitys">[docs]</a>    <span class="k">def</span> <span class="nf">UpdateCoolantDensitys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transportOutputFile</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Dummy coolant density calculation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Kick out if density updates are not requested</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;updateCoolantDensities&#39;</span><span class="p">):</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Kick out if decay step or transmute-only</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsDecayStep</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">():</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.UpdateFuelTemperatures"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.UpdateFuelTemperatures">[docs]</a>    <span class="k">def</span> <span class="nf">UpdateFuelTemperatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transportOutputFile</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Dummy fuel temperature calculation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Kick out if temperatures updates are not requested</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;updateFuelTemperatures&#39;</span><span class="p">):</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Kick out if decay step or transmute-only</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsDecayStep</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">():</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.IncrementTransportIteration"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.IncrementTransportIteration">[docs]</a>    <span class="k">def</span> <span class="nf">IncrementTransportIteration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Increment index of transport iterations.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transportIteration</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.ResetTransportIteration"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.ResetTransportIteration">[docs]</a>    <span class="k">def</span> <span class="nf">ResetTransportIteration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reset index of transport iterations.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEitherUpdate</span><span class="p">():</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Transport converged after {:d} iterations {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTransportIteration</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionString</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="c"># Link base file names to final iterations</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transportIteration</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">SymbolicLink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">withoutTH</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="c"># Transport is not performed for decay steps or pickle transmute</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsDecayStep</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">():</span>
                <span class="n">SymbolicLink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;o&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">withoutTH</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># Reset transport iteration number</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transportIteration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.TransmuteThreads"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.TransmuteThreads">[docs]</a>    <span class="k">def</span> <span class="nf">TransmuteThreads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transportOutputFile</span><span class="p">,</span> <span class="n">currentDir</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Execute transmute concurrently for each cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Kick out, if this is a transport-only simulation</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepTimeInterval</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Null the cell # -&gt; burnRate, micros, zam2Moles</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2BurnRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zam2Moles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Micros</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">()};</span>
            <span class="c">###</span>
            <span class="c"># Populate decay heat (delayed β&#39;s and γ&#39;s)</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep2CellNumber2DecayPower</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep2CellNumber2DecayPower</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">0</span><span class="p">)];</span>
            <span class="c">###</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Executing {:d} concurrent ORIGEN thread(s) for {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;numberOfOrigenThreads&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionString</span><span class="p">()));</span>
        <span class="c">###</span>
        <span class="c"># Multiple concurrent ORIGEN threads for each burn cell</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2BurnRate</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="c">###</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">threads</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">());</span>
        <span class="k">with</span> <span class="n">Futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;numberOfOrigenThreads&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">future2CellNumber</span> <span class="o">=</span> <span class="p">{</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TransmuteThread</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">transportOutputFile</span><span class="p">,</span> <span class="n">currentDir</span><span class="p">)</span> <span class="p">:</span> <span class="n">cellNumber</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">()};</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">Futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">future2CellNumber</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span><span class="p">(</span><span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">());</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">thread</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Completed burning cell #{:d} (thread {:d} of {:d})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">future2CellNumber</span><span class="p">[</span><span class="n">future</span><span class="p">],</span> <span class="n">thread</span><span class="p">,</span> <span class="n">threads</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Extract and attach cell # -&gt; Origen calculation, ZAm -&gt; moles, micros</span>
        <span class="c">###</span>
        <span class="n">cellNumber2Transmute</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">future</span><span class="p">,</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">future2CellNumber</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenCalculation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zam2Moles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Micros</span> <span class="o">=</span> <span class="p">[{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">transmute</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">transmute</span> <span class="ow">in</span> <span class="n">cellNumber2Transmute</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)];</span>
        <span class="c">###</span>
        <span class="c"># Populate decay heat (delayed β&#39;s and γ&#39;s)</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep2CellNumber2DecayPower</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">origenCalculation</span><span class="o">.</span><span class="n">GetDecayPower</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetZa2WattsPerMole</span><span class="p">())</span> <span class="k">for</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">origenCalculation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumber2OrigenCalculation</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.TransmuteThread"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.TransmuteThread">[docs]</a>    <span class="k">def</span> <span class="nf">TransmuteThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">transportOutputFile</span><span class="p">,</span> <span class="n">currentDir</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Execute transmute concurrently for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Find cell</span>
        <span class="c">###</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Move to temporary directory</span>
        <span class="c">###</span>
        <span class="n">tmpDir</span> <span class="o">=</span> <span class="n">MakeTemporaryDirectory</span><span class="p">(</span><span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># Write transmutation inputs;</span>
        <span class="c">###</span>
        <span class="n">zam2Moles</span><span class="p">,</span> <span class="n">micros</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PrepareTransmute</span><span class="p">(</span><span class="n">transportOutputFile</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">tmpDir</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Run transmutation calculation;</span>
        <span class="c"># Parse transport results</span>
        <span class="c">###</span>
        <span class="n">origenCalculation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Transmute</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">tmpDir</span><span class="p">,</span> <span class="n">currentDir</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Attach micros to origenCalculation</span>
        <span class="c">###</span>
        <span class="n">origenCalculation</span><span class="o">.</span><span class="n">AttachMicros</span><span class="p">(</span><span class="n">micros</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Clean up files</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CleanUpFiles</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">origenCalculation</span><span class="p">,</span> <span class="n">zam2Moles</span><span class="p">,</span> <span class="n">micros</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.PrepareTransmute"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.PrepareTransmute">[docs]</a>    <span class="k">def</span> <span class="nf">PrepareTransmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transportOutputFile</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">tmpDir</span> <span class="o">=</span> <span class="s">&#39;./&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Prepare transmute calculation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Writing transmute input for cell #{:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()));</span>
        <span class="c">###</span>
        <span class="c"># Extract cell #</span>
        <span class="c">###</span>
        <span class="n">cellNumber</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># origen (ORIGEN executable)</span>
        <span class="c">###</span>
        <span class="n">SymbolicLink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;origenExecutablePath&#39;</span><span class="p">),</span> <span class="s">&#39;{}origen&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># TAPE10.INP (default photon library):</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">():</span>
            <span class="c">###</span>
            <span class="c"># This is a pickle transmute cycle, so grab the unpickled TAPE10</span>
            <span class="c">###</span>
            <span class="n">WriteFile</span><span class="p">(</span><span class="s">&#39;{}TAPE10.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">()</span><span class="o">.</span><span class="n">GetCellNumberTAPE10</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">WriteFile</span><span class="p">(</span><span class="s">&#39;{}TAPE10.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDefaultPhotonLibrary</span><span class="p">(),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># TAPE4.INP (.pch punch card):</span>
        <span class="c"># Cell moles</span>
        <span class="c">###</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># If TAPE7.OUT exists from a previous ORIGEN calculation,</span>
            <span class="c"># grab zam2Moles from there</span>
            <span class="c">###</span>
            <span class="n">zam2Moles</span> <span class="o">=</span> <span class="p">{</span><span class="n">Zaid2Zam</span><span class="p">(</span><span class="n">zaid</span><span class="p">)</span> <span class="p">:</span> <span class="n">moles</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumber2OrigenCalculation</span><span class="p">()[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">GetZaid2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># No ORIGEN calculation is performed either for this depletion step, or for this cell</span>
            <span class="c">###</span>
            <span class="n">zam2Moles</span> <span class="o">=</span> <span class="p">{</span><span class="n">Za2Zam</span><span class="p">(</span><span class="n">za</span><span class="p">)</span> <span class="p">:</span> <span class="n">moles</span> <span class="k">for</span> <span class="n">za</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetZa2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
        <span class="c">###</span>
        <span class="n">WriteFile</span><span class="p">(</span><span class="s">&#39;{}TAPE4.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">),</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">origenPunchCardTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lib</span> <span class="o">=</span> <span class="n">lib</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="n">zam</span> <span class="o">=</span> <span class="n">zam</span><span class="p">,</span> <span class="n">moles</span> <span class="o">=</span> <span class="n">zam2Moles</span><span class="p">[</span><span class="n">zam</span><span class="p">])</span> <span class="k">for</span> <span class="n">lib</span><span class="p">,</span> <span class="n">zams</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetLib2Zams</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">for</span> <span class="n">zam</span> <span class="ow">in</span> <span class="n">zams</span> <span class="k">if</span> <span class="n">zam</span> <span class="ow">in</span> <span class="n">zam2Moles</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">0 0 0 0&#39;</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># TAPE9.INP (default decay and modified cross-section library):</span>
        <span class="c"># Cell microscopic cross-sections</span>
        <span class="c"># Cell zams</span>
        <span class="c"># Cross-section library</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsDecayStep</span><span class="p">():</span>
            <span class="c">###</span>
            <span class="c"># No transport is done, so default libraries are used</span>
            <span class="c">###</span>
            <span class="n">micros</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="c">###</span>
            <span class="n">WriteFile</span><span class="p">(</span><span class="s">&#39;{}TAPE9.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDefaultDecayLibrary</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDefaultXsLibrary</span><span class="p">(),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">():</span>
                <span class="c">###</span>
                <span class="c"># This is a pickle transmute cycle, so grab the unpickled micros and TAPE9</span>
                <span class="c">###</span>
                <span class="n">micros</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">()</span><span class="o">.</span><span class="n">GetCellNumberMicros</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="n">WriteFile</span><span class="p">(</span><span class="s">&#39;{}TAPE9.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">()</span><span class="o">.</span><span class="n">GetCellNumberTAPE9</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Transport-update cross-sections are required;</span>
                <span class="c"># Calculate them from transport results</span>
                <span class="c">###</span>
                <span class="k">def</span> <span class="nf">HelperMicros</span><span class="p">(</span><span class="n">zam</span><span class="p">,</span> <span class="n">micros</span><span class="p">,</span> <span class="n">mts</span><span class="p">,</span> <span class="n">excites</span><span class="p">):</span>
                    <span class="c">###</span>
                    <span class="n">multipliers</span> <span class="o">=</span> <span class="p">[</span><span class="n">excite</span> <span class="k">for</span> <span class="n">excite</span> <span class="ow">in</span> <span class="n">excites</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">excite</span> <span class="k">for</span> <span class="n">excite</span> <span class="ow">in</span> <span class="n">excites</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
                    <span class="c">###</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">multipliers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">*</span> <span class="n">micros</span><span class="p">[(</span><span class="n">zam</span><span class="p">,</span> <span class="n">mts</span><span class="p">[</span><span class="n">index</span><span class="p">])]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)];</span>
                <span class="c">###</span>
                <span class="c"># Extract transmutation cross-sections</span>
                <span class="c">###</span>
                <span class="n">tallyNumber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTransmuteTallyNumber</span><span class="p">();</span>
                <span class="n">tally</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">tally</span> <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">(</span><span class="s">&#39;fm4&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">tallyNumber</span> <span class="o">==</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">());</span>
                <span class="n">micros</span> <span class="o">=</span> <span class="p">{(</span><span class="n">Zaid2Zam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetMaterialNumberZaid</span><span class="p">(</span><span class="n">materialNumber</span><span class="p">)),</span> <span class="n">reactionNumber</span><span class="p">)</span> <span class="p">:</span> <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">GetCellNumberMicroscopicCrossSection</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">materialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">materialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span> <span class="ow">in</span> <span class="p">(</span><span class="n">tallyBin</span><span class="p">[</span><span class="mi">2</span> <span class="p">:</span> <span class="p">]</span> <span class="k">for</span> <span class="n">tallyBin</span> <span class="ow">in</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetMultiplierBins</span><span class="p">()</span> <span class="k">if</span> <span class="n">cellNumber</span> <span class="o">==</span> <span class="n">tallyBin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">materialNumber</span><span class="p">};</span>
                <span class="c">###</span>
                <span class="n">cellZams</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">zam</span> <span class="k">for</span> <span class="n">zam</span><span class="p">,</span> <span class="n">reactionNumber</span> <span class="ow">in</span> <span class="n">micros</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="n">reXs</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^ *(\d+) +(\d+)&#39;</span><span class="p">);</span>
                <span class="n">xsLibraryLines</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDefaultXsLibrary</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">reXs</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
                    <span class="c">###</span>
                    <span class="c"># Kick out if format line</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">xsLibraryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
                        <span class="c">###</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="c">###</span>
                    <span class="n">lib</span><span class="p">,</span> <span class="n">zam</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">();</span>
                    <span class="c">###</span>
                    <span class="n">zam</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">zam</span><span class="p">));</span>
                    <span class="k">if</span> <span class="n">zam</span> <span class="ow">in</span> <span class="n">cellZams</span><span class="p">:</span>
                        <span class="n">lib</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lib</span><span class="p">));</span>
                        <span class="n">mts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetOrigen2LibMts</span><span class="p">(</span><span class="n">lib</span><span class="p">);</span>
                        <span class="c">###</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">origenXsLibraryTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lib</span> <span class="o">=</span> <span class="n">lib</span><span class="p">,</span> <span class="n">zam</span> <span class="o">=</span> <span class="n">zam</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">HelperMicros</span><span class="p">(</span><span class="n">zam</span><span class="p">,</span> <span class="n">micros</span><span class="p">,</span> <span class="n">mts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetLibZamExcite</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">zam</span><span class="p">)));</span>
                    <span class="c">###</span>
                    <span class="n">xsLibraryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="n">WriteFile</span><span class="p">(</span><span class="s">&#39;{}TAPE9.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDefaultDecayLibrary</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xsLibraryLines</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># TAPE5.INP (.inp instructions):</span>
        <span class="c"># Cross-section library numbers</span>
        <span class="c"># Flux or power mode</span>
        <span class="c"># Inner depletion timestep endtimes</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">():</span>
            <span class="c">###</span>
            <span class="c"># This is a pickle transmute cycle, so grab the unpickled cell burn rate and TAPE5</span>
            <span class="c">###</span>
            <span class="n">cellBurnRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">()</span><span class="o">.</span><span class="n">GetCellNumberBurnRate</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="n">WriteFile</span><span class="p">(</span><span class="s">&#39;{}TAPE5.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">()</span><span class="o">.</span><span class="n">GetCellNumberTAPE5</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xsLibs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetLib2Zams</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="n">burnMode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnMode</span><span class="p">();</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsDecayStep</span><span class="p">():</span>
                <span class="c">###</span>
                <span class="c"># Decay cell</span>
                <span class="c">###</span>
                <span class="n">cellBurnRate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Burn cell</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isPowerMode&#39;</span><span class="p">):</span>
                    <span class="c">###</span>
                    <span class="c"># Extract ORIGEN power that matches flux magnitudes</span>
                    <span class="c">###</span>
                    <span class="n">cellBurnRate</span> <span class="o">=</span> <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">GetCellNumberOrigenPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">isOrigen2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsOrigen2</span><span class="p">());</span>
                    <span class="c">###</span>
                    <span class="c"># Convert powers Wth -&gt; MWth</span>
                    <span class="c">###</span>
                    <span class="n">cellBurnRate</span> <span class="o">*=</span> <span class="mf">1e-6</span><span class="p">;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cellBurnRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">transportOutputFile</span><span class="o">.</span><span class="n">GetCellNumberScalarFlux</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">));</span>
            <span class="c">###</span>
            <span class="n">timeLapse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStepTimeInterval</span><span class="p">();</span>
            <span class="n">timeSteps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">origenInputFileTemplate</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;timeEnds&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]);</span>
            <span class="n">timeEnds</span> <span class="o">=</span> <span class="p">[</span><span class="n">timeLapse</span> <span class="o">*</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">timeSteps</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">timeSteps</span><span class="p">)];</span>
            <span class="c">###</span>
            <span class="n">WriteFile</span><span class="p">(</span><span class="s">&#39;{}TAPE5.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">),</span> <span class="n">origenInputFileTemplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xsLibs</span> <span class="o">=</span> <span class="n">xsLibs</span><span class="p">,</span> <span class="n">burnMode</span> <span class="o">=</span> <span class="n">burnMode</span><span class="p">,</span> <span class="n">timeEnds</span> <span class="o">=</span> <span class="n">timeEnds</span><span class="p">,</span> <span class="n">cellBurnRate</span> <span class="o">=</span> <span class="n">cellBurnRate</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2BurnRate</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="n">cellBurnRate</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">zam2Moles</span><span class="p">,</span> <span class="n">micros</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.Transmute"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.Transmute">[docs]</a>    <span class="k">def</span> <span class="nf">Transmute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">tmpDir</span> <span class="o">=</span> <span class="s">&#39;./&#39;</span><span class="p">,</span> <span class="n">currentDir</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Execute ORIGEN2.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Burning cell #{:d} at {:10.5E} {:s} in `{:s}</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberBurnRate</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;burnUnits&#39;</span><span class="p">),</span> <span class="n">tmpDir</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Ensure necessary files do/don&#39;t exist</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">tapeNumber</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="n">AssertFileExists</span><span class="p">(</span><span class="s">&#39;{}TAPE{:d}.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">,</span> <span class="n">tapeNumber</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Execute ORIGEN</span>
        <span class="c">###</span>
        <span class="n">SystemCall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;origenRunCommand&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">,</span> <span class="n">currentDir</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Parse transmute results</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">OrigenCalculation</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetSuffix</span><span class="p">(),</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">(),</span> <span class="n">tmpDir</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.PickleDepletionStep"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.PickleDepletionStep">[docs]</a>    <span class="k">def</span> <span class="nf">PickleDepletionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transportOutputFile</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Serialized current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Pickling {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionString</span><span class="p">()));</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep2DepletionStepPickle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()]</span> <span class="o">=</span> <span class="n">DepletionStepPickle</span><span class="p">(</span><span class="s">&#39;{}.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="n">withoutTH</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span> <span class="s">&#39;pkl&#39;</span><span class="p">),</span> <span class="n">transportOutputFile</span><span class="p">,</span> <span class="bp">self</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.UnpickleDepletionStep"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.UnpickleDepletionStep">[docs]</a>    <span class="k">def</span> <span class="nf">UnpickleDepletionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Un-serialized current depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Unpickling {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionString</span><span class="p">()));</span>
        <span class="c">###</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="s">&#39;pkl&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;compressPickles&#39;</span><span class="p">):</span>
            <span class="n">extension</span> <span class="o">+=</span> <span class="s">&#39;.gz&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">DepletionStepPickle</span><span class="p">(</span><span class="s">&#39;{}.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="n">withoutTH</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span> <span class="n">extension</span><span class="p">));</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.CleanUpFiles"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.CleanUpFiles">[docs]</a>    <span class="k">def</span> <span class="nf">CleanUpFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmpDir</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Remove transmute files.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">tmpDir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Transport files</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="s">&#39;tpe&#39;</span><span class="p">):</span>
                <span class="n">RemoveFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="n">extension</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Transmute files</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">tapeNumber</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
                <span class="n">RemoveFile</span><span class="p">(</span><span class="s">&#39;{}TAPE{:d}.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">,</span> <span class="n">tapeNumber</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">tapeNumber</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
                <span class="n">RemoveFile</span><span class="p">(</span><span class="s">&#39;{}TAPE{:d}.OUT&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">,</span> <span class="n">tapeNumber</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="n">RemoveFile</span><span class="p">(</span><span class="s">&#39;{}origen&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
            <span class="n">RemoveDirectory</span><span class="p">(</span><span class="n">tmpDir</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.IncrementDepletionStep"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.IncrementDepletionStep">[docs]</a>    <span class="k">def</span> <span class="nf">IncrementDepletionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Increment index for depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depletionStep</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.ProcessFuel"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.ProcessFuel">[docs]</a>    <span class="k">def</span> <span class="nf">ProcessFuel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Dummy fuel processing.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.MultiplicationFactor"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.MultiplicationFactor">[docs]</a>    <span class="k">def</span> <span class="nf">MultiplicationFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return characteristic multiplication factor.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">multiplicationFactor</span> <span class="k">for</span> <span class="n">multiplicationFactor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionCalculationPickle</span><span class="p">()</span><span class="o">.</span><span class="n">multiplicationFactors</span> <span class="k">if</span> <span class="n">multiplicationFactor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculation.MultiplicationFactorSigma"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculation.MultiplicationFactorSigma">[docs]</a>    <span class="k">def</span> <span class="nf">MultiplicationFactorSigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return characteristic multiplication factor standard deviation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">multiplicationFactorSigma</span> <span class="k">for</span> <span class="n">multiplicationFactorSigma</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionCalculationPickle</span><span class="p">()</span><span class="o">.</span><span class="n">multiplicationFactorSigmas</span> <span class="k">if</span> <span class="n">multiplicationFactorSigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="c">###</span>
<span class="c"># Depletion calculation pickle</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="DepletionCalculationPickle"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle">[docs]</a><span class="k">class</span> <span class="nc">DepletionCalculationPickle</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Pickle for depletion calculation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Unpickling depletion calculation&#39;</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="n">args</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Maybe gunzip;</span>
            <span class="c"># Unpickle</span>
            <span class="c">###</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} &gt;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">));</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="n">pickle</span> <span class="o">=</span> <span class="n">UnPickle</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
            <span class="k">except</span> <span class="n">UnpicklingError</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">GzipOpen</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="n">pickle</span> <span class="o">=</span> <span class="n">UnPickle</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Transfer pickle attributes to instance</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;cellNumber2BurnRates&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2DecayPowers&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2FissionPowers&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2Micros&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2OrigenFluxes&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2OrigenPowers&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2PromptPowers&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2ScalarFluxes&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2ThermalPowers&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2Volume&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2Zaid2MassDensitys&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2Zaid2NumberDensitys&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2Zam2Moles&#39;</span><span class="p">,</span> <span class="s">&#39;coolantDensityCalculations&#39;</span><span class="p">,</span> <span class="s">&#39;fuelTemperatureCalculations&#39;</span><span class="p">,</span> <span class="s">&#39;mevPerFissions&#39;</span><span class="p">,</span> <span class="s">&#39;multiplicationFactorSigmas&#39;</span><span class="p">,</span> <span class="s">&#39;multiplicationFactors&#39;</span><span class="p">,</span> <span class="s">&#39;neutronsPerFissions&#39;</span><span class="p">,</span> <span class="s">&#39;parameters&#39;</span><span class="p">,</span> <span class="s">&#39;powerCells&#39;</span><span class="p">,</span> <span class="s">&#39;sourceRates&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">pickle</span><span class="p">,</span> <span class="n">attribute</span><span class="p">));</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="ne">Warning</span><span class="p">(</span><span class="s">&#39;The depletion calculation pickle was created with an older version of {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__file__</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Pickling depletion calculation&#39;</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="n">depletionCalculation</span> <span class="o">=</span> <span class="n">args</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Input parameters</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># Transport</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zaid2NumberDensitys</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zaid2MassDensitys</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactors</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactorSigmas</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neutronsPerFissions</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mevPerFissions</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sourceRates</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2DecayPowers</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2FissionPowers</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PromptPowers</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ScalarFluxes</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ThermalPowers</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="c">###</span>
            <span class="c"># Transport convergence</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coolantDensityCalculations</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fuelTemperatureCalculations</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="c">###</span>
            <span class="c"># Transmute</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2BurnRates</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Micros</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenFluxes</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenPowers</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zam2Moles</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="c">###</span>
            <span class="c"># Iterate over depletion steps</span>
            <span class="c">###</span>
            <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">depletionStep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">while</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">depletionCalculation</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># Extract depletion step pickle;</span>
                <span class="c"># Parse transport input file;</span>
                <span class="c"># Maybe parse transport output file</span>
                <span class="c">###</span>
                <span class="n">depletionStepPickle</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetDepletionStepPickle</span><span class="p">();</span>
                <span class="c">###</span>
                <span class="c"># Transport</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetMultiplicationFactor</span><span class="p">());</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactorSigmas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetMultiplicationFactorSigma</span><span class="p">());</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">neutronsPerFissions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetNeutronsPerFission</span><span class="p">());</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mevPerFissions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetMevPerFission</span><span class="p">());</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceRates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetSourceRate</span><span class="p">());</span>
                <span class="c">###</span>
                <span class="c"># Transport convergence</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coolantDensityCalculations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCoolantDensityCalculations</span><span class="p">());</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuelTemperatureCalculations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetFuelTemperatureCalculations</span><span class="p">());</span>
                <span class="c">###</span>
                <span class="c"># Iterate over power cells for transport results</span>
                <span class="c">###</span>
                <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">():</span>
                    <span class="c">###</span>
                    <span class="c"># Instantiate cell lists</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zaid2NumberDensitys</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zaid2MassDensitys</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="c">###</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2DecayPowers</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2FissionPowers</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PromptPowers</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ScalarFluxes</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ThermalPowers</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="c">###</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zaid2NumberDensitys</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberZaid2NumberDensity</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">));</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zaid2MassDensitys</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberZaid2MassDensity</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">));</span>
                    <span class="c">###</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2DecayPowers</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberDecayPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">));</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2FissionPowers</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberFissionPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">));</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PromptPowers</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberPromptPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">));</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ScalarFluxes</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberScalarFlux</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">));</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ThermalPowers</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberThermalPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">));</span>
                <span class="c">###</span>
                <span class="c"># Iterate over burn cells for transmute results</span>
                <span class="c">###</span>
                <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">():</span>
                    <span class="c">###</span>
                    <span class="c"># Instantiate cell lists</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2BurnRates</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Micros</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenFluxes</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenPowers</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zam2Moles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">depletionCalculation</span><span class="p">):</span>
                        <span class="n">burnRate</span> <span class="o">=</span> <span class="n">micros</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">burnRate</span> <span class="o">=</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberBurnRate</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
                        <span class="n">micros</span> <span class="o">=</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberMicros</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">depletionCalculation</span><span class="p">)</span> <span class="ow">or</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetDepletionStepTimeInterval</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">origenFlux</span> <span class="o">=</span> <span class="n">origenPower</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">origenFlux</span> <span class="o">=</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberOrigenFlux</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
                        <span class="n">origenPower</span> <span class="o">=</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberOrigenPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
                    <span class="n">zam2Moles</span> <span class="o">=</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberZam2Moles</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
                    <span class="c">###</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2BurnRates</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">burnRate</span><span class="p">);</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Micros</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">micros</span><span class="p">);</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenFluxes</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">origenFlux</span><span class="p">);</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenPowers</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">origenPower</span><span class="p">);</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zam2Moles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zam2Moles</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="c"># Increment depletion step</span>
                <span class="c">###</span>
                <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">IncrementDepletionStep</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">powerCells</span> <span class="o">=</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">();</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Volume</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">depletionStepPickle</span><span class="o">.</span><span class="n">GetCellNumberVolume</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
            <span class="c">###</span>
            <span class="c"># Pickle</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Save</span><span class="p">(</span><span class="n">baseName</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetOriginalTransportFile</span><span class="p">()</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(),</span> <span class="n">display</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="c"># Return depletion step counter to end</span>
            <span class="c">###</span>
            <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">depletionStep</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return number of depletion steps.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c">###</span>
<div class="viewcode-block" id="DepletionCalculationPickle.Save"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.Save">[docs]</a>    <span class="k">def</span> <span class="nf">Save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseName</span><span class="p">,</span> <span class="n">display</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Save to file.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Pickle;</span>
        <span class="c"># Maybe gzip</span>
        <span class="c">###</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="s">&#39;pkl&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;compressPickles&#39;</span><span class="p">):</span>
            <span class="n">extension</span> <span class="o">+=</span> <span class="s">&#39;.gz&#39;</span><span class="p">;</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="s">&#39;{}.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseName</span><span class="p">,</span> <span class="n">extension</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="n">RemoveFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="n">display</span><span class="p">);</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} &lt;&lt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">));</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;compressPickles&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">GzipOpen</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">,</span> <span class="n">compresslevel</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">PickleString</span><span class="p">(</span><span class="bp">self</span><span class="p">));</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">Pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetBurnCells"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetBurnCells">[docs]</a>    <span class="k">def</span> <span class="nf">GetBurnCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cells which are depleted.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;burnCells&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetCellNumberVolume"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetCellNumberVolume">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return volume of a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Volume</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetDecayPowers"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetDecayPowers">[docs]</a>    <span class="k">def</span> <span class="nf">GetDecayPowers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of system total decay powers.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">decayPower</span> <span class="k">for</span> <span class="n">decayPowers</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2DecayPowers</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">decayPower</span> <span class="ow">in</span> <span class="p">[</span><span class="n">decayPowers</span><span class="p">[</span><span class="n">depletionStep</span><span class="p">]]</span> <span class="k">if</span> <span class="n">decayPower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">depletionStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetDepletionStepTimeEnds"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetDepletionStepTimeEnds">[docs]</a>    <span class="k">def</span> <span class="nf">GetDepletionStepTimeEnds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return start and end points of depletion steps.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepTimeEnds&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetDepletionStepTimeIntervals"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetDepletionStepTimeIntervals">[docs]</a>    <span class="k">def</span> <span class="nf">GetDepletionStepTimeIntervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return durations of depletion steps.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetFileName"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetFileName">[docs]</a>    <span class="k">def</span> <span class="nf">GetFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return filename.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetFIMAs"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetFIMAs">[docs]</a>    <span class="k">def</span> <span class="nf">GetFIMAs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of FIMAs.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">heavyMetalMoles</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">moles</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">()</span> <span class="k">for</span> <span class="n">zam</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zam2Moles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">depletionStep</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">ZaIsActinide</span><span class="p">(</span><span class="n">Zam2Za</span><span class="p">(</span><span class="n">zam</span><span class="p">)))</span> <span class="k">for</span> <span class="n">depletionStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))];</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">moles</span> <span class="o">/</span> <span class="n">heavyMetalMoles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">moles</span> <span class="ow">in</span> <span class="n">heavyMetalMoles</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetFissionPowers"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetFissionPowers">[docs]</a>    <span class="k">def</span> <span class="nf">GetFissionPowers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of system total fission powers.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">fissionPower</span> <span class="k">for</span> <span class="n">fissionPowers</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2FissionPowers</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">fissionPower</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fissionPowers</span><span class="p">[</span><span class="n">depletionStep</span><span class="p">]]</span> <span class="k">if</span> <span class="n">fissionPower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">depletionStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetMultiplicationFactors"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetMultiplicationFactors">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplicationFactors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of multiplication factors.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactors</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetMultiplicationFactorSigmas"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetMultiplicationFactorSigmas">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplicationFactorSigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of multiplication factors standard deviations.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactorSigmas</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetOrigenFluxes"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetOrigenFluxes">[docs]</a>    <span class="k">def</span> <span class="nf">GetOrigenFluxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of system total ORIGEN fluxes.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">cellNumber2Volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Volume</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">origenFlux</span> <span class="o">*</span> <span class="n">cellNumber2Volume</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="k">for</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">origenFluxes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenFluxes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">origenFlux</span> <span class="ow">in</span> <span class="p">[</span><span class="n">origenFluxes</span><span class="p">[</span><span class="n">depletionStep</span><span class="p">]]</span> <span class="k">if</span> <span class="n">origenFlux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cellNumber2Volume</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">for</span> <span class="n">depletionStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetOrigenPowers"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetOrigenPowers">[docs]</a>    <span class="k">def</span> <span class="nf">GetOrigenPowers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of system total ORIGEN powers.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">origenPower</span> <span class="k">for</span> <span class="n">origenPowers</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenPowers</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">origenPower</span> <span class="ow">in</span> <span class="p">[</span><span class="n">origenPowers</span><span class="p">[</span><span class="n">depletionStep</span><span class="p">]]</span> <span class="k">if</span> <span class="n">origenPower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">depletionStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetPromptPowers"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetPromptPowers">[docs]</a>    <span class="k">def</span> <span class="nf">GetPromptPowers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of system total prompt powers.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">promptPower</span> <span class="k">for</span> <span class="n">promptPowers</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PromptPowers</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">promptPower</span> <span class="ow">in</span> <span class="p">[</span><span class="n">promptPowers</span><span class="p">[</span><span class="n">depletionStep</span><span class="p">]]</span> <span class="k">if</span> <span class="n">promptPower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">depletionStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetParameter"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetParameter">[docs]</a>    <span class="k">def</span> <span class="nf">GetParameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return mocdown input file parameter for a key.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">()[</span><span class="n">key</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetParameters"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetParameters">[docs]</a>    <span class="k">def</span> <span class="nf">GetParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return mocdown input file parameters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetPowerCells"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetPowerCells">[docs]</a>    <span class="k">def</span> <span class="nf">GetPowerCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of cells which are dense enough to provide power.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">powerCells</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetScalarFluxes"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetScalarFluxes">[docs]</a>    <span class="k">def</span> <span class="nf">GetScalarFluxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of cells which might provide power.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">cellNumber2Volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Volume</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">scalarFlux</span> <span class="o">*</span> <span class="n">cellNumber2Volume</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="k">for</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">scalarFluxes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ScalarFluxes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">scalarFlux</span> <span class="ow">in</span> <span class="p">[</span><span class="n">scalarFluxes</span><span class="p">[</span><span class="n">depletionStep</span><span class="p">]]</span> <span class="k">if</span> <span class="n">scalarFlux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cellNumber2Volume</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">for</span> <span class="n">depletionStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetSourceRates"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetSourceRates">[docs]</a>    <span class="k">def</span> <span class="nf">GetSourceRates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of system total neutron source rates.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceRates</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetThermalPowers"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetThermalPowers">[docs]</a>    <span class="k">def</span> <span class="nf">GetThermalPowers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of system total thermal powers.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">thermalPower</span> <span class="k">for</span> <span class="n">thermalPowers</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ThermalPowers</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">thermalPower</span> <span class="ow">in</span> <span class="p">[</span><span class="n">thermalPowers</span><span class="p">[</span><span class="n">depletionStep</span><span class="p">]]</span> <span class="k">if</span> <span class="n">thermalPower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">depletionStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetZa2Masses"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetZa2Masses">[docs]</a>    <span class="k">def</span> <span class="nf">GetZa2Masses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get list of dictionaries mapping isotope to mass.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">za2Masses</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="n">depletionStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">za2Masses</span><span class="o">.</span><span class="n">append</span><span class="p">({});</span>
            <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">():</span>
                <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberVolume</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
                <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">massDensity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zaid2MassDensitys</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">depletionStep</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">za2Masses</span><span class="p">[</span><span class="n">depletionStep</span><span class="p">][</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">massDensity</span> <span class="o">*</span> <span class="n">volume</span><span class="p">;</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">za2Masses</span><span class="p">[</span><span class="n">depletionStep</span><span class="p">][</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">)]</span> <span class="o">=</span> <span class="n">massDensity</span> <span class="o">*</span> <span class="n">volume</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">za2Masses</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionCalculationPickle.GetZa2Moles"><a class="viewcode-back" href="../src.html#MocDown.DepletionCalculationPickle.GetZa2Moles">[docs]</a>    <span class="k">def</span> <span class="nf">GetZa2Moles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get list of dictionaries mapping isotope to mole.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">za2Moles</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="n">depletionStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="n">za2Moles</span><span class="o">.</span><span class="n">append</span><span class="p">({});</span>
            <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetBurnCells</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">zam</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zam2Moles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">depletionStep</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">za2Moles</span><span class="p">[</span><span class="n">depletionStep</span><span class="p">][</span><span class="n">Zam2Za</span><span class="p">(</span><span class="n">zam</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">moles</span><span class="p">;</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">za2Moles</span><span class="p">[</span><span class="n">depletionStep</span><span class="p">][</span><span class="n">Zam2Za</span><span class="p">(</span><span class="n">zam</span><span class="p">)]</span> <span class="o">=</span> <span class="n">moles</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">za2Moles</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Depletion step dump</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="DepletionStepPickle"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle">[docs]</a><span class="k">class</span> <span class="nc">DepletionStepPickle</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Pickle for depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="mi">3</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Pickle data</span>
            <span class="c">###</span>
            <span class="n">fileName</span><span class="p">,</span> <span class="n">transportFile</span><span class="p">,</span> <span class="n">depletionCalculation</span> <span class="o">=</span> <span class="n">args</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># General</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;compressPickles&#39;</span><span class="p">):</span>
                <span class="n">fileName</span> <span class="o">+=</span> <span class="s">&#39;.gz&#39;</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">powerCells</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">();</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Volume</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">()</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">();</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xsDirZaids</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetXsDirZaids</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># Transport convergence</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coolantDensityCalculations</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetCoolantDensityCalculations</span><span class="p">();</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fuelTemperatureCalculations</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetFuelTemperatureCalculations</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># Transmute</span>
            <span class="c">###</span>
            <span class="n">cellNumber2BurnRate</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetCellNumber2BurnRate</span><span class="p">();</span>
            <span class="n">cellNumber2OrigenCalculation</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetCellNumber2OrigenCalculation</span><span class="p">();</span>
            <span class="n">cellNumber2Micros</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetCellNumber2Micros</span><span class="p">();</span>
            <span class="n">cellNumber2Zam2Moles</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetCellNumber2Zam2Moles</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">depletionCalculation</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cellNumber2OrigenCalculation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cellNumber2Zam2Moles</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="p">{</span><span class="n">Zaid2Zam</span><span class="p">(</span><span class="n">zaid</span><span class="p">)</span> <span class="p">:</span> <span class="n">moles</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="n">origenCalculation</span><span class="o">.</span><span class="n">GetZaid2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="k">for</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">origenCalculation</span> <span class="ow">in</span> <span class="n">cellNumber2OrigenCalculation</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2BurnRate</span> <span class="o">=</span> <span class="n">cellNumber2BurnRate</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenCalculation</span> <span class="o">=</span> <span class="n">cellNumber2OrigenCalculation</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Micros</span> <span class="o">=</span> <span class="n">cellNumber2Micros</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zam2Moles</span> <span class="o">=</span> <span class="n">cellNumber2Zam2Moles</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Transport input</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transportInputRaw</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetInputRaw</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zaid2NumberDensity</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetZaid2NumberDensity</span><span class="p">()</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zaid2MassDensity</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetZaid2MassDensity</span><span class="p">()</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
            <span class="c">###</span>
            <span class="c"># Transport output</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetDepletionStep</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">depletionCalculation</span><span class="p">)</span> <span class="ow">or</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetIsDecayStep</span><span class="p">()</span> <span class="ow">or</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transportOutputRaw</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactorSigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neutronsPerFission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mevPerFission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceRate</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2DecayPower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2FissionPower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2NextDecayPower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ScalarFlux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PromptPower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ThermalPower</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transportOutputRaw</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetOutputRaw</span><span class="p">();</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactor</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetMultiplicationFactor</span><span class="p">();</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactorSigma</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetMultiplicationFactorSigma</span><span class="p">();</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">neutronsPerFission</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetNeutronsPerFission</span><span class="p">();</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mevPerFission</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetMevPerFission</span><span class="p">();</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sourceRate</span> <span class="o">=</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetSourceRate</span><span class="p">(</span><span class="n">realSourceRate</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2DecayPower</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetCellNumberDecayPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2NextDecayPower</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetCellNumberDecayPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2FissionPower</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">transportFile</span><span class="o">.</span><span class="n">GetCellNumberFissionPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">))</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ScalarFlux</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">transportFile</span><span class="o">.</span><span class="n">GetCellNumberScalarFlux</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">))</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PromptPower</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetCellNumberThermalPower</span><span class="p">(</span><span class="n">transportFile</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">includeDecayHeat</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ThermalPower</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetCellNumberThermalPower</span><span class="p">(</span><span class="n">transportFile</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">includeDecayHeat</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
            <span class="c">###</span>
            <span class="c"># Pickle;</span>
            <span class="c"># Maybe gzip</span>
            <span class="c">###</span>
            <span class="n">RemoveFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} &lt;&lt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">));</span>
            <span class="k">if</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;compressPickles&#39;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">GzipOpen</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">,</span> <span class="n">compresslevel</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">PickleString</span><span class="p">(</span><span class="bp">self</span><span class="p">));</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">Pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">elif</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Unpickle data</span>
            <span class="c">###</span>
            <span class="n">fileName</span><span class="p">,</span> <span class="o">=</span> <span class="n">args</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Maybe gunzip;</span>
            <span class="c"># Unpickle</span>
            <span class="c">###</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} &gt;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">));</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="n">pickle</span> <span class="o">=</span> <span class="n">UnPickle</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
            <span class="k">except</span> <span class="n">UnpicklingError</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">GzipOpen</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="n">pickle</span> <span class="o">=</span> <span class="n">UnPickle</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Transfer pickle attributes to instance</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;cellNumber2BurnRate&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2DecayPower&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2FissionPower&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2NextDecayPower&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2Micros&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2OrigenCalculation&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2PromptPower&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2ScalarFlux&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2ThermalPower&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2Volume&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2Zaid2NumberDensity&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2Zaid2MassDensity&#39;</span><span class="p">,</span> <span class="s">&#39;cellNumber2Zam2Moles&#39;</span><span class="p">,</span> <span class="s">&#39;coolantDensityCalculations&#39;</span><span class="p">,</span> <span class="s">&#39;fileName&#39;</span><span class="p">,</span> <span class="s">&#39;fuelTemperatureCalculations&#39;</span><span class="p">,</span> <span class="s">&#39;parameters&#39;</span><span class="p">,</span> <span class="s">&#39;mevPerFission&#39;</span><span class="p">,</span> <span class="s">&#39;multiplicationFactor&#39;</span><span class="p">,</span> <span class="s">&#39;multiplicationFactorSigma&#39;</span><span class="p">,</span> <span class="s">&#39;neutronsPerFission&#39;</span><span class="p">,</span> <span class="s">&#39;powerCells&#39;</span><span class="p">,</span> <span class="s">&#39;sourceRate&#39;</span><span class="p">,</span> <span class="s">&#39;transportInputRaw&#39;</span><span class="p">,</span> <span class="s">&#39;transportOutputRaw&#39;</span><span class="p">,</span> <span class="s">&#39;xsDirZaids&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">pickle</span><span class="p">,</span> <span class="n">attribute</span><span class="p">));</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="ne">Warning</span><span class="p">(</span><span class="s">&#39;The depletion step pickle was created with an older version of {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__file__</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="DepletionStepPickle.GetBurnCells"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetBurnCells">[docs]</a>    <span class="k">def</span> <span class="nf">GetBurnCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cells which are depleted.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;burnCells&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberBurnRate"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberBurnRate">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberBurnRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell flux or power for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2BurnRate</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberDecayPower"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberDecayPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberDecayPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell decay power for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumber2DecayPower</span><span class="p">()[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumber2DecayPower"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumber2DecayPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumber2DecayPower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping cell to decay power for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2DecayPower</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberFissionPower"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberFissionPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberFissionPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell fission power for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2FissionPower</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumber2NextDecayPower"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumber2NextDecayPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumber2NextDecayPower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping cell to decay power for next depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2NextDecayPower</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberOrigenCalculation"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberOrigenCalculation">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberOrigenCalculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell ORIGEN calculuation for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2OrigenCalculation</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberOrigenFlux"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberOrigenFlux">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberOrigenFlux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell ORIGEN flux for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberOrigenCalculation</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetFlux</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberOrigenPower"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberOrigenPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberOrigenPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell ORIGEN power for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberOrigenCalculation</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetPower</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberPromptPower"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberPromptPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberPromptPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell prompt power for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PromptPower</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberMicros"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberMicros">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberMicros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return one-group microscopic cross-sections of a cell for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Micros</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberScalarFlux"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberScalarFlux">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberScalarFlux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell MCNP flux for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ScalarFlux</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberTAPE4"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberTAPE4">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberTAPE4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN TAPE4 of a cell for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberOrigenCalculation</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetTAPE4</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberTAPE5"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberTAPE5">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberTAPE5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN TAPE5 of a cell for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberOrigenCalculation</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetTAPE5</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberTAPE6"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberTAPE6">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberTAPE6</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN TAPE6 of a cell for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberOrigenCalculation</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetTAPE6</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberTAPE7"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberTAPE7">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberTAPE7</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN TAPE7 of a cell for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberOrigenCalculation</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetTAPE7</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberTAPE9"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberTAPE9">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberTAPE9</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN TAPE9 of a cell for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberOrigenCalculation</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetTAPE9</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberTAPE10"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberTAPE10">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberTAPE10</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN TAPE10 of a cell for the depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberOrigenCalculation</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetTAPE10</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberThermalPower"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberThermalPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberThermalPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell thermal power for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ThermalPower</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberVolume"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberVolume">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell volume.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Volume</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberZaid2NumberDensity"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberZaid2NumberDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberZaid2NumberDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to number density of a cell for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zaid2NumberDensity</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberZaid2MassDensity"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberZaid2MassDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberZaid2MassDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to mass density of a cell for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zaid2MassDensity</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCellNumberZam2Moles"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCellNumberZam2Moles">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberZam2Moles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to moles of a cell for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Zam2Moles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetCoolantDensityCalculations"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetCoolantDensityCalculations">[docs]</a>    <span class="k">def</span> <span class="nf">GetCoolantDensityCalculations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell coolant density calculuations for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coolantDensityCalculations</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetDepletionStepTimeEnds"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetDepletionStepTimeEnds">[docs]</a>    <span class="k">def</span> <span class="nf">GetDepletionStepTimeEnds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return start and end points of depletion steps.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepTimeEnds&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetDepletionStepTimeIntervals"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetDepletionStepTimeIntervals">[docs]</a>    <span class="k">def</span> <span class="nf">GetDepletionStepTimeIntervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return durations of depletion steps.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetFileName"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetFileName">[docs]</a>    <span class="k">def</span> <span class="nf">GetFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return filename.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetFuelTemperatureCalculations"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetFuelTemperatureCalculations">[docs]</a>    <span class="k">def</span> <span class="nf">GetFuelTemperatureCalculations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell fuel temperature calculuations for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuelTemperatureCalculations</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetParameter"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetParameter">[docs]</a>    <span class="k">def</span> <span class="nf">GetParameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return mocdown input file parameter for a key.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">()[</span><span class="n">key</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetParameters"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetParameters">[docs]</a>    <span class="k">def</span> <span class="nf">GetParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return mocdown input file parameters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetMevPerFission"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetMevPerFission">[docs]</a>    <span class="k">def</span> <span class="nf">GetMevPerFission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return effective MeV per fission for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mevPerFission</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetMultiplicationFactor"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetMultiplicationFactor">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplicationFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return multiplication factor for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactor</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetMultiplicationFactorSigma"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetMultiplicationFactorSigma">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplicationFactorSigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return multiplication factor standard deviation for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactorSigma</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetNeutronsPerFission"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetNeutronsPerFission">[docs]</a>    <span class="k">def</span> <span class="nf">GetNeutronsPerFission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return effective neutrons per fission for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">neutronsPerFission</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetPowerCells"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetPowerCells">[docs]</a>    <span class="k">def</span> <span class="nf">GetPowerCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of cells which are dense enough to provide power.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">powerCells</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetTransportInputRaw"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetTransportInputRaw">[docs]</a>    <span class="k">def</span> <span class="nf">GetTransportInputRaw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return text from MCNP output file for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transportInputRaw</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetTransportOutputRaw"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetTransportOutputRaw">[docs]</a>    <span class="k">def</span> <span class="nf">GetTransportOutputRaw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return text from MCNP input file for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transportOutputRaw</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="DepletionStepPickle.GetSourceRate"><a class="viewcode-back" href="../src.html#MocDown.DepletionStepPickle.GetSourceRate">[docs]</a>    <span class="k">def</span> <span class="nf">GetSourceRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return system total neutron source rate for this depletion step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceRate</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Material composition</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="MaterialComposition"><a class="viewcode-back" href="../src.html#MocDown.MaterialComposition">[docs]</a><span class="k">class</span> <span class="nc">MaterialComposition</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Derive compositions from arbitary isotopic mixtures.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materialDensity</span><span class="p">,</span> <span class="n">isotope2Fraction</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">fractionSum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">isotope2Fraction</span><span class="o">.</span><span class="n">values</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># Determine if isotopes are expressed as isotope&#39;s or za&#39;s for molar mass lookup</span>
        <span class="c"># Extract ZAs</span>
        <span class="c"># Determine most frequent library suffix</span>
        <span class="c">###</span>
        <span class="n">isotope</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">isotope2Fraction</span><span class="p">));</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">isotope</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">MolarMass</span> <span class="o">=</span> <span class="n">Zaid2MolarMass</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zas</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">)</span> <span class="k">for</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="n">isotope2Fraction</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="n">isotope</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">isotope2Fraction</span><span class="p">];</span>
            <span class="n">count2Suff</span> <span class="o">=</span> <span class="p">{</span><span class="n">suffixes</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="p">:</span> <span class="n">suffix</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">suffixes</span><span class="p">)};</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">count2Suff</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">count2Suff</span><span class="p">)];</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">isotope</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">MolarMass</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">za</span><span class="p">:</span> <span class="n">za2MolarMass</span><span class="p">[</span><span class="n">za</span><span class="p">];</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zas</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">isotope2Fraction</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Calculate isotope -&gt; a, w</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isotope2AtomFraction</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isotope2WeightFraction</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">fraction</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">fraction</span> <span class="ow">in</span> <span class="n">isotope2Fraction</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="c">###</span>
            <span class="c"># Atom fractions are provided</span>
            <span class="c">###</span>
            <span class="n">mix</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">atomFraction</span> <span class="o">*</span> <span class="n">MolarMass</span><span class="p">(</span><span class="n">isotope</span><span class="p">)</span> <span class="k">for</span> <span class="n">isotope</span><span class="p">,</span> <span class="n">atomFraction</span> <span class="ow">in</span> <span class="n">isotope2Fraction</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">/</span> <span class="n">fractionSum</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">isotope</span><span class="p">,</span> <span class="n">atomFraction</span> <span class="ow">in</span> <span class="n">isotope2Fraction</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c">###</span>
                <span class="c"># Atom fraction</span>
                <span class="c">###</span>
                <span class="n">atomFraction</span> <span class="o">/=</span> <span class="n">fractionSum</span><span class="p">;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isotope2AtomFraction</span><span class="p">[</span><span class="n">isotope</span><span class="p">]</span> <span class="o">=</span> <span class="n">atomFraction</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Weight fraction</span>
                <span class="c">###</span>
                <span class="n">molarMass</span> <span class="o">=</span> <span class="n">MolarMass</span><span class="p">(</span><span class="n">isotope</span><span class="p">);</span>
                <span class="n">weightFraction</span> <span class="o">=</span> <span class="n">atomFraction</span> <span class="o">*</span> <span class="n">molarMass</span> <span class="o">/</span> <span class="n">mix</span><span class="p">;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isotope2WeightFraction</span><span class="p">[</span><span class="n">isotope</span><span class="p">]</span> <span class="o">=</span> <span class="n">weightFraction</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Cell molar mass</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellMolarMass</span> <span class="o">=</span> <span class="n">atomFraction</span> <span class="o">*</span> <span class="n">molarMass</span> <span class="o">/</span> <span class="n">weightFraction</span><span class="p">;</span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">fraction</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">fraction</span> <span class="ow">in</span> <span class="n">isotope2Fraction</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="c">###</span>
            <span class="c"># Weight fractions are provided</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">isotope</span><span class="p">,</span> <span class="n">weightFraction</span> <span class="ow">in</span> <span class="n">isotope2Fraction</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c">###</span>
                <span class="c"># Weight fraction</span>
                <span class="c">###</span>
                <span class="n">weightFraction</span> <span class="o">/=</span> <span class="n">fractionSum</span><span class="p">;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isotope2WeightFraction</span><span class="p">[</span><span class="n">isotope</span><span class="p">]</span> <span class="o">=</span> <span class="n">weightFraction</span><span class="p">;</span>
            <span class="n">fractionSum</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fractionSum</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Cell molar mass</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellMolarMass</span> <span class="o">=</span> <span class="n">fractionSum</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weightFraction</span> <span class="o">/</span> <span class="n">MolarMass</span><span class="p">(</span><span class="n">isotope</span><span class="p">)</span> <span class="k">for</span> <span class="n">isotope</span><span class="p">,</span> <span class="n">weightFraction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotope2WeightFraction</span><span class="o">.</span><span class="n">items</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">isotope</span><span class="p">,</span> <span class="n">weightFraction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotope2WeightFraction</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">weightFraction</span> <span class="o">=</span> <span class="n">weightFraction</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Atom fraction</span>
                <span class="c">###</span>
                <span class="n">molarMass</span> <span class="o">=</span> <span class="n">MolarMass</span><span class="p">(</span><span class="n">isotope</span><span class="p">);</span>
                <span class="n">atomFraction</span> <span class="o">=</span> <span class="n">weightFraction</span> <span class="o">/</span> <span class="n">fractionSum</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellMolarMass</span> <span class="o">/</span> <span class="n">molarMass</span><span class="p">;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isotope2AtomFraction</span><span class="p">[</span><span class="n">isotope</span><span class="p">]</span> <span class="o">=</span> <span class="n">atomFraction</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Calculate ρ [g/cm³], N [a/b·cm], isotope -&gt; ρ, N</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isotope2MassDensity</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isotope2NumberDensity</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">materialDensity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Given cell number density</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">numberDensity</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">materialDensity</span><span class="p">);</span>
            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">isotope2Fraction</span><span class="p">:</span>
                <span class="n">atomFraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotope2AtomFraction</span><span class="p">[</span><span class="n">isotope</span><span class="p">];</span>
                <span class="c">###</span>
                <span class="c"># Number density</span>
                <span class="c">###</span>
                <span class="n">numberDensity</span> <span class="o">=</span> <span class="n">atomFraction</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberDensity</span><span class="p">;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isotope2NumberDensity</span><span class="p">[</span><span class="n">isotope</span><span class="p">]</span> <span class="o">=</span> <span class="n">numberDensity</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Mass density</span>
                <span class="c">###</span>
                <span class="n">molarMass</span> <span class="o">=</span> <span class="n">MolarMass</span><span class="p">(</span><span class="n">isotope</span><span class="p">);</span>
                <span class="n">massDensity</span> <span class="o">=</span> <span class="n">numberDensity</span> <span class="o">*</span> <span class="n">molarMass</span> <span class="o">/</span> <span class="n">avogadrosNumber</span><span class="p">;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isotope2MassDensity</span><span class="p">[</span><span class="n">isotope</span><span class="p">]</span> <span class="o">=</span> <span class="n">massDensity</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Cell mass density</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">massDensity</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isotope2MassDensity</span><span class="o">.</span><span class="n">values</span><span class="p">());</span>
        <span class="k">elif</span> <span class="n">materialDensity</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Given cell mass density</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">massDensity</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">materialDensity</span><span class="p">);</span>
            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">isotope2Fraction</span><span class="p">:</span>
                <span class="n">weightFraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotope2WeightFraction</span><span class="p">[</span><span class="n">isotope</span><span class="p">];</span>
                <span class="c">###</span>
                <span class="c"># Mass density</span>
                <span class="c">###</span>
                <span class="n">massDensity</span> <span class="o">=</span> <span class="n">weightFraction</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">massDensity</span><span class="p">;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isotope2MassDensity</span><span class="p">[</span><span class="n">isotope</span><span class="p">]</span> <span class="o">=</span> <span class="n">massDensity</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Number density</span>
                <span class="c">###</span>
                <span class="n">molarMass</span> <span class="o">=</span> <span class="n">MolarMass</span><span class="p">(</span><span class="n">isotope</span><span class="p">);</span>
                <span class="n">numberDensity</span> <span class="o">=</span> <span class="n">massDensity</span> <span class="o">*</span> <span class="n">avogadrosNumber</span> <span class="o">/</span> <span class="n">molarMass</span><span class="p">;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isotope2NumberDensity</span><span class="p">[</span><span class="n">isotope</span><span class="p">]</span> <span class="o">=</span> <span class="n">numberDensity</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Cell number density</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">numberDensity</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isotope2NumberDensity</span><span class="o">.</span><span class="n">values</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MocDown input file</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="MocDownInputFile"><a class="viewcode-back" href="../src.html#MocDown.MocDownInputFile">[docs]</a><span class="k">class</span> <span class="nc">MocDownInputFile</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Parser for mocdown input file.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="s">&#39;mocDownInputFileName&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">arguments</span><span class="o">.</span><span class="n">mocDownInputFileName</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Maybe read file</span>
        <span class="c">###</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">AssertFileExists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputRaw</span> <span class="o">=</span> <span class="n">ReadFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(),</span> <span class="n">display</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">));</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputRaw</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return number of depletion steps.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isPredictorMode&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;numberOfPredictorSteps&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;numberOfCorrectorSteps&#39;</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return summary string of parameters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&lt; MocDown input summary for `{}</span><span class="se">\&#39;</span><span class="s"> &gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">())];</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;{:&lt;38s} = {:&gt;38}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)));</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;{:^89}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="MocDownInputFile.GetConverter"><a class="viewcode-back" href="../src.html#MocDown.MocDownInputFile.GetConverter">[docs]</a>    <span class="k">def</span> <span class="nf">GetConverter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return parameter parser for a key.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetConverters</span><span class="p">()[</span><span class="n">key</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="MocDownInputFile.GetConverters"><a class="viewcode-back" href="../src.html#MocDown.MocDownInputFile.GetConverters">[docs]</a>    <span class="k">def</span> <span class="nf">GetConverters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return custom parameter parsers.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">converters</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="MocDownInputFile.GetFileName"><a class="viewcode-back" href="../src.html#MocDown.MocDownInputFile.GetFileName">[docs]</a>    <span class="k">def</span> <span class="nf">GetFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return filename.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="MocDownInputFile.GetInputRaw"><a class="viewcode-back" href="../src.html#MocDown.MocDownInputFile.GetInputRaw">[docs]</a>    <span class="k">def</span> <span class="nf">GetInputRaw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return text from file.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputRaw</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="MocDownInputFile.GetKeyValueValues"><a class="viewcode-back" href="../src.html#MocDown.MocDownInputFile.GetKeyValueValues">[docs]</a>    <span class="k">def</span> <span class="nf">GetKeyValueValues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Parse and return key value pairs.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">reComments</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;\s*#.*&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetInputRaw</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># Remove comments</span>
            <span class="c">###</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">reComments</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Kick out blank and commented lines</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Extract key and value(s)</span>
            <span class="c">###</span>
            <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">);</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">());</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">];</span>
            <span class="c">###</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;[,];&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)];</span>
            <span class="c">###</span>
            <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="MocDownInputFile.GetParameter"><a class="viewcode-back" href="../src.html#MocDown.MocDownInputFile.GetParameter">[docs]</a>    <span class="k">def</span> <span class="nf">GetParameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return mocdown input file parameter for a key.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">()[</span><span class="n">key</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="MocDownInputFile.GetParameters"><a class="viewcode-back" href="../src.html#MocDown.MocDownInputFile.GetParameters">[docs]</a>    <span class="k">def</span> <span class="nf">GetParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return mocdown input file parameters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Population methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="MocDownInputFile.Populate"><a class="viewcode-back" href="../src.html#MocDown.MocDownInputFile.Populate">[docs]</a>    <span class="k">def</span> <span class="nf">Populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct parameter mapping.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Default parameter values</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c"># T/F</span>
            <span class="s">&#39;compressPickles&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">&#39;forceDecayTransport&#39;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">&#39;includeDecayHeat&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">&#39;recycleToEquilibrium&#39;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">&#39;updateCoolantDensities&#39;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">&#39;updateFuelTemperatures&#39;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="c"># #</span>
            <span class="s">&#39;numberOfPredictorSteps&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&#39;numberOfCorrectorSteps&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&#39;numberOfOrigenThreads&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c"># #.#</span>
            <span class="s">&#39;depletionTerminalDecayTime&#39;</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="c"># [years]</span>
            <span class="s">&#39;depletionFlux&#39;</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="c"># [n/cm²·s]</span>
            <span class="s">&#39;depletionPower&#39;</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="c"># [MWth]</span>
            <span class="s">&#39;depletionTime&#39;</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="c"># [days]</span>
            <span class="s">&#39;isotopicsConvergenceTolerance&#39;</span> <span class="p">:</span> <span class="mf">1e-5</span><span class="p">,</span>
            <span class="s">&#39;maximumBurnupStep&#39;</span> <span class="p">:</span> <span class="mf">5e3</span><span class="p">,</span> <span class="c"># [MWd/MTHM]</span>
            <span class="s">&#39;maximumFluenceStep&#39;</span> <span class="p">:</span> <span class="mf">8e21</span><span class="p">,</span> <span class="c"># [n/cm²] # FIXME Pick reasonable numbers!</span>
            <span class="s">&#39;minimumBurnupStep&#39;</span> <span class="p">:</span> <span class="mf">2e2</span><span class="p">,</span> <span class="c"># [MWd/MTHM]</span>
            <span class="s">&#39;minimumCellMassDensityCutoff&#39;</span> <span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="c"># [g/cm³]</span>
            <span class="s">&#39;minimumFluenceStep&#39;</span> <span class="p">:</span> <span class="mf">3e20</span><span class="p">,</span> <span class="c"># [n/cm²] # FIXME Pick reasonable numbers!</span>
            <span class="s">&#39;minimumIsotopeCutoff&#39;</span> <span class="p">:</span> <span class="mf">1e-8</span><span class="p">,</span>
            <span class="s">&#39;multiplicationFactorConvergenceTolerance&#39;</span> <span class="p">:</span> <span class="mf">100e-5</span><span class="p">,</span>
            <span class="c"># &#39;&#39;.lower()</span>
            <span class="s">&#39;isotopicsConvergenceNormType&#39;</span> <span class="p">:</span> <span class="s">&#39;inf&#39;</span><span class="p">,</span>
            <span class="c"># &#39;&#39;</span>
            <span class="s">&#39;defaultDecayLibrary&#39;</span> <span class="p">:</span> <span class="s">&#39;decay&#39;</span><span class="p">,</span>
            <span class="s">&#39;defaultPhotonLibrary&#39;</span> <span class="p">:</span> <span class="s">&#39;gxuo2brm&#39;</span><span class="p">,</span>
            <span class="s">&#39;defaultXsLibrary&#39;</span> <span class="p">:</span> <span class="s">&#39;pwru50&#39;</span><span class="p">,</span>
            <span class="s">&#39;mcnpExecutablePath&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/local/LANL/MCNP6/bin/mcnp6.mpi&#39;</span><span class="p">,</span>
            <span class="s">&#39;mcnpSourceFileName&#39;</span> <span class="p">:</span> <span class="s">&#39;source&#39;</span><span class="p">,</span>
            <span class="s">&#39;mcnpXsdirPath&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/local/LANL/MCNP_BINDATA/xsdir&#39;</span><span class="p">,</span>
            <span class="s">&#39;origenExecutablePath&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/local/ORIGEN/bin/o2_fast&#39;</span><span class="p">,</span>
            <span class="s">&#39;origenLibraryPathTemplate&#39;</span> <span class="p">:</span> <span class="s">&#39;/usr/local/ORIGEN/libs/{}.lib&#39;</span><span class="p">,</span>
            <span class="s">&#39;qValueMethod&#39;</span> <span class="p">:</span> <span class="s">&#39;origens&#39;</span><span class="p">,</span>
            <span class="c"># [#]</span>
            <span class="s">&#39;burnCells&#39;</span> <span class="p">:</span> <span class="p">[],</span>
            <span class="c"># [#.#]</span>
            <span class="s">&#39;depletionStepFluxes&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="c"># [n/cm²·s]</span>
            <span class="s">&#39;depletionStepPowers&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="c"># [MWth]</span>
            <span class="s">&#39;depletionStepTimeIntervals&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="c"># [days]</span>
            <span class="c"># [&#39;&#39;]</span>
            <span class="s">&#39;supplementaryMocdownLibrary&#39;</span> <span class="p">:</span> <span class="p">[],</span>
            <span class="c"># /</span>
            <span class="s">&#39;mcnpRunCommand&#39;</span> <span class="p">:</span> <span class="s">&#39;DATAPATH=&quot;&quot; ; srun {executable} tasks 6 i={baseName}.i me={baseName}.mesh o={baseName}.o r={baseName}.tpe s={baseName}.src x={xsdir} &gt;&gt; transport.log 2&gt;&amp;1 ;&#39;</span><span class="p">,</span>
            <span class="s">&#39;origenRunCommand&#39;</span> <span class="p">:</span> <span class="s">&#39;cd {} ; ./origen &gt;&gt; {}transmute.log 2&gt;&amp;1&#39;</span><span class="p">,</span>
        <span class="p">};</span>
        <span class="c">###</span>
        <span class="c"># Default converters</span>
        <span class="c">###</span>
        <span class="n">Bool</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
        <span class="n">Float</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
        <span class="n">Int</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">def</span> <span class="nf">ListInt</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
                <span class="k">if</span> <span class="s">&#39;..&#39;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                    <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span> <span class="p">:</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">2</span><span class="p">];</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lo</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">hi</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))));</span>
            <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">def</span> <span class="nf">ListFloat</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
                <span class="k">if</span> <span class="s">&#39;r&#39;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                    <span class="n">repeat</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">);</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">repeat</span><span class="p">)));</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)));</span>
            <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">ListReturn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">];</span>
        <span class="n">Lower</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">();</span>
        <span class="n">Return</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">();</span>
        <span class="n">Path</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39; ;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; ;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">converters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c"># T/F</span>
            <span class="s">&#39;compressPickles&#39;</span> <span class="p">:</span> <span class="n">Bool</span><span class="p">,</span>
            <span class="s">&#39;forceDecayTransport&#39;</span> <span class="p">:</span> <span class="n">Bool</span><span class="p">,</span>
            <span class="s">&#39;includeDecayHeat&#39;</span> <span class="p">:</span> <span class="n">Bool</span><span class="p">,</span>
            <span class="s">&#39;recycleToEquilibrium&#39;</span> <span class="p">:</span> <span class="n">Bool</span><span class="p">,</span>
            <span class="s">&#39;updateCoolantDensities&#39;</span> <span class="p">:</span> <span class="n">Bool</span><span class="p">,</span>
            <span class="s">&#39;updateFuelTemperatures&#39;</span> <span class="p">:</span> <span class="n">Bool</span><span class="p">,</span>
            <span class="c"># #</span>
            <span class="s">&#39;numberOfPredictorSteps&#39;</span> <span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
            <span class="s">&#39;numberOfCorrectorSteps&#39;</span>  <span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
            <span class="s">&#39;numberOfOrigenThreads&#39;</span> <span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
            <span class="c"># #.#</span>
            <span class="s">&#39;depletionTerminalDecayTime&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="s">&#39;depletionFlux&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="s">&#39;depletionPower&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="s">&#39;depletionTime&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="s">&#39;isotopicsConvergenceTolerance&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="s">&#39;maximumBurnupStep&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="s">&#39;maximumFluenceStep&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="s">&#39;minimumBurnupStep&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="s">&#39;minimumCellMassDensityCutoff&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="s">&#39;minimumFluenceStep&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="s">&#39;minimumIsotopeCutoff&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="s">&#39;multiplicationFactorConvergenceTolerance&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
            <span class="c"># &#39;&#39;.lower()</span>
            <span class="s">&#39;isotopicsConvergenceNormType&#39;</span> <span class="p">:</span> <span class="n">Lower</span><span class="p">,</span>
            <span class="c"># &#39;&#39;</span>
            <span class="s">&#39;defaultDecayLibrary&#39;</span> <span class="p">:</span> <span class="n">Return</span><span class="p">,</span>
            <span class="s">&#39;defaultPhotonLibrary&#39;</span> <span class="p">:</span> <span class="n">Return</span><span class="p">,</span>
            <span class="s">&#39;defaultXsLibrary&#39;</span> <span class="p">:</span> <span class="n">Return</span><span class="p">,</span>
            <span class="s">&#39;mcnpExecutablePath&#39;</span> <span class="p">:</span> <span class="n">Return</span><span class="p">,</span>
            <span class="s">&#39;mcnpSourceFileName&#39;</span> <span class="p">:</span> <span class="n">Return</span><span class="p">,</span>
            <span class="s">&#39;mcnpXsdirPath&#39;</span> <span class="p">:</span> <span class="n">Return</span><span class="p">,</span>
            <span class="s">&#39;origenExecutablePath&#39;</span> <span class="p">:</span> <span class="n">Return</span><span class="p">,</span>
            <span class="s">&#39;origenLibraryPathTemplate&#39;</span> <span class="p">:</span> <span class="n">Return</span><span class="p">,</span>
            <span class="s">&#39;qValueMethod&#39;</span> <span class="p">:</span> <span class="n">Return</span><span class="p">,</span>
            <span class="c"># [#]</span>
            <span class="s">&#39;burnCells&#39;</span> <span class="p">:</span> <span class="n">ListInt</span><span class="p">,</span>
            <span class="c"># [#.#]</span>
            <span class="s">&#39;depletionStepFluxes&#39;</span> <span class="p">:</span> <span class="n">ListFloat</span><span class="p">,</span>
            <span class="s">&#39;depletionStepPowers&#39;</span> <span class="p">:</span> <span class="n">ListFloat</span><span class="p">,</span>
            <span class="s">&#39;depletionStepTimeIntervals&#39;</span> <span class="p">:</span> <span class="n">ListFloat</span><span class="p">,</span>
            <span class="c"># [&#39;&#39;]</span>
            <span class="s">&#39;supplementaryMocdownLibrary&#39;</span> <span class="p">:</span> <span class="n">ListReturn</span><span class="p">,</span>
            <span class="c"># /</span>
            <span class="s">&#39;mcnpRunCommand&#39;</span> <span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
            <span class="s">&#39;origenRunCommand&#39;</span> <span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="p">};</span>
        <span class="c">###</span>
        <span class="c"># Import library parameters</span>
        <span class="c">###</span>
        <span class="n">parameters</span><span class="p">,</span> <span class="n">converters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetLibraryParametersConverters</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">converters</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Custom parameter values</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetKeyValueValues</span><span class="p">():</span>
            <span class="c">###</span>
            <span class="c"># Only allow for defined parameters</span>
            <span class="c">###</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">());</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetConverters</span><span class="p">());</span>
            <span class="n">converter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetConverter</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">converter</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">));</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">converter</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Determine isPredictorMode</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;isPredictorMode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;numberOfPredictorSteps&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;numberOfCorrectorSteps&#39;</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Error checking for depletion step times and powers/fluxes</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Time intervals are provided;</span>
            <span class="c">###</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTime&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepFluxes&#39;</span><span class="p">)):</span>
                <span class="c">###</span>
                <span class="c"># Fluxes are provided</span>
                <span class="c"># Error check</span>
                <span class="c">###</span>
                <span class="k">assert</span><span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionFlux&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">)));</span>
            <span class="k">elif</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">)):</span>
                <span class="c">###</span>
                <span class="c"># Powers are provided;</span>
                <span class="c"># Error check</span>
                <span class="c">###</span>
                <span class="k">assert</span><span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepFluxes&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionFlux&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">)));</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionFlux&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Single flux is provided;</span>
                <span class="c"># Error check and populate</span>
                <span class="c">###</span>
                <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepFluxes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionFlux&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Single power is provided;</span>
                <span class="c"># Error check and populate</span>
                <span class="c">###</span>
                <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionFlux&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Maybe append decay step</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTerminalDecayTime&#39;</span><span class="p">)):</span>
                <span class="c">###</span>
                <span class="c"># Decay time</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepTimeIntervals&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTerminalDecayTime&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">daysPerYear</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="c"># Power or flux</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;depletionStepFluxes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">elif</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionTime&#39;</span><span class="p">)):</span>
            <span class="c">###</span>
            <span class="c"># Only total depletion time is provided;</span>
            <span class="c"># Depletion step powers/fluxes will be populated within the DepletionCalculation</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionFlux&#39;</span><span class="p">)):</span>
                <span class="c">###</span>
                <span class="c"># Single flux is provided</span>
                <span class="c">###</span>
                <span class="k">assert</span><span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepFluxes&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">);</span>
            <span class="k">elif</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)):</span>
                <span class="c">###</span>
                <span class="c"># Single power is provided</span>
                <span class="c">###</span>
                <span class="k">assert</span><span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepFluxes&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionFlux&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Determine isPowerMode</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;isPowerMode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionPower&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Determine burnUnits</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">&#39;burnUnits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;n/cm²·s&#39;</span><span class="p">,</span> <span class="s">&#39;MWth&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isPowerMode&#39;</span><span class="p">)];</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isVerbose</span><span class="p">):</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="MocDownInputFile.GetLibraryParametersConverters"><a class="viewcode-back" href="../src.html#MocDown.MocDownInputFile.GetLibraryParametersConverters">[docs]</a>    <span class="k">def</span> <span class="nf">GetLibraryParametersConverters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return default values and parsing functions for custom parameters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">{},</span> <span class="p">{};</span>
<span class="c">###</span>
<span class="c"># MCNP card</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="McnpCard"><a class="viewcode-back" href="../src.html#MocDown.McnpCard">[docs]</a><span class="k">class</span> <span class="nc">McnpCard</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;A single card in an MCNP input file.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Populate</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return number.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Quantitatively compare similar instances.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">));</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return text.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="McnpCard.GetRaw"><a class="viewcode-back" href="../src.html#MocDown.McnpCard.GetRaw">[docs]</a>    <span class="k">def</span> <span class="nf">GetRaw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return text.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCard.GetNumber"><a class="viewcode-back" href="../src.html#MocDown.McnpCard.GetNumber">[docs]</a>    <span class="k">def</span> <span class="nf">GetNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return number.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Regular expression builder</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCard.GetRegex"><a class="viewcode-back" href="../src.html#MocDown.McnpCard.GetRegex">[docs]</a>    <span class="k">def</span> <span class="nf">GetRegex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return compiled regular expression for this instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Escape special regex characters</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s">r&#39;().+-*?&#39;</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">character</span><span class="p">,</span> <span class="s">r&#39;\{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">character</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Clean up spaces</span>
        <span class="c">###</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39; +&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;[\s&amp;]+&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">ReCompile</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Population methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCard.Populate"><a class="viewcode-back" href="../src.html#MocDown.McnpCard.Populate">[docs]</a>    <span class="k">def</span> <span class="nf">Populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Dummy method.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP cell</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="McnpCell"><a class="viewcode-back" href="../src.html#MocDown.McnpCell">[docs]</a><span class="k">class</span> <span class="nc">McnpCell</span><span class="p">(</span><span class="n">McnpCard</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP celsurface card.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="McnpCell.GetFillUniverse"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetFillUniverse">[docs]</a>    <span class="k">def</span> <span class="nf">GetFillUniverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return universe which fills.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fillUniverse</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetHeavyMetalMT"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetHeavyMetalMT">[docs]</a>    <span class="k">def</span> <span class="nf">GetHeavyMetalMT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return metric tonnes of heavy metal.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMass</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weightFraction</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">weightFraction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2WeightFraction</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">ZaIsActinide</span><span class="p">(</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">)));</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetImportance"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetImportance">[docs]</a>    <span class="k">def</span> <span class="nf">GetImportance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return importance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">importance</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetLatticeType"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetLatticeType">[docs]</a>    <span class="k">def</span> <span class="nf">GetLatticeType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return lattice type.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">latticeType</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetMass"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetMass">[docs]</a>    <span class="k">def</span> <span class="nf">GetMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return grams.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMassDensity</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetMassDensity"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetMassDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetMassDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return grams per cubic centimeter.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">massDensity</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetMaterialDensity"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetMaterialDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetMaterialDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return grams per cubic centimeter or atoms per barn centimeter.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materialDensity</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetMaterialDensityRegex"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetMaterialDensityRegex">[docs]</a>    <span class="k">def</span> <span class="nf">GetMaterialDensityRegex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return compiled material density regular expression.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materialDensityRegex</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetMaterialNumber"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetMaterialNumber">[docs]</a>    <span class="k">def</span> <span class="nf">GetMaterialNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return material number.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materialNumber</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetMoles"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetMoles">[docs]</a>    <span class="k">def</span> <span class="nf">GetMoles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return moles.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberDensity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">()</span> <span class="o">/</span> <span class="n">avogadrosNumber</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetNumberDensity"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetNumberDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetNumberDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return atoms per barn centimeter.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberDensity</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetSuffix"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetSuffix">[docs]</a>    <span class="k">def</span> <span class="nf">GetSuffix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return most prominent nuclear library suffix.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetSurfaceNumbers"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetSurfaceNumbers">[docs]</a>    <span class="k">def</span> <span class="nf">GetSurfaceNumbers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of surface numbers.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaceNumbers</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetTemperature"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetTemperature">[docs]</a>    <span class="k">def</span> <span class="nf">GetTemperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return MeV.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetTemperatureRegex"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetTemperatureRegex">[docs]</a>    <span class="k">def</span> <span class="nf">GetTemperatureRegex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return compiled temperature regular expression.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperatureRegex</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetUniverse"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetUniverse">[docs]</a>    <span class="k">def</span> <span class="nf">GetUniverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return universe.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetVolume"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetVolume">[docs]</a>    <span class="k">def</span> <span class="nf">GetVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cubic centimeters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetZa2Moles"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetZa2Moles">[docs]</a>    <span class="k">def</span> <span class="nf">GetZa2Moles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to moles.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">();</span>
        <span class="n">za2Moles</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">numberDensity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2NumberDensity</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">za</span> <span class="o">=</span> <span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">);</span>
            <span class="n">moles</span> <span class="o">=</span> <span class="n">numberDensity</span> <span class="o">*</span> <span class="n">volume</span> <span class="o">/</span> <span class="n">avogadrosNumber</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">za2Moles</span><span class="p">[</span><span class="n">za</span><span class="p">]</span> <span class="o">+=</span> <span class="n">moles</span><span class="p">;</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">za2Moles</span><span class="p">[</span><span class="n">za</span><span class="p">]</span> <span class="o">=</span> <span class="n">moles</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">za2Moles</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetZaid2AtomFraction"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetZaid2AtomFraction">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2AtomFraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to atom fraction.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zaid2AtomFraction</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetZaidMass"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetZaidMass">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaidMass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zaid</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return grams for an isotope.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaidMassDensity</span><span class="p">(</span><span class="n">zaid</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetZaidMassDensity"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetZaidMassDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaidMassDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zaid</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return grams per cubic centimeter for an isotope.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2MassDensity</span><span class="p">()[</span><span class="n">zaid</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetZaid2MassDensity"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetZaid2MassDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2MassDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to grams per cubic centimeter.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zaid2MassDensity</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetZaidMoles"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetZaidMoles">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaidMoles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zaid</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return moles for an isotope.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaidNumberDensity</span><span class="p">(</span><span class="n">zaid</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">()</span> <span class="o">/</span> <span class="n">avogadrosNumber</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetZaidNumberDensity"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetZaidNumberDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaidNumberDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zaid</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return atoms per barn centimeter for an isotope.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2NumberDensity</span><span class="p">()[</span><span class="n">zaid</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetZaid2NumberDensity"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetZaid2NumberDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2NumberDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to atoms per barn centimeter.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zaid2NumberDensity</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetZaid2WeightFraction"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetZaid2WeightFraction">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2WeightFraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to weight fraction.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zaid2WeightFraction</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.GetZaids"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.GetZaids">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of isotopes.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zaid2AtomFraction</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Population methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCell.Populate"><a class="viewcode-back" href="../src.html#MocDown.McnpCell.Populate">[docs]</a>    <span class="k">def</span> <span class="nf">Populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">cellNumber</span><span class="p">,</span> <span class="n">materialNumber</span><span class="p">,</span> <span class="n">materialDensity</span><span class="p">,</span> <span class="n">surfaceNumbers</span><span class="p">,</span> <span class="n">junk</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">junk</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^(\d{1,8}\s+)(\d{1,8}\s+)([\d\.e+\-]+\s+)?((:?[+\-]?\d{1,8}\s*)*)((.|\n)+)$&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">())</span><span class="o">.</span><span class="n">groups</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># cell number, material number, material density, surface numbers, material density regex</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">));</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materialNumber</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">materialNumber</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMaterialNumber</span><span class="p">()</span> <span class="ow">and</span> <span class="n">materialDensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Material density stole a surface!</span>
            <span class="c"># When the material number is null, the density is absent, so the first surface is grabbed by the material density</span>
            <span class="c">###</span>
            <span class="n">surfaceNumbers</span> <span class="o">=</span> <span class="s">&#39;{} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">materialDensity</span><span class="p">,</span> <span class="n">surfaceNumbers</span><span class="p">);</span>
            <span class="n">materialDensity</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">materialDensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">regex</span> <span class="o">=</span> <span class="n">materialDensity</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Escape special regex characters</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s">r&#39;.+-&#39;</span><span class="p">:</span>
                <span class="n">regex</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">character</span><span class="p">,</span> <span class="s">r&#39;\{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">character</span><span class="p">));</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materialDensityRegex</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="n">regex</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="n">materialDensity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">materialDensity</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materialDensity</span> <span class="o">=</span> <span class="n">materialDensity</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surfaceNumbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">surface</span><span class="p">))</span> <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">surfaceNumbers</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()];</span>
        <span class="c">###</span>
        <span class="c"># Optional parameters</span>
        <span class="c">###</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;(imp|vol|pwt|ext|fcl|wwn|dxc|nonu|pd|tmp|u|trcl|lat|fill)&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">parameters</span><span class="p">)[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">];</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)};</span>
        <span class="c">###</span>
        <span class="c"># importance, volume, temperature, temperature regex, universe, lattice type, fill universe</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">importance</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">universe</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latticeType</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fillUniverse</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">keyValue</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="n">value</span><span class="p">;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="s">&#39;imp&#39;</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">importance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
            <span class="k">elif</span> <span class="s">&#39;vol&#39;</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
            <span class="k">elif</span> <span class="s">&#39;tmp&#39;</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">regex</span> <span class="o">=</span> <span class="n">keyValue</span><span class="p">;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
            <span class="k">elif</span> <span class="s">&#39;u&#39;</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">universe</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
            <span class="k">elif</span> <span class="s">&#39;lat&#39;</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">latticeType</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
<span class="c">#            elif &#39;fill&#39; == key: # FIXME</span>
<span class="c">#                self.fillUniverse = int(float(value)); # FIXME</span>
        <span class="c">###</span>
        <span class="c"># Escape special regex characters</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s">r&#39;.+-&#39;</span><span class="p">:</span>
            <span class="n">regex</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">character</span><span class="p">,</span> <span class="s">r&#39;\{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">character</span><span class="p">));</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperatureRegex</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="n">regex</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP surface</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="McnpSurface"><a class="viewcode-back" href="../src.html#MocDown.McnpSurface">[docs]</a><span class="k">class</span> <span class="nc">McnpSurface</span><span class="p">(</span><span class="n">McnpCard</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP surface card.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="McnpSurface.GetMnemonic"><a class="viewcode-back" href="../src.html#MocDown.McnpSurface.GetMnemonic">[docs]</a>    <span class="k">def</span> <span class="nf">GetMnemonic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return surface type mnemonic.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Population methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpSurface.Populate"><a class="viewcode-back" href="../src.html#MocDown.McnpSurface.Populate">[docs]</a>    <span class="k">def</span> <span class="nf">Populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">surfaceNumber</span><span class="p">,</span> <span class="n">transformationNumber</span><span class="p">,</span> <span class="n">mnemonic</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^[+\*]?(\d{1,8}\s+)([+\-]?\d{1,3}\s+)?([psckgthr][ep/]?[oxyzqp]?\s+)(.+)$&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">())</span><span class="o">.</span><span class="n">groups</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># surface number, transformation number, mnemonic</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">surfaceNumber</span><span class="p">));</span>
        <span class="k">if</span> <span class="n">transformationNumber</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">transformationNumber</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">transformationNumber</span><span class="p">));</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformationNumber</span> <span class="o">=</span> <span class="n">transformationNumber</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="n">mnemonic</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># geometric parameters</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span> <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">split</span><span class="p">()];</span>
        <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP material</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="McnpMaterial"><a class="viewcode-back" href="../src.html#MocDown.McnpMaterial">[docs]</a><span class="k">class</span> <span class="nc">McnpMaterial</span><span class="p">(</span><span class="n">McnpCard</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP material card.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return number of isotopes.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2Fraction</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="McnpMaterial.GetIsSingleIsotope"><a class="viewcode-back" href="../src.html#MocDown.McnpMaterial.GetIsSingleIsotope">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsSingleIsotope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if only one isotope is contained.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpMaterial.GetZa"><a class="viewcode-back" href="../src.html#MocDown.McnpMaterial.GetZa">[docs]</a>    <span class="k">def</span> <span class="nf">GetZa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return first isotope.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZas</span><span class="p">()[</span><span class="n">index</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpMaterial.GetZas"><a class="viewcode-back" href="../src.html#MocDown.McnpMaterial.GetZas">[docs]</a>    <span class="k">def</span> <span class="nf">GetZas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of isotopes.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zas</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpMaterial.GetZaids"><a class="viewcode-back" href="../src.html#MocDown.McnpMaterial.GetZaids">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of isotopes.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2Fraction</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpMaterial.GetZaid2Fraction"><a class="viewcode-back" href="../src.html#MocDown.McnpMaterial.GetZaid2Fraction">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2Fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to abundance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zaid2Fraction</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Population methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpMaterial.Populate"><a class="viewcode-back" href="../src.html#MocDown.McnpMaterial.Populate">[docs]</a>    <span class="k">def</span> <span class="nf">Populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">card</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()];</span>
        <span class="n">materialNumber</span> <span class="o">=</span> <span class="n">card</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">materialNumber</span><span class="p">));</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zaid2Fraction</span> <span class="o">=</span> <span class="p">{</span><span class="n">card</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">card</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">card</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zas</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">({</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">)</span> <span class="k">for</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2Fraction</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()});</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP tally</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="McnpTally"><a class="viewcode-back" href="../src.html#MocDown.McnpTally">[docs]</a><span class="k">class</span> <span class="nc">McnpTally</span><span class="p">(</span><span class="n">McnpCard</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP generic tally card.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if particle, tally tag, or space is contained.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">particle</span> <span class="ow">in</span> <span class="n">other</span> <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParticles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;tallyTags&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tallyTags</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSpaces</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSpaces</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return number of spaces.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetSpaces</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="McnpTally.GetEnergys"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.GetEnergys">[docs]</a>    <span class="k">def</span> <span class="nf">GetEnergys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return energy bins.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">energys</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.GetParticles"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.GetParticles">[docs]</a>    <span class="k">def</span> <span class="nf">GetParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return particles.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.GetResultString"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.GetResultString">[docs]</a>    <span class="k">def</span> <span class="nf">GetResultString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return result text.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resultString</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.GetMnemonic"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.GetMnemonic">[docs]</a>    <span class="k">def</span> <span class="nf">GetMnemonic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return tally type mnemonic.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.GetSpaces"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.GetSpaces">[docs]</a>    <span class="k">def</span> <span class="nf">GetSpaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of spaces.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spaces</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.GetSpaceType"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.GetSpaceType">[docs]</a>    <span class="k">def</span> <span class="nf">GetSpaceType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return surface or cell, according to tally type mnemonic.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMnemonic</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;f1&#39;</span><span class="p">,</span> <span class="s">&#39;f2&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;surface&#39;</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;cell&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Physical quantity getter methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.GetTallyResults"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.GetTallyResults">[docs]</a>    <span class="k">def</span> <span class="nf">GetTallyResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return an indexed tally result.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Tally-type-specific indicies (space, angle, multiplier bin)</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMnemonic</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;f1&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">jndex</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMnemonic</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;f2&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f5&#39;</span><span class="p">,</span> <span class="s">&#39;f6&#39;</span><span class="p">,</span> <span class="s">&#39;f7&#39;</span><span class="p">,</span> <span class="s">&#39;f8&#39;</span><span class="p">):</span>
            <span class="n">jndex</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">);</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMnemonic</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;fm4&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">jndex</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Indices are none-valued unless specified</span>
        <span class="c">###</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">kndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
            <span class="n">index</span><span class="p">[</span><span class="n">jndex</span><span class="p">[</span><span class="n">kndex</span><span class="p">]]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">kndex</span><span class="p">];</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
    <span class="c">###</span>
    <span class="c"># Population methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.Populate"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.Populate">[docs]</a>    <span class="k">def</span> <span class="nf">Populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate input-related metrics.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopulateGenerics</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.PopulateAngles"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.PopulateAngles">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateAngles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angles</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Attach angle bins.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="n">angles</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.PopulateGenerics"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.PopulateGenerics">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateGenerics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Generic population input-related metrics.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">multiplier</span><span class="p">,</span> <span class="n">tallyNumber</span><span class="p">,</span> <span class="n">particleOne</span><span class="p">,</span> <span class="n">particleTwo</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;f(m?)(\d{1,8})\s*:?\s*([np]?)\s*,?\s*([np]?)&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">())</span><span class="o">.</span><span class="n">groups</span><span class="p">();</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tallyNumber</span><span class="p">));</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;f{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">][</span><span class="n">multiplier</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()</span> <span class="o">%</span> <span class="mi">10</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">particleOne</span><span class="p">,</span> <span class="n">particleTwo</span><span class="p">));</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.PopulateEnergys"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.PopulateEnergys">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateEnergys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energys</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Attach energy bins.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energys</span> <span class="o">=</span> <span class="n">energys</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.PopulateResults"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.PopulateResults">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resultString</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Parse and populate tally output text.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultString</span> <span class="o">=</span> <span class="n">resultString</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">reSpaces</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39; {2,}&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
        <span class="n">reSpace</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^ {}  ?(\d+)[(\d)&lt;]* +$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetSpaceType</span><span class="p">()),</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
        <span class="n">reAngle</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^ [ca][on][sg][il][ne][e ] bin:  ([ \-]\d\.[ \d]{5}E[+\-]\d{2}) to ([ \-]\d\.[ \d]{5}E[+\-]\d{2}) [m ][u ] +$&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
        <span class="n">reMultiplierBin</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^ multiplier bin:  [ \-]\d\.\d{5}E[+\-]\d{2} +(\d+)? +([ :\d\-]+)? +$&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
        <span class="n">reNumerics</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^ {4}(\d\.\d{4}E[+\-]\d{2}| {2}total {3}| {10}) {3}(\d\.\d{5}E[+\-]\d{2}) (\d\.\d{4}$)&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Energys</span>
        <span class="c">###</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">energys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">();</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">energys</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="c">###</span>
        <span class="c"># Build empty results array</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">ReCompile</span><span class="p">(</span><span class="s">&#39;^ $&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetResultString</span><span class="p">())[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">]):</span>
            <span class="c">###</span>
            <span class="c"># Space</span>
            <span class="c">###</span>
            <span class="n">space</span> <span class="o">=</span> <span class="n">reSpace</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">block</span><span class="p">);</span>
            <span class="n">space</span> <span class="o">=</span> <span class="n">space</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">space</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
            <span class="c">###</span>
            <span class="c"># Angle</span>
            <span class="c">###</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">reAngle</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">block</span><span class="p">);</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="p">(</span><span class="n">angle</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)));</span>
            <span class="c">###</span>
            <span class="c"># Multiplier bin</span>
            <span class="c">###</span>
            <span class="n">multiplierBin</span> <span class="o">=</span> <span class="n">reMultiplierBin</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">block</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">multiplierBin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">groups</span> <span class="o">=</span> <span class="n">multiplierBin</span><span class="o">.</span><span class="n">groups</span><span class="p">();</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplierBin</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">1</span><span class="p">])));</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">multiplierBin</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">reSpaces</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; : &#39;</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">));</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">multiplierBin</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;fm4&#39;</span><span class="p">,</span> <span class="s">&#39;fm5&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">multiplierBin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">multiplierBin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[(</span><span class="n">space</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">multiplierBin</span><span class="p">)]</span> <span class="o">=</span> <span class="n">TallyResult</span><span class="p">(</span><span class="n">reNumerics</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">block</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">energys</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpTally.PopulateSpaces"><a class="viewcode-back" href="../src.html#MocDown.McnpTally.PopulateSpaces">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateSpaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Attach spaces.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">spaces</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">]);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">character</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">()</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s">&#39;()&#39;</span><span class="p">):</span>
            <span class="n">startStop</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spaces</span><span class="p">)):</span>
                <span class="k">if</span> <span class="s">&#39;(&#39;</span> <span class="o">==</span> <span class="n">spaces</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                    <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">level</span><span class="p">:</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">index</span><span class="p">;</span>
                <span class="k">elif</span> <span class="s">&#39;)&#39;</span> <span class="o">==</span> <span class="n">spaces</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                    <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">level</span><span class="p">:</span>
                        <span class="n">stop</span> <span class="o">=</span> <span class="n">index</span><span class="p">;</span>
                        <span class="n">startStop</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">));</span>
            <span class="c">###</span>
            <span class="n">spaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">spaces</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">stop</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">startStop</span><span class="p">];</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">spaces</span><span class="o">.</span><span class="n">split</span><span class="p">()];</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spaces</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">word</span><span class="p">))</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">]</span> <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">character</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">word</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s">&#39;()&#39;</span><span class="p">)];</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP F1 surface current tally</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="McnpSurfaceCurrentTally"><a class="viewcode-back" href="../src.html#MocDown.McnpSurfaceCurrentTally">[docs]</a><span class="k">class</span> <span class="nc">McnpSurfaceCurrentTally</span><span class="p">(</span><span class="n">McnpTally</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP surface current tally.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">pass</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP F2 surface flux tally</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="McnpSurfaceFluxTally"><a class="viewcode-back" href="../src.html#MocDown.McnpSurfaceFluxTally">[docs]</a><span class="k">class</span> <span class="nc">McnpSurfaceFluxTally</span><span class="p">(</span><span class="n">McnpTally</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP surface flux tally.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">pass</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP F4 cell flux tally</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="McnpCellFluxTally"><a class="viewcode-back" href="../src.html#MocDown.McnpCellFluxTally">[docs]</a><span class="k">class</span> <span class="nc">McnpCellFluxTally</span><span class="p">(</span><span class="n">McnpTally</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP cell flux tally.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">pass</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP FM4 cell flux multiplier tally</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="McnpCellFluxMultiplierTally"><a class="viewcode-back" href="../src.html#MocDown.McnpCellFluxMultiplierTally">[docs]</a><span class="k">class</span> <span class="nc">McnpCellFluxMultiplierTally</span><span class="p">(</span><span class="n">McnpTally</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP cell flux tally with multiplier.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="McnpCellFluxMultiplierTally.GetMultiplierBins"><a class="viewcode-back" href="../src.html#MocDown.McnpCellFluxMultiplierTally.GetMultiplierBins">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplierBins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return multiplier bins.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplierBins</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Population methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCellFluxMultiplierTally.CrackBin"><a class="viewcode-back" href="../src.html#MocDown.McnpCellFluxMultiplierTally.CrackBin">[docs]</a>    <span class="k">def</span> <span class="nf">CrackBin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tallyBin</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Helper for parsing multiplier bins.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">tallyBin</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">tallyBin</span><span class="o">.</span><span class="n">split</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">tallyBin</span><span class="p">);</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">multiplier</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">materialNumber</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">tallyBin</span><span class="p">)));</span>
            <span class="n">reactionNumbers</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span> <span class="n">reactionNumber</span> <span class="ow">in</span> <span class="p">(</span><span class="n">reactionNumber</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;()&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">reactionNumber</span> <span class="ow">in</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">&#39;\) +\(&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tallyBin</span><span class="p">))):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">reactionNumbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">reactionNumber</span><span class="p">)));</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">reactionNumbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reactionNumber</span><span class="p">);</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="n">materialNumber</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
            <span class="n">reactionNumbers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">multiplier</span><span class="p">,</span> <span class="n">materialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">reactionNumber</span> <span class="ow">in</span> <span class="n">reactionNumbers</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCellFluxMultiplierTally.PopulateSpaces"><a class="viewcode-back" href="../src.html#MocDown.McnpCellFluxMultiplierTally.PopulateSpaces">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateSpaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tallys</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Attach inherited particles and spaces.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="n">tallys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetMnemonic</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f5&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetParticles</span><span class="p">();</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spaces</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetSpaces</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpCellFluxMultiplierTally.PopulateMultiplierBins"><a class="viewcode-back" href="../src.html#MocDown.McnpCellFluxMultiplierTally.PopulateMultiplierBins">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateMultiplierBins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cells</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct multiplier bins.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Multiplier bins and particles</span>
        <span class="c">###</span>
        <span class="n">particleOne</span><span class="p">,</span> <span class="n">particleTwo</span><span class="p">,</span> <span class="n">multiplierBins</span><span class="p">,</span> <span class="n">junk</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;fm\d{0,7}4:?\s*([np]?)\s*,?\s*([np]?)\s+((.|\n)+)&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">())</span><span class="o">.</span><span class="n">groups</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># Overwrite inherited particles from F4 tally</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">particleOne</span><span class="p">,</span> <span class="n">particleTwo</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Segregate multiplier bins</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">multiplierBins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">multiplierBins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">multiplierBins</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiplierBins</span><span class="p">];</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">startStop</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">multiplierBins</span><span class="p">)):</span>
                <span class="k">if</span> <span class="s">&#39;(&#39;</span> <span class="o">==</span> <span class="n">multiplierBins</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                    <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">level</span><span class="p">:</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">index</span><span class="p">;</span>
                <span class="k">elif</span> <span class="s">&#39;)&#39;</span> <span class="o">==</span> <span class="n">multiplierBins</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                    <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">level</span><span class="p">:</span>
                        <span class="n">stop</span> <span class="o">=</span> <span class="n">index</span><span class="p">;</span>
                        <span class="n">startStop</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">));</span>
            <span class="c">###</span>
            <span class="n">multiplierBins</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiplierBins</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">stop</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">startStop</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># Crack open bin string</span>
        <span class="c">###</span>
        <span class="n">multiplierBins</span> <span class="o">=</span> <span class="p">[</span><span class="n">crackedBins</span> <span class="k">for</span> <span class="n">tallyBin</span> <span class="ow">in</span> <span class="n">multiplierBins</span> <span class="k">for</span> <span class="n">crackedBins</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CrackBin</span><span class="p">(</span><span class="n">tallyBin</span><span class="p">)];</span>
        <span class="c">###</span>
        <span class="c"># Check and normalize multiplier</span>
        <span class="c"># attach multiplier bins</span>
        <span class="c">###</span>
        <span class="n">cellNumber2MaterialNumber</span> <span class="o">=</span> <span class="p">{</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()</span> <span class="p">:</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMaterialNumber</span><span class="p">()</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplierBins</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSpaces</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">materialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span> <span class="ow">in</span> <span class="n">multiplierBins</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">materialNumber</span> <span class="o">==</span> <span class="n">cellNumber2MaterialNumber</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">multiplier</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="c">###</span>
                    <span class="c"># Real material tally</span>
                    <span class="c">###</span>
                    <span class="n">multiplier</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">*</span> <span class="nb">bool</span><span class="p">(</span><span class="n">multiplier</span><span class="p">);</span>
                <span class="k">elif</span> <span class="n">materialNumber</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cellNumber2MaterialNumber</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="c">###</span>
                    <span class="c"># Single-isotope tally</span>
                    <span class="c">###</span>
                    <span class="n">multiplier</span> <span class="o">=</span> <span class="o">+</span><span class="mf">1.</span> <span class="o">*</span> <span class="nb">bool</span><span class="p">(</span><span class="n">multiplier</span><span class="p">);</span>
                <span class="k">elif</span> <span class="n">materialNumber</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">reactionNumber</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="c"># Only the flux is extracted</span>
                    <span class="c">###</span>
                    <span class="k">pass</span><span class="p">;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="c"># Cell flux multiplier tally may have a multiplier of improper sign</span>
                    <span class="c">###</span>
                    <span class="k">pass</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiplierBins</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">materialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP F5 detector tally</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="McnpDetectorTally"><a class="viewcode-back" href="../src.html#MocDown.McnpDetectorTally">[docs]</a><span class="k">class</span> <span class="nc">McnpDetectorTally</span><span class="p">(</span><span class="n">McnpTally</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP detector tally.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">pass</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP FM5 detector multiplier tally</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="McnpDetectorMultiplierTally"><a class="viewcode-back" href="../src.html#MocDown.McnpDetectorMultiplierTally">[docs]</a><span class="k">class</span> <span class="nc">McnpDetectorMultiplierTally</span><span class="p">(</span><span class="n">McnpCellFluxMultiplierTally</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP detector tally.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">pass</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP F6 cell energy deposition tally</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="McnpCellEnergyDepositionTally"><a class="viewcode-back" href="../src.html#MocDown.McnpCellEnergyDepositionTally">[docs]</a><span class="k">class</span> <span class="nc">McnpCellEnergyDepositionTally</span><span class="p">(</span><span class="n">McnpTally</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP cell energy deposition tally.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">pass</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP F7 cell fission energy deposition tally</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="McnpCellFissionEnergyDepositionTally"><a class="viewcode-back" href="../src.html#MocDown.McnpCellFissionEnergyDepositionTally">[docs]</a><span class="k">class</span> <span class="nc">McnpCellFissionEnergyDepositionTally</span><span class="p">(</span><span class="n">McnpTally</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP cell fission energy deposition tally.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">pass</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP F8 cell pulse height tally</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="McnpCellPulseHeightTally"><a class="viewcode-back" href="../src.html#MocDown.McnpCellPulseHeightTally">[docs]</a><span class="k">class</span> <span class="nc">McnpCellPulseHeightTally</span><span class="p">(</span><span class="n">McnpTally</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MCNP cell pulse height tally.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">pass</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP input file parser</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile">[docs]</a><span class="k">class</span> <span class="nc">McnpInputFile</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;MCNP input file parser.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">outputRaw</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputRaw</span> <span class="o">=</span> <span class="n">outputRaw</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Read input raw or extract it from the output raw</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetOutputRaw</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;\.o$&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">fileName</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="n">reInputRaw</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;(?&lt;=\d- {7})[\S ]+&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
            <span class="n">inputRaw</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^1&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetOutputRaw</span><span class="p">())</span> <span class="k">if</span> <span class="s">&#39;mcnp&#39;</span> <span class="o">==</span> <span class="n">block</span><span class="p">[</span> <span class="p">:</span> <span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reInputRaw</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">block</span><span class="p">));</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">inputRaw</span> <span class="o">=</span> <span class="n">ReadFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(),</span> <span class="n">display</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Strip whitespace from the ends of lines</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputRaw</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inputRaw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">rstrip</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Populate</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Mathematical operator overloaders</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return fractional difference between system total isotopics.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Sum isotopic moles over cells</span>
            <span class="c">###</span>
            <span class="n">za2MolesOne</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZa2Moles</span><span class="p">();</span>
            <span class="n">za2MolesTwo</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">GetZa2Moles</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># Zero-value missing za&#39;s</span>
            <span class="c">###</span>
            <span class="n">za2MolesOne</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">za</span> <span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">za</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">za2MolesTwo</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">za2MolesOne</span><span class="p">)});</span>
            <span class="n">za2MolesTwo</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">za</span> <span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">za</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">za2MolesOne</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">za2MolesTwo</span><span class="p">)});</span>
            <span class="c">###</span>
            <span class="c"># Calculate fractional difference</span>
            <span class="c">###</span>
            <span class="n">totalMoles</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">za2MolesOne</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">za2MolesTwo</span><span class="o">.</span><span class="n">values</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="n">relativeDifferences</span> <span class="o">=</span> <span class="n">Array</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">za2MolesOne</span><span class="p">[</span><span class="n">za</span><span class="p">]</span> <span class="o">-</span> <span class="n">za2MolesTwo</span><span class="p">[</span><span class="n">za</span><span class="p">])</span> <span class="o">/</span> <span class="n">totalMoles</span> <span class="k">for</span> <span class="n">za</span> <span class="ow">in</span> <span class="n">za2MolesOne</span><span class="p">]);</span>
            <span class="c">###</span>
            <span class="c"># Calculate convergence norm</span>
            <span class="c">###</span>
            <span class="n">normType</span> <span class="o">=</span> <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isotopicsConvergenceNormType&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="n">normType</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;one&#39;</span><span class="p">):</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="n">relativeDifferences</span><span class="o">.</span><span class="n">mean</span><span class="p">();</span>
            <span class="k">elif</span> <span class="n">normType</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">):</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">relativeDifferences</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
            <span class="k">elif</span> <span class="n">normType</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">,</span> <span class="s">&#39;infinite&#39;</span><span class="p">,</span> <span class="s">&#39;infinity&#39;</span><span class="p">):</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="n">relativeDifferences</span><span class="o">.</span><span class="n">max</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="k">return</span> <span class="n">norm</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return fractional difference between system total isotopics.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">__sub__</span><span class="p">(</span><span class="n">other</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="McnpInputFile.GetAngles"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetAngles">[docs]</a>    <span class="k">def</span> <span class="nf">GetAngles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return angle cards.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetCellBlock"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetCellBlock">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return block of cell cards.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellBlock</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetCellNumberDecayPower"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetCellNumberDecayPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberDecayPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">za2WattsPerMole</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return decay power for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">moles</span> <span class="o">*</span> <span class="n">za2WattsPerMole</span><span class="p">[</span><span class="n">za</span><span class="p">]</span> <span class="k">for</span> <span class="n">za</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetZa2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">za</span> <span class="ow">in</span> <span class="n">za2WattsPerMole</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetCellNumberPaths"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetCellNumberPaths">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberPaths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return hierarchical path for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumber2Paths</span><span class="p">()[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetCellNumber2Paths"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetCellNumber2Paths">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumber2Paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping cell to hierarchical path.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Paths</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetCells"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetCells">[docs]</a>    <span class="k">def</span> <span class="nf">GetCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of cells.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetCellNumbers"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetCellNumbers">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumbers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of cell numbers.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumbers</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetDataBlock"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetDataBlock">[docs]</a>    <span class="k">def</span> <span class="nf">GetDataBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return block of data cards.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataBlock</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetEnergys"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetEnergys">[docs]</a>    <span class="k">def</span> <span class="nf">GetEnergys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return energy cards.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">energys</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetFileName"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetFileName">[docs]</a>    <span class="k">def</span> <span class="nf">GetFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return filename.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetFissionCells"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetFissionCells">[docs]</a>    <span class="k">def</span> <span class="nf">GetFissionCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of cells which contain fissile isotopes.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">fissionCells</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">():</span>
            <span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindCellMaterial</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">ZaIsActinide</span><span class="p">(</span><span class="n">za</span><span class="p">)</span> <span class="ow">and</span> <span class="n">za</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">89225</span><span class="p">,</span> <span class="mi">89226</span><span class="p">,</span> <span class="mi">99253</span><span class="p">)</span> <span class="k">for</span> <span class="n">za</span> <span class="ow">in</span> <span class="n">material</span><span class="o">.</span><span class="n">GetZas</span><span class="p">()):</span>
                <span class="n">fissionCells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">fissionCells</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetHeavyMetalMT"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetHeavyMetalMT">[docs]</a>    <span class="k">def</span> <span class="nf">GetHeavyMetalMT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return syystem total metric tonnes of heavy metal.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetHeavyMetalMT</span><span class="p">()</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">()</span> <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMaterialNumber</span><span class="p">());</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetInputRaw"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetInputRaw">[docs]</a>    <span class="k">def</span> <span class="nf">GetInputRaw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return text.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputRaw</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetIsKcode"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetIsKcode">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsKcode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if it is a criticality problem.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNamedCard</span><span class="p">(</span><span class="s">&#39;kcode&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetInputRawWithoutComments"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetInputRawWithoutComments">[docs]</a>    <span class="k">def</span> <span class="nf">GetInputRawWithoutComments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return text without comments.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputRawWithoutComments</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetIsCoupled"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetIsCoupled">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsCoupled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if photons are considered.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="s">&#39;p&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMode</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetIsMultiplyRootedLeafCell"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetIsMultiplyRootedLeafCell">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsMultiplyRootedLeafCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leafCell</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if a cell appears in multiple root cells.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">leafCell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMultiplyRootedLeafCells</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetMultiplyRootedLeafCell"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetMultiplyRootedLeafCell">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplyRootedLeafCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leafCell</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return path for a cell which appears in multiple root cells.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMultiplyRootedLeafCells</span><span class="p">()[</span><span class="n">leafCell</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetMultiplyRootedLeafCells"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetMultiplyRootedLeafCells">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplyRootedLeafCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping cell to path for cells which appear in multiple root cells.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplyRootedLeafCells</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetMaterials"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetMaterials">[docs]</a>    <span class="k">def</span> <span class="nf">GetMaterials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of materials.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetMaterialNumbers"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetMaterialNumbers">[docs]</a>    <span class="k">def</span> <span class="nf">GetMaterialNumbers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of material numbers.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">materialNumbers</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetMode"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetMode">[docs]</a>    <span class="k">def</span> <span class="nf">GetMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return particle mode (n, p, or np).&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetNamedCard</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetNamedCard"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetNamedCard">[docs]</a>    <span class="k">def</span> <span class="nf">GetNamedCard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cardName</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of named cards for a variety.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">namedCards</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNamedCards</span><span class="p">();</span>
        <span class="k">if</span> <span class="n">cardName</span> <span class="ow">in</span> <span class="n">namedCards</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">namedCards</span><span class="p">[</span><span class="n">cardName</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetNamedCards"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetNamedCards">[docs]</a>    <span class="k">def</span> <span class="nf">GetNamedCards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary of named cards.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetOutputRaw"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetOutputRaw">[docs]</a>    <span class="k">def</span> <span class="nf">GetOutputRaw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return text for associated output.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputRaw</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetPowerCells"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetPowerCells">[docs]</a>    <span class="k">def</span> <span class="nf">GetPowerCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of cells which are dense enough to provide power.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">powerCells</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">():</span>
            <span class="c">###</span>
            <span class="c"># Kick out immaterial cells</span>
            <span class="c"># Only cells with materials can contribute directly to heating</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMaterialNumber</span><span class="p">():</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Kick out low-density cells</span>
            <span class="c"># Low-density cells are assumed to not contribute sufficiently to heating</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMaterialDensity</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMassDensity</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;minimumCellMassDensityCutoff&#39;</span><span class="p">):</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">powerCells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">powerCells</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetSurfaces"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetSurfaces">[docs]</a>    <span class="k">def</span> <span class="nf">GetSurfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of surface cards.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetSurfaceBlock"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetSurfaceBlock">[docs]</a>    <span class="k">def</span> <span class="nf">GetSurfaceBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return block of surface cards.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaceBlock</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetTallyIndices"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetTallyIndices">[docs]</a>    <span class="k">def</span> <span class="nf">GetTallyIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mnemonic</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return spaces for a tally type mnemonic.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallyType2Indices</span><span class="p">()[</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetTallyType2Indices"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetTallyType2Indices">[docs]</a>    <span class="k">def</span> <span class="nf">GetTallyType2Indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping tally type mnemonic to spaces.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tallyType2Indices</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetTallys"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetTallys">[docs]</a>    <span class="k">def</span> <span class="nf">GetTallys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mnemonic</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of tally cards.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">mnemonic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">tally</span> <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">()</span> <span class="k">if</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetMnemonic</span><span class="p">()</span> <span class="o">==</span> <span class="n">mnemonic</span><span class="p">);</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tallys</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetZa2Moles"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetZa2Moles">[docs]</a>    <span class="k">def</span> <span class="nf">GetZa2Moles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to system total moles.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">za2Moles</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMaterialNumber</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">za</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetZa2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">za2Moles</span><span class="p">[</span><span class="n">za</span><span class="p">]</span> <span class="o">+=</span> <span class="n">moles</span><span class="p">;</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">za2Moles</span><span class="p">[</span><span class="n">za</span><span class="p">]</span> <span class="o">=</span> <span class="n">moles</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">za2Moles</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Constructed getter methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.FindCell"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.FindCell">[docs]</a>    <span class="k">def</span> <span class="nf">FindCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find a cell by cell number.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumbers</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.FindCellMaterial"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.FindCellMaterial">[docs]</a>    <span class="k">def</span> <span class="nf">FindCellMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find a cell material by cell number.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cell</span><span class="p">:</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">materialNumber</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMaterialNumber</span><span class="p">();</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindMaterial</span><span class="p">(</span><span class="n">materialNumber</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.FindCellSurfaces"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.FindCellSurfaces">[docs]</a>    <span class="k">def</span> <span class="nf">FindCellSurfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find cell surfaces by cell number.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cell</span><span class="p">:</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">surfaceNumbers</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">surfaceNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">surfaceNumber</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetSurfaceNumbers</span><span class="p">());</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">surface</span> <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSurfaces</span><span class="p">()</span> <span class="k">if</span> <span class="n">surface</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()</span> <span class="ow">in</span> <span class="n">surfaceNumbers</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.FindLeafCells"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.FindLeafCells">[docs]</a>    <span class="k">def</span> <span class="nf">FindLeafCells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cells</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find cells contained within a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">leafCells</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="c">###</span>
            <span class="c"># Accumulate leafcell tree</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetFillUniverse</span><span class="p">():</span>
                    <span class="c">###</span>
                    <span class="c"># Grab child nodes</span>
                    <span class="c">###</span>
                    <span class="n">leafCells</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FindLeafCells</span><span class="p">(</span><span class="n">childCell</span> <span class="k">for</span> <span class="n">childCell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">()</span> <span class="k">if</span> <span class="n">childCell</span><span class="o">.</span><span class="n">GetUniverse</span><span class="p">()</span> <span class="o">==</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetFillUniverse</span><span class="p">()));</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="c"># Grab current node</span>
                    <span class="c">###</span>
                    <span class="n">leafCells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">leafCells</span><span class="p">);</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindLeafCells</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cells</span><span class="p">));</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindLeafCells</span><span class="p">([</span><span class="n">cells</span><span class="p">]);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.FindMaterial"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.FindMaterial">[docs]</a>    <span class="k">def</span> <span class="nf">FindMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materialNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find a material by material number.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">materialNumber</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMaterials</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetMaterialNumbers</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">materialNumber</span><span class="p">)];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.FindRootCells"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.FindRootCells">[docs]</a>    <span class="k">def</span> <span class="nf">FindRootCells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cells</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find cells which contain a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rootCells</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="c">###</span>
            <span class="c"># Accumulate rootcell tree</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetUniverse</span><span class="p">():</span>
                    <span class="c">###</span>
                    <span class="c"># Grab parent nodes</span>
                    <span class="c">###</span>
                    <span class="n">rootCells</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FindRootCells</span><span class="p">(</span><span class="n">parentCell</span> <span class="k">for</span> <span class="n">parentCell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">()</span> <span class="k">if</span> <span class="n">parentCell</span><span class="o">.</span><span class="n">GetFillUniverse</span><span class="p">()</span> <span class="o">==</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetUniverse</span><span class="p">()));</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="c"># Grab current nodes</span>
                    <span class="c">###</span>
                    <span class="n">rootCells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">rootCells</span><span class="p">);</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindRootCells</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cells</span><span class="p">));</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindRootCells</span><span class="p">([</span><span class="n">cells</span><span class="p">]);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.FindSingleZaidMaterialNumber"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.FindSingleZaidMaterialNumber">[docs]</a>    <span class="k">def</span> <span class="nf">FindSingleZaidMaterialNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zaid</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find material number which contains a single isotope.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">material</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMaterials</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">GetIsSingleIsotope</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="n">material</span><span class="o">.</span><span class="n">GetZaids</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">material</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="c"># Input card stripping methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.Block2SingleLineCards"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.Block2SingleLineCards">[docs]</a>    <span class="k">def</span> <span class="nf">Block2SingleLineCards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return card blocks with newlines and continuations stripped.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">reIndent</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^( {5,}|\t)&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
        <span class="n">reAmpersand</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;&amp;\s{1,}$&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="n">cards</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="n">continuation</span> <span class="o">=</span> <span class="bp">False</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="n">continuation</span> <span class="o">|=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">reIndent</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">));</span>
            <span class="k">if</span> <span class="n">continuation</span><span class="p">:</span>
                <span class="n">cards</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">line</span><span class="p">;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="n">continuation</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">reAmpersand</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">cards</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetCellCards"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetCellCards">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellCards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of cell cards.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Block2SingleLineCards</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCellBlock</span><span class="p">());</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetDataCards"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetDataCards">[docs]</a>    <span class="k">def</span> <span class="nf">GetDataCards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of data cards.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Block2SingleLineCards</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDataBlock</span><span class="p">());</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetSurfaceCards"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetSurfaceCards">[docs]</a>    <span class="k">def</span> <span class="nf">GetSurfaceCards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of surface cards.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Block2SingleLineCards</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetSurfaceBlock</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="c"># Population methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.Populate"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.Populate">[docs]</a>    <span class="k">def</span> <span class="nf">Populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Populate input blocks</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopulateInputBlocks</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Populate cells</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">McnpCell</span><span class="p">(</span><span class="n">cellCard</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellCard</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellCards</span><span class="p">()[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">]];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">()];</span>
        <span class="c">###</span>
        <span class="c"># Populate cell heirarchy</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopulateCellHeirarchy</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Populate surfaces</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">McnpSurface</span><span class="p">(</span><span class="n">surfaceCard</span><span class="p">)</span> <span class="k">for</span> <span class="n">surfaceCard</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSurfaceCards</span><span class="p">()];</span>
        <span class="c">###</span>
        <span class="c"># Populate data cards</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopulateDataCards</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Populate cell material attributes</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopulateCellMaterialAttributes</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Populate tally energys, angles, and spaces and cell flux multiplier tally bins</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopulateTallySpecifics</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Populate cell -&gt; tally indices</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopulateTallyIndices</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.PopulateInputBlocks"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.PopulateInputBlocks">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateInputBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Extract cell, surface, and data blocks.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># cell block, surface block, data block</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputRawWithoutComments</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;$&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetInputRaw</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span> <span class="p">:</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;c &#39;</span><span class="p">))</span><span class="o">.</span><span class="n">rstrip</span><span class="p">();</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellBlock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaceBlock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataBlock</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;\n[ \t]*\n&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetInputRawWithoutComments</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.PopulateCellHeirarchy"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.PopulateCellHeirarchy">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateCellHeirarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Determine hierarchy of cells.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Build childCell -&gt; parentCells</span>
        <span class="c">###</span>
        <span class="n">cell2ParentCells</span> <span class="o">=</span> <span class="p">{</span><span class="n">childCell</span> <span class="p">:</span> <span class="p">[</span><span class="n">parentCell</span> <span class="k">for</span> <span class="n">parentCell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">()</span> <span class="k">if</span> <span class="n">childCell</span><span class="o">.</span><span class="n">GetUniverse</span><span class="p">()</span> <span class="k">if</span> <span class="n">parentCell</span><span class="o">.</span><span class="n">GetFillUniverse</span><span class="p">()</span> <span class="o">==</span> <span class="n">childCell</span><span class="o">.</span><span class="n">GetUniverse</span><span class="p">()]</span> <span class="k">for</span> <span class="n">childCell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">()};</span>
        <span class="c">###</span>
        <span class="c"># Populated leafCell -&gt; ... -&gt; rootCell paths</span>
        <span class="c"># Depth-first searches are performed, ascending from each leafCell</span>
        <span class="c">###</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="n">branches</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sorted</span><span class="p">([</span><span class="n">leafCell</span> <span class="k">for</span> <span class="n">leafCell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">leafCell</span><span class="o">.</span><span class="n">GetFillUniverse</span><span class="p">()],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)];</span>
        <span class="c">###</span>
        <span class="k">while</span> <span class="n">branches</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># New path based upon branch listing</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">branches</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c">###</span>
                <span class="c"># The current level has no branches</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">):</span>
                    <span class="c">###</span>
                    <span class="c"># No more branch levels exist</span>
                    <span class="c"># Break</span>
                    <span class="c">###</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Descend a level</span>
                <span class="c">###</span>
                <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">();</span>
                <span class="n">branches</span><span class="o">.</span><span class="n">pop</span><span class="p">();</span>
                <span class="c">###</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Move next branch to path</span>
                <span class="c">###</span>
                <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branches</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="n">parents</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cell2ParentCells</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
            <span class="k">while</span> <span class="n">parents</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Acsend to root cell, while keeping track of branching cells</span>
                <span class="c">###</span>
                <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parents</span><span class="o">.</span><span class="n">pop</span><span class="p">());</span>
                <span class="n">branches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parents</span><span class="p">);</span>
                <span class="n">parents</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cell2ParentCells</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Ascent is finished</span>
                <span class="c"># Note if it connects a leafCell to a rootCell</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetUniverse</span><span class="p">():</span>
                    <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="p">));</span>
                <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Convert cell paths -&gt; cell number paths</span>
        <span class="c">###</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">path</span><span class="p">]</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># Match redundant paths</span>
        <span class="c">###</span>
        <span class="n">matchSets</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">jndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)):</span>
                <span class="n">match</span> <span class="o">=</span> <span class="bp">True</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Kick out paths of unequal length</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">jndex</span><span class="p">]):</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="bp">False</span><span class="p">;</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="n">previous</span> <span class="o">=</span> <span class="bp">True</span><span class="p">;</span>
                <span class="k">for</span> <span class="n">kndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">index</span><span class="p">])):</span>
                    <span class="n">current</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">kndex</span><span class="p">]</span> <span class="o">==</span> <span class="n">paths</span><span class="p">[</span><span class="n">jndex</span><span class="p">][</span><span class="n">kndex</span><span class="p">];</span>
                    <span class="c">###</span>
                    <span class="c"># Kick out paths with non-matching leaf or root nodes</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="n">kndex</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">current</span><span class="p">:</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="bp">False</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="c">###</span>
                    <span class="c"># Kick out paths with two consecutive non-matching nodes</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">previous</span> <span class="ow">or</span> <span class="n">current</span><span class="p">):</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="bp">False</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="c">###</span>
                    <span class="n">previous</span> <span class="o">=</span> <span class="n">current</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="c"># The two paths match</span>
                    <span class="c"># Add them to the set of matching paths or ...</span>
                    <span class="c">###</span>
                    <span class="n">matchNoted</span> <span class="o">=</span> <span class="bp">False</span><span class="p">;</span>
                    <span class="k">for</span> <span class="n">matchSet</span> <span class="ow">in</span> <span class="n">matchSets</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">kndex</span> <span class="ow">in</span> <span class="n">matchSet</span> <span class="k">for</span> <span class="n">kndex</span> <span class="ow">in</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">jndex</span><span class="p">)):</span>
                            <span class="n">matchNoted</span> <span class="o">=</span> <span class="bp">True</span><span class="p">;</span>
                            <span class="n">matchSet</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">jndex</span><span class="p">));</span>
                    <span class="c">###</span>
                    <span class="c"># ... create a new set of matching paths</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">matchNoted</span><span class="p">:</span>
                        <span class="n">matchSets</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">index</span><span class="p">,</span> <span class="n">jndex</span><span class="p">});</span>
        <span class="c">###</span>
        <span class="c"># Merge redundant paths</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Paths</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">for</span> <span class="n">matchSet</span> <span class="ow">in</span> <span class="n">matchSets</span><span class="p">:</span>
            <span class="n">mergedPath</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="n">cellNumber</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">matchSet</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cellNumber</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">cellNumber</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
                <span class="k">for</span> <span class="n">jndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">index</span><span class="p">])):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">mergedPath</span><span class="p">[</span><span class="n">jndex</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">paths</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">jndex</span><span class="p">],</span> <span class="p">));</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">mergedPath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="n">paths</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">jndex</span><span class="p">],</span> <span class="p">)));</span>
            <span class="n">mergedPath</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">mergedPath</span><span class="p">];</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mergedPath</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mergedPath</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">cellNumber</span> <span class="o">=</span> <span class="n">mergedPath</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Paths</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mergedPath</span><span class="p">);</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Paths</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mergedPath</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># Populate multiply-rooted leaf cells</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplyRootedLeafCells</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span> <span class="k">for</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">paths</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumber2Paths</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">};</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.PopulateDataCards"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.PopulateDataCards">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateDataCards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate the many named data card types.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Populate defaults</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c">###</span>
            <span class="c"># title</span>
            <span class="c">###</span>
            <span class="s">&#39;title&#39;</span> <span class="p">:</span> <span class="n">McnpCard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetInputRaw</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="c">###</span>
            <span class="c"># Uncoupled neutron transport</span>
            <span class="c">###</span>
            <span class="s">&#39;mode&#39;</span>  <span class="p">:</span> <span class="n">McnpCard</span><span class="p">(</span><span class="s">&#39;mode n&#39;</span><span class="p">),</span>
        <span class="p">};</span>
        <span class="c">###</span>
        <span class="c"># Initialize multi-card containers</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;angles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energys</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;energys&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materialNumbers</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tallys</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;tallyComments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;thermalScatters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="c">###</span>
        <span class="c"># Define regex&#39;s for mnemonic and tally number</span>
        <span class="c">###</span>
        <span class="n">reMnemonic</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^[\*]?([a-z]{1,5})&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
        <span class="n">reTallyNumber</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;(\d{1,8})&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Parse data cards</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">dataCard</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDataCards</span><span class="p">():</span>
            <span class="n">mnemonic</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">dataCard</span><span class="o">.</span><span class="n">split</span><span class="p">()][</span><span class="mi">0</span><span class="p">];</span>
            <span class="n">mnemonicLetters</span> <span class="o">=</span> <span class="n">reMnemonic</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># Problem type cards</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">mnemonicLetters</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># mode</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;mode&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">McnpCard</span><span class="p">(</span><span class="n">dataCard</span><span class="p">);</span>
                    <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Geometry cards</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">mnemonicLetters</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;vol&#39;</span><span class="p">,</span> <span class="s">&#39;area&#39;</span><span class="p">,</span> <span class="s">&#39;u&#39;</span><span class="p">,</span> <span class="s">&#39;trcl&#39;</span><span class="p">,</span> <span class="s">&#39;lat&#39;</span><span class="p">,</span> <span class="s">&#39;fill&#39;</span><span class="p">,</span> <span class="s">&#39;tr&#39;</span><span class="p">,</span> <span class="s">&#39;uran&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># volumes</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;vol&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">dataCard</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">]:</span>
                        <span class="k">if</span> <span class="s">&#39;j&#39;</span> <span class="ow">in</span> <span class="n">volume</span><span class="p">:</span>
                            <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">volume</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;j&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)));</span>
                            <span class="n">volumes</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="n">number</span><span class="p">);</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">volumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">volume</span><span class="p">));</span>
                    <span class="c">###</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">():</span>
                        <span class="n">cell</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="n">volumes</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
                        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Source specification cards</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">mnemonicLetters</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;sdef&#39;</span><span class="p">,</span> <span class="s">&#39;si&#39;</span><span class="p">,</span> <span class="s">&#39;sp&#39;</span><span class="p">,</span> <span class="s">&#39;sb&#39;</span><span class="p">,</span> <span class="s">&#39;ds&#39;</span><span class="p">,</span> <span class="s">&#39;sc&#39;</span><span class="p">,</span> <span class="s">&#39;ssw&#39;</span><span class="p">,</span> <span class="s">&#39;ssr&#39;</span><span class="p">,</span> <span class="s">&#39;kcode&#39;</span><span class="p">,</span> <span class="s">&#39;ksrc&#39;</span><span class="p">,</span> <span class="s">&#39;hsrc&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># sdef</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;sdef&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;sdef&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">McnpCard</span><span class="p">(</span><span class="n">dataCard</span><span class="p">);</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># kcode</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;kcode&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;kcode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">McnpCard</span><span class="p">(</span><span class="n">dataCard</span><span class="p">);</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># ksrc</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;ksrc&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;ksrc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">McnpCard</span><span class="p">(</span><span class="n">dataCard</span><span class="p">);</span>
                    <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Tally specification cards</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">mnemonicLetters</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;fc&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;fq&#39;</span><span class="p">,</span> <span class="s">&#39;fm&#39;</span><span class="p">,</span> <span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="s">&#39;df&#39;</span><span class="p">,</span> <span class="s">&#39;em&#39;</span><span class="p">,</span> <span class="s">&#39;tm&#39;</span><span class="p">,</span> <span class="s">&#39;cm&#39;</span><span class="p">,</span> <span class="s">&#39;cf&#39;</span><span class="p">,</span> <span class="s">&#39;sf&#39;</span><span class="p">,</span> <span class="s">&#39;fs&#39;</span><span class="p">,</span> <span class="s">&#39;sd&#39;</span><span class="p">,</span> <span class="s">&#39;fu&#39;</span><span class="p">,</span> <span class="s">&#39;tf&#39;</span><span class="p">,</span> <span class="s">&#39;dd&#39;</span><span class="p">,</span> <span class="s">&#39;dxt&#39;</span><span class="p">,</span> <span class="s">&#39;ft&#39;</span><span class="p">,</span> <span class="s">&#39;fmesh&#39;</span><span class="p">,</span> <span class="s">&#39;spdtl&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># tally</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="n">mnemonicLetters</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;fm&#39;</span><span class="p">):</span>
                    <span class="n">tallyNumber</span> <span class="o">=</span> <span class="n">reTallyNumber</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                    <span class="n">tallyType</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tallyNumber</span><span class="p">))</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">tallyType</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tallys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpSurfaceCurrentTally</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="k">if</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">tallyType</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tallys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpSurfaceFluxTally</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="k">if</span> <span class="mi">4</span> <span class="o">==</span> <span class="n">tallyType</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s">&#39;f&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tallys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpCellFluxTally</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                        <span class="k">elif</span> <span class="s">&#39;fm&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tallys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpCellFluxMultiplierTally</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="k">if</span> <span class="mi">5</span> <span class="o">==</span> <span class="n">tallyType</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s">&#39;f&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tallys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpDetectorTally</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                        <span class="k">elif</span> <span class="s">&#39;fm&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tallys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpDetectorMultiplierTally</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="k">if</span> <span class="mi">6</span> <span class="o">==</span> <span class="n">tallyType</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tallys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpCellEnergyDepositionTally</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="k">if</span> <span class="mi">7</span> <span class="o">==</span> <span class="n">tallyType</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tallys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpCellFissionEnergyDepositionTally</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="k">if</span> <span class="mi">8</span> <span class="o">==</span> <span class="n">tallyType</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tallys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpCellPulseHeightTally</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                        <span class="k">continue</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># tally comment</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;fc&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;tallyComments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpCard</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># energys</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;e&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="n">energyNumber</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)));</span>
                    <span class="n">stringEnergys</span> <span class="o">=</span> <span class="n">dataCard</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">];</span>
                    <span class="n">energys</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stringEnergys</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="s">&#39;log&#39;</span> <span class="ow">in</span> <span class="n">stringEnergys</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                            <span class="n">energys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">LogSpace</span><span class="p">(</span><span class="n">NaturalLogarithm</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">stringEnergys</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="n">NaturalLogarithm</span><span class="p">(</span><span class="mf">10.</span><span class="p">),</span> <span class="n">NaturalLogarithm</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">stringEnergys</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="n">NaturalLogarithm</span><span class="p">(</span><span class="mf">10.</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">stringEnergys</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;ilog&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">energys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">stringEnergys</span><span class="p">[</span><span class="n">index</span><span class="p">]));</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">energys</span><span class="p">[</span><span class="n">energyNumber</span><span class="p">]</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">energys</span><span class="p">);</span>
                    <span class="c">###</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;energys&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpCard</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># angles</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;c&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="n">angleNumber</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)));</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">angleNumber</span><span class="p">]</span> <span class="o">=</span> <span class="n">Array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">dataCard</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span> <span class="p">:</span> <span class="p">]]);</span>
                    <span class="c">###</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;angles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpCard</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                    <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Material specification cards</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">mnemonicLetters</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;mpn&#39;</span><span class="p">,</span> <span class="s">&#39;drxs&#39;</span><span class="p">,</span> <span class="s">&#39;totnu&#39;</span><span class="p">,</span> <span class="s">&#39;nonu&#39;</span><span class="p">,</span> <span class="s">&#39;awtab&#39;</span><span class="p">,</span> <span class="s">&#39;xs&#39;</span><span class="p">,</span> <span class="s">&#39;void&#39;</span><span class="p">,</span> <span class="s">&#39;pikmt&#39;</span><span class="p">,</span> <span class="s">&#39;mgopt&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># materials</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;m&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpMaterial</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">materialNumbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">());</span>
                    <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Energy and thermal treatment specification cards</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">mnemonicLetters</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;phys&#39;</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;thyme&#39;</span><span class="p">,</span> <span class="s">&#39;mt&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># thermal scatter library</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;mt&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;thermalScatters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">McnpCard</span><span class="p">(</span><span class="n">dataCard</span><span class="p">));</span>
                    <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Problem cutoff cards</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">mnemonicLetters</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;cut&#39;</span><span class="p">,</span> <span class="s">&#39;elpt&#39;</span><span class="p">,</span> <span class="s">&#39;notrn&#39;</span><span class="p">,</span> <span class="s">&#39;nps&#39;</span><span class="p">,</span> <span class="s">&#39;ctme&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># nps</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;nps&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;nps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">McnpCard</span><span class="p">(</span><span class="n">dataCard</span><span class="p">);</span>
                    <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># User data arrays</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">mnemonicLetters</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;idum&#39;</span><span class="p">,</span> <span class="s">&#39;rdum&#39;</span><span class="p">):</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Peripheral cards</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">mnemonicLetters</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;prdmp&#39;</span><span class="p">,</span> <span class="s">&#39;lost&#39;</span><span class="p">,</span> <span class="s">&#39;rand&#39;</span><span class="p">,</span> <span class="s">&#39;dbcn&#39;</span><span class="p">,</span> <span class="s">&#39;files&#39;</span><span class="p">,</span> <span class="s">&#39;print&#39;</span><span class="p">,</span> <span class="s">&#39;talnp&#39;</span><span class="p">,</span> <span class="s">&#39;mplot&#39;</span><span class="p">,</span> <span class="s">&#39;ptrac&#39;</span><span class="p">,</span> <span class="s">&#39;pert&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># print tables</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="s">&#39;print&#39;</span> <span class="o">==</span> <span class="n">mnemonicLetters</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">namedCards</span><span class="p">[</span><span class="s">&#39;print&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">McnpCard</span><span class="p">(</span><span class="n">dataCard</span><span class="p">);</span>
                    <span class="k">continue</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.PopulateCellMaterialAttributes"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.PopulateCellMaterialAttributes">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateCellMaterialAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate the many named data card types.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Calculate cell number densities, regardless of material density / fraction provided</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">():</span>
            <span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindCellMaterial</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="c"># Kick out immaterial cells</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">material</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">composition</span> <span class="o">=</span> <span class="n">MaterialComposition</span><span class="p">(</span><span class="n">materialDensity</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMaterialDensity</span><span class="p">(),</span> <span class="n">isotope2Fraction</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">GetZaid2Fraction</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;numberDensity&#39;</span><span class="p">,</span> <span class="s">&#39;massDensity&#39;</span><span class="p">,</span> <span class="s">&#39;cellMolarMass&#39;</span><span class="p">,</span> <span class="s">&#39;isotope2AtomFraction&#39;</span><span class="p">,</span> <span class="s">&#39;isotope2WeightFraction&#39;</span><span class="p">,</span> <span class="s">&#39;isotope2NumberDensity&#39;</span><span class="p">,</span> <span class="s">&#39;isotope2MassDensity&#39;</span><span class="p">,</span> <span class="s">&#39;suffix&#39;</span><span class="p">,</span> <span class="s">&#39;zas&#39;</span><span class="p">):</span>
                <span class="n">myAttribute</span> <span class="o">=</span> <span class="n">attribute</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;isotope&#39;</span><span class="p">,</span> <span class="s">&#39;zaid&#39;</span><span class="p">);</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">myAttribute</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">composition</span><span class="p">,</span> <span class="n">attribute</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.PopulateTallySpecifics"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.PopulateTallySpecifics">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateTallySpecifics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Attach modifiers to tallys.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">():</span>
            <span class="c">###</span>
            <span class="c"># Attach energy bins</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">tallyNumber</span><span class="p">,</span> <span class="n">energyBins</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">tallyNumber</span> <span class="ow">or</span> <span class="n">tallyNumber</span> <span class="o">==</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">():</span>
                    <span class="n">tally</span><span class="o">.</span><span class="n">PopulateEnergys</span><span class="p">(</span><span class="n">energyBins</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Attach angle bins</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetMnemonic</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;f1&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">tallyNumber</span><span class="p">,</span> <span class="n">angleBins</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetAngles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">tallyNumber</span> <span class="ow">or</span> <span class="n">tallyNumber</span> <span class="o">==</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">():</span>
                        <span class="n">tally</span><span class="o">.</span><span class="n">PopulateAngles</span><span class="p">(</span><span class="n">angleBins</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Attach multiplier bins</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetMnemonic</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;fm4&#39;</span><span class="p">,</span> <span class="s">&#39;fm5&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># FM4 tallys inherit the particles and spaces of their sibling F4 tally</span>
                <span class="c">###</span>
                <span class="n">tally</span><span class="o">.</span><span class="n">PopulateSpaces</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">());</span>
                <span class="c">###</span>
                <span class="c"># Having the necessary information</span>
                <span class="c">###</span>
                <span class="n">tally</span><span class="o">.</span><span class="n">PopulateMultiplierBins</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">());</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tally</span><span class="o">.</span><span class="n">PopulateSpaces</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.PopulateTallyIndices"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.PopulateTallyIndices">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateTallyIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate lists of spaces which are tallied.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">tallyType2Indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">mnemonic</span> <span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">mnemonic</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;f1&#39;</span><span class="p">,</span> <span class="s">&#39;f2&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f5&#39;</span><span class="p">,</span> <span class="s">&#39;f6&#39;</span><span class="p">,</span> <span class="s">&#39;f7&#39;</span><span class="p">,</span> <span class="s">&#39;f8&#39;</span><span class="p">)};</span>
        <span class="n">tallyType2Indices</span><span class="p">[</span><span class="s">&#39;fm4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">():</span>
            <span class="c">###</span>
            <span class="c"># Kick out non-root and non-leaf (but not necessarily immaterial) cells</span>
            <span class="c"># Leaf cells contain physical materials and can contribute to reaction rates</span>
            <span class="c"># Root cells (redundantly) contain leaf cells but conveniently capture contributions from all their leaves</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetUniverse</span><span class="p">()</span> <span class="ow">and</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetFillUniverse</span><span class="p">():</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Straight cell tallys (F4, F6, F7)</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">mnemonic</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f6&#39;</span><span class="p">,</span> <span class="s">&#39;f7&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># Consider cell and its leaves</span>
                <span class="c">###</span>
                <span class="k">for</span> <span class="n">leafCell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindLeafCells</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">leafCell</span> <span class="ow">in</span> <span class="n">tally</span><span class="p">:</span>
                            <span class="n">tallyType2Indices</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="c"># Straight surface tallys (F1, F2)</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">mnemonic</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;f1&#39;</span><span class="p">,</span> <span class="s">&#39;f2&#39;</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># Kick out cells without cell flux tallys</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tallyType2Indices</span><span class="p">[</span><span class="s">&#39;f4&#39;</span><span class="p">]:</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Do not consider cell leaves</span>
                <span class="c">###</span>
                <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindCellSurfaces</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">tally</span><span class="p">:</span>
                            <span class="n">tallyType2Indices</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="c"># Cell multiplier tallys (FM4)</span>
            <span class="c">###</span>
            <span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;fm4&#39;</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Consider cell and its leaves</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">leafCell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindLeafCells</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span>
                <span class="n">leafCellNumber</span> <span class="o">=</span> <span class="n">leafCell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">();</span>
                <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">leafCell</span> <span class="ow">in</span> <span class="n">tally</span><span class="p">:</span>
                        <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">bin</span><span class="p">,</span> <span class="mi">0</span><span class="p">][</span><span class="nb">bin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">]</span> <span class="k">for</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="n">tallyBin</span><span class="p">[</span><span class="mi">2</span> <span class="p">:</span> <span class="p">])</span> <span class="k">for</span> <span class="n">tallyBin</span> <span class="ow">in</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetMultiplierBins</span><span class="p">()</span> <span class="k">if</span> <span class="n">leafCellNumber</span> <span class="o">==</span> <span class="n">tallyBin</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">tallyType2Indices</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">][</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">indices</span><span class="p">);</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="n">tallyType2Indices</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">][</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()]</span> <span class="o">=</span> <span class="n">indices</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Unique sort indices</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">mnemonic</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;f1&#39;</span><span class="p">,</span> <span class="s">&#39;f2&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;fm4&#39;</span><span class="p">,</span> <span class="s">&#39;f5&#39;</span><span class="p">,</span> <span class="s">&#39;f6&#39;</span><span class="p">,</span> <span class="s">&#39;f7&#39;</span><span class="p">,</span> <span class="s">&#39;f8&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">&#39;fm4&#39;</span> <span class="o">==</span> <span class="n">mnemonic</span><span class="p">:</span>
                <span class="n">tallyType2Indices</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">tallyType2Indices</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
                <span class="n">tallyType2Indices</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">value</span><span class="p">,</span> <span class="bp">None</span><span class="p">][</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">tallyType2Indices</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tallyType2Indices</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tallyType2Indices</span><span class="p">[</span><span class="n">mnemonic</span><span class="p">]));</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tallyType2Indices</span> <span class="o">=</span> <span class="n">tallyType2Indices</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Report methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.Report"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.Report">[docs]</a>    <span class="k">def</span> <span class="nf">Report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Offer summary or diagnostic reports to stdout.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">reportCells</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Extract material cells</span>
            <span class="c">###</span>
            <span class="n">cells</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cell</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCells</span><span class="p">()</span> <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMaterialDensity</span><span class="p">());</span>
            <span class="c">###</span>
            <span class="c"># cell # -&gt; material number, number density, mass density, volume, atoms, mass, temperature</span>
            <span class="c">###</span>
            <span class="n">PrintNow</span><span class="p">(</span>
                <span class="s">&#39;&gt; Cell material numbers, number densities, mass densities, volumes, atoms, masses, and temperatures&#39;</span><span class="p">,</span>
                <span class="s">&#39;{:^8}{:^12}{:^14}{:^11}{:^14}{:^14}{:^14}{:^17}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;Cell #&#39;</span><span class="p">,</span> <span class="s">&#39;Material #&#39;</span><span class="p">,</span> <span class="s">&#39;N [a/b·cm]&#39;</span><span class="p">,</span> <span class="s">&#39;ρ [g/cm³]&#39;</span><span class="p">,</span> <span class="s">&#39;Volume [cm³]&#39;</span><span class="p">,</span> <span class="s">&#39;Atoms [mol]&#39;</span><span class="p">,</span> <span class="s">&#39;Mass [g]&#39;</span><span class="p">,</span> <span class="s">&#39;Temperature [K]&#39;</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="s">&#39;{0.number:^8}{0.materialNumber:^12}{0.numberDensity:^14.6G}{0.massDensity:^11.4G}{0.volume:^14.6E}{1:^14.6E}{2:^14.6E}{3:^17.0G}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMoles</span><span class="p">(),</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMass</span><span class="p">(),</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetTemperature</span><span class="p">()</span> <span class="o">*</span> <span class="n">kelvinPerMev</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">),</span>
                <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># cell # -&gt; isotope, temperature id, temperature, number density, mass density, atoms, mass</span>
            <span class="c">###</span>
            <span class="n">PrintNow</span><span class="p">(</span>
                <span class="s">&#39;&gt; Cell isotopes, temperature ids, number densities, mass densities, atoms, and masses&#39;</span><span class="p">,</span>
                <span class="s">&#39;{:^8}{:^9}{:^17}{:^14}{:^11}{:^14}{:^14}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;Cell #&#39;</span><span class="p">,</span> <span class="s">&#39;Isotope&#39;</span><span class="p">,</span> <span class="s">&#39;Temperature [K]&#39;</span><span class="p">,</span> <span class="s">&#39;N [a/b·cm]&#39;</span><span class="p">,</span> <span class="s">&#39;ρ [g/cm³]&#39;</span><span class="p">,</span> <span class="s">&#39;Atoms [mol]&#39;</span><span class="p">,</span> <span class="s">&#39;Mass [g]&#39;</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="s">&#39;{:^8}{:^9}{:^17}{:^14.6G}{:^11.4G}{:^14.6E}{:^14.6E}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">(),</span> <span class="n">Zaid2Isotope</span><span class="p">(</span><span class="n">zaid</span><span class="p">),</span> <span class="s">&#39;.{} ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Zaid2Id</span><span class="p">(</span><span class="n">zaid</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">zaid2Temperature</span><span class="p">[</span><span class="n">zaid</span><span class="p">]</span> <span class="o">*</span> <span class="n">kelvinPerMev</span> <span class="o">/</span> <span class="mi">15</span><span class="p">))</span> <span class="o">*</span> <span class="mi">15</span><span class="p">),</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetZaidNumberDensity</span><span class="p">(</span><span class="n">zaid</span><span class="p">),</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetZaidMassDensity</span><span class="p">(</span><span class="n">zaid</span><span class="p">),</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetZaidMoles</span><span class="p">(</span><span class="n">zaid</span><span class="p">),</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetZaidMass</span><span class="p">(</span><span class="n">zaid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span> <span class="k">for</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">GetZaids</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="n">NumericStringKey</span><span class="p">)),</span>
                <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">reportIsotopes</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Union of isotopes</span>
            <span class="c">###</span>
            <span class="n">PrintNow</span><span class="p">(</span>
                <span class="s">&#39;&gt; All isotopes&#39;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">(</span><span class="s">&#39;{:&gt;10}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zaid</span><span class="p">)</span> <span class="k">for</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">({</span><span class="n">zaid</span> <span class="k">for</span> <span class="n">material</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMaterials</span><span class="p">()</span> <span class="k">for</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="n">material</span><span class="o">.</span><span class="n">GetZaids</span><span class="p">()},</span> <span class="n">key</span> <span class="o">=</span> <span class="n">NumericStringKey</span><span class="p">)),</span>
                <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">reportTallys</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># tally # -&gt; tally type, spaces</span>
            <span class="c">###</span>
            <span class="n">PrintNow</span><span class="p">(</span>
                <span class="s">&#39;&gt; Tally spaces&#39;</span><span class="p">,</span>
                <span class="s">&#39;{:^9}{:^6}{:^50}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;Tally #&#39;</span><span class="p">,</span> <span class="s">&#39;Type&#39;</span><span class="p">,</span> <span class="s">&#39;Surfaces or cells&#39;</span><span class="p">),</span>
                <span class="o">*</span><span class="p">(</span><span class="s">&#39;{0.number:^9}{0.mnemonic:^6}{1:^50}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tally</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">space</span><span class="p">)</span> <span class="k">for</span> <span class="n">space</span> <span class="ow">in</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetSpaces</span><span class="p">()))</span> <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">()),</span>
                <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Automated input file methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.AppendNewputCard"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.AppendNewputCard">[docs]</a>    <span class="k">def</span> <span class="nf">AppendNewputCard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Append a card to input.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newputRaw</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">card</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetIsUpdated"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetIsUpdated">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsUpdated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if input cards have been added or modified.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;newputRaw&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetNewputFileName"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetNewputFileName">[docs]</a>    <span class="k">def</span> <span class="nf">GetNewputFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depletionStep</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return file name for new input.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">();</span>
        <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">fileName</span><span class="p">:</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fileName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="s">&#39;{}.{:03d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">depletionStep</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.GetNewputRaw"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.GetNewputRaw">[docs]</a>    <span class="k">def</span> <span class="nf">GetNewputRaw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return new input text.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">newputRaw</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.ResetNewput"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.ResetNewput">[docs]</a>    <span class="k">def</span> <span class="nf">ResetNewput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Revert new input text to original text.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newputRaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetInputRaw</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.ReplaceNewputCard"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.ReplaceNewputCard">[docs]</a>    <span class="k">def</span> <span class="nf">ReplaceNewputCard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldCard</span><span class="p">,</span> <span class="n">newCard</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Modify an existing card.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;newputRaw&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ResetNewput</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">newCard</span><span class="p">:</span>
            <span class="n">newCard</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">newCard</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newputRaw</span> <span class="o">=</span> <span class="n">oldCard</span><span class="o">.</span><span class="n">GetRegex</span><span class="p">()</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">newCard</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNewputRaw</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpInputFile.ReplaceNamedNewputCard"><a class="viewcode-back" href="../src.html#MocDown.McnpInputFile.ReplaceNamedNewputCard">[docs]</a>    <span class="k">def</span> <span class="nf">ReplaceNamedNewputCard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldCardName</span><span class="p">,</span> <span class="n">newCard</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Modify an existing named card.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">oldCard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNamedCard</span><span class="p">(</span><span class="n">oldCardName</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ReplaceNewputCard</span><span class="p">(</span><span class="n">oldCard</span><span class="p">,</span> <span class="n">newCard</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MCNP output file parser</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="McnpOutputFile"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile">[docs]</a><span class="k">class</span> <span class="nc">McnpOutputFile</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;MCNP output file parser.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputRaw</span> <span class="o">=</span> <span class="n">ReadFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(),</span> <span class="n">display</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Populate</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return brief summary string.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&lt; Transport results summary for `{}</span><span class="se">\&#39;</span><span class="s"> &gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">())];</span>
        <span class="c">###</span>
        <span class="n">nameValue</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;keff&#39;</span><span class="p">,</span> <span class="s">&#39;{:.5f} ± {:.5f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetMultiplicationFactor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMultiplicationFactorSigma</span><span class="p">())),</span>
            <span class="p">(</span><span class="s">&#39;nu&#39;</span><span class="p">,</span> <span class="s">&#39;{:.3f}    [n/fiss]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetNeutronsPerFission</span><span class="p">())),</span>
            <span class="p">(</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="s">&#39;{:.2f}   [MeV/fiss]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetMevPerFission</span><span class="p">())),</span>
            <span class="p">(</span><span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="s">&#39;{:.5E} [n/s]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetSourceRate</span><span class="p">(</span><span class="n">realSourceRate</span> <span class="o">=</span> <span class="bp">True</span><span class="p">))),</span>
        <span class="p">);</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">nameValue</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;{:&lt;9s} = {:&gt;23s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;{:^59}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="McnpOutputFile.GetFileName"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetFileName">[docs]</a>    <span class="k">def</span> <span class="nf">GetFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return filename.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetOutputRaw"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetOutputRaw">[docs]</a>    <span class="k">def</span> <span class="nf">GetOutputRaw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return text.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputRaw</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetMevPerFission"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetMevPerFission">[docs]</a>    <span class="k">def</span> <span class="nf">GetMevPerFission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return effective MeV per fission.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mevPerFission</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetMcnpInputFile"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetMcnpInputFile">[docs]</a>    <span class="k">def</span> <span class="nf">GetMcnpInputFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return MCNP input file derived from output text.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcnpInputFile</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetMultiplicationFactor"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetMultiplicationFactor">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplicationFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return multiplication factor.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactor</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetMultiplicationFactorRV"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetMultiplicationFactorRV">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplicationFactorRV</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return multiplication factor random variable.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">RandomVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetMultiplicationFactor</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMultiplicationFactorSigma</span><span class="p">(),</span> <span class="n">isStd</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetMultiplicationFactorSigma"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetMultiplicationFactorSigma">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplicationFactorSigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return multiplication factor standard deviation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactorSigma</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetNeutronsPerFission"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetNeutronsPerFission">[docs]</a>    <span class="k">def</span> <span class="nf">GetNeutronsPerFission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return effective neutrons per fission.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">neutronsPerFission</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetSourceRate"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetSourceRate">[docs]</a>    <span class="k">def</span> <span class="nf">GetSourceRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">realSourceRate</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return system total neutron source rate.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
            <span class="k">if</span> <span class="n">realSourceRate</span><span class="p">:</span>
                <span class="n">multiplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMultiplicationFactor</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceRate</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">;</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Automated input file methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetIsUpdated"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetIsUpdated">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsUpdated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if an update is warranted.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetMcnpInputFile</span><span class="p">(),</span> <span class="s">&#39;newputRaw&#39;</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Physical quantity getter methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetCellNumberFissionPower"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetCellNumberFissionPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberFissionPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return fission power for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberQPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="s">&#39;mcnp&#39;</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetCellNumberFissionRate"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetCellNumberFissionRate">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberFissionRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;fm4&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return fission rate for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Accumulate fission rate from each leaf cell</span>
        <span class="c">###</span>
        <span class="n">reactionNumber</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberReactionRate</span><span class="p">(</span><span class="n">leafCell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindSingleZaidMaterialNumber</span><span class="p">(</span><span class="n">zaid</span><span class="p">),</span> <span class="n">reactionNumber</span><span class="p">,</span> <span class="n">doFloat</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">leafCell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindLeafCells</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindCellMaterial</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetZaids</span><span class="p">()</span> <span class="k">if</span> <span class="n">ZaIsActinide</span><span class="p">(</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">)));</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetCellNumberOrigenPower"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetCellNumberOrigenPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberOrigenPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">isOrigen2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return ORIGEN power for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberQPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">qMethod</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;origens&#39;</span><span class="p">,</span> <span class="s">&#39;origen2&#39;</span><span class="p">][</span><span class="n">isOrigen2</span><span class="p">]);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetCellNumberMicroscopicCrossSection"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetCellNumberMicroscopicCrossSection">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberMicroscopicCrossSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">materialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Derive one-group microscopic cross-section for a cell, isotope, and reaction.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># reactionNumber = -6 is synonymous with reactionNumber = 18</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="mi">18</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
            <span class="n">reactionNumber</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Ignore the possibility of leaf cells</span>
        <span class="c">###</span>
        <span class="n">scalarFlux</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">(</span><span class="s">&#39;f4&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">tally</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="c"># [n/cm²·sn]</span>
                    <span class="c">###</span>
                    <span class="n">scalarFlux</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tally</span><span class="o">.</span><span class="n">GetTallyResults</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">));</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="c"># Continue on fail</span>
                    <span class="c">###</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Kick out after a single tally</span>
                <span class="c">###</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Ignore the possibility of leaf cells</span>
        <span class="c">###</span>
        <span class="n">reactionsPerN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">(</span><span class="s">&#39;fm4&#39;</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Kick out tallies that do not contain cell</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">cellNumber</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tally</span><span class="p">:</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Ignore the possibility of non-unity multipliers</span>
                <span class="c"># [rxn/sn·N]</span>
                <span class="c">###</span>
                <span class="n">reactionsPerN</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tally</span><span class="o">.</span><span class="n">GetTallyResults</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="p">(</span><span class="n">materialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span><span class="p">)));</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Perhaps another tally for this cell contains the multiplier bins we want</span>
                <span class="c">###</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Kick out after a single tally</span>
            <span class="c">###</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="n">reactionsPerN</span><span class="p">,</span> <span class="n">scalarFlux</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetCellNumberParticlePower"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetCellNumberParticlePower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberParticlePower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;f6&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return prompt power for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">power</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Kick out tallies that do not contain cell</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">cellNumber</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tally</span><span class="p">:</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetMass</span><span class="p">()</span> <span class="o">*</span> <span class="n">joulePerMev</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># [Jth/sn]</span>
            <span class="c">###</span>
            <span class="n">power</span> <span class="o">+=</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetTallyResults</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">power</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSourceRate</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetCellNumberQPower"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetCellNumberQPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberQPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">qMethod</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return power for a cell using a number of reaction Q-values.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="s">&#39;mcnp&#39;</span> <span class="o">==</span> <span class="n">qMethod</span><span class="p">:</span>
            <span class="n">ZRs</span> <span class="o">=</span> <span class="p">((</span><span class="n">QFissionMCNP</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="p">);</span>
        <span class="k">elif</span> <span class="s">&#39;monteburns2&#39;</span> <span class="o">==</span> <span class="n">qMethod</span><span class="p">:</span>
            <span class="n">ZRs</span> <span class="o">=</span> <span class="p">((</span><span class="n">QFissionMonteburns2</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="p">);</span>
        <span class="k">elif</span> <span class="s">&#39;origen2&#39;</span> <span class="o">==</span> <span class="n">qMethod</span> <span class="ow">or</span> <span class="s">&#39;mocup&#39;</span> <span class="o">==</span> <span class="n">qMethod</span> <span class="ow">or</span> <span class="s">&#39;imocup&#39;</span> <span class="o">==</span> <span class="n">qMethod</span><span class="p">:</span>
            <span class="n">ZRs</span> <span class="o">=</span> <span class="p">((</span><span class="n">QFissionOrigen2</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="p">);</span>
        <span class="k">elif</span> <span class="s">&#39;origens&#39;</span> <span class="o">==</span> <span class="n">qMethod</span><span class="p">:</span>
            <span class="n">ZRs</span> <span class="o">=</span> <span class="p">((</span><span class="n">QFissionOrigenS</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="n">QCaptureOrigenS</span><span class="p">,</span> <span class="mi">102</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">joulePerMev</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">Za2Q</span><span class="p">(</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberReactionRate</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindSingleZaidMaterialNumber</span><span class="p">(</span><span class="n">zaid</span><span class="p">),</span> <span class="n">reactionNumber</span><span class="p">,</span> <span class="n">doFloat</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">zaid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindCellMaterial</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetZaids</span><span class="p">()</span> <span class="k">if</span> <span class="n">ZaIsActinide</span><span class="p">(</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">)))</span> <span class="k">for</span> <span class="n">Za2Q</span><span class="p">,</span> <span class="n">reactionNumber</span> <span class="ow">in</span> <span class="n">ZRs</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetCellNumberReactionRate"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetCellNumberReactionRate">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberReactionRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">materialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span><span class="p">,</span> <span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;fm4&#39;</span><span class="p">,</span> <span class="n">forMicro</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">doFloat</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Derive reaction rate for a cell, isotope, and reaction.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c">#</span>
        <span class="c">###</span>
        <span class="n">FloatHelper</span> <span class="o">=</span> <span class="nb">float</span><span class="p">;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">doFloat</span><span class="p">:</span>
            <span class="n">FloatHelper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="n">arg</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># reactionNumber = -6 is synonymous with reactionNumber = 18</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="mi">18</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
            <span class="n">reactionNumber</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Accumulate reaction rate from each leaf cell</span>
        <span class="c">###</span>
        <span class="n">totalReactionRatePerNumberDensity</span> <span class="o">=</span> <span class="n">totalVolume</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">leafCell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindLeafCells</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Use leaf cell materials if no material number is given</span>
            <span class="c">###</span>
            <span class="n">leafCellMaterialNumber</span> <span class="o">=</span> <span class="n">materialNumber</span> <span class="ow">or</span> <span class="n">leafCell</span><span class="o">.</span><span class="n">GetMaterialNumber</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="n">leafCellMaterial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindMaterial</span><span class="p">(</span><span class="n">leafCellMaterialNumber</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Divide by the number of physical instantiations of leaf cell</span>
            <span class="c">###</span>
            <span class="n">divisor</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsMultiplyRootedLeafCell</span><span class="p">(</span><span class="n">leafCell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()):</span>
                <span class="n">divisor</span> <span class="o">*=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetMultiplyRootedLeafCell</span><span class="p">(</span><span class="n">leafCell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">):</span>
                <span class="c">###</span>
                <span class="c"># Kick out tallies that do not contain leaf cell</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="n">leafCell</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tally</span><span class="p">:</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="k">for</span> <span class="n">multiplierBin</span> <span class="ow">in</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetMultiplierBins</span><span class="p">():</span>
                    <span class="c">###</span>
                    <span class="c"># Kick out multiplier bins that do not contain leaf cell number, reaction number</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">leafCellMaterialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">multiplierBin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">multiplierBin</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">multiplierBin</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="c">###</span>
                    <span class="c"># Volume</span>
                    <span class="c">###</span>
                    <span class="n">volume</span> <span class="o">=</span> <span class="n">leafCell</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">();</span>
                    <span class="n">totalVolume</span> <span class="o">+=</span> <span class="n">volume</span><span class="p">;</span>
                    <span class="c">###</span>
                    <span class="c"># Divide out non-unity multipliers</span>
                    <span class="c">###</span>
                    <span class="n">multiplier</span> <span class="o">=</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">multiplierBin</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
                    <span class="c">###</span>
                    <span class="c"># Multiply isotopic tallys by the number density</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">forMicro</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">leafCellMaterial</span><span class="o">.</span><span class="n">GetIsSingleIsotope</span><span class="p">():</span>
                            <span class="n">zaid</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">leafCellMaterial</span><span class="o">.</span><span class="n">GetZaids</span><span class="p">()));</span>
                            <span class="c">###</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">numberDensity</span> <span class="o">=</span> <span class="n">leafCell</span><span class="o">.</span><span class="n">GetZaidNumberDensity</span><span class="p">(</span><span class="n">zaid</span><span class="p">);</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                <span class="n">numberDensity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                            <span class="n">multiplier</span> <span class="o">*=</span> <span class="n">numberDensity</span><span class="p">;</span>
                    <span class="c">###</span>
                    <span class="c"># [rxn/sn] or [rxn/sn·N]</span>
                    <span class="c">###</span>
                    <span class="n">totalReactionRatePerNumberDensity</span> <span class="o">+=</span> <span class="n">FloatHelper</span><span class="p">(</span><span class="n">tally</span><span class="o">.</span><span class="n">GetTallyResults</span><span class="p">(</span><span class="n">leafCell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">(),</span> <span class="p">(</span><span class="n">leafCellMaterialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span><span class="p">)))</span> <span class="o">*</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="n">multiplier</span><span class="p">,</span> <span class="n">divisor</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">forMicro</span><span class="p">:</span>
            <span class="n">totalVolume</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="n">totalReactionRatePerNumberDensity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSourceRate</span><span class="p">(),</span> <span class="n">totalVolume</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetCellNumberScalarFlux"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetCellNumberScalarFlux">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberScalarFlux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;f4&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Derive scalar flux for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># flux = track length / volume</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberTrackLengthVolume</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">mnemonic</span><span class="p">));</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.GetCellNumberTrackLengthVolume"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.GetCellNumberTrackLengthVolume">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberTrackLengthVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">mnemonic</span> <span class="o">=</span> <span class="s">&#39;f4&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Derive track length and volume for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">totalTrackLength</span> <span class="o">=</span> <span class="n">totalVolume</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Accumulate track lengths and volumes from each leaf cell</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">leafCell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindLeafCells</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Volume;</span>
            <span class="c"># Divide by the number of physical instantiations of leaf cell</span>
            <span class="c">###</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="n">leafCell</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">();</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsMultiplyRootedLeafCell</span><span class="p">(</span><span class="n">leafCell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()):</span>
                <span class="n">volume</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetMultiplyRootedLeafCell</span><span class="p">(</span><span class="n">leafCell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()));</span>
            <span class="n">totalVolume</span> <span class="o">+=</span> <span class="n">volume</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Track length</span>
            <span class="c">###</span>
            <span class="n">trackLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">leafCell</span> <span class="ow">in</span> <span class="n">tally</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c">###</span>
                        <span class="c"># [n·cm/sn]</span>
                        <span class="c">###</span>
                        <span class="n">trackLength</span> <span class="o">+=</span> <span class="n">tally</span><span class="o">.</span><span class="n">GetTallyResults</span><span class="p">(</span><span class="n">leafCell</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">())</span> <span class="o">*</span> <span class="n">volume</span><span class="p">;</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="c">###</span>
                        <span class="c"># Continue on fail</span>
                        <span class="c">###</span>
                        <span class="k">continue</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">totalTrackLength</span> <span class="o">+=</span> <span class="n">trackLength</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">totalTrackLength</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSourceRate</span><span class="p">(),</span> <span class="n">totalVolume</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Population methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.Populate"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.Populate">[docs]</a>    <span class="k">def</span> <span class="nf">Populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Populate mcnp input file</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcnpInputFile</span> <span class="o">=</span> <span class="n">McnpInputFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetOutputRaw</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># Populate pointers to mcnp input file methods</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopulateMcnpInputFileMethods</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Populate tally results</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopulateTallyResults</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Populate kcode results</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsKcode</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PopulateMultiplicationResults</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.PopulateMcnpInputFileMethods"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.PopulateMcnpInputFileMethods">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateMcnpInputFileMethods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate methods derived from MCNP input.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">mcnpInputFileMethods</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&#39;FindCell&#39;</span><span class="p">,</span>
            <span class="s">&#39;FindCellMaterial&#39;</span><span class="p">,</span>
            <span class="s">&#39;FindLeafCells&#39;</span><span class="p">,</span>
            <span class="s">&#39;FindMaterial&#39;</span><span class="p">,</span>
            <span class="s">&#39;FindSingleZaidMaterialNumber&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetCells&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetFissionCells&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetInputRaw&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetIsCoupled&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetIsKcode&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetIsMultiplyRootedLeafCell&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetMaterials&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetMultiplyRootedLeafCell&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetNewputRaw&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetPowerCells&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetTallys&#39;</span><span class="p">,</span>
            <span class="s">&#39;GetTallyIndices&#39;</span><span class="p">,</span>
            <span class="s">&#39;ReplaceNewputCard&#39;</span><span class="p">,</span>
            <span class="s">&#39;ResetNewput&#39;</span><span class="p">,</span>
            <span class="p">);</span>
        <span class="c">###</span>
        <span class="n">mcnpInputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMcnpInputFile</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">mcnpInputFileMethods</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mcnpInputFile</span><span class="p">,</span> <span class="n">method</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.PopulateTallyResults"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.PopulateTallyResults">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateTallyResults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate tally results.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Parse tally results</span>
        <span class="c">###</span>
        <span class="n">tallyBlocks</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;1{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^1&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetOutputRaw</span><span class="p">())</span> <span class="k">if</span> <span class="s">&#39;tally &#39;</span> <span class="o">==</span> <span class="n">block</span><span class="p">[</span> <span class="p">:</span> <span class="mi">6</span><span class="p">]</span> <span class="ow">and</span> <span class="s">&#39;f&#39;</span> <span class="o">!=</span> <span class="n">block</span><span class="p">[</span><span class="mi">6</span><span class="p">]];</span>
        <span class="k">for</span> <span class="n">tally</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallys</span><span class="p">():</span>
            <span class="n">reTally</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^1tally *{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tally</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()),</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">tallyBlock</span> <span class="ow">in</span> <span class="n">tallyBlocks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">reTally</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">tallyBlock</span><span class="p">):</span>
                    <span class="n">tally</span><span class="o">.</span><span class="n">PopulateResults</span><span class="p">(</span><span class="n">tallyBlock</span><span class="p">);</span>
                    <span class="c">###</span>
                    <span class="k">break</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.PopulateMultiplicationResults"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.PopulateMultiplicationResults">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateMultiplicationResults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate multiplication factor results.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Kick out if multiplication results don&#39;t exist</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;final estimated&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetOutputRaw</span><span class="p">()):</span>
            <span class="ne">Warning</span><span class="p">(</span><span class="s">&#39;Transport output does not contain multiplication factor results&#39;</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neutronsPerFission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactorSigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mevPerFission</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Neutrons per fission</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neutronsPerFission</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;the average number of neutrons produced per fission = ([\d\.]{5})&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetOutputRaw</span><span class="p">())</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Multiplication factor and its counting uncertainty</span>
        <span class="c">###</span>
        <span class="n">multiplicationFactor</span><span class="p">,</span> <span class="n">multiplicationFactorSigma</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;the final estimated.+([\d\.]{7}) with an estimated.+([\d\.]{7})&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetOutputRaw</span><span class="p">())</span><span class="o">.</span><span class="n">groups</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">multiplicationFactor</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactorSigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">multiplicationFactorSigma</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Effective fission Q</span>
        <span class="c">###</span>
        <span class="n">fissionPower</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberFissionPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">))</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFissionCells</span><span class="p">());</span>
        <span class="n">fissionRate</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberFissionRate</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">))</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFissionCells</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mevPerFission</span> <span class="o">=</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="n">fissionPower</span> <span class="o">*</span> <span class="n">mevPerJoule</span><span class="p">,</span> <span class="n">fissionRate</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.PopulateSourceRate"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.PopulateSourceRate">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateSourceRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceRate</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Attach system total neutron source rate.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceRate</span> <span class="o">=</span> <span class="n">sourceRate</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Report methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.Report"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.Report">[docs]</a>    <span class="k">def</span> <span class="nf">Report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Offer summary or diagnostic reports to stdout.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">reportKeff</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Call __str__ method</span>
            <span class="c">###</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeEnergyDepositions</span><span class="p">:</span> <span class="c"># FIXME Thermal energy? Decay heat too?</span>
            <span class="c">###</span>
            <span class="k">pass</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeFissionEnergyDepositions</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Fission-Energy-Deposition</span>
            <span class="c"># F</span>
            <span class="c">###</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="s">&#39;{}.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetMcnpInputFile</span><span class="p">()</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(),</span> <span class="s">&#39;fedep&#39;</span><span class="p">);</span>
            <span class="n">tallyResults</span> <span class="o">=</span> <span class="p">{(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberFissionPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallyIndices</span><span class="p">(</span><span class="s">&#39;f4&#39;</span><span class="p">)};</span> <span class="c"># FIXME This is a float instead of a TallyResult!</span>
            <span class="c">###</span>
            <span class="n">baseUnits</span> <span class="o">=</span> <span class="s">&#39;J_f / source - &#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeFissionEnergyDepositions</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;ebin&#39;</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetPerBins&#39;</span><span class="p">,</span> <span class="s">&#39;{}Ebin&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseUnits</span><span class="p">);</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeFissionEnergyDepositions</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;energy&#39;</span><span class="p">,</span> <span class="s">&#39;mev&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetPerEnergys&#39;</span><span class="p">,</span> <span class="s">&#39;{}MeV&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseUnits</span><span class="p">);</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeFissionEnergyDepositions</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;lethargy&#39;</span><span class="p">,</span> <span class="s">&#39;leth&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetPerLethargys&#39;</span><span class="p">,</span> <span class="s">&#39;{}lethargy&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseUnits</span><span class="p">);</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeFissionEnergyDepositions</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;normalized&#39;</span><span class="p">,</span> <span class="s">&#39;norm&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetNormPerLethargys&#39;</span><span class="p">,</span> <span class="s">&#39;1 / lethargy&#39;</span><span class="p">;</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeFissionEnergyDepositions</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;uncertainty&#39;</span><span class="p">,</span> <span class="s">&#39;std&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetRelativeUncertaintys&#39;</span><span class="p">,</span> <span class="s">&#39;1 / \sigma / Ebin&#39;</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">headerFormat</span> <span class="o">=</span> <span class="s">&#39;Fission-Energy-Deposition (cell {{}}) [{}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">WritePhysicalQuantity</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">getter</span><span class="p">,</span> <span class="n">headerFormat</span><span class="p">,</span> <span class="n">tallyResults</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">downSample</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeMicroscopicCrosssections</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="k">pass</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeReactionRates</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Reaction-Rate</span>
            <span class="c"># R</span>
            <span class="c">###</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="s">&#39;{}.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetMcnpInputFile</span><span class="p">()</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(),</span> <span class="s">&#39;rxn&#39;</span><span class="p">);</span>
            <span class="n">cellNumber2PossibleMaterialNumbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumber2PossibleMaterialNumbers</span><span class="p">();</span>
            <span class="n">tallyResults</span> <span class="o">=</span> <span class="p">{(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">materialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span><span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberReactionRate</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="n">materialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">multiplierBins</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallyIndices</span><span class="p">(</span><span class="s">&#39;fm4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">materialNumber</span><span class="p">,</span> <span class="n">reactionNumber</span> <span class="ow">in</span> <span class="n">multiplierBins</span> <span class="k">if</span> <span class="n">materialNumber</span> <span class="ow">in</span> <span class="n">cellNumber2PossibleMaterialNumbers</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]};</span>
            <span class="c">###</span>
            <span class="n">baseUnits</span> <span class="o">=</span> <span class="s">&#39;reactions / source - &#39;</span><span class="p">;</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeReactionRates</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;ebin&#39;</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetPerBins&#39;</span><span class="p">,</span> <span class="s">&#39;{}Ebin&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseUnits</span><span class="p">);</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeReactionRates</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;energy&#39;</span><span class="p">,</span> <span class="s">&#39;mev&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetPerEnergys&#39;</span><span class="p">,</span> <span class="s">&#39;{}MeV&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseUnits</span><span class="p">);</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeReactionRates</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;lethargy&#39;</span><span class="p">,</span> <span class="s">&#39;leth&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetPerLethargys&#39;</span><span class="p">,</span> <span class="s">&#39;{}lethargy&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseUnits</span><span class="p">);</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeReactionRates</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;normalized&#39;</span><span class="p">,</span> <span class="s">&#39;norm&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetNormPerLethargys&#39;</span><span class="p">,</span> <span class="s">&#39;1 / lethargy&#39;</span><span class="p">;</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeReactionRates</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;uncertainty&#39;</span><span class="p">,</span> <span class="s">&#39;std&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetRelativeUncertaintys&#39;</span><span class="p">,</span> <span class="s">&#39;1 / \sigma / Ebin&#39;</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">headerFormat</span> <span class="o">=</span> <span class="s">&#39;Reaction-Rate (cell {{}}; material {{}}; reaction {{}}) [{}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">WritePhysicalQuantity</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">getter</span><span class="p">,</span> <span class="n">headerFormat</span><span class="p">,</span> <span class="n">tallyResults</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">downSample</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeScalarFluxes</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="s">&#39;{}.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetMcnpInputFile</span><span class="p">()</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(),</span> <span class="s">&#39;flx&#39;</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="c"># Scalar-Flux</span>
            <span class="c"># \phi</span>
            <span class="c">###</span>
            <span class="n">tallyResults</span> <span class="o">=</span> <span class="p">{(</span><span class="n">cellNumber</span><span class="p">,</span> <span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberScalarFlux</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTallyIndices</span><span class="p">(</span><span class="s">&#39;f4&#39;</span><span class="p">)};</span>
            <span class="n">baseUnits</span> <span class="o">=</span> <span class="s">&#39;particles / source - cm^2 - &#39;</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeScalarFluxes</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;ebin&#39;</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetPerBins&#39;</span><span class="p">,</span> <span class="s">&#39;{}Ebin&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseUnits</span><span class="p">);</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeScalarFluxes</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;energy&#39;</span><span class="p">,</span> <span class="s">&#39;mev&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetPerEnergys&#39;</span><span class="p">,</span> <span class="s">&#39;{}MeV&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseUnits</span><span class="p">);</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeScalarFluxes</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;lethargy&#39;</span><span class="p">,</span> <span class="s">&#39;leth&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetPerLethargys&#39;</span><span class="p">,</span> <span class="s">&#39;{}lethargy&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseUnits</span><span class="p">);</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeScalarFluxes</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;normalized&#39;</span><span class="p">,</span> <span class="s">&#39;norm&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetNormPerLethargys&#39;</span><span class="p">,</span> <span class="s">&#39;1 / lethargy&#39;</span><span class="p">;</span>
            <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">writeScalarFluxes</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;uncertainty&#39;</span><span class="p">,</span> <span class="s">&#39;std&#39;</span><span class="p">):</span>
                <span class="n">getter</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;GetRelativeUncertaintys&#39;</span><span class="p">,</span> <span class="s">&#39;1 / \sigma / Ebin&#39;</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">headerFormat</span> <span class="o">=</span> <span class="s">&#39;Scalar-Flux (cell {{}}) [{}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">WritePhysicalQuantity</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">getter</span><span class="p">,</span> <span class="n">headerFormat</span><span class="p">,</span> <span class="n">tallyResults</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">downSample</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Call MCNP input file&#39;s report</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetMcnpInputFile</span><span class="p">()</span><span class="o">.</span><span class="n">Report</span><span class="p">(</span><span class="n">arguments</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="McnpOutputFile.WritePhysicalQuantity"><a class="viewcode-back" href="../src.html#MocDown.McnpOutputFile.WritePhysicalQuantity">[docs]</a>    <span class="k">def</span> <span class="nf">WritePhysicalQuantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">getter</span><span class="p">,</span> <span class="n">headerFormat</span><span class="p">,</span> <span class="n">tallyResults</span><span class="p">,</span> <span class="n">downSample</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Offer summary or diagnostic reports to file.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Kick out null tally results</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tallyResults</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tallyResult</span><span class="p">)</span> <span class="k">for</span> <span class="n">tallyResult</span> <span class="ow">in</span> <span class="n">tallyResults</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Down-sample results</span>
        <span class="c">###</span>
        <span class="k">while</span> <span class="n">downSample</span><span class="p">:</span>
            <span class="n">isNegative</span> <span class="o">=</span> <span class="n">downSample</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">tallyResults</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">tallyResult</span><span class="o">.</span><span class="n">HalfSample</span><span class="p">(</span><span class="n">isNegative</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">tallyResult</span> <span class="ow">in</span> <span class="n">tallyResults</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
            <span class="n">downSample</span> <span class="o">-=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">isNegative</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Header line</span>
        <span class="c">###</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Neutron Energy [MeV]&#39;</span><span class="p">];</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">headerFormat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tallyResults</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Data lines</span>
        <span class="c">###</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">tallyResults</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">Concatenate</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">Concatenate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">tallyResults</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">getter</span><span class="p">)()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tallyResults</span><span class="p">)),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Kick out null-valued data</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Write .csv file</span>
        <span class="c">###</span>
        <span class="n">WriteCsvFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="p">[</span><span class="n">headers</span><span class="p">],</span> <span class="n">data</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># ORIGEN2.2 output file parser</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="OrigenCalculation"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation">[docs]</a><span class="k">class</span> <span class="nc">OrigenCalculation</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;ORIGEN2 calculation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">cellVolume</span><span class="p">,</span> <span class="n">directory</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="n">cellVolume</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Populate</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="OrigenCalculation.GetBurnup"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetBurnup">[docs]</a>    <span class="k">def</span> <span class="nf">GetBurnup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return exposure accrued.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">burnup</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetDecayPower"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetDecayPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetDecayPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">za2WattsPerMole</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return decay power.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">moles</span> <span class="o">*</span> <span class="n">za2WattsPerMole</span><span class="p">[</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">)]</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">)</span> <span class="ow">in</span> <span class="n">za2WattsPerMole</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetDirectory"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetDirectory">[docs]</a>    <span class="k">def</span> <span class="nf">GetDirectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return working directory.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetFlux"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetFlux">[docs]</a>    <span class="k">def</span> <span class="nf">GetFlux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return flux magnitude.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetMoles"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetMoles">[docs]</a>    <span class="k">def</span> <span class="nf">GetMoles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell total moles.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">());</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetPower"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetPower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return transmute power.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetSuffix"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetSuffix">[docs]</a>    <span class="k">def</span> <span class="nf">GetSuffix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return nuclear library suffix.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetNumberDensity"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetNumberDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetNumberDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell total atoms per barn centimeter.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2NumberDensity</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">());</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetMassDensity"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetMassDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetMassDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell total grams per cubic centimeter.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2MassDensity</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">());</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetMicros"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetMicros">[docs]</a>    <span class="k">def</span> <span class="nf">GetMicros</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return one-group microscopic cross-sections.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">micros</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetTableTotal"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetTableTotal">[docs]</a>    <span class="k">def</span> <span class="nf">GetTableTotal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return sum of a reported table.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetZaidTableNumber2Value</span><span class="p">(</span><span class="n">tableNumber</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">());</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetTAPE4"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetTAPE4">[docs]</a>    <span class="k">def</span> <span class="nf">GetTAPE4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return TAPE4.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAPE4</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetTAPE5"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetTAPE5">[docs]</a>    <span class="k">def</span> <span class="nf">GetTAPE5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return TAPE5.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAPE5</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetTAPE6"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetTAPE6">[docs]</a>    <span class="k">def</span> <span class="nf">GetTAPE6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return TAPE6.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAPE6</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetTAPE7"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetTAPE7">[docs]</a>    <span class="k">def</span> <span class="nf">GetTAPE7</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return TAPE7.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAPE7</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetTAPE9"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetTAPE9">[docs]</a>    <span class="k">def</span> <span class="nf">GetTAPE9</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return TAPE9.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAPE9</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetTAPE10"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetTAPE10">[docs]</a>    <span class="k">def</span> <span class="nf">GetTAPE10</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return TAPE10.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAPE10</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetVolume"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetVolume">[docs]</a>    <span class="k">def</span> <span class="nf">GetVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cubic centimeters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetZaid2AbsorptionFraction"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetZaid2AbsorptionFraction">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2AbsorptionFraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to fractional absorption.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">tableNumber</span> <span class="o">=</span> <span class="mi">19</span><span class="p">;</span>
        <span class="n">totalAbsorptionRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTableTotal</span><span class="p">(</span><span class="n">tableNumber</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">zaid</span> <span class="p">:</span> <span class="n">absorptionRate</span> <span class="o">/</span> <span class="n">totalAbsorptionRate</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">absorptionRate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaidTableNumber2Value</span><span class="p">(</span><span class="n">tableNumber</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetZaid2AtomFraction"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetZaid2AtomFraction">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2AtomFraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to atom fission.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">totalMoles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMoles</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">zaid</span> <span class="p">:</span> <span class="n">moles</span> <span class="o">/</span> <span class="n">totalMoles</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetZaid2FissionFraction"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetZaid2FissionFraction">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2FissionFraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to fractional fission.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">tableNumber</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>
        <span class="n">totalFissionRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTableTotal</span><span class="p">(</span><span class="n">tableNumber</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">zaid</span> <span class="p">:</span> <span class="n">fissionRate</span> <span class="o">/</span> <span class="n">totalFissionRate</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">fissionRate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaidTableNumber2Value</span><span class="p">(</span><span class="n">tableNumber</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetZaid2Moles"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetZaid2Moles">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2Moles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to moles.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zaid2Moles</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetZaid2NumberDensity"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetZaid2NumberDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2NumberDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to atoms per barn centimeter.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">zaid</span> <span class="p">:</span> <span class="n">moles</span> <span class="o">*</span> <span class="n">avogadrosNumber</span> <span class="o">/</span> <span class="n">volume</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetZaid2MassDensity"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetZaid2MassDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2MassDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to grams per cubic centimeter.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">zaid</span> <span class="p">:</span> <span class="n">moles</span> <span class="o">*</span> <span class="n">Zaid2MolarMass</span><span class="p">(</span><span class="n">zaid</span><span class="p">)</span> <span class="o">/</span> <span class="n">volume</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetZaidTableNumber2Value"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetZaidTableNumber2Value">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaidTableNumber2Value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return result table for a table number.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zaid2TableNumber2Value</span><span class="p">[</span><span class="n">tableNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.GetZaid2WeightFraction"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.GetZaid2WeightFraction">[docs]</a>    <span class="k">def</span> <span class="nf">GetZaid2WeightFraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary mapping isotope to weight fission.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">totalMassDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMassDensity</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">zaid</span> <span class="p">:</span> <span class="n">massDensity</span> <span class="o">/</span> <span class="n">totalMassDensity</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">massDensity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetZaid2MassDensity</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
    <span class="c">###</span>
    <span class="c"># Population methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.AttachMicros"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.AttachMicros">[docs]</a>    <span class="k">def</span> <span class="nf">AttachMicros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micros</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Attach one-group microscopic cross-sections.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">micros</span> <span class="o">=</span> <span class="n">micros</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="OrigenCalculation.Populate"><a class="viewcode-back" href="../src.html#MocDown.OrigenCalculation.Populate">[docs]</a>    <span class="k">def</span> <span class="nf">Populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Read TAPE4.INP</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAPE4</span> <span class="o">=</span> <span class="n">ReadFile</span><span class="p">(</span><span class="s">&#39;{}TAPE4.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()),</span> <span class="n">display</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Read TAPE5.INP</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAPE5</span> <span class="o">=</span> <span class="n">ReadFile</span><span class="p">(</span><span class="s">&#39;{}TAPE5.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()),</span> <span class="n">display</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Read TAPE6.OUT</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAPE6</span> <span class="o">=</span> <span class="n">ReadFile</span><span class="p">(</span><span class="s">&#39;{}TAPE6.OUT&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()),</span> <span class="n">display</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Read TAPE7.OUT</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAPE7</span> <span class="o">=</span> <span class="n">ReadFile</span><span class="p">(</span><span class="s">&#39;{}TAPE7.OUT&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()),</span> <span class="n">display</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Read TAPE9.INP</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAPE9</span> <span class="o">=</span> <span class="n">ReadFile</span><span class="p">(</span><span class="s">&#39;{}TAPE9.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()),</span> <span class="n">display</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Read TAPE10.INP</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TAPE10</span> <span class="o">=</span> <span class="n">ReadFile</span><span class="p">(</span><span class="s">&#39;{}TAPE10.INP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()),</span> <span class="n">display</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Extract isotopic moles from .pch file</span>
        <span class="c">###</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSuffix</span><span class="p">();</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTAPE7</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">5</span> <span class="p">:</span> <span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zaid2Moles</span> <span class="o">=</span> <span class="p">{</span><span class="n">Zam2Zaid</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">numbers</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">suffix</span><span class="p">)</span> <span class="p">:</span> <span class="n">numbers</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">numbers</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">numbers</span><span class="p">[</span><span class="n">index</span><span class="p">]};</span>
        <span class="c">###</span>
        <span class="c"># Extract burnup, flux, and power from .pch file</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">burnup</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># Extract absorption rate (19) and fission rate (21) from .out file</span>
        <span class="c">###</span>
        <span class="n">reBlock</span> <span class="o">=</span> <span class="s">r&#39;^0 +{}( .+\n){{,70}}^[01]&#39;</span><span class="p">;</span>
        <span class="n">reIsotopeValue</span> <span class="o">=</span> <span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^([ A-Z]{3}[ 0-9]{3}M?) +( \d\.\d{3}e[+\-]\d\d)+$&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="n">TAPE6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTAPE6</span><span class="p">();</span>
        <span class="n">tableNumbers</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">21</span><span class="p">);</span> <span class="c"># FIXME For when parsing Ci&#39;s and radiotoxicities</span>
        <span class="n">tableNumbers</span> <span class="o">=</span> <span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">21</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zaid2TableNumber2Value</span> <span class="o">=</span> <span class="p">{</span><span class="n">tableNumber</span> <span class="p">:</span> <span class="p">{</span><span class="n">Zam2Zaid</span><span class="p">(</span><span class="n">Isotope2Zam</span><span class="p">(</span><span class="n">isotope</span><span class="p">),</span> <span class="n">suffix</span><span class="p">)</span> <span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">ReCompile</span><span class="p">(</span><span class="n">reBlock</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tableNumber</span><span class="p">),</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">TAPE6</span><span class="p">)</span> <span class="k">for</span> <span class="n">isotopeValue</span> <span class="ow">in</span> <span class="n">reIsotopeValue</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">group</span><span class="p">())</span> <span class="k">for</span> <span class="n">isotope</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="n">isotopeValue</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span> <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">}</span> <span class="k">for</span> <span class="n">tableNumber</span> <span class="ow">in</span> <span class="n">tableNumbers</span><span class="p">};</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Random variable: float with uncertainty</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="RandomVariable"><a class="viewcode-back" href="../src.html#MocDown.RandomVariable">[docs]</a><span class="k">class</span> <span class="nc">RandomVariable</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Statistical random variable.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return absolute value.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetExp</span><span class="p">());</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVar</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">RandomVariable</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">isVar</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if expected value is non-zero.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetExp</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return expected value.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetExp</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">,</span> <span class="n">isStd</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">isVar</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">expected</span><span class="p">);</span>
        <span class="n">uncertainty</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">uncertainty</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">isStd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">uncertainty</span> <span class="o">**</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">isVar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">uncertainty</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">expected</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">uncertainty</span> <span class="o">**</span> <span class="mi">2</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Compare with another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return summary of expected value and standard deviation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="s">&#39;{:&gt;+10.5f} ± {: &gt;7.5f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetExp</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetStd</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="c"># Mathematical operator overloaders</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add to another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Expected is affected</span>
            <span class="c">###</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetExp</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Variance is not affected</span>
            <span class="c">###</span>
            <span class="n">variance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVar</span><span class="p">();</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># var = var_a + var_b + (2 * corr_ab * std_a * std_b)</span>
            <span class="c"># Correlation is assumed as 0 for addition</span>
            <span class="c">###</span>
            <span class="n">correlationCoefficient</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetExp</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetExp</span><span class="p">();</span>
            <span class="n">variance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVar</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetVar</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetStd</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">GetStd</span><span class="p">()</span> <span class="o">*</span> <span class="n">correlationCoefficient</span><span class="p">);</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">TallyResult</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">RandomVariable</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">isVar</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Multiply with another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Expected, variance is affected</span>
            <span class="c">###</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetExp</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="p">;</span>
            <span class="n">variance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVar</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span> <span class="o">**</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># relvar = relvar_a + relvar_b + (2 * relstd_a * relstd_b * corr_ab)</span>
            <span class="c"># Correlation is assumed as +1 for multiplication</span>
            <span class="c">###</span>
            <span class="n">correlationCoefficient</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetExp</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">GetExp</span><span class="p">();</span>
            <span class="n">variance</span> <span class="o">=</span> <span class="n">expected</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRelVar</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetRelVar</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRelStd</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">GetRelStd</span><span class="p">()</span> <span class="o">*</span> <span class="n">correlationCoefficient</span><span class="p">);</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">TallyResult</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">RandomVariable</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">isVar</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Divide another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">other</span><span class="p">);</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># relvar = relvar_a + relvar_b + (2 * relstd_a * relstd_b * corr_ab)</span>
            <span class="c"># Correlation is assumed as -1 for division</span>
            <span class="c">###</span>
            <span class="n">correlationCoefficient</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">expected</span> <span class="o">=</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetExp</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">GetExp</span><span class="p">());</span>
            <span class="n">variance</span> <span class="o">=</span> <span class="n">expected</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRelVar</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetRelVar</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRelStd</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">GetRelStd</span><span class="p">()</span> <span class="o">*</span> <span class="n">correlationCoefficient</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">RandomVariable</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">isVar</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Take to an exponent.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">float</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">RandomVariable</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__pow__</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">other</span><span class="p">);</span>
        <span class="k">elif</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">elif</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">other</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">*</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__pow__</span><span class="p">(</span><span class="n">other</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pow__</span><span class="p">(</span><span class="n">other</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="n">__radd__</span> <span class="o">=</span> <span class="n">__add__</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">__rmul__</span> <span class="o">=</span> <span class="n">__mul__</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">__rtruediv__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">other</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pow__</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Subtract another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="o">-</span><span class="n">other</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Subtract from another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">__sub__</span><span class="p">(</span><span class="n">other</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Positive.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Negate.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if equal to another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="n">other</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Compare to another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">other</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Getters</span>
    <span class="c">###</span>
<div class="viewcode-block" id="RandomVariable.GetExp"><a class="viewcode-back" href="../src.html#MocDown.RandomVariable.GetExp">[docs]</a>    <span class="k">def</span> <span class="nf">GetExp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return expected value.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RandomVariable.GetRelStd"><a class="viewcode-back" href="../src.html#MocDown.RandomVariable.GetRelStd">[docs]</a>    <span class="k">def</span> <span class="nf">GetRelStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return relative standard deviation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRelVar</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RandomVariable.GetStd"><a class="viewcode-back" href="../src.html#MocDown.RandomVariable.GetStd">[docs]</a>    <span class="k">def</span> <span class="nf">GetStd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return standard deviation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVar</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RandomVariable.GetRelVar"><a class="viewcode-back" href="../src.html#MocDown.RandomVariable.GetRelVar">[docs]</a>    <span class="k">def</span> <span class="nf">GetRelVar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return relative variance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetVar</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetExp</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RandomVariable.GetVar"><a class="viewcode-back" href="../src.html#MocDown.RandomVariable.GetVar">[docs]</a>    <span class="k">def</span> <span class="nf">GetVar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return variance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">;</span>
    <span class="c">###</span></div>
    <span class="n">GetElements</span> <span class="o">=</span> <span class="n">GetTotalElement</span> <span class="o">=</span> <span class="n">GetExp</span><span class="p">;</span>
    <span class="n">GetRelativeVariances</span> <span class="o">=</span> <span class="n">GetRelVar</span><span class="p">;</span>
    <span class="n">GetRelativeUncertaintys</span> <span class="o">=</span> <span class="n">GetTotalRelativeUncertainty</span> <span class="o">=</span> <span class="n">GetRelStd</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Accelerated recycle calculation</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation">[docs]</a><span class="k">class</span> <span class="nc">RecycleCalculation</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Recycle calculation, held in memory during operation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Set argument attributes</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Run recycle calculation</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Recycle</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="RecycleCalculation.GetArguments"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.GetArguments">[docs]</a>    <span class="k">def</span> <span class="nf">GetArguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return runtime arguments.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.GetDisplayFiles"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.GetDisplayFiles">[docs]</a>    <span class="k">def</span> <span class="nf">GetDisplayFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if file operations are verbose.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetArguments</span><span class="p">()</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.GetIsPickleTransmute"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.GetIsPickleTransmute">[docs]</a>    <span class="k">def</span> <span class="nf">GetIsPickleTransmute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if current depletion step is to be transmuted using pickles.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isPickleTransmute</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.GetParameter"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.GetParameter">[docs]</a>    <span class="k">def</span> <span class="nf">GetParameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return mocdown input file parameter for a key.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">()[</span><span class="n">key</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.GetParameters"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.GetParameters">[docs]</a>    <span class="k">def</span> <span class="nf">GetParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return mocdown input file parameters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">GetParameters</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.GetRecycleIndex"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.GetRecycleIndex">[docs]</a>    <span class="k">def</span> <span class="nf">GetRecycleIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return index of current recycling step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recycleIndex</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.GetRecycleString"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.GetRecycleString">[docs]</a>    <span class="k">def</span> <span class="nf">GetRecycleString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return string for current recycling step.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="s">&#39;{} recycle #{:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">([</span><span class="s">&#39;transport/transmute&#39;</span><span class="p">,</span> <span class="s">&#39;transmute-only&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">()],</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleIndex</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="c"># Recycle methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.Recycle"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.Recycle">[docs]</a>    <span class="k">def</span> <span class="nf">Recycle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Execute MocDown recycling.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; {} will recycle to equilibrium&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__file__</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># First, a transport/transmute recycle is performed;</span>
        <span class="c"># In order to preserve it for multiplication convergence, isConverged is set to True</span>
        <span class="c">###</span>
        <span class="n">transportFile</span> <span class="o">=</span> <span class="n">depletionCalculation</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recycleIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isPickleTransmute</span> <span class="o">=</span> <span class="bp">False</span><span class="p">;</span>
        <span class="n">isConverged</span> <span class="o">=</span> <span class="bp">True</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Recycle until multiplication has converged</span>
        <span class="c">###</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Save previous calculation for multiplication convergence</span>
            <span class="c">###</span>
            <span class="n">previousDepletionCalculation</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Recycle until isotopics have converged</span>
            <span class="c">###</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Prepare depletion calculation</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PrepareRecycle</span><span class="p">(</span><span class="n">transportFile</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="c"># Run depletion calculation</span>
                <span class="c">###</span>
                <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Depleting {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleString</span><span class="p">()));</span>
                <span class="n">depletionCalculation</span> <span class="o">=</span> <span class="n">DepletionCalculation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetArguments</span><span class="p">(),</span> <span class="n">isPickleTransmute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">());</span>
                <span class="c">###</span>
                <span class="c"># Switch off restarts following the first depletion cycle</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">isRestart</span> <span class="o">=</span> <span class="bp">False</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Save previous transport file for isotopics convergence</span>
                <span class="c">###</span>
                <span class="n">previousTransportFile</span> <span class="o">=</span> <span class="n">transportFile</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Extract processed transport input raw for isotopics convergence</span>
                <span class="c">###</span>
                <span class="n">transportFile</span> <span class="o">=</span> <span class="n">depletionCalculation</span><span class="o">.</span><span class="n">ProcessFuel</span><span class="p">();</span>
                <span class="c">###</span>
                <span class="c"># Archive depletion calculation recycle</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ArchiveRecycle</span><span class="p">();</span>
                <span class="c">###</span>
                <span class="c"># Kick out if isotopics have converged</span>
                <span class="c">###</span>
                <span class="k">if</span> <span class="n">isConverged</span><span class="p">:</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Determine if BOEC isotopics have converged;</span>
                <span class="c"># If so, kick out after one last transport/transmute recycle;</span>
                <span class="c"># If not, continue transmute-only recycles</span>
                <span class="c">###</span>
                <span class="n">isConverged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsotopicsHaveConverged</span><span class="p">(</span><span class="n">previousTransportFile</span><span class="p">,</span> <span class="n">transportFile</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isPickleTransmute</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">isConverged</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="c"># Increment recycle index</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IncrementRecycleIndex</span><span class="p">();</span>
            <span class="c">###</span>
            <span class="c"># Determine if EOEC multiplication has converged;</span>
            <span class="c"># If so, kick out immediately;</span>
            <span class="c"># If not, continue transmute-only recycles</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MultiplicationHasConverged</span><span class="p">(</span><span class="n">previousDepletionCalculation</span><span class="p">,</span> <span class="n">depletionCalculation</span><span class="p">):</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">isConverged</span> <span class="o">=</span> <span class="bp">False</span><span class="p">;</span>
                <span class="c">###</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isPickleTransmute</span> <span class="o">=</span> <span class="bp">True</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Increment recycle index</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IncrementRecycleIndex</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Prepare BOEC transport input</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrepareRecycle</span><span class="p">(</span><span class="n">transportFile</span><span class="p">,</span> <span class="n">finale</span> <span class="o">=</span> <span class="bp">True</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.PrepareRecycle"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.PrepareRecycle">[docs]</a>    <span class="k">def</span> <span class="nf">PrepareRecycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transportFile</span><span class="p">,</span> <span class="n">finale</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Populate default recycling parameters.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># If this is a pickle transmute recycle, unarchive pickles from the previous recycle</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleIndex</span><span class="p">())</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">finale</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Unarchiving (linking) previous recycle&#39;</span><span class="p">);</span>
            <span class="n">directoryName</span> <span class="o">=</span> <span class="s">&#39;./{:03d}/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleIndex</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">linkFiles</span> <span class="o">=</span> <span class="p">(</span><span class="n">linkFile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">directoryName</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">linkFile</span> <span class="ow">in</span> <span class="n">Glob</span><span class="p">(</span><span class="s">&#39;{}/{}*.pkl*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directoryName</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">transportFileName</span><span class="p">)));</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">linkFile</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">linkFiles</span><span class="p">):</span>
                <span class="n">SymbolicLink</span><span class="p">(</span><span class="s">&#39;{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directoryName</span><span class="p">,</span> <span class="n">linkFile</span><span class="p">),</span> <span class="n">linkFile</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># Maybe write processed input</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">transportFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">WriteFile</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">transportFileName</span><span class="p">,</span> <span class="n">transportFile</span><span class="o">.</span><span class="n">GetNewputRaw</span><span class="p">(),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.ArchiveRecycle"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.ArchiveRecycle">[docs]</a>    <span class="k">def</span> <span class="nf">ArchiveRecycle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Move files from previous recycling step to a folder.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Archiving {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleString</span><span class="p">()));</span>
        <span class="c">###</span>
        <span class="c"># Create backup depletion directory</span>
        <span class="c">###</span>
        <span class="n">directoryName</span> <span class="o">=</span> <span class="s">&#39;./{:03d}/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleIndex</span><span class="p">());</span>
        <span class="n">MakeDirectory</span><span class="p">(</span><span class="n">directoryName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="c"># Move depletion files</span>
        <span class="c">###</span>
        <span class="n">transportFileName</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">transportFileName</span><span class="p">;</span>
        <span class="n">moveFiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">transportFileName</span><span class="p">,</span> <span class="s">&#39;transport.log&#39;</span><span class="p">,</span> <span class="s">&#39;transmute.log&#39;</span><span class="p">];</span>
        <span class="n">moveFiles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fileName</span> <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="s">&#39;pkl&#39;</span><span class="p">,</span> <span class="s">&#39;gz&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="n">Glob</span><span class="p">(</span><span class="s">&#39;{}*.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">transportFileName</span><span class="p">,</span> <span class="n">extension</span><span class="p">)));</span>
        <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">transportFileName</span><span class="p">:</span>
            <span class="n">removeExtension</span> <span class="o">=</span> <span class="n">transportFileName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">moveFiles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fileName</span> <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="s">&#39;pkl&#39;</span><span class="p">,</span> <span class="s">&#39;gz&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="n">Glob</span><span class="p">(</span><span class="s">&#39;{}*.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">transportFileName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">removeExtension</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="n">extension</span><span class="p">)));</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">moveFile</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">moveFiles</span><span class="p">),</span> <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
            <span class="n">MoveFile</span><span class="p">(</span><span class="n">moveFile</span><span class="p">,</span> <span class="s">&#39;{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directoryName</span><span class="p">,</span> <span class="n">moveFile</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDisplayFiles</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.IncrementRecycleIndex"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.IncrementRecycleIndex">[docs]</a>    <span class="k">def</span> <span class="nf">IncrementRecycleIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Increment index of recycling iterations.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recycleIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.IsotopicsHaveConverged"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.IsotopicsHaveConverged">[docs]</a>    <span class="k">def</span> <span class="nf">IsotopicsHaveConverged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transportOne</span><span class="p">,</span> <span class="n">transportTwo</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if isotopics of subsequent cycles have converged.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">transportOne</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">transportTwo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Isotopics convergence: UNDEFINED during {} ... continue transmute-only recycle&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleString</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="k">return</span> <span class="bp">False</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">transportOne</span> <span class="o">-</span> <span class="n">transportTwo</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="n">normType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isotopicsConvergenceNormType&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="n">normType</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;one&#39;</span><span class="p">):</span>
            <span class="n">normCharacter</span> <span class="o">=</span> <span class="s">&#39;1&#39;</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">normType</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">):</span>
            <span class="n">normCharacter</span> <span class="o">=</span> <span class="s">&#39;2&#39;</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">normType</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">,</span> <span class="s">&#39;infinite&#39;</span><span class="p">,</span> <span class="s">&#39;infinity&#39;</span><span class="p">):</span>
            <span class="n">normCharacter</span> <span class="o">=</span> <span class="s">&#39;∞&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isotopicsConvergenceTolerance&#39;</span><span class="p">):</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Isotopics convergence: FAILURE (|Δiso|{} = {:.1E} &gt; {:.1E}) during {} ... continue transmute-only recycle&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normCharacter</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isotopicsConvergenceTolerance&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleString</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="k">return</span> <span class="bp">False</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Isotopics convergence: SUCCESS (|Δiso|{} = {:.1E} ≤ {:.1E}) during {} ... perform one last transport/transmute recycle&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normCharacter</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;isotopicsConvergenceTolerance&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleString</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="k">return</span> <span class="bp">True</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="RecycleCalculation.MultiplicationHasConverged"><a class="viewcode-back" href="../src.html#MocDown.RecycleCalculation.MultiplicationHasConverged">[docs]</a>    <span class="k">def</span> <span class="nf">MultiplicationHasConverged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depletionOne</span><span class="p">,</span> <span class="n">depletionTwo</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if multiplication of subsequent transport cycles have converged.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">depletionOne</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">depletionTwo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Multiplication convergence: UNDEFINED during {} ... continue transmute-only recycle&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleString</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="k">return</span> <span class="bp">False</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">keffOne</span><span class="p">,</span> <span class="n">kSigmaOne</span> <span class="o">=</span> <span class="n">depletionOne</span><span class="o">.</span><span class="n">MultiplicationFactor</span><span class="p">(),</span> <span class="n">depletionOne</span><span class="o">.</span><span class="n">MultiplicationFactorSigma</span><span class="p">();</span>
        <span class="n">keffTwo</span><span class="p">,</span> <span class="n">kSigmaTwo</span> <span class="o">=</span> <span class="n">depletionTwo</span><span class="o">.</span><span class="n">MultiplicationFactor</span><span class="p">(),</span> <span class="n">depletionTwo</span><span class="o">.</span><span class="n">MultiplicationFactorSigma</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="n">deltaK</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">keffOne</span> <span class="o">-</span> <span class="n">keffTwo</span><span class="p">);</span>
        <span class="n">deltaSigmaK</span> <span class="o">=</span> <span class="p">(</span><span class="n">kSigmaOne</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">kSigmaTwo</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">deltaK</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;multiplicationFactorConvergenceTolerance&#39;</span><span class="p">):</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Multiplication convergence: FAILURE (Δk = {:.5f} ± {:.5f} &gt; {:.5f}) during {} ... continue transmute-only recycle&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">deltaK</span><span class="p">,</span> <span class="n">deltaSigmaK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;multiplicationFactorConvergenceTolerance&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleString</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="k">return</span> <span class="bp">False</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Multiplication convergence: SUCCESS (Δk = {:.5f} ± {:.5f} ≤ {:.5f}) during {} ... equilibrium search is finished&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">deltaK</span><span class="p">,</span> <span class="n">deltaSigmaK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;multiplicationFactorConvergenceTolerance&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRecycleString</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="k">return</span> <span class="bp">True</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Tally result</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="TallyResult"><a class="viewcode-back" href="../src.html#MocDown.TallyResult">[docs]</a><span class="k">class</span> <span class="nc">TallyResult</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;MCNP tally parser.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return if total is non-zero.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return total.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Match iterator and number of iterations</span>
            <span class="c">###</span>
            <span class="n">matches</span><span class="p">,</span> <span class="n">numberOfIterations</span> <span class="o">=</span> <span class="n">args</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variances</span> <span class="o">=</span> <span class="p">(</span><span class="n">Empty</span><span class="p">(</span><span class="n">numberOfIterations</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">numberOfIterations</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
                    <span class="c">###</span>
                    <span class="c"># Energys, elements, variances</span>
                    <span class="c">###</span>
                    <span class="n">energy</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">relativeUncertainty</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">());</span>
                    <span class="c">###</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">energys</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">variances</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">element</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">relativeUncertainty</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">###</span>
                    <span class="c"># Total element, total variance</span>
                    <span class="c">###</span>
                    <span class="n">totalElement</span><span class="p">,</span> <span class="n">totalRelativeUncertainty</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
                    <span class="c">###</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">totalElement</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalVariance</span> <span class="o">=</span> <span class="n">totalElement</span><span class="p">,</span> <span class="n">totalElement</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">totalRelativeUncertainty</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">;</span>
                    <span class="c">###</span>
                <span class="c">###</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">elif</span> <span class="mi">5</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Energys, elements, variances, total element, total variance</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variances</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalElement</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalVariance</span> <span class="o">=</span> <span class="n">args</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return number of energy bins.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="c"># Mathematical operator overloaders</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add to another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Elements and sum(elements) are affected</span>
            <span class="c">###</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetElements</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="p">;</span>
            <span class="n">totalElement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="c"># Variances and sum(variances) are not affected</span>
            <span class="c">###</span>
            <span class="n">variances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVariances</span><span class="p">();</span>
            <span class="n">totalVariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalVariance</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="c"># var = var_a + var_b + (2 * corr_ab * std_a * std_b)</span>
            <span class="c"># Correlation is assumed as 0 for addition</span>
            <span class="c">###</span>
            <span class="n">correlationCoefficient</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetElements</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetElements</span><span class="p">();</span>
            <span class="n">variances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVariances</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetVariances</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetUncertaintys</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">GetUncertaintys</span><span class="p">()</span> <span class="o">*</span> <span class="n">correlationCoefficient</span><span class="p">);</span>
            <span class="n">totalElement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">();</span>
            <span class="n">totalVariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalVariance</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetTotalVariance</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">TallyResult</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">(),</span> <span class="n">elements</span><span class="p">,</span> <span class="n">variances</span><span class="p">,</span> <span class="n">totalElement</span><span class="p">,</span> <span class="n">totalVariance</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Multiply with another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Elements, variances, sum(elements), sum(variances) are affected</span>
            <span class="c">###</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetElements</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="p">;</span>
            <span class="n">variances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVariances</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">other</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">);</span>
            <span class="n">totalElement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="p">;</span>
            <span class="n">totalVariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalVariance</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">other</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">);</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">RandomVariable</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="c"># relvar = relvar_a + relvar_b + (2 * relstd_a * relstd_b * corr_ab)</span>
            <span class="c"># Correlation is assumed as 1 for multiplication</span>
            <span class="c">###</span>
            <span class="n">correlationCoefficient</span> <span class="o">=</span> <span class="o">+</span><span class="mf">1.</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetElements</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">GetElements</span><span class="p">();</span>
            <span class="n">variances</span> <span class="o">=</span> <span class="n">elements</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRelativeVariances</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetRelativeVariances</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRelativeUncertaintys</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">GetRelativeUncertaintys</span><span class="p">()</span> <span class="o">*</span> <span class="n">correlationCoefficient</span><span class="p">));</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">totalElement</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elements</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="n">totalVariance</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">variances</span><span class="p">);</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">totalElement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">();</span>
                <span class="c">###</span>
                <span class="n">totalVariance</span> <span class="o">=</span> <span class="n">totalElement</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTotalRelativeUncertainty</span><span class="p">()</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetTotalRelativeUncertainty</span><span class="p">()</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalRelativeUncertainty</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">GetTotalRelativeUncertainty</span><span class="p">()</span> <span class="o">*</span> <span class="n">correlationCoefficient</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">TallyResult</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">(),</span> <span class="n">elements</span><span class="p">,</span> <span class="n">variances</span><span class="p">,</span> <span class="n">totalElement</span><span class="p">,</span> <span class="n">totalVariance</span><span class="p">);</span>
        <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Divide another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="n">other</span><span class="p">);</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">RandomVariable</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="c"># relvar = relvar_a + relvar_b - (2 * relstd_a * relstd_b * corr_ab)</span>
            <span class="c"># Correlation is assumed as 1 for division</span>
            <span class="c">###</span>
            <span class="n">correlationCoefficient</span> <span class="o">=</span> <span class="o">+</span><span class="mf">1.</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetElements</span><span class="p">()</span> <span class="o">/</span> <span class="n">other</span><span class="o">.</span><span class="n">GetElements</span><span class="p">();</span>
            <span class="n">variances</span> <span class="o">=</span> <span class="n">elements</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRelativeVariances</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetRelativeVariances</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRelativeUncertaintys</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">GetRelativeUncertaintys</span><span class="p">()</span> <span class="o">*</span> <span class="n">correlationCoefficient</span><span class="p">));</span>
            <span class="c">###</span>
            <span class="c"># Change nan&#39;s to zero&#39;s</span>
            <span class="c">###</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="n">Nan2Num</span><span class="p">(</span><span class="n">elements</span><span class="p">);</span>
            <span class="n">elements</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">variances</span> <span class="o">=</span> <span class="n">Nan2Num</span><span class="p">(</span><span class="n">variances</span><span class="p">);</span>
            <span class="n">variances</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">totalElement</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elements</span><span class="p">);</span>
                <span class="c">###</span>
                <span class="n">totalVariance</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">variances</span><span class="p">);</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">totalElement</span> <span class="o">=</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">());</span>
                <span class="c">###</span>
                <span class="n">totalVariance</span> <span class="o">=</span> <span class="n">totalElement</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTotalRelativeUncertainty</span><span class="p">()</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">GetTotalRelativeUncertainty</span><span class="p">()</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalRelativeUncertainty</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">GetTotalRelativeUncertainty</span><span class="p">()</span> <span class="o">*</span> <span class="n">correlationCoefficient</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">TallyResult</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">(),</span> <span class="n">elements</span><span class="p">,</span> <span class="n">variances</span><span class="p">,</span> <span class="n">totalElement</span><span class="p">,</span> <span class="n">totalVariance</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="n">__radd__</span> <span class="o">=</span> <span class="n">__add__</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">__rmul__</span> <span class="o">=</span> <span class="n">__mul__</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Subtract another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="o">-</span><span class="n">other</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Subtract from another.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">__sub__</span><span class="p">(</span><span class="n">other</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Positive.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Negate.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">*</span> <span class="bp">self</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Generic getter methods</span>
    <span class="c">###</span>
<div class="viewcode-block" id="TallyResult.GetElements"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetElements">[docs]</a>    <span class="k">def</span> <span class="nf">GetElements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return energy bin values.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetEnergys"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetEnergys">[docs]</a>    <span class="k">def</span> <span class="nf">GetEnergys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return energy bin boundaries.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">energys</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetTotalElement"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetTotalElement">[docs]</a>    <span class="k">def</span> <span class="nf">GetTotalElement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return total.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalElement</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetTotalVariance"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetTotalVariance">[docs]</a>    <span class="k">def</span> <span class="nf">GetTotalVariance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return total variance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalVariance</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetVariances"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetVariances">[docs]</a>    <span class="k">def</span> <span class="nf">GetVariances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return variances for each energy bin.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variances</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Algorithmic methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.HalfSample"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.HalfSample">[docs]</a>    <span class="k">def</span> <span class="nf">HalfSample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doAverage</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Downsample energy bins by one half.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">isOdd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">energys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">isOdd</span> <span class="p">:</span> <span class="p">:</span> <span class="mi">2</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetElements</span><span class="p">()[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">isOdd</span> <span class="p">:</span> <span class="p">:</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">Concatenate</span><span class="p">(((</span><span class="mf">0.</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="n">isOdd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetElements</span><span class="p">()[</span><span class="n">isOdd</span> <span class="p">:</span> <span class="p">:</span> <span class="mi">2</span><span class="p">]));</span>
        <span class="n">variances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVariances</span><span class="p">()[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">isOdd</span> <span class="p">:</span> <span class="p">:</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">Concatenate</span><span class="p">(((</span><span class="mf">0.</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="n">isOdd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVariances</span><span class="p">()[</span><span class="n">isOdd</span> <span class="p">:</span> <span class="p">:</span> <span class="mi">2</span><span class="p">]));</span>
        <span class="n">totalElement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">();</span>
        <span class="n">totalVariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalVariance</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">doAverage</span><span class="p">:</span>
            <span class="n">elements</span><span class="p">[</span><span class="n">isOdd</span> <span class="p">:</span> <span class="p">]</span> <span class="o">/=</span> <span class="mf">2.</span><span class="p">;</span>
            <span class="n">variances</span><span class="p">[</span><span class="n">isOdd</span> <span class="p">:</span> <span class="p">]</span> <span class="o">/=</span> <span class="mi">4</span><span class="p">;</span>
            <span class="n">totalElement</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">totalVariance</span> <span class="o">/=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">TallyResult</span><span class="p">(</span><span class="n">energys</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">variances</span><span class="p">,</span> <span class="n">totalElement</span><span class="p">,</span> <span class="n">totalVariance</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Derived statistical getter methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetUncertaintys"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetUncertaintys">[docs]</a>    <span class="k">def</span> <span class="nf">GetUncertaintys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return standard deviations for each energy bin.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetVariances</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetRelativeUncertaintys"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetRelativeUncertaintys">[docs]</a>    <span class="k">def</span> <span class="nf">GetRelativeUncertaintys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return relative standard deviations for each energy bin.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetRelativeVariances</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetRelativeVariances"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetRelativeVariances">[docs]</a>    <span class="k">def</span> <span class="nf">GetRelativeVariances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return relative variances for each energy bin.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">Nan2Num</span><span class="p">(</span><span class="n">SafeDivide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetVariances</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetElements</span><span class="p">()</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">));</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetTotalRelativeUncertainty"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetTotalRelativeUncertainty">[docs]</a>    <span class="k">def</span> <span class="nf">GetTotalRelativeUncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return total relative variance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTotalVariance</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">()</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetTotalUncertainty"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetTotalUncertainty">[docs]</a>    <span class="k">def</span> <span class="nf">GetTotalUncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return total standard deviation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalRelativeUncertainty</span><span class="p">()</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="c"># Bin parameter getter methods</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetEnergyBinMeans"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetEnergyBinMeans">[docs]</a>    <span class="k">def</span> <span class="nf">GetEnergyBinMeans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return energy bin means.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEnergyPerBins</span><span class="p">();</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetEnergyPerBins"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetEnergyPerBins">[docs]</a>    <span class="k">def</span> <span class="nf">GetEnergyPerBins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return unit energy per energy bin.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">Concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()[</span> <span class="p">:</span> <span class="mi">1</span><span class="p">],</span> <span class="n">Difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">())));</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetLethargyPerBins"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetLethargyPerBins">[docs]</a>    <span class="k">def</span> <span class="nf">GetLethargyPerBins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return unit lethargy per energy bin.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">Nan2Num</span><span class="p">(</span><span class="o">-</span><span class="n">NaturalLogarithm</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEnergyPerBins</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEnergys</span><span class="p">()));</span>
    <span class="c">###</span>
    <span class="c"># Element per getter methods</span>
    <span class="c">###</span></div>
    <span class="n">GetPerBins</span> <span class="o">=</span> <span class="n">GetElements</span><span class="p">;</span>
    <span class="c">###</span>
<div class="viewcode-block" id="TallyResult.GetPerEnergys"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetPerEnergys">[docs]</a>    <span class="k">def</span> <span class="nf">GetPerEnergys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return per unit energy.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetPerBins</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetEnergyPerBins</span><span class="p">());</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetPerLethargys"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetPerLethargys">[docs]</a>    <span class="k">def</span> <span class="nf">GetPerLethargys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return per unit lethargy.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetPerBins</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetLethargyPerBins</span><span class="p">());</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="TallyResult.GetNormPerLethargys"><a class="viewcode-back" href="../src.html#MocDown.TallyResult.GetNormPerLethargys">[docs]</a>    <span class="k">def</span> <span class="nf">GetNormPerLethargys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return normalized per unit lethargy.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetPerLethargys</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTotalElement</span><span class="p">());</span>

<span class="c">###</span>
<span class="c">### Custom functions</span>
<span class="c">###</span>

<span class="c">###</span>
<span class="c"># Assert file exists</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="AssertFileExists"><a class="viewcode-back" href="../src.html#MocDown.AssertFileExists">[docs]</a><span class="k">def</span> <span class="nf">AssertFileExists</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Assert that a file exists.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Exists</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="ow">and</span> <span class="n">FileStatus</span><span class="p">(</span><span class="n">fileName</span><span class="p">)[</span><span class="mi">6</span><span class="p">]);</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;File `{}</span><span class="se">\&#39;</span><span class="s"> was not found or is empty&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Copy file</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="CopyFile"><a class="viewcode-back" href="../src.html#MocDown.CopyFile">[docs]</a><span class="k">def</span> <span class="nf">CopyFile</span><span class="p">(</span><span class="n">pathOne</span><span class="p">,</span> <span class="n">pathTwo</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Copy a file, overwriting its destination.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pathOne</span><span class="p">,</span> <span class="n">pathTwo</span><span class="p">));</span>
    <span class="k">if</span> <span class="n">Exists</span><span class="p">(</span><span class="n">pathTwo</span><span class="p">):</span>
        <span class="n">RemoveFile</span><span class="p">(</span><span class="n">pathTwo</span><span class="p">,</span> <span class="n">display</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">Exists</span><span class="p">(</span><span class="n">pathOne</span><span class="p">):</span>
        <span class="n">LibCopyFile</span><span class="p">(</span><span class="n">pathOne</span><span class="p">,</span> <span class="n">pathTwo</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Run gnuplot;</span>
<span class="c"># Run epstopng;</span>
<span class="c"># Run epstopdf;</span>
<span class="c"># Delete .{dat?,plt?}</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="DoGnuPlot"><a class="viewcode-back" href="../src.html#MocDown.DoGnuPlot">[docs]</a><span class="k">def</span> <span class="nf">DoGnuPlot</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">keepPlt</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Execute gnuplot and convert the resulting eps to png and pdf.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">gnuplot</span> <span class="o">=</span> <span class="s">&#39;/usr/local/gnuplot422/bin/gnuplot&#39;</span><span class="p">;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Running gnuplot, epstopng, epstopdf, rm on `{}</span><span class="se">\&#39;</span><span class="s">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.plt&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)));</span>
    <span class="c">###</span>
    <span class="n">SystemCall</span><span class="p">(</span><span class="s">&#39;TMPDIR=&quot;/tmp&quot; ; [ -e {eps} ] &amp;&amp; rm -f {eps} ; {gnuplot} &lt; {plt} &gt; {eps} &amp;&amp; convert -antialias -compress Lossless -density 350 -flatten -quality 95 {eps} {png} &amp;&amp; epstopdf {eps} &amp;&amp; rm -f {delete}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gnuplot</span> <span class="o">=</span> <span class="n">gnuplot</span><span class="p">,</span> <span class="n">delete</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;{} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">fileName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.plt&#39;</span><span class="p">,</span> <span class="s">&#39;.dat&#39;</span><span class="p">)),</span> <span class="s">&#39;&#39;</span><span class="p">][</span><span class="n">keepPlt</span><span class="p">],</span> <span class="n">eps</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.plt&#39;</span><span class="p">,</span> <span class="s">&#39;.eps&#39;</span><span class="p">),</span> <span class="n">plt</span> <span class="o">=</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">png</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.plt&#39;</span><span class="p">,</span> <span class="s">&#39;.png&#39;</span><span class="p">)));</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># File exists and is newer</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="ExistsAndNewer"><a class="viewcode-back" href="../src.html#MocDown.ExistsAndNewer">[docs]</a><span class="k">def</span> <span class="nf">ExistsAndNewer</span><span class="p">(</span><span class="n">pathOne</span><span class="p">,</span> <span class="n">pathTwo</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return if file exists and is newer.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">AssertFileExists</span><span class="p">(</span><span class="n">pathTwo</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Exists</span><span class="p">(</span><span class="n">pathOne</span><span class="p">)</span> <span class="ow">and</span> <span class="n">GetModificationTime</span><span class="p">(</span><span class="n">pathTwo</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">GetModificationTime</span><span class="p">(</span><span class="n">pathOne</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Import supplementary libraries</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="ImportLibraries"><a class="viewcode-back" href="../src.html#MocDown.ImportLibraries">[docs]</a><span class="k">def</span> <span class="nf">ImportLibraries</span><span class="p">(</span><span class="n">mocDownInputFile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Import supplementary libraries.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Iterate over libraries</span>
    <span class="c">###</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">moduleFileName</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">GetKeyValueValues</span><span class="p">():</span>
        <span class="c">###</span>
        <span class="c"># Kick out if not a MocDown library</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="s">&#39;supplementaryMocdownLibrary&#39;</span> <span class="o">!=</span> <span class="n">key</span><span class="p">:</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Strip whitespace from module filename</span>
        <span class="c">###</span>
        <span class="n">moduleFileName</span> <span class="o">=</span> <span class="n">moduleFileName</span><span class="o">.</span><span class="n">strip</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Import module</span>
        <span class="c">###</span>
        <span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">moduleFileName</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Iterate over module contents</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">subModule</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Attach module methods to MocDown</span>
            <span class="c">###</span>
            <span class="k">for</span> <span class="n">mocDownClass</span> <span class="ow">in</span> <span class="p">(</span><span class="n">DepletionCalculation</span><span class="p">,</span> <span class="n">RecycleCalculation</span><span class="p">,</span> <span class="n">MocDownInputFile</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">subModule</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">mocDownClass</span><span class="p">):</span>
                    <span class="c">###</span>
                    <span class="c"># Kick out builtin methods</span>
                    <span class="c">###</span>
                    <span class="k">if</span> <span class="s">&#39;__&#39;</span> <span class="o">==</span> <span class="n">subModule</span><span class="p">[</span> <span class="p">:</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">subModule</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="p">]:</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="c">###</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">mocDownClass</span><span class="p">,</span> <span class="n">subModule</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">subModule</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="c"># Attach functions and variables</span>
        <span class="c">###</span>
        <span class="n">currentModule</span> <span class="o">=</span> <span class="n">Modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">];</span>
        <span class="k">for</span> <span class="n">variableName</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;Array&#39;</span><span class="p">,</span> <span class="s">&#39;Exponent&#39;</span><span class="p">,</span> <span class="s">&#39;LinearInterpolate&#39;</span><span class="p">,</span> <span class="s">&#39;McnpInputFile&#39;</span><span class="p">,</span> <span class="s">&#39;Nan2Num&#39;</span><span class="p">,</span> <span class="s">&#39;NaturalLogarithm&#39;</span><span class="p">,</span> <span class="s">&#39;NonZero&#39;</span><span class="p">,</span> <span class="s">&#39;PrintNow&#39;</span><span class="p">,</span> <span class="s">&#39;Warning&#39;</span><span class="p">,</span> <span class="s">&#39;WordArrange&#39;</span><span class="p">,</span> <span class="s">&#39;WriteFile&#39;</span><span class="p">,</span> <span class="s">&#39;ZaIsActinide&#39;</span><span class="p">,</span> <span class="s">&#39;Zeros&#39;</span><span class="p">,</span> <span class="s">&#39;avogadrosNumber&#39;</span><span class="p">,</span> <span class="s">&#39;epsilon&#39;</span><span class="p">,</span> <span class="s">&#39;mocDownInputFile&#39;</span><span class="p">):</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">currentModule</span><span class="p">,</span> <span class="n">variableName</span><span class="p">);</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">variableName</span><span class="p">,</span> <span class="n">variable</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Convert isotope string -&gt; ZAm</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Isotope2Zam"><a class="viewcode-back" href="../src.html#MocDown.Isotope2Zam">[docs]</a><span class="k">def</span> <span class="nf">Isotope2Zam</span><span class="p">(</span><span class="n">isotope</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert isotope string -&gt; ZAm.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;M&#39;</span> <span class="o">==</span> <span class="n">isotope</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">reNumber</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">isotope</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">();</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">z2Element</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">isotope</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">m</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Reaction numbers of interest and the za&#39;s that cause them</span>
<span class="c"># Based upon ENDF/B-VII.0, Low-fidelity covariance library</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="IsZaReactionNumberOfInterest"><a class="viewcode-back" href="../src.html#MocDown.IsZaReactionNumberOfInterest">[docs]</a><span class="k">def</span> <span class="nf">IsZaReactionNumberOfInterest</span><span class="p">(</span><span class="n">za</span><span class="p">,</span> <span class="n">reactionNumber</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return if a reaction is of interested for an isotope.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">z</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">za</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">za</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># (n, n) can be significant for any isotope</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># (n, n&#39;) can be significant for any isotope, but does not exist for some</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="mi">4</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">za</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1001</span><span class="p">,</span> <span class="mi">1002</span><span class="p">,</span> <span class="mi">1003</span><span class="p">,</span> <span class="mi">2003</span><span class="p">,</span> <span class="mi">2004</span><span class="p">,</span> <span class="mi">4007</span><span class="p">,</span> <span class="mi">4009</span><span class="p">,</span> <span class="mi">23000</span><span class="p">,</span> <span class="mi">28059</span><span class="p">,</span> <span class="mi">33074</span><span class="p">,</span> <span class="mi">39090</span><span class="p">,</span> <span class="mi">91231</span><span class="p">,</span> <span class="mi">91233</span><span class="p">,</span> <span class="mi">98253</span><span class="p">,</span> <span class="mi">99253</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># (n, 2n) can be significant for any isotope, but does not exist for some</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="mi">16</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">za</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1001</span><span class="p">,</span> <span class="mi">2003</span><span class="p">,</span> <span class="mi">2004</span><span class="p">,</span> <span class="mi">3006</span><span class="p">,</span> <span class="mi">4007</span><span class="p">,</span> <span class="mi">5010</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">98253</span><span class="p">,</span> <span class="mi">99253</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># (n, 3n) is assumed only significant for actinides, but does not exist for some</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="mi">17</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ZaIsActinide</span><span class="p">(</span><span class="n">za</span><span class="p">)</span> <span class="ow">and</span> <span class="n">za</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">92234</span><span class="p">,</span> <span class="mi">92236</span><span class="p">,</span> <span class="mi">93237</span><span class="p">,</span> <span class="mi">94238</span><span class="p">,</span> <span class="mi">94240</span><span class="p">,</span> <span class="mi">94241</span><span class="p">,</span> <span class="mi">94242</span><span class="p">,</span> <span class="mi">95241</span><span class="p">,</span> <span class="mi">95242</span><span class="p">,</span> <span class="mi">95243</span><span class="p">,</span> <span class="mi">96242</span><span class="p">,</span> <span class="mi">96243</span><span class="p">,</span> <span class="mi">96244</span><span class="p">,</span> <span class="mi">96245</span><span class="p">,</span> <span class="mi">98253</span><span class="p">,</span> <span class="mi">99253</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># (n, fission) is assumed only significant for actinides, but does not exist for some</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="mi">18</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ZaIsActinide</span><span class="p">(</span><span class="n">za</span><span class="p">)</span> <span class="ow">and</span> <span class="n">za</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">89225</span><span class="p">,</span> <span class="mi">89226</span><span class="p">,</span> <span class="mi">99253</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># (n, \gamma) can be significant for any isotope, but does not exist for some</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="mi">102</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">za</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1003</span><span class="p">,</span> <span class="mi">2004</span><span class="p">,</span> <span class="mi">4007</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># (n, p) is assumed only significant for fission products, but does not exist for some</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="mi">103</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">z</span> <span class="o">&lt;</span> <span class="mi">89</span> <span class="ow">and</span> <span class="n">za</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1001</span><span class="p">,</span> <span class="mi">1002</span><span class="p">,</span> <span class="mi">1003</span><span class="p">,</span> <span class="mi">2004</span><span class="p">,</span> <span class="mi">3007</span><span class="p">,</span> <span class="mi">4007</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># (n, t) is significant below 14.1 MeV for these isotopes</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="mi">205</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">za</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3006</span><span class="p">,</span> <span class="mi">3007</span><span class="p">,</span> <span class="mi">4009</span><span class="p">,</span> <span class="mi">5011</span><span class="p">,</span> <span class="mi">7014</span><span class="p">,</span> <span class="mi">7015</span><span class="p">,</span> <span class="mi">9019</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># (n, a) is assumed only significant for actinides</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="mi">107</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ZaIsActinide</span><span class="p">(</span><span class="n">za</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># MCNP&#39;s -6 is equivalent to MT = 18</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="o">-</span><span class="mi">6</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IsZaReactionNumberOfInterest</span><span class="p">(</span><span class="n">za</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># 205 is a better MT than 105</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="mi">105</span> <span class="o">==</span> <span class="n">reactionNumber</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">IsZaReactionNumberOfInterest</span><span class="p">(</span><span class="n">za</span><span class="p">,</span> <span class="mi">205</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Unaccounted-for reactions are assumed to be not of interest</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="bp">False</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Make directory</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="MakeDirectory"><a class="viewcode-back" href="../src.html#MocDown.MakeDirectory">[docs]</a><span class="k">def</span> <span class="nf">MakeDirectory</span><span class="p">(</span><span class="n">directoryName</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Make directory.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">RemoveTree</span><span class="p">(</span><span class="n">directoryName</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="n">display</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} ^^&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directoryName</span><span class="p">));</span>
    <span class="n">LibMakeDirectory</span><span class="p">(</span><span class="n">directoryName</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Make temporary directory</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="MakeTemporaryDirectory"><a class="viewcode-back" href="../src.html#MocDown.MakeTemporaryDirectory">[docs]</a><span class="k">def</span> <span class="nf">MakeTemporaryDirectory</span><span class="p">(</span><span class="n">display</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Make temporary directory.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">directoryName</span> <span class="o">=</span> <span class="n">LibMakeTemporaryDirectory</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} ^^&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directoryName</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">directoryName</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Move file</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="MoveFile"><a class="viewcode-back" href="../src.html#MocDown.MoveFile">[docs]</a><span class="k">def</span> <span class="nf">MoveFile</span><span class="p">(</span><span class="n">pathOne</span><span class="p">,</span> <span class="n">pathTwo</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Move file.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pathOne</span><span class="p">,</span> <span class="n">pathTwo</span><span class="p">));</span>
    <span class="k">if</span> <span class="n">Exists</span><span class="p">(</span><span class="n">pathOne</span><span class="p">):</span>
        <span class="n">LibMoveFile</span><span class="p">(</span><span class="n">pathOne</span><span class="p">,</span> <span class="n">pathTwo</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Key for extracting numerics from strings</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="NumericStringKey"><a class="viewcode-back" href="../src.html#MocDown.NumericStringKey">[docs]</a><span class="k">def</span> <span class="nf">NumericStringKey</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return hash from numerics in a string.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">character</span> <span class="ow">in</span> <span class="s">&#39;0123456789&#39;</span><span class="p">:</span>
            <span class="n">digit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">character</span><span class="p">);</span>
            <span class="k">if</span> <span class="n">output</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">digit</span><span class="p">;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">digit</span><span class="p">);</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">character</span><span class="o">.</span><span class="n">lower</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">output</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Print now</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="PrintNow"><a class="viewcode-back" href="../src.html#MocDown.PrintNow">[docs]</a><span class="k">def</span> <span class="nf">PrintNow</span><span class="p">(</span><span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Print to stdout immediately.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">print</span><span class="p">(</span><span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">);</span>
    <span class="n">StdOut</span><span class="o">.</span><span class="n">flush</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Q-fission of MCNP</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="QFissionMCNP"><a class="viewcode-back" href="../src.html#MocDown.QFissionMCNP">[docs]</a><span class="k">def</span> <span class="nf">QFissionMCNP</span><span class="p">(</span><span class="n">ZA</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return Q-fission of MCNP.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">za2Q</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">90232</span> <span class="p">:</span> <span class="mf">171.91</span><span class="p">,</span>
        <span class="mi">91233</span> <span class="p">:</span> <span class="mf">175.57</span><span class="p">,</span>
        <span class="mi">92233</span> <span class="p">:</span> <span class="mf">180.84</span><span class="p">,</span>
        <span class="mi">92234</span> <span class="p">:</span> <span class="mf">179.45</span><span class="p">,</span>
        <span class="mi">92235</span> <span class="p">:</span> <span class="mf">180.88</span><span class="p">,</span>
        <span class="mi">92236</span> <span class="p">:</span> <span class="mf">179.50</span><span class="p">,</span>
        <span class="mi">92237</span> <span class="p">:</span> <span class="mf">180.40</span><span class="p">,</span>
        <span class="mi">92238</span> <span class="p">:</span> <span class="mf">181.31</span><span class="p">,</span>
        <span class="mi">92239</span> <span class="p">:</span> <span class="mf">180.40</span><span class="p">,</span>
        <span class="mi">92240</span> <span class="p">:</span> <span class="mf">180.40</span><span class="p">,</span>
        <span class="mi">93237</span> <span class="p">:</span> <span class="mf">183.67</span><span class="p">,</span>
        <span class="mi">94238</span> <span class="p">:</span> <span class="mf">186.65</span><span class="p">,</span>
        <span class="mi">94239</span> <span class="p">:</span> <span class="mf">189.44</span><span class="p">,</span>
        <span class="mi">94240</span> <span class="p">:</span> <span class="mf">186.36</span><span class="p">,</span>
        <span class="mi">94241</span> <span class="p">:</span> <span class="mf">188.99</span><span class="p">,</span>
        <span class="mi">94242</span> <span class="p">:</span> <span class="mf">185.98</span><span class="p">,</span>
        <span class="mi">94243</span> <span class="p">:</span> <span class="mf">187.48</span><span class="p">,</span>
        <span class="mi">95241</span> <span class="p">:</span> <span class="mf">190.83</span><span class="p">,</span>
        <span class="mi">95242</span> <span class="p">:</span> <span class="mf">190.54</span><span class="p">,</span>
        <span class="mi">95243</span> <span class="p">:</span> <span class="mf">190.25</span><span class="p">,</span>
        <span class="mi">96242</span> <span class="p">:</span> <span class="mf">190.49</span><span class="p">,</span>
        <span class="mi">96244</span> <span class="p">:</span> <span class="mf">190.49</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="c">###</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">za2Q</span><span class="p">[</span><span class="n">ZA</span><span class="p">];</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">180</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Q-fission of MONTEBURNS2</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="QFissionMonteburns2"><a class="viewcode-back" href="../src.html#MocDown.QFissionMonteburns2">[docs]</a><span class="k">def</span> <span class="nf">QFissionMonteburns2</span><span class="p">(</span><span class="n">ZA</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return Q-fission of MONTEBURNS2.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">za2Q</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">90227</span> <span class="p">:</span> <span class="mf">0.9043</span><span class="p">,</span>
        <span class="mi">90229</span> <span class="p">:</span> <span class="mf">0.9247</span><span class="p">,</span>
        <span class="mi">90232</span> <span class="p">:</span> <span class="mf">0.9573</span><span class="p">,</span>
        <span class="mi">91231</span> <span class="p">:</span> <span class="mf">0.9471</span><span class="p">,</span>
        <span class="mi">91233</span> <span class="p">:</span> <span class="mf">0.9850</span><span class="p">,</span>
        <span class="mi">92232</span> <span class="p">:</span> <span class="mf">0.9553</span><span class="p">,</span>
        <span class="mi">92233</span> <span class="p">:</span> <span class="mf">0.9881</span><span class="p">,</span>
        <span class="mi">92234</span> <span class="p">:</span> <span class="mf">0.9774</span><span class="p">,</span>
        <span class="mi">92235</span> <span class="p">:</span> <span class="mf">1.0000</span><span class="p">,</span>
        <span class="mi">92236</span> <span class="p">:</span> <span class="mf">0.9973</span><span class="p">,</span>
        <span class="mi">92237</span> <span class="p">:</span> <span class="mf">1.0074</span><span class="p">,</span>
        <span class="mi">92238</span> <span class="p">:</span> <span class="mf">1.0175</span><span class="p">,</span>
        <span class="mi">93237</span> <span class="p">:</span> <span class="mf">1.0073</span><span class="p">,</span>
        <span class="mi">93238</span> <span class="p">:</span> <span class="mf">1.0175</span><span class="p">,</span>
        <span class="mi">94238</span> <span class="p">:</span> <span class="mf">1.0175</span><span class="p">,</span>
        <span class="mi">94239</span> <span class="p">:</span> <span class="mf">1.0435</span><span class="p">,</span>
        <span class="mi">94240</span> <span class="p">:</span> <span class="mf">1.0379</span><span class="p">,</span>
        <span class="mi">94241</span> <span class="p">:</span> <span class="mf">1.0536</span><span class="p">,</span>
        <span class="mi">94242</span> <span class="p">:</span> <span class="mf">1.0583</span><span class="p">,</span>
        <span class="mi">95241</span> <span class="p">:</span> <span class="mf">1.0513</span><span class="p">,</span>
        <span class="mi">95242</span> <span class="p">:</span> <span class="mf">1.0609</span><span class="p">,</span>
        <span class="mi">95243</span> <span class="p">:</span> <span class="mf">1.0685</span><span class="p">,</span>
        <span class="mi">96242</span> <span class="p">:</span> <span class="mf">1.0583</span><span class="p">,</span>
        <span class="mi">96243</span> <span class="p">:</span> <span class="mf">1.0685</span><span class="p">,</span>
        <span class="mi">96244</span> <span class="p">:</span> <span class="mf">1.0787</span><span class="p">,</span>
        <span class="mi">96245</span> <span class="p">:</span> <span class="mf">1.0889</span><span class="p">,</span>
        <span class="mi">96246</span> <span class="p">:</span> <span class="mf">1.0991</span><span class="p">,</span>
        <span class="mi">96248</span> <span class="p">:</span> <span class="mf">1.1195</span><span class="p">,</span>
        <span class="mi">96249</span> <span class="p">:</span> <span class="mf">1.1296</span><span class="p">,</span>
        <span class="mi">98251</span> <span class="p">:</span> <span class="mf">1.1501</span><span class="p">,</span>
        <span class="mi">99254</span> <span class="p">:</span> <span class="mf">1.1807</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="n">za2Q</span><span class="p">[</span><span class="n">ZA</span><span class="p">];</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="mi">200</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Q-fission of ORIGEN2.2</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="QFissionOrigen2"><a class="viewcode-back" href="../src.html#MocDown.QFissionOrigen2">[docs]</a><span class="k">def</span> <span class="nf">QFissionOrigen2</span><span class="p">(</span><span class="n">ZA</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return Q-fission of ORIGEN2.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">Z</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">ZA</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">ZA</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="k">return</span> <span class="mf">1.29927E-03</span> <span class="o">*</span> <span class="p">(</span><span class="n">Z</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">A</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="mf">33.12</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Q-capture of ORIGEN-S</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="QCaptureOrigenS"><a class="viewcode-back" href="../src.html#MocDown.QCaptureOrigenS">[docs]</a><span class="k">def</span> <span class="nf">QCaptureOrigenS</span><span class="p">(</span><span class="n">ZA</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return Q-capture of ORIGEN-S.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">za2Q</span> <span class="o">=</span> <span class="p">{</span>
         <span class="mi">1001</span> <span class="p">:</span> <span class="mf">2.225</span><span class="p">,</span>
         <span class="mi">5010</span> <span class="p">:</span> <span class="mf">2.790</span><span class="p">,</span>
         <span class="mi">8016</span> <span class="p">:</span> <span class="mf">4.143</span><span class="p">,</span>
        <span class="mi">26056</span> <span class="p">:</span> <span class="mf">7.600</span><span class="p">,</span>
        <span class="mi">28058</span> <span class="p">:</span> <span class="mf">9.020</span><span class="p">,</span>
        <span class="mi">40090</span> <span class="p">:</span> <span class="mf">7.203</span><span class="p">,</span>
        <span class="mi">40091</span> <span class="p">:</span> <span class="mf">8.635</span><span class="p">,</span>
        <span class="mi">40092</span> <span class="p">:</span> <span class="mf">6.758</span><span class="p">,</span>
        <span class="mi">40096</span> <span class="p">:</span> <span class="mf">5.571</span><span class="p">,</span>
        <span class="mi">42095</span> <span class="p">:</span> <span class="mf">9.154</span><span class="p">,</span>
        <span class="mi">43095</span> <span class="p">:</span> <span class="mf">7.710</span><span class="p">,</span>
        <span class="mi">44101</span> <span class="p">:</span> <span class="mf">9.216</span><span class="p">,</span>
        <span class="mi">45103</span> <span class="p">:</span> <span class="mf">6.999</span><span class="p">,</span>
        <span class="mi">45105</span> <span class="p">:</span> <span class="mf">7.094</span><span class="p">,</span>
        <span class="mi">47109</span> <span class="p">:</span> <span class="mf">6.825</span><span class="p">,</span>
        <span class="mi">54131</span> <span class="p">:</span> <span class="mf">8.936</span><span class="p">,</span>
        <span class="mi">54135</span> <span class="p">:</span> <span class="mf">7.880</span><span class="p">,</span>
        <span class="mi">55133</span> <span class="p">:</span> <span class="mf">6.704</span><span class="p">,</span>
        <span class="mi">55134</span> <span class="p">:</span> <span class="mf">6.550</span><span class="p">,</span>
        <span class="mi">60143</span> <span class="p">:</span> <span class="mf">7.817</span><span class="p">,</span>
        <span class="mi">60145</span> <span class="p">:</span> <span class="mf">7.565</span><span class="p">,</span>
        <span class="mi">61147</span> <span class="p">:</span> <span class="mf">5.900</span><span class="p">,</span>
        <span class="mi">61148</span> <span class="p">:</span> <span class="mf">7.266</span><span class="p">,</span>
        <span class="mi">62147</span> <span class="p">:</span> <span class="mf">8.140</span><span class="p">,</span>
        <span class="mi">62149</span> <span class="p">:</span> <span class="mf">7.982</span><span class="p">,</span>
        <span class="mi">62150</span> <span class="p">:</span> <span class="mf">5.596</span><span class="p">,</span>
        <span class="mi">62151</span> <span class="p">:</span> <span class="mf">8.258</span><span class="p">,</span>
        <span class="mi">62152</span> <span class="p">:</span> <span class="mf">5.867</span><span class="p">,</span>
        <span class="mi">63153</span> <span class="p">:</span> <span class="mf">6.444</span><span class="p">,</span>
        <span class="mi">63154</span> <span class="p">:</span> <span class="mf">8.167</span><span class="p">,</span>
        <span class="mi">63155</span> <span class="p">:</span> <span class="mf">6.490</span><span class="p">,</span>
        <span class="mi">90230</span> <span class="p">:</span> <span class="mf">5.010</span><span class="p">,</span>
        <span class="mi">90232</span> <span class="p">:</span> <span class="mf">4.786</span><span class="p">,</span>
        <span class="mi">90233</span> <span class="p">:</span> <span class="mf">6.080</span><span class="p">,</span>
        <span class="mi">91231</span> <span class="p">:</span> <span class="mf">5.660</span><span class="p">,</span>
        <span class="mi">91233</span> <span class="p">:</span> <span class="mf">5.197</span><span class="p">,</span>
        <span class="mi">92232</span> <span class="p">:</span> <span class="mf">5.930</span><span class="p">,</span>
        <span class="mi">92233</span> <span class="p">:</span> <span class="mf">6.841</span><span class="p">,</span>
        <span class="mi">92234</span> <span class="p">:</span> <span class="mf">5.297</span><span class="p">,</span>
        <span class="mi">92235</span> <span class="p">:</span> <span class="mf">6.545</span><span class="p">,</span>
        <span class="mi">92236</span> <span class="p">:</span> <span class="mf">5.124</span><span class="p">,</span>
        <span class="mi">92238</span> <span class="p">:</span> <span class="mf">4.804</span><span class="p">,</span>
        <span class="mi">93237</span> <span class="p">:</span> <span class="mf">5.490</span><span class="p">,</span>
        <span class="mi">93239</span> <span class="p">:</span> <span class="mf">4.970</span><span class="p">,</span>
        <span class="mi">94238</span> <span class="p">:</span> <span class="mf">5.550</span><span class="p">,</span>
        <span class="mi">94239</span> <span class="p">:</span> <span class="mf">6.533</span><span class="p">,</span>
        <span class="mi">94240</span> <span class="p">:</span> <span class="mf">5.241</span><span class="p">,</span>
        <span class="mi">94241</span> <span class="p">:</span> <span class="mf">6.301</span><span class="p">,</span>
        <span class="mi">94242</span> <span class="p">:</span> <span class="mf">5.071</span><span class="p">,</span>
        <span class="mi">94243</span> <span class="p">:</span> <span class="mf">6.020</span><span class="p">,</span>
        <span class="mi">95241</span> <span class="p">:</span> <span class="mf">5.529</span><span class="p">,</span>
        <span class="mi">95242</span> <span class="p">:</span> <span class="mf">6.426</span><span class="p">,</span>
        <span class="mi">95243</span> <span class="p">:</span> <span class="mf">5.363</span><span class="p">,</span>
        <span class="mi">96244</span> <span class="p">:</span> <span class="mf">6.451</span><span class="p">,</span>
        <span class="mi">96245</span> <span class="p">:</span> <span class="mf">6.110</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="c">###</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">za2Q</span><span class="p">[</span><span class="n">ZA</span><span class="p">];</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Q-fission of ORIGEN-S</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="QFissionOrigenS"><a class="viewcode-back" href="../src.html#MocDown.QFissionOrigenS">[docs]</a><span class="k">def</span> <span class="nf">QFissionOrigenS</span><span class="p">(</span><span class="n">ZA</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return Q-fission of ORIGEN-S.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">za2Q</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">90230</span> <span class="p">:</span> <span class="mf">190.00</span><span class="p">,</span>
        <span class="mi">90232</span> <span class="p">:</span> <span class="mf">189.21</span><span class="p">,</span>
        <span class="mi">90233</span> <span class="p">:</span> <span class="mf">190.00</span><span class="p">,</span>
        <span class="mi">91231</span> <span class="p">:</span> <span class="mf">190.00</span><span class="p">,</span>
        <span class="mi">91233</span> <span class="p">:</span> <span class="mf">189.10</span><span class="p">,</span>
        <span class="mi">92233</span> <span class="p">:</span> <span class="mf">191.29</span><span class="p">,</span>
        <span class="mi">92234</span> <span class="p">:</span> <span class="mf">190.30</span><span class="p">,</span>
        <span class="mi">92235</span> <span class="p">:</span> <span class="mf">194.02</span><span class="p">,</span>
        <span class="mi">92236</span> <span class="p">:</span> <span class="mf">192.80</span><span class="p">,</span>
        <span class="mi">92238</span> <span class="p">:</span> <span class="mf">198.12</span><span class="p">,</span>
        <span class="mi">93237</span> <span class="p">:</span> <span class="mf">195.10</span><span class="p">,</span>
        <span class="mi">94238</span> <span class="p">:</span> <span class="mf">197.80</span><span class="p">,</span>
        <span class="mi">94239</span> <span class="p">:</span> <span class="mf">200.05</span><span class="p">,</span>
        <span class="mi">94240</span> <span class="p">:</span> <span class="mf">199.79</span><span class="p">,</span>
        <span class="mi">94241</span> <span class="p">:</span> <span class="mf">202.22</span><span class="p">,</span>
        <span class="mi">94242</span> <span class="p">:</span> <span class="mf">200.62</span><span class="p">,</span>
        <span class="mi">95241</span> <span class="p">:</span> <span class="mf">202.30</span><span class="p">,</span>
        <span class="mi">95242</span> <span class="p">:</span> <span class="mf">202.29</span><span class="p">,</span>
        <span class="mi">95243</span> <span class="p">:</span> <span class="mf">202.10</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="c">###</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">za2Q</span><span class="p">[</span><span class="n">ZA</span><span class="p">];</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">200</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Read ascii file</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="ReadFile"><a class="viewcode-back" href="../src.html#MocDown.ReadFile">[docs]</a><span class="k">def</span> <span class="nf">ReadFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Read and return ascii file.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">AssertFileExists</span><span class="p">(</span><span class="n">fileName</span><span class="p">);</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; File `{}</span><span class="se">\&#39;</span><span class="s"> does not exist ... waiting {:d} seconds and checking again ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">seconds</span><span class="p">));</span>
        <span class="n">Sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="n">AssertFileExists</span><span class="p">(</span><span class="n">fileName</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} &gt;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">));</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">raw</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Read xsdir from DATAPATH</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="ReadXsDir"><a class="viewcode-back" href="../src.html#MocDown.ReadXsDir">[docs]</a><span class="k">def</span> <span class="nf">ReadXsDir</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Find, read, and return xsdir file.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># 1) Use xsdir in current directory</span>
    <span class="c"># 2) Use path provided by argument</span>
    <span class="c"># 3) Use DATAPATH path defined in env</span>
    <span class="c">###</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;xsdir&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">];</span>
    <span class="c">###</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">environ</span><span class="p">;</span>
        <span class="c">##</span>
        <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;{}/xsdir&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DATAPATH&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;//&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">));</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">AssertFileExists</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="k">return</span> <span class="n">ReadFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">display</span><span class="p">);</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">continue</span><span class="p">;</span>
    <span class="ne">Warning</span><span class="p">(</span><span class="s">&#39;xsdir was not found.&#39;</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Parse MCNP5, MCNP6, or MCNPX input/output file</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="ReadTransportFile"><a class="viewcode-back" href="../src.html#MocDown.ReadTransportFile">[docs]</a><span class="k">def</span> <span class="nf">ReadTransportFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Read MCNP input or output file.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">ReadFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">4000</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ReCompile</span><span class="p">(</span><span class="s">r&#39;^1mcnp&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">raw</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">McnpOutputFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">);</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">McnpInputFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Remove directory</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="RemoveDirectory"><a class="viewcode-back" href="../src.html#MocDown.RemoveDirectory">[docs]</a><span class="k">def</span> <span class="nf">RemoveDirectory</span><span class="p">(</span><span class="n">directoryName</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Remove directory.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">Exists</span><span class="p">(</span><span class="n">directoryName</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} XX&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directoryName</span><span class="p">));</span>
        <span class="n">LibRemoveDirectory</span><span class="p">(</span><span class="n">directoryName</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Remove directory tree</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="RemoveTree"><a class="viewcode-back" href="../src.html#MocDown.RemoveTree">[docs]</a><span class="k">def</span> <span class="nf">RemoveTree</span><span class="p">(</span><span class="n">directoryName</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Remove directory tree.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">Exists</span><span class="p">(</span><span class="n">directoryName</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{}* XX&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directoryName</span><span class="p">));</span>
        <span class="n">LibRemoveTree</span><span class="p">(</span><span class="n">directoryName</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Remove file</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="RemoveFile"><a class="viewcode-back" href="../src.html#MocDown.RemoveFile">[docs]</a><span class="k">def</span> <span class="nf">RemoveFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Remove file.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">Exists</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} XX&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">));</span>
        <span class="n">LibRemoveFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Safely divide two quantities</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="SafeDivide"><a class="viewcode-back" href="../src.html#MocDown.SafeDivide">[docs]</a><span class="k">def</span> <span class="nf">SafeDivide</span><span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Safely divide two quantities.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">;</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Determine the slope of a set of points using a simple linear regression</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Slope"><a class="viewcode-back" href="../src.html#MocDown.Slope">[docs]</a><span class="k">def</span> <span class="nf">Slope</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Determine the slope of a set of points using a simple linear regression.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span> <span class="o">*</span> <span class="n">point</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">)</span> <span class="o">-</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">)</span> <span class="o">-</span> <span class="n">SafeDivide</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)));</span>
<span class="c">###</span>
<span class="c"># Symbolically link files</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="SymbolicLink"><a class="viewcode-back" href="../src.html#MocDown.SymbolicLink">[docs]</a><span class="k">def</span> <span class="nf">SymbolicLink</span><span class="p">(</span><span class="n">pathOne</span><span class="p">,</span> <span class="n">pathTwo</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Symbolically link files.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">AssertFileExists</span><span class="p">(</span><span class="n">pathOne</span><span class="p">);</span>
    <span class="n">RemoveFile</span><span class="p">(</span><span class="n">pathTwo</span><span class="p">,</span> <span class="n">display</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pathTwo</span><span class="p">,</span> <span class="n">pathOne</span><span class="p">));</span>
    <span class="n">LibSymbolicLink</span><span class="p">(</span><span class="n">pathOne</span><span class="p">,</span> <span class="n">pathTwo</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Find a unique integer, given a number of digits and container of forbidden integers</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="UniqueDigits"><a class="viewcode-back" href="../src.html#MocDown.UniqueDigits">[docs]</a><span class="k">def</span> <span class="nf">UniqueDigits</span><span class="p">(</span><span class="n">numberOfDigits</span><span class="p">,</span> <span class="n">forbiddenNumbers</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Find a unique integer, given a number of digits and container of forbidden integers.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">RandomInteger</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">numberOfDigits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="n">output</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">forbiddenNumbers</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Arrange words of a given format within columns</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="WordArrange"><a class="viewcode-back" href="../src.html#MocDown.WordArrange">[docs]</a><span class="k">def</span> <span class="nf">WordArrange</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">columnNumber</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Arrange words of a given format within columns.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="s">&#39;{&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">format</span><span class="p">:</span>
        <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;{{{}}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">format</span><span class="p">);</span>
    <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">prefix</span><span class="p">];</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">word</span><span class="p">);</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">columnNumber</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">*</span> <span class="nb">bool</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
            <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)];</span>
        <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">);</span>
    <span class="n">output</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">*</span> <span class="nb">bool</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">output</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Display warning messages</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Warning"><a class="viewcode-back" href="../src.html#MocDown.Warning">[docs]</a><span class="k">def</span> <span class="nf">Warning</span><span class="p">(</span><span class="n">warningMessage</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Display warning messages.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;Warning:</span><span class="se">\t</span><span class="s">{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\t\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">warningMessage</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))));</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Write .csv file</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="WriteCsvFile"><a class="viewcode-back" href="../src.html#MocDown.WriteCsvFile">[docs]</a><span class="k">def</span> <span class="nf">WriteCsvFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="o">*</span><span class="n">iterables</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Write .csv file.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} &lt;&lt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">));</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">CsvWriter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">lineterminator</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="n">iterable</span> <span class="ow">in</span> <span class="n">iterables</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">iterable</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Write ascii file</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="WriteFile"><a class="viewcode-back" href="../src.html#MocDown.WriteFile">[docs]</a><span class="k">def</span> <span class="nf">WriteFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">display</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Write ascii file.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;{} &lt;&lt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">));</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">raw</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Z # --&gt; Element</span>
<span class="c">###</span></div>
<span class="n">z2Element</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;n&#39;</span><span class="p">,</span> <span class="s">&#39;H&#39;</span><span class="p">,</span> <span class="s">&#39;He&#39;</span><span class="p">,</span> <span class="s">&#39;Li&#39;</span><span class="p">,</span> <span class="s">&#39;Be&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="s">&#39;O&#39;</span><span class="p">,</span> <span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="s">&#39;Ne&#39;</span><span class="p">,</span> <span class="s">&#39;Na&#39;</span><span class="p">,</span> <span class="s">&#39;Mg&#39;</span><span class="p">,</span> <span class="s">&#39;Al&#39;</span><span class="p">,</span> <span class="s">&#39;Si&#39;</span><span class="p">,</span> <span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="s">&#39;Cl&#39;</span><span class="p">,</span> <span class="s">&#39;Ar&#39;</span><span class="p">,</span> <span class="s">&#39;K&#39;</span><span class="p">,</span> <span class="s">&#39;Ca&#39;</span><span class="p">,</span> <span class="s">&#39;Sc&#39;</span><span class="p">,</span> <span class="s">&#39;Ti&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">,</span> <span class="s">&#39;Cr&#39;</span><span class="p">,</span> <span class="s">&#39;Mn&#39;</span><span class="p">,</span> <span class="s">&#39;Fe&#39;</span><span class="p">,</span> <span class="s">&#39;Co&#39;</span><span class="p">,</span> <span class="s">&#39;Ni&#39;</span><span class="p">,</span> <span class="s">&#39;Cu&#39;</span><span class="p">,</span> <span class="s">&#39;Zn&#39;</span><span class="p">,</span> <span class="s">&#39;Ga&#39;</span><span class="p">,</span> <span class="s">&#39;Ge&#39;</span><span class="p">,</span> <span class="s">&#39;As&#39;</span><span class="p">,</span> <span class="s">&#39;Se&#39;</span><span class="p">,</span> <span class="s">&#39;Br&#39;</span><span class="p">,</span> <span class="s">&#39;Kr&#39;</span><span class="p">,</span> <span class="s">&#39;Rb&#39;</span><span class="p">,</span> <span class="s">&#39;Sr&#39;</span><span class="p">,</span> <span class="s">&#39;Y&#39;</span><span class="p">,</span> <span class="s">&#39;Zr&#39;</span><span class="p">,</span> <span class="s">&#39;Nb&#39;</span><span class="p">,</span> <span class="s">&#39;Mo&#39;</span><span class="p">,</span> <span class="s">&#39;Tc&#39;</span><span class="p">,</span> <span class="s">&#39;Ru&#39;</span><span class="p">,</span> <span class="s">&#39;Rh&#39;</span><span class="p">,</span> <span class="s">&#39;Pd&#39;</span><span class="p">,</span> <span class="s">&#39;Ag&#39;</span><span class="p">,</span> <span class="s">&#39;Cd&#39;</span><span class="p">,</span> <span class="s">&#39;In&#39;</span><span class="p">,</span> <span class="s">&#39;Sn&#39;</span><span class="p">,</span> <span class="s">&#39;Sb&#39;</span><span class="p">,</span> <span class="s">&#39;Te&#39;</span><span class="p">,</span> <span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="s">&#39;Xe&#39;</span><span class="p">,</span> <span class="s">&#39;Cs&#39;</span><span class="p">,</span> <span class="s">&#39;Ba&#39;</span><span class="p">,</span> <span class="s">&#39;La&#39;</span><span class="p">,</span> <span class="s">&#39;Ce&#39;</span><span class="p">,</span> <span class="s">&#39;Pr&#39;</span><span class="p">,</span> <span class="s">&#39;Nd&#39;</span><span class="p">,</span> <span class="s">&#39;Pm&#39;</span><span class="p">,</span> <span class="s">&#39;Sm&#39;</span><span class="p">,</span> <span class="s">&#39;Eu&#39;</span><span class="p">,</span> <span class="s">&#39;Gd&#39;</span><span class="p">,</span> <span class="s">&#39;Tb&#39;</span><span class="p">,</span> <span class="s">&#39;Dy&#39;</span><span class="p">,</span> <span class="s">&#39;Ho&#39;</span><span class="p">,</span> <span class="s">&#39;Er&#39;</span><span class="p">,</span> <span class="s">&#39;Tm&#39;</span><span class="p">,</span> <span class="s">&#39;Yb&#39;</span><span class="p">,</span> <span class="s">&#39;Lu&#39;</span><span class="p">,</span> <span class="s">&#39;Hf&#39;</span><span class="p">,</span> <span class="s">&#39;Ta&#39;</span><span class="p">,</span> <span class="s">&#39;W&#39;</span><span class="p">,</span> <span class="s">&#39;Re&#39;</span><span class="p">,</span> <span class="s">&#39;Os&#39;</span><span class="p">,</span> <span class="s">&#39;Ir&#39;</span><span class="p">,</span> <span class="s">&#39;Pt&#39;</span><span class="p">,</span> <span class="s">&#39;Au&#39;</span><span class="p">,</span> <span class="s">&#39;Hg&#39;</span><span class="p">,</span> <span class="s">&#39;Tl&#39;</span><span class="p">,</span> <span class="s">&#39;Pb&#39;</span><span class="p">,</span> <span class="s">&#39;Bi&#39;</span><span class="p">,</span> <span class="s">&#39;Po&#39;</span><span class="p">,</span> <span class="s">&#39;At&#39;</span><span class="p">,</span> <span class="s">&#39;Rn&#39;</span><span class="p">,</span> <span class="s">&#39;Fr&#39;</span><span class="p">,</span> <span class="s">&#39;Ra&#39;</span><span class="p">,</span> <span class="s">&#39;Ac&#39;</span><span class="p">,</span> <span class="s">&#39;Th&#39;</span><span class="p">,</span> <span class="s">&#39;Pa&#39;</span><span class="p">,</span> <span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="s">&#39;Np&#39;</span><span class="p">,</span> <span class="s">&#39;Pu&#39;</span><span class="p">,</span> <span class="s">&#39;Am&#39;</span><span class="p">,</span> <span class="s">&#39;Cm&#39;</span><span class="p">,</span> <span class="s">&#39;Bk&#39;</span><span class="p">,</span> <span class="s">&#39;Cf&#39;</span><span class="p">,</span> <span class="s">&#39;Es&#39;</span><span class="p">,</span> <span class="s">&#39;Fm&#39;</span><span class="p">,</span> <span class="s">&#39;Md&#39;</span><span class="p">,</span> <span class="s">&#39;No&#39;</span><span class="p">,</span> <span class="s">&#39;Lr&#39;</span><span class="p">,</span> <span class="s">&#39;Rf&#39;</span><span class="p">,</span> <span class="s">&#39;Db&#39;</span><span class="p">,</span> <span class="s">&#39;Sg&#39;</span><span class="p">,</span> <span class="s">&#39;Bh&#39;</span><span class="p">,</span> <span class="s">&#39;Hs&#39;</span><span class="p">,</span> <span class="s">&#39;Mt&#39;</span><span class="p">,</span> <span class="s">&#39;Ds&#39;</span><span class="p">,</span> <span class="s">&#39;Rg&#39;</span><span class="p">,</span> <span class="s">&#39;Cn&#39;</span><span class="p">,</span> <span class="s">&#39;Uut&#39;</span><span class="p">,</span> <span class="s">&#39;Fl&#39;</span><span class="p">,</span> <span class="s">&#39;Uup&#39;</span><span class="p">,</span> <span class="s">&#39;Lv&#39;</span><span class="p">,</span> <span class="s">&#39;Uus&#39;</span><span class="p">,</span> <span class="s">&#39;Uuo&#39;</span><span class="p">];</span>
<span class="c">###</span>
<span class="c"># ZA # --&gt; Elemental natural abundance (http://www.nist.gov/pml/data/comp.cfm)</span>
<span class="c">###</span>
<span class="n">za2Abundance</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1001</span> <span class="p">:</span> <span class="mf">0.999885</span><span class="p">,</span> <span class="mi">1002</span> <span class="p">:</span> <span class="mf">0.000115</span><span class="p">,</span> <span class="mi">2003</span> <span class="p">:</span> <span class="mf">0.00000134</span><span class="p">,</span> <span class="mi">2004</span> <span class="p">:</span> <span class="mf">0.99999866</span><span class="p">,</span> <span class="mi">3006</span> <span class="p">:</span> <span class="mf">0.0759</span><span class="p">,</span> <span class="mi">3007</span> <span class="p">:</span> <span class="mf">0.9241</span><span class="p">,</span> <span class="mi">4009</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">5010</span> <span class="p">:</span> <span class="mf">0.199</span><span class="p">,</span> <span class="mi">5011</span> <span class="p">:</span> <span class="mf">0.801</span><span class="p">,</span> <span class="mi">6012</span> <span class="p">:</span> <span class="mf">0.9893</span><span class="p">,</span>
    <span class="mi">6013</span> <span class="p">:</span> <span class="mf">0.0107</span><span class="p">,</span> <span class="mi">7014</span> <span class="p">:</span> <span class="mf">0.99636</span><span class="p">,</span> <span class="mi">7015</span> <span class="p">:</span> <span class="mf">0.00364</span><span class="p">,</span> <span class="mi">8016</span> <span class="p">:</span> <span class="mf">0.99757</span><span class="p">,</span> <span class="mi">8017</span> <span class="p">:</span> <span class="mf">0.00038</span><span class="p">,</span> <span class="mi">8018</span> <span class="p">:</span> <span class="mf">0.00205</span><span class="p">,</span> <span class="mi">9019</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">10020</span> <span class="p">:</span> <span class="mf">0.9048</span><span class="p">,</span> <span class="mi">10021</span> <span class="p">:</span> <span class="mf">0.0027</span><span class="p">,</span> <span class="mi">10022</span> <span class="p">:</span> <span class="mf">0.0925</span><span class="p">,</span>
    <span class="mi">11023</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">12024</span> <span class="p">:</span> <span class="mf">0.7899</span><span class="p">,</span> <span class="mi">12025</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">12026</span> <span class="p">:</span> <span class="mf">0.1101</span><span class="p">,</span> <span class="mi">13027</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">14028</span> <span class="p">:</span> <span class="mf">0.92223</span><span class="p">,</span> <span class="mi">14029</span> <span class="p">:</span> <span class="mf">0.04685</span><span class="p">,</span> <span class="mi">14030</span> <span class="p">:</span> <span class="mf">0.03092</span><span class="p">,</span> <span class="mi">15031</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">16032</span> <span class="p">:</span> <span class="mf">0.9499</span><span class="p">,</span>
    <span class="mi">16033</span> <span class="p">:</span> <span class="mf">0.0075</span><span class="p">,</span> <span class="mi">16034</span> <span class="p">:</span> <span class="mf">0.0425</span><span class="p">,</span> <span class="mi">16036</span> <span class="p">:</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mi">17035</span> <span class="p">:</span> <span class="mf">0.7576</span><span class="p">,</span> <span class="mi">17037</span> <span class="p">:</span> <span class="mf">0.2424</span><span class="p">,</span> <span class="mi">18036</span> <span class="p">:</span> <span class="mf">0.003365</span><span class="p">,</span> <span class="mi">18038</span> <span class="p">:</span> <span class="mf">0.000632</span><span class="p">,</span> <span class="mi">18040</span> <span class="p">:</span> <span class="mf">0.996003</span><span class="p">,</span> <span class="mi">19039</span> <span class="p">:</span> <span class="mf">0.932581</span><span class="p">,</span>
    <span class="mi">19040</span> <span class="p">:</span> <span class="mf">0.000117</span><span class="p">,</span> <span class="mi">19041</span> <span class="p">:</span> <span class="mf">0.067302</span><span class="p">,</span> <span class="mi">20040</span> <span class="p">:</span> <span class="mf">0.96941</span><span class="p">,</span> <span class="mi">20042</span> <span class="p">:</span> <span class="mf">0.00647</span><span class="p">,</span> <span class="mi">20043</span> <span class="p">:</span> <span class="mf">0.00135</span><span class="p">,</span> <span class="mi">20044</span> <span class="p">:</span> <span class="mf">0.02086</span><span class="p">,</span> <span class="mi">20046</span> <span class="p">:</span> <span class="mf">0.00004</span><span class="p">,</span> <span class="mi">20048</span> <span class="p">:</span> <span class="mf">0.00187</span><span class="p">,</span> <span class="mi">21045</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span>
    <span class="mi">22046</span> <span class="p">:</span> <span class="mf">0.0825</span><span class="p">,</span> <span class="mi">22047</span> <span class="p">:</span> <span class="mf">0.0744</span><span class="p">,</span> <span class="mi">22048</span> <span class="p">:</span> <span class="mf">0.7372</span><span class="p">,</span> <span class="mi">22049</span> <span class="p">:</span> <span class="mf">0.0541</span><span class="p">,</span> <span class="mi">22050</span> <span class="p">:</span> <span class="mf">0.0518</span><span class="p">,</span> <span class="mi">23050</span> <span class="p">:</span> <span class="mf">0.0025</span><span class="p">,</span> <span class="mi">23051</span> <span class="p">:</span> <span class="mf">0.9975</span><span class="p">,</span> <span class="mi">24050</span> <span class="p">:</span> <span class="mf">0.04345</span><span class="p">,</span> <span class="mi">24052</span> <span class="p">:</span> <span class="mf">0.83789</span><span class="p">,</span>
    <span class="mi">24053</span> <span class="p">:</span> <span class="mf">0.09501</span><span class="p">,</span> <span class="mi">24054</span> <span class="p">:</span> <span class="mf">0.02365</span><span class="p">,</span> <span class="mi">25055</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">26054</span> <span class="p">:</span> <span class="mf">0.05845</span><span class="p">,</span> <span class="mi">26056</span> <span class="p">:</span> <span class="mf">0.91754</span><span class="p">,</span> <span class="mi">26057</span> <span class="p">:</span> <span class="mf">0.02119</span><span class="p">,</span> <span class="mi">26058</span> <span class="p">:</span> <span class="mf">0.00282</span><span class="p">,</span> <span class="mi">27059</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">28058</span> <span class="p">:</span> <span class="mf">0.680769</span><span class="p">,</span>
    <span class="mi">28060</span> <span class="p">:</span> <span class="mf">0.262231</span><span class="p">,</span> <span class="mi">28061</span> <span class="p">:</span> <span class="mf">0.011399</span><span class="p">,</span> <span class="mi">28062</span> <span class="p">:</span> <span class="mf">0.036345</span><span class="p">,</span> <span class="mi">28064</span> <span class="p">:</span> <span class="mf">0.009256</span><span class="p">,</span> <span class="mi">29063</span> <span class="p">:</span> <span class="mf">0.6915</span><span class="p">,</span> <span class="mi">29065</span> <span class="p">:</span> <span class="mf">0.3085</span><span class="p">,</span> <span class="mi">30064</span> <span class="p">:</span> <span class="mf">0.48268</span><span class="p">,</span> <span class="mi">30066</span> <span class="p">:</span> <span class="mf">0.27975</span><span class="p">,</span> <span class="mi">30067</span> <span class="p">:</span> <span class="mf">0.04102</span><span class="p">,</span>
    <span class="mi">30068</span> <span class="p">:</span> <span class="mf">0.19024</span><span class="p">,</span> <span class="mi">30070</span> <span class="p">:</span> <span class="mf">0.00631</span><span class="p">,</span> <span class="mi">31069</span> <span class="p">:</span> <span class="mf">0.60108</span><span class="p">,</span> <span class="mi">31071</span> <span class="p">:</span> <span class="mf">0.39892</span><span class="p">,</span> <span class="mi">32070</span> <span class="p">:</span> <span class="mf">0.2038</span><span class="p">,</span> <span class="mi">32072</span> <span class="p">:</span> <span class="mf">0.2731</span><span class="p">,</span> <span class="mi">32073</span> <span class="p">:</span> <span class="mf">0.0776</span><span class="p">,</span> <span class="mi">32074</span> <span class="p">:</span> <span class="mf">0.3672</span><span class="p">,</span> <span class="mi">32076</span> <span class="p">:</span> <span class="mf">0.0783</span><span class="p">,</span>
    <span class="mi">33075</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">34074</span> <span class="p">:</span> <span class="mf">0.0089</span><span class="p">,</span> <span class="mi">34076</span> <span class="p">:</span> <span class="mf">0.0937</span><span class="p">,</span> <span class="mi">34077</span> <span class="p">:</span> <span class="mf">0.0763</span><span class="p">,</span> <span class="mi">34078</span> <span class="p">:</span> <span class="mf">0.2377</span><span class="p">,</span> <span class="mi">34080</span> <span class="p">:</span> <span class="mf">0.4961</span><span class="p">,</span> <span class="mi">34082</span> <span class="p">:</span> <span class="mf">0.0873</span><span class="p">,</span> <span class="mi">35079</span> <span class="p">:</span> <span class="mf">0.5069</span><span class="p">,</span> <span class="mi">35081</span> <span class="p">:</span> <span class="mf">0.4931</span><span class="p">,</span> <span class="mi">36078</span> <span class="p">:</span> <span class="mf">0.00355</span><span class="p">,</span>
    <span class="mi">36080</span> <span class="p">:</span> <span class="mf">0.02286</span><span class="p">,</span> <span class="mi">36082</span> <span class="p">:</span> <span class="mf">0.11593</span><span class="p">,</span> <span class="mi">36083</span> <span class="p">:</span> <span class="mf">0.115</span><span class="p">,</span> <span class="mi">36084</span> <span class="p">:</span> <span class="mf">0.56987</span><span class="p">,</span> <span class="mi">36086</span> <span class="p">:</span> <span class="mf">0.17279</span><span class="p">,</span> <span class="mi">37085</span> <span class="p">:</span> <span class="mf">0.7217</span><span class="p">,</span> <span class="mi">37087</span> <span class="p">:</span> <span class="mf">0.2783</span><span class="p">,</span> <span class="mi">38084</span> <span class="p">:</span> <span class="mf">0.0056</span><span class="p">,</span> <span class="mi">38086</span> <span class="p">:</span> <span class="mf">0.0986</span><span class="p">,</span>
    <span class="mi">38087</span> <span class="p">:</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mi">38088</span> <span class="p">:</span> <span class="mf">0.8258</span><span class="p">,</span> <span class="mi">39089</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">40090</span> <span class="p">:</span> <span class="mf">0.5145</span><span class="p">,</span> <span class="mi">40091</span> <span class="p">:</span> <span class="mf">0.1122</span><span class="p">,</span> <span class="mi">40092</span> <span class="p">:</span> <span class="mf">0.1715</span><span class="p">,</span> <span class="mi">40094</span> <span class="p">:</span> <span class="mf">0.1738</span><span class="p">,</span> <span class="mi">40096</span> <span class="p">:</span> <span class="mf">0.028</span><span class="p">,</span> <span class="mi">41093</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">42092</span> <span class="p">:</span> <span class="mf">0.1477</span><span class="p">,</span>
    <span class="mi">42094</span> <span class="p">:</span> <span class="mf">0.0923</span><span class="p">,</span> <span class="mi">42095</span> <span class="p">:</span> <span class="mf">0.159</span><span class="p">,</span> <span class="mi">42096</span> <span class="p">:</span> <span class="mf">0.1668</span><span class="p">,</span> <span class="mi">42097</span> <span class="p">:</span> <span class="mf">0.0956</span><span class="p">,</span> <span class="mi">42098</span> <span class="p">:</span> <span class="mf">0.2419</span><span class="p">,</span> <span class="mi">42100</span> <span class="p">:</span> <span class="mf">0.0967</span><span class="p">,</span> <span class="mi">44096</span> <span class="p">:</span> <span class="mf">0.0554</span><span class="p">,</span> <span class="mi">44098</span> <span class="p">:</span> <span class="mf">0.0187</span><span class="p">,</span> <span class="mi">44099</span> <span class="p">:</span> <span class="mf">0.1276</span><span class="p">,</span>
    <span class="mi">44100</span> <span class="p">:</span> <span class="mf">0.126</span><span class="p">,</span> <span class="mi">44101</span> <span class="p">:</span> <span class="mf">0.1706</span><span class="p">,</span> <span class="mi">44102</span> <span class="p">:</span> <span class="mf">0.3155</span><span class="p">,</span> <span class="mi">44104</span> <span class="p">:</span> <span class="mf">0.1862</span><span class="p">,</span> <span class="mi">45103</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">46102</span> <span class="p">:</span> <span class="mf">0.0102</span><span class="p">,</span> <span class="mi">46104</span> <span class="p">:</span> <span class="mf">0.1114</span><span class="p">,</span> <span class="mi">46105</span> <span class="p">:</span> <span class="mf">0.2233</span><span class="p">,</span> <span class="mi">46106</span> <span class="p">:</span> <span class="mf">0.2733</span><span class="p">,</span> <span class="mi">46108</span> <span class="p">:</span> <span class="mf">0.2646</span><span class="p">,</span>
    <span class="mi">46110</span> <span class="p">:</span> <span class="mf">0.1172</span><span class="p">,</span> <span class="mi">47107</span> <span class="p">:</span> <span class="mf">0.51839</span><span class="p">,</span> <span class="mi">47109</span> <span class="p">:</span> <span class="mf">0.48161</span><span class="p">,</span> <span class="mi">48106</span> <span class="p">:</span> <span class="mf">0.0125</span><span class="p">,</span> <span class="mi">48108</span> <span class="p">:</span> <span class="mf">0.0089</span><span class="p">,</span> <span class="mi">48110</span> <span class="p">:</span> <span class="mf">0.1249</span><span class="p">,</span> <span class="mi">48111</span> <span class="p">:</span> <span class="mf">0.128</span><span class="p">,</span> <span class="mi">48112</span> <span class="p">:</span> <span class="mf">0.2413</span><span class="p">,</span> <span class="mi">48113</span> <span class="p">:</span> <span class="mf">0.1222</span><span class="p">,</span>
    <span class="mi">48114</span> <span class="p">:</span> <span class="mf">0.2873</span><span class="p">,</span> <span class="mi">48116</span> <span class="p">:</span> <span class="mf">0.0749</span><span class="p">,</span> <span class="mi">49113</span> <span class="p">:</span> <span class="mf">0.0429</span><span class="p">,</span> <span class="mi">49115</span> <span class="p">:</span> <span class="mf">0.9571</span><span class="p">,</span> <span class="mi">50112</span> <span class="p">:</span> <span class="mf">0.0097</span><span class="p">,</span> <span class="mi">50114</span> <span class="p">:</span> <span class="mf">0.0066</span><span class="p">,</span> <span class="mi">50115</span> <span class="p">:</span> <span class="mf">0.0034</span><span class="p">,</span> <span class="mi">50116</span> <span class="p">:</span> <span class="mf">0.1454</span><span class="p">,</span> <span class="mi">50117</span> <span class="p">:</span> <span class="mf">0.0768</span><span class="p">,</span>
    <span class="mi">50118</span> <span class="p">:</span> <span class="mf">0.2422</span><span class="p">,</span> <span class="mi">50119</span> <span class="p">:</span> <span class="mf">0.0859</span><span class="p">,</span> <span class="mi">50120</span> <span class="p">:</span> <span class="mf">0.3258</span><span class="p">,</span> <span class="mi">50122</span> <span class="p">:</span> <span class="mf">0.0463</span><span class="p">,</span> <span class="mi">50124</span> <span class="p">:</span> <span class="mf">0.0579</span><span class="p">,</span> <span class="mi">51121</span> <span class="p">:</span> <span class="mf">0.5721</span><span class="p">,</span> <span class="mi">51123</span> <span class="p">:</span> <span class="mf">0.4279</span><span class="p">,</span> <span class="mi">52120</span> <span class="p">:</span> <span class="mf">0.0009</span><span class="p">,</span> <span class="mi">52122</span> <span class="p">:</span> <span class="mf">0.0255</span><span class="p">,</span>
    <span class="mi">52123</span> <span class="p">:</span> <span class="mf">0.0089</span><span class="p">,</span> <span class="mi">52124</span> <span class="p">:</span> <span class="mf">0.0474</span><span class="p">,</span> <span class="mi">52125</span> <span class="p">:</span> <span class="mf">0.0707</span><span class="p">,</span> <span class="mi">52126</span> <span class="p">:</span> <span class="mf">0.1884</span><span class="p">,</span> <span class="mi">52128</span> <span class="p">:</span> <span class="mf">0.3174</span><span class="p">,</span> <span class="mi">52130</span> <span class="p">:</span> <span class="mf">0.3408</span><span class="p">,</span> <span class="mi">53127</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">54124</span> <span class="p">:</span> <span class="mf">0.000952</span><span class="p">,</span> <span class="mi">54126</span> <span class="p">:</span> <span class="mf">0.00089</span><span class="p">,</span>
    <span class="mi">54128</span> <span class="p">:</span> <span class="mf">0.019102</span><span class="p">,</span> <span class="mi">54129</span> <span class="p">:</span> <span class="mf">0.264006</span><span class="p">,</span> <span class="mi">54130</span> <span class="p">:</span> <span class="mf">0.04071</span><span class="p">,</span> <span class="mi">54131</span> <span class="p">:</span> <span class="mf">0.212324</span><span class="p">,</span> <span class="mi">54132</span> <span class="p">:</span> <span class="mf">0.269086</span><span class="p">,</span> <span class="mi">54134</span> <span class="p">:</span> <span class="mf">0.104357</span><span class="p">,</span> <span class="mi">54136</span> <span class="p">:</span> <span class="mf">0.088573</span><span class="p">,</span> <span class="mi">55133</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">56130</span> <span class="p">:</span> <span class="mf">0.00106</span><span class="p">,</span>
    <span class="mi">56132</span> <span class="p">:</span> <span class="mf">0.00101</span><span class="p">,</span> <span class="mi">56134</span> <span class="p">:</span> <span class="mf">0.02417</span><span class="p">,</span> <span class="mi">56135</span> <span class="p">:</span> <span class="mf">0.06592</span><span class="p">,</span> <span class="mi">56136</span> <span class="p">:</span> <span class="mf">0.07854</span><span class="p">,</span> <span class="mi">56137</span> <span class="p">:</span> <span class="mf">0.11232</span><span class="p">,</span> <span class="mi">56138</span> <span class="p">:</span> <span class="mf">0.71698</span><span class="p">,</span> <span class="mi">57138</span> <span class="p">:</span> <span class="mf">0.0009</span><span class="p">,</span> <span class="mi">57139</span> <span class="p">:</span> <span class="mf">0.9991</span><span class="p">,</span> <span class="mi">58136</span> <span class="p">:</span> <span class="mf">0.00185</span><span class="p">,</span>
    <span class="mi">58138</span> <span class="p">:</span> <span class="mf">0.00251</span><span class="p">,</span> <span class="mi">58140</span> <span class="p">:</span> <span class="mf">0.8845</span><span class="p">,</span> <span class="mi">58142</span> <span class="p">:</span> <span class="mf">0.11114</span><span class="p">,</span> <span class="mi">59141</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">60142</span> <span class="p">:</span> <span class="mf">0.272</span><span class="p">,</span> <span class="mi">60143</span> <span class="p">:</span> <span class="mf">0.122</span><span class="p">,</span> <span class="mi">60144</span> <span class="p">:</span> <span class="mf">0.238</span><span class="p">,</span> <span class="mi">60145</span> <span class="p">:</span> <span class="mf">0.083</span><span class="p">,</span> <span class="mi">60146</span> <span class="p">:</span> <span class="mf">0.172</span><span class="p">,</span> <span class="mi">60148</span> <span class="p">:</span> <span class="mf">0.057</span><span class="p">,</span>
    <span class="mi">60150</span> <span class="p">:</span> <span class="mf">0.056</span><span class="p">,</span> <span class="mi">62144</span> <span class="p">:</span> <span class="mf">0.0307</span><span class="p">,</span> <span class="mi">62147</span> <span class="p">:</span> <span class="mf">0.1499</span><span class="p">,</span> <span class="mi">62148</span> <span class="p">:</span> <span class="mf">0.1124</span><span class="p">,</span> <span class="mi">62149</span> <span class="p">:</span> <span class="mf">0.1382</span><span class="p">,</span> <span class="mi">62150</span> <span class="p">:</span> <span class="mf">0.0738</span><span class="p">,</span> <span class="mi">62152</span> <span class="p">:</span> <span class="mf">0.2675</span><span class="p">,</span> <span class="mi">62154</span> <span class="p">:</span> <span class="mf">0.2275</span><span class="p">,</span> <span class="mi">63151</span> <span class="p">:</span> <span class="mf">0.4781</span><span class="p">,</span>
    <span class="mi">63153</span> <span class="p">:</span> <span class="mf">0.5219</span><span class="p">,</span> <span class="mi">64152</span> <span class="p">:</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mi">64154</span> <span class="p">:</span> <span class="mf">0.0218</span><span class="p">,</span> <span class="mi">64155</span> <span class="p">:</span> <span class="mf">0.148</span><span class="p">,</span> <span class="mi">64156</span> <span class="p">:</span> <span class="mf">0.2047</span><span class="p">,</span> <span class="mi">64157</span> <span class="p">:</span> <span class="mf">0.1565</span><span class="p">,</span> <span class="mi">64158</span> <span class="p">:</span> <span class="mf">0.2484</span><span class="p">,</span> <span class="mi">64160</span> <span class="p">:</span> <span class="mf">0.2186</span><span class="p">,</span> <span class="mi">65159</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">66156</span> <span class="p">:</span> <span class="mf">0.00056</span><span class="p">,</span>
    <span class="mi">66158</span> <span class="p">:</span> <span class="mf">0.00095</span><span class="p">,</span> <span class="mi">66160</span> <span class="p">:</span> <span class="mf">0.02329</span><span class="p">,</span> <span class="mi">66161</span> <span class="p">:</span> <span class="mf">0.18889</span><span class="p">,</span> <span class="mi">66162</span> <span class="p">:</span> <span class="mf">0.25475</span><span class="p">,</span> <span class="mi">66163</span> <span class="p">:</span> <span class="mf">0.24896</span><span class="p">,</span> <span class="mi">66164</span> <span class="p">:</span> <span class="mf">0.2826</span><span class="p">,</span> <span class="mi">67165</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">68162</span> <span class="p">:</span> <span class="mf">0.00139</span><span class="p">,</span> <span class="mi">68164</span> <span class="p">:</span> <span class="mf">0.01601</span><span class="p">,</span>
    <span class="mi">68166</span> <span class="p">:</span> <span class="mf">0.33503</span><span class="p">,</span> <span class="mi">68167</span> <span class="p">:</span> <span class="mf">0.22869</span><span class="p">,</span> <span class="mi">68168</span> <span class="p">:</span> <span class="mf">0.26978</span><span class="p">,</span> <span class="mi">68170</span> <span class="p">:</span> <span class="mf">0.1491</span><span class="p">,</span> <span class="mi">69169</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">70168</span> <span class="p">:</span> <span class="mf">0.0013</span><span class="p">,</span> <span class="mi">70170</span> <span class="p">:</span> <span class="mf">0.0304</span><span class="p">,</span> <span class="mi">70171</span> <span class="p">:</span> <span class="mf">0.1428</span><span class="p">,</span> <span class="mi">70172</span> <span class="p">:</span> <span class="mf">0.2183</span><span class="p">,</span>
    <span class="mi">70173</span> <span class="p">:</span> <span class="mf">0.1613</span><span class="p">,</span> <span class="mi">70174</span> <span class="p">:</span> <span class="mf">0.3183</span><span class="p">,</span> <span class="mi">70176</span> <span class="p">:</span> <span class="mf">0.1276</span><span class="p">,</span> <span class="mi">71175</span> <span class="p">:</span> <span class="mf">0.9741</span><span class="p">,</span> <span class="mi">71176</span> <span class="p">:</span> <span class="mf">0.0259</span><span class="p">,</span> <span class="mi">72174</span> <span class="p">:</span> <span class="mf">0.0016</span><span class="p">,</span> <span class="mi">72176</span> <span class="p">:</span> <span class="mf">0.0526</span><span class="p">,</span> <span class="mi">72177</span> <span class="p">:</span> <span class="mf">0.186</span><span class="p">,</span> <span class="mi">72178</span> <span class="p">:</span> <span class="mf">0.2728</span><span class="p">,</span>
    <span class="mi">72179</span> <span class="p">:</span> <span class="mf">0.1362</span><span class="p">,</span> <span class="mi">72180</span> <span class="p">:</span> <span class="mf">0.3508</span><span class="p">,</span> <span class="mi">73180</span> <span class="p">:</span> <span class="mf">0.00012</span><span class="p">,</span> <span class="mi">73181</span> <span class="p">:</span> <span class="mf">0.99988</span><span class="p">,</span> <span class="mi">74180</span> <span class="p">:</span> <span class="mf">0.0012</span><span class="p">,</span> <span class="mi">74182</span> <span class="p">:</span> <span class="mf">0.265</span><span class="p">,</span> <span class="mi">74183</span> <span class="p">:</span> <span class="mf">0.1431</span><span class="p">,</span> <span class="mi">74184</span> <span class="p">:</span> <span class="mf">0.3064</span><span class="p">,</span> <span class="mi">74186</span> <span class="p">:</span> <span class="mf">0.2843</span><span class="p">,</span>
    <span class="mi">75185</span> <span class="p">:</span> <span class="mf">0.374</span><span class="p">,</span> <span class="mi">75187</span> <span class="p">:</span> <span class="mf">0.626</span><span class="p">,</span> <span class="mi">76184</span> <span class="p">:</span> <span class="mf">0.0002</span><span class="p">,</span> <span class="mi">76186</span> <span class="p">:</span> <span class="mf">0.0159</span><span class="p">,</span> <span class="mi">76187</span> <span class="p">:</span> <span class="mf">0.0196</span><span class="p">,</span> <span class="mi">76188</span> <span class="p">:</span> <span class="mf">0.1324</span><span class="p">,</span> <span class="mi">76189</span> <span class="p">:</span> <span class="mf">0.1615</span><span class="p">,</span> <span class="mi">76190</span> <span class="p">:</span> <span class="mf">0.2626</span><span class="p">,</span> <span class="mi">76192</span> <span class="p">:</span> <span class="mf">0.4078</span><span class="p">,</span>
    <span class="mi">77191</span> <span class="p">:</span> <span class="mf">0.373</span><span class="p">,</span> <span class="mi">77193</span> <span class="p">:</span> <span class="mf">0.627</span><span class="p">,</span> <span class="mi">78190</span> <span class="p">:</span> <span class="mf">0.00014</span><span class="p">,</span> <span class="mi">78192</span> <span class="p">:</span> <span class="mf">0.00782</span><span class="p">,</span> <span class="mi">78194</span> <span class="p">:</span> <span class="mf">0.32967</span><span class="p">,</span> <span class="mi">78195</span> <span class="p">:</span> <span class="mf">0.33832</span><span class="p">,</span> <span class="mi">78196</span> <span class="p">:</span> <span class="mf">0.25242</span><span class="p">,</span> <span class="mi">78198</span> <span class="p">:</span> <span class="mf">0.07163</span><span class="p">,</span> <span class="mi">79197</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span>
    <span class="mi">80196</span> <span class="p">:</span> <span class="mf">0.0015</span><span class="p">,</span> <span class="mi">80198</span> <span class="p">:</span> <span class="mf">0.0997</span><span class="p">,</span> <span class="mi">80199</span> <span class="p">:</span> <span class="mf">0.1687</span><span class="p">,</span> <span class="mi">80200</span> <span class="p">:</span> <span class="mf">0.231</span><span class="p">,</span> <span class="mi">80201</span> <span class="p">:</span> <span class="mf">0.1318</span><span class="p">,</span> <span class="mi">80202</span> <span class="p">:</span> <span class="mf">0.2986</span><span class="p">,</span> <span class="mi">80204</span> <span class="p">:</span> <span class="mf">0.0687</span><span class="p">,</span> <span class="mi">81203</span> <span class="p">:</span> <span class="mf">0.2952</span><span class="p">,</span> <span class="mi">81205</span> <span class="p">:</span> <span class="mf">0.7048</span><span class="p">,</span>
    <span class="mi">82204</span> <span class="p">:</span> <span class="mf">0.014</span><span class="p">,</span> <span class="mi">82206</span> <span class="p">:</span> <span class="mf">0.241</span><span class="p">,</span> <span class="mi">82207</span> <span class="p">:</span> <span class="mf">0.221</span><span class="p">,</span> <span class="mi">82208</span> <span class="p">:</span> <span class="mf">0.524</span><span class="p">,</span> <span class="mi">83209</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">90232</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">91231</span> <span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">92234</span> <span class="p">:</span> <span class="mf">0.000054</span><span class="p">,</span> <span class="mi">92235</span> <span class="p">:</span> <span class="mf">0.007204</span><span class="p">,</span> <span class="mi">92238</span> <span class="p">:</span> <span class="mf">0.992742</span>
    <span class="p">};</span>
<span class="c">###</span>
<span class="c"># Convert ZA -&gt; isotope string</span>
<span class="c">###</span>
<div class="viewcode-block" id="Za2Isotope"><a class="viewcode-back" href="../src.html#MocDown.Za2Isotope">[docs]</a><span class="k">def</span> <span class="nf">Za2Isotope</span><span class="p">(</span><span class="n">za</span><span class="p">,</span> <span class="n">texFormat</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert ZA -&gt; isotope string.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">za</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">za</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="n">z</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">za</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">za</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="n">texFormat</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;^{{{}}}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">z2Element</span><span class="p">[</span><span class="n">z</span><span class="p">]);</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="s">&#39;{}-{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z2Element</span><span class="p">[</span><span class="n">z</span><span class="p">],</span> <span class="n">a</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Extract molar mass for a given Z,A from xsdir</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Za2MolarMass"><a class="viewcode-back" href="../src.html#MocDown.Za2MolarMass">[docs]</a><span class="k">def</span> <span class="nf">Za2MolarMass</span><span class="p">(</span><span class="n">xsDir</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Extract molar mass for a given Z,A from xsdir.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Kick out if xsDir is null</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="n">xsDir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{};</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">xsDir</span><span class="o">.</span><span class="n">split</span><span class="p">();</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">words</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;atomic&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">words</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;directory&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="k">return</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span> <span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">neutronMass</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)};</span>
<span class="c">###</span>
<span class="c"># Convert ZA -&gt; ZAm</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Za2Zam"><a class="viewcode-back" href="../src.html#MocDown.Za2Zam">[docs]</a><span class="k">def</span> <span class="nf">Za2Zam</span><span class="p">(</span><span class="n">za</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert ZA -&gt; ZAm.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Change natural carbon to carbon-12</span>
    <span class="c">###</span>
    <span class="n">za</span> <span class="o">+=</span> <span class="p">(</span><span class="n">za</span> <span class="o">==</span> <span class="mi">6000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Determine Z, A, and m</span>
    <span class="c">###</span>
    <span class="n">Z</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">za</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">za</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Switch Am-242 and Am-242m</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="mi">95242</span> <span class="o">==</span> <span class="n">za</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">952421</span><span class="p">;</span>
    <span class="k">elif</span> <span class="mi">95642</span> <span class="o">==</span> <span class="n">za</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">952420</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Decrement A according to metastable</span>
    <span class="c">###</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Z</span> <span class="o">-</span> <span class="mi">300</span><span class="p">)</span> <span class="o">//</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">A</span> <span class="o">-=</span> <span class="p">(</span><span class="n">A</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">300</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">Z</span> <span class="o">*</span> <span class="mi">10000</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">m</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Is za an actinide</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="ZaIsActinide"><a class="viewcode-back" href="../src.html#MocDown.ZaIsActinide">[docs]</a><span class="k">def</span> <span class="nf">ZaIsActinide</span><span class="p">(</span><span class="n">za</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return if isotope is an actinide.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">za</span> <span class="o">//</span> <span class="mi">1000</span> <span class="o">&gt;</span> <span class="mi">88</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Extract temperature ID from ZAID</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Zaid2Id"><a class="viewcode-back" href="../src.html#MocDown.Zaid2Id">[docs]</a><span class="k">def</span> <span class="nf">Zaid2Id</span><span class="p">(</span><span class="n">zaid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Extract temperature ID from ZAID.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">zaid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
<span class="c">###</span>
<span class="c"># Convert a zaid string into an isotope string</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Zaid2Isotope"><a class="viewcode-back" href="../src.html#MocDown.Zaid2Isotope">[docs]</a><span class="k">def</span> <span class="nf">Zaid2Isotope</span><span class="p">(</span><span class="n">zaid</span><span class="p">,</span> <span class="n">texFormat</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert a zaid string into an isotope string.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">Za2Isotope</span><span class="p">(</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">));</span>
<span class="c">###</span>
<span class="c"># Extract molar mass for a given ZAID from xsdir</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Zaid2MolarMass"><a class="viewcode-back" href="../src.html#MocDown.Zaid2MolarMass">[docs]</a><span class="k">def</span> <span class="nf">Zaid2MolarMass</span><span class="p">(</span><span class="n">zaid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Extract molar mass for a given ZAID from xsdir.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">za2MolarMass</span><span class="p">[</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">)];</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Zaid2Zam</span><span class="p">(</span><span class="n">zaid</span><span class="p">)</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Extract temperature for a given ZAID from xsdir</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Zaid2Temperature"><a class="viewcode-back" href="../src.html#MocDown.Zaid2Temperature">[docs]</a><span class="k">def</span> <span class="nf">Zaid2Temperature</span><span class="p">(</span><span class="n">xsDir</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Extract temperature for a given ZAID from xsdir.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">xsDir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Find directory line index</span>
    <span class="c">###</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
        <span class="k">if</span> <span class="s">&#39;directory&#39;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
            <span class="n">directoryIndex</span> <span class="o">=</span> <span class="n">index</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Filter out zaids</span>
    <span class="c">###</span>
    <span class="n">zaidLines</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="s">&#39;ptable&#39;</span> <span class="o">!=</span> <span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">directoryIndex</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">]</span> <span class="k">if</span> <span class="n">line</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Build zaid --&gt; temperature mapping</span>
    <span class="c">###</span>
    <span class="n">zaid2Temperature</span> <span class="o">=</span> <span class="p">{</span><span class="n">zaidLine</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">zaidLine</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">zaidLine</span> <span class="ow">in</span> <span class="n">zaidLines</span><span class="p">};</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">zaid</span> <span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">zaid</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span> <span class="ow">in</span> <span class="n">zaid2Temperature</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">character</span> <span class="ow">in</span> <span class="n">zaid</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s">&#39;cm&#39;</span><span class="p">)};</span>
<span class="c">###</span>
<span class="c"># Convert ZAID -&gt; ZA</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Zaid2Za"><a class="viewcode-back" href="../src.html#MocDown.Zaid2Za">[docs]</a><span class="k">def</span> <span class="nf">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert ZAID -&gt; ZA.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">zaid</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]));</span>
<span class="c">###</span>
<span class="c"># Convert ZAID -&gt; ZAm</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Zaid2Zam"><a class="viewcode-back" href="../src.html#MocDown.Zaid2Zam">[docs]</a><span class="k">def</span> <span class="nf">Zaid2Zam</span><span class="p">(</span><span class="n">zaid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert ZAID -&gt; ZAm.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">Za2Zam</span><span class="p">(</span><span class="n">Zaid2Za</span><span class="p">(</span><span class="n">zaid</span><span class="p">));</span>
<span class="c">###</span>
<span class="c"># Convert ZAm -&gt; ZA</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Zam2Za"><a class="viewcode-back" href="../src.html#MocDown.Zam2Za">[docs]</a><span class="k">def</span> <span class="nf">Zam2Za</span><span class="p">(</span><span class="n">zam</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert ZAm -&gt; ZA.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">zam</span> <span class="o">//</span> <span class="mi">10</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Convert ZAm -&gt; ZAID</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="Zam2Zaid"><a class="viewcode-back" href="../src.html#MocDown.Zam2Zaid">[docs]</a><span class="k">def</span> <span class="nf">Zam2Zaid</span><span class="p">(</span><span class="n">zam</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert ZAm -&gt; ZAID.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">za</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">zam</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">zam</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Change carbon-12 to natural carbon</span>
    <span class="c">###</span>
    <span class="n">za</span> <span class="o">-=</span> <span class="p">(</span><span class="n">za</span> <span class="o">==</span> <span class="mi">6012</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Switch Am-242m and Am-242</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">95242</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">za</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;95242.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">suffix</span><span class="p">);</span>
    <span class="k">elif</span> <span class="p">(</span><span class="mi">95242</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">za</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;95642.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">suffix</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Increment A according to metastable</span>
    <span class="c">###</span>
    <span class="n">za</span> <span class="o">+=</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">300</span> <span class="o">+</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">m</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="s">&#39;{:d}.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">za</span><span class="p">,</span> <span class="n">suffix</span><span class="p">);</span>

<span class="c">###</span>
<span class="c">### Script</span>
<span class="c">###</span>

<span class="c">###</span>
<span class="c"># Initiate argument parser and add custom arguments</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="InterpretArguments"><a class="viewcode-back" href="../src.html#MocDown.InterpretArguments">[docs]</a><span class="k">def</span> <span class="nf">InterpretArguments</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Initiate argument parser and add custom arguments.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Script name</span>
    <span class="c">###</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">__file__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.py&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">);</span>
    <span class="n">script2Description</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;MocDown&#39;</span>   <span class="p">:</span> <span class="s">&#39;MOCUP/MONTEBURNS rewritten in Python.  Compatible with MCNP5, MCNP6, MCNPX, and ORIGEN2.2.&#39;</span><span class="p">,</span>
        <span class="s">&#39;ParseMcnp&#39;</span> <span class="p">:</span> <span class="s">&#39;Script for parsing MCNP5, MCNP6, and MCNPX input and output files.&#39;</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="c">###</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">script</span> <span class="ow">in</span> <span class="n">script2Description</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span> <span class="o">=</span> <span class="n">script2Description</span><span class="p">[</span><span class="n">script</span><span class="p">],</span> <span class="n">epilog</span> <span class="o">=</span> <span class="s">&#39;Version {} | {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__version__</span><span class="p">,</span> <span class="n">__author__</span><span class="p">,</span> <span class="n">__year__</span><span class="p">));</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(prog)s</span><span class="s"> {} | {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__version__</span><span class="p">,</span> <span class="n">__author__</span><span class="p">,</span> <span class="n">__year__</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="n">action</span> <span class="o">=</span> <span class="s">&#39;store_true&#39;</span><span class="p">;</span>
    <span class="n">nargs</span> <span class="o">=</span> <span class="s">&#39;?&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Transport file argument</span>
    <span class="c">###</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;transportFileName&#39;</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="s">&#39;inp1&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;MCNP input file (=inp1 by default)&#39;</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># MocDown input file argument</span>
    <span class="c">###</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;mocDownInputFileName&#39;</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="s">&#39;mocdown.inp&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;MocDown input file (= mocdown.inp by default)&#39;</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Optional arguments</span>
    <span class="c">###</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--isVerbose&#39;</span><span class="p">,</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Verbose operation&#39;</span><span class="p">);</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--isQuiet&#39;</span><span class="p">,</span> <span class="s">&#39;-q&#39;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Hide file operation messages&#39;</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="n">script</span> <span class="o">==</span> <span class="s">&#39;MocDown&#39;</span><span class="p">:</span>
        <span class="c">###</span>
        <span class="c"># MocDown arguments</span>
        <span class="c">###</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--isRestart&#39;</span><span class="p">,</span> <span class="s">&#39;-r&#39;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Restart depletion from last pickle&#39;</span><span class="p">);</span>
    <span class="k">elif</span> <span class="n">script</span> <span class="o">==</span> <span class="s">&#39;ParseMcnp&#39;</span><span class="p">:</span>
        <span class="c">###</span>
        <span class="c"># MCNP input | parsing stdout reports</span>
        <span class="c">###</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--reportCells&#39;</span><span class="p">,</span> <span class="s">&#39;--cel&#39;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Report problem cell summary&#39;</span><span class="p">);</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--reportIsotopes&#39;</span><span class="p">,</span> <span class="s">&#39;--iso&#39;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Report problem isotope summary&#39;</span><span class="p">);</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--reportTallys&#39;</span><span class="p">,</span> <span class="s">&#39;--tal&#39;</span><span class="p">,</span> <span class="s">&#39;--reportFulfilled&#39;</span><span class="p">,</span> <span class="s">&#39;--ful&#39;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Report problem tally summary&#39;</span><span class="p">);</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--reportKeff&#39;</span><span class="p">,</span> <span class="s">&#39;--keff&#39;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Report problem keff summary&#39;</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># MCNP output | physical quantity .csv reports</span>
        <span class="c">###</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;lethargy&#39;</span><span class="p">,</span> <span class="s">&#39;leth&#39;</span><span class="p">,</span> <span class="s">&#39;ebin&#39;</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">,</span> <span class="s">&#39;energy&#39;</span><span class="p">,</span> <span class="s">&#39;mev&#39;</span><span class="p">,</span> <span class="s">&#39;normalied&#39;</span><span class="p">,</span> <span class="s">&#39;norm&#39;</span><span class="p">,</span> <span class="s">&#39;uncertainty&#39;</span><span class="p">,</span> <span class="s">&#39;std&#39;</span><span class="p">);</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--writeEnergyDepositions&#39;</span><span class="p">,</span> <span class="s">&#39;--edep&#39;</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span><span class="p">,</span> <span class="n">const</span> <span class="o">=</span> <span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Write energy depositions .csv&#39;</span><span class="p">);</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--writeFissionEnergyDepositions&#39;</span><span class="p">,</span> <span class="s">&#39;--fedep&#39;</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span><span class="p">,</span> <span class="n">const</span> <span class="o">=</span> <span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Write fission energy depositions .csv&#39;</span><span class="p">);</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--writeMicroscopicCrosssections&#39;</span><span class="p">,</span> <span class="s">&#39;--micro&#39;</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span><span class="p">,</span> <span class="n">const</span> <span class="o">=</span> <span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Write microscopic cross sections .csv&#39;</span><span class="p">);</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--writeReactionRates&#39;</span><span class="p">,</span> <span class="s">&#39;--rxn&#39;</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span><span class="p">,</span> <span class="n">const</span> <span class="o">=</span> <span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Write reaction rates .csv&#39;</span><span class="p">);</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--writeScalarFluxes&#39;</span><span class="p">,</span> <span class="s">&#39;--flx&#39;</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span><span class="p">,</span> <span class="n">const</span> <span class="o">=</span> <span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Write scalar fluxes .csv&#39;</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># MCNP output | result down-sampling</span>
        <span class="c">###</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">choices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--downSample&#39;</span><span class="p">,</span> <span class="s">&#39;--dwn&#39;</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span><span class="p">,</span> <span class="n">const</span> <span class="o">=</span> <span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;Down-sample results by a factor of 2 ** n.  If n is negative, results will be averaged instead of summed.&#39;</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">();</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">script</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">arguments</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Main()</span>
<span class="c">###</span></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c">###</span>
    <span class="c"># Interpret arguments</span>
    <span class="c">###</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="n">InterpretArguments</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="c"># Read MocDown input file</span>
    <span class="c">###</span>
    <span class="n">mocDownInputFile</span> <span class="o">=</span> <span class="n">MocDownInputFile</span><span class="p">(</span><span class="n">arguments</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Import supplementary MocDown library(s) and overwrite DepletionCalculation, RecycleCalculation, and MocDownInputFile methods</span>
    <span class="c">###</span>
    <span class="n">ImportLibraries</span><span class="p">(</span><span class="n">mocDownInputFile</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Populate MocDown input file</span>
    <span class="c">###</span>
    <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">Populate</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="c"># Parse xsdir</span>
    <span class="c">###</span>
    <span class="n">xsDir</span> <span class="o">=</span> <span class="n">ReadXsDir</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;mcnpXsdirPath&#39;</span><span class="p">),</span> <span class="n">display</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">));</span>
    <span class="n">za2MolarMass</span> <span class="o">=</span> <span class="n">Za2MolarMass</span><span class="p">(</span><span class="n">xsDir</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">script</span> <span class="o">==</span> <span class="s">&#39;MocDown&#39;</span><span class="p">:</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;recycleToEquilibrium&#39;</span><span class="p">):</span>
            <span class="c">###</span>
            <span class="c"># Run accelerated depletion/recycle calculation</span>
            <span class="c">###</span>
            <span class="n">recycleCalculation</span> <span class="o">=</span> <span class="n">RecycleCalculation</span><span class="p">(</span><span class="n">arguments</span><span class="p">);</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Run simple depletion calculation</span>
            <span class="c">###</span>
            <span class="n">depletionCalculation</span> <span class="o">=</span> <span class="n">DepletionCalculation</span><span class="p">(</span><span class="n">arguments</span><span class="p">);</span>
    <span class="k">elif</span> <span class="n">arguments</span><span class="o">.</span><span class="n">script</span> <span class="o">==</span> <span class="s">&#39;ParseMcnp&#39;</span><span class="p">:</span>
        <span class="c">###</span>
        <span class="n">zaid2Temperature</span> <span class="o">=</span> <span class="n">Zaid2Temperature</span><span class="p">(</span><span class="n">xsDir</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Parse transport file</span>
        <span class="c">###</span>
        <span class="n">mcnpFile</span> <span class="o">=</span> <span class="n">ReadTransportFile</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">transportFileName</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Execute desired reports</span>
        <span class="c">###</span>
        <span class="n">mcnpFile</span><span class="o">.</span><span class="n">Report</span><span class="p">(</span><span class="n">arguments</span><span class="p">);</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c">###</span>
    <span class="c"># Empty arguments</span>
    <span class="c">###</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="n">Class</span><span class="p">();</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">isVerbose</span> <span class="o">=</span> <span class="bp">False</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Empty MocDown input file</span>
    <span class="c">###</span>
    <span class="n">mocDownInputFile</span> <span class="o">=</span> <span class="n">MocDownInputFile</span><span class="p">(</span><span class="n">arguments</span><span class="p">);</span>
    <span class="n">mocDownInputFile</span><span class="o">.</span><span class="n">Populate</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="c"># Parse xsdir</span>
    <span class="c">###</span>
    <span class="n">xsDir</span> <span class="o">=</span> <span class="n">ReadXsDir</span><span class="p">(</span><span class="n">display</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">isQuiet</span><span class="p">));</span>
    <span class="n">za2MolarMass</span> <span class="o">=</span> <span class="n">Za2MolarMass</span><span class="p">(</span><span class="n">xsDir</span><span class="p">);</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">MocDown 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Jeffrey Edwin Seifried.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>