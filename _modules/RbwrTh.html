

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>RbwrTh &mdash; MocDown 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MocDown 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">MocDown 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for RbwrTh</h1><div class="highlight"><pre>
<span class="c">#! /usr/bin/env python3</span>

<span class="c">###</span>
<span class="c">### Library imports</span>
<span class="c">###</span>

<span class="k">if</span> <span class="s">&#39;Offline&#39;</span> <span class="ow">in</span> <span class="n">__file__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.py&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">MocDown</span> <span class="kn">import</span> <span class="n">Array</span><span class="p">,</span>\
                        <span class="n">Class</span><span class="p">,</span>\
                        <span class="n">Exponent</span><span class="p">,</span>\
                        <span class="n">LinearInterpolate</span><span class="p">,</span>\
                        <span class="n">McnpInputFile</span><span class="p">,</span>\
                        <span class="n">MocDownInputFile</span><span class="p">,</span>\
                        <span class="n">Nan2Num</span><span class="p">,</span>\
                        <span class="n">NaturalLogarithm</span><span class="p">,</span>\
                        <span class="n">NonZero</span><span class="p">,</span>\
                        <span class="n">PrintNow</span><span class="p">,</span>\
                        <span class="n">WordArrange</span><span class="p">,</span>\
                        <span class="n">WriteFile</span><span class="p">,</span>\
                        <span class="n">ZaIsActinide</span><span class="p">,</span>\
                        <span class="n">Zeros</span><span class="p">,</span>\
                        <span class="n">avogadrosNumber</span><span class="p">,</span>\
                        <span class="n">epsilon</span><span class="p">;</span>

<span class="c">###</span>
<span class="c">### Custom classes</span>
<span class="c">###</span>

<span class="c">###</span>
<span class="c"># Void-fraction and critical power ratio calculation results</span>
<span class="c">###</span>
<div class="viewcode-block" id="BoilingCalculation"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation">[docs]</a><span class="k">class</span> <span class="nc">BoilingCalculation</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Coolant density calculation for a single boiling channel.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumbers</span><span class="p">,</span> <span class="n">cellNumber2PreviousMassDensity</span><span class="p">,</span> <span class="n">cellNumber2MassDensity</span><span class="p">,</span> <span class="n">axialPowers</span><span class="p">,</span> <span class="n">axialQualitys</span><span class="p">,</span> <span class="n">axialVoidFractions</span><span class="p">,</span> <span class="n">finePositionCPRs</span><span class="p">,</span> <span class="n">minimumCriticalPowerRatio</span><span class="p">,</span> <span class="n">minimumCriticalPowerRatioQuality</span><span class="p">,</span> <span class="n">minimumCriticalPowerRatioLocation</span><span class="p">,</span> <span class="n">criticalPowerRatioLimit</span><span class="p">,</span> <span class="n">flowLengths</span><span class="p">,</span> <span class="n">axialPressureDrops</span><span class="p">,</span> <span class="n">transportOutputFile</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumbers</span> <span class="o">=</span> <span class="n">cellNumbers</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PreviousMassDensity</span> <span class="o">=</span> <span class="n">cellNumber2PreviousMassDensity</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2MassDensity</span> <span class="o">=</span> <span class="n">cellNumber2MassDensity</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Iterate over cell #</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ThermalPower</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Quality</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2VoidFraction</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PressureDrop</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumbers</span><span class="p">())):</span>
            <span class="n">cellNumber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumbers</span><span class="p">()[</span><span class="n">index</span><span class="p">];</span>
            <span class="c">###</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ThermalPower</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="n">axialPowers</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Quality</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="n">axialQualitys</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2VoidFraction</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="n">axialVoidFractions</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PressureDrop</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="n">axialPressureDrops</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flowLengths</span> <span class="o">=</span> <span class="n">flowLengths</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finePositionCPRs</span> <span class="o">=</span> <span class="n">finePositionCPRs</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimumCriticalPowerRatio</span> <span class="o">=</span> <span class="n">minimumCriticalPowerRatio</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimumCriticalPowerRatioQuality</span> <span class="o">=</span> <span class="n">minimumCriticalPowerRatioQuality</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimumCriticalPowerRatioLocation</span> <span class="o">=</span> <span class="n">minimumCriticalPowerRatioLocation</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">criticalPowerRatioLimit</span> <span class="o">=</span> <span class="n">criticalPowerRatioLimit</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactor</span> <span class="o">=</span> <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">GetMultiplicationFactor</span><span class="p">();</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactorSigma</span> <span class="o">=</span> <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">GetMultiplicationFactorSigma</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return summary string.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&lt; Void fraction and pressure drop calculation outlet summary &gt;&#39;</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="n">attributeName</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;cellNumber2PreviousMassDensity&#39;</span><span class="p">,</span> <span class="s">&#39;ρorg [kg/m³]&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;cellNumber2Quality&#39;</span><span class="p">,</span>             <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;.1%&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;cellNumber2VoidFraction&#39;</span><span class="p">,</span>        <span class="s">&#39;α&#39;</span><span class="p">,</span> <span class="s">&#39;.1%&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;cellNumber2MassDensity&#39;</span><span class="p">,</span>         <span class="s">&#39;ρ [kg/m³]&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;cellNumber2PressureDrop&#39;</span><span class="p">,</span>        <span class="s">&#39;ΔP [MPa]&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">),</span>
        <span class="p">);</span>
        <span class="c">###</span>
        <span class="n">cellNumber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetOutletCellNumber</span><span class="p">();</span>
        <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">format</span> <span class="ow">in</span> <span class="n">attributeName</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;{{:&lt;13s}} = {{:&gt;13{}}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">format</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)[</span><span class="n">cellNumber</span><span class="p">]));</span>
        <span class="c">###</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt; Minimum critical power ratio calculation summary &gt;&#39;</span><span class="p">);</span>
        <span class="n">attributeName</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;minimumCriticalPowerRatio&#39;</span><span class="p">,</span>         <span class="s">&#39;MCPR&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;minimumCriticalPowerRatioQuality&#39;</span><span class="p">,</span>  <span class="s">&#39;x(MCPR)&#39;</span><span class="p">,</span> <span class="s">&#39;.1%&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;minimumCriticalPowerRatioLocation&#39;</span><span class="p">,</span> <span class="s">&#39;z(MCPR) [m]&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">),</span>
        <span class="p">);</span>
        <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">format</span> <span class="ow">in</span> <span class="n">attributeName</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;{{:&lt;13s}} = {{:&gt;13{}}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">format</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)));</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetMinimumCriticalPowerRatio</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCriticalPowerRatioLimit</span><span class="p">():</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Warning: The MCPR limit of {} is violated&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCriticalPowerRatioLimit</span><span class="p">()));</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;{:^59}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">);</span>
    <span class="c">###</span>
<div class="viewcode-block" id="BoilingCalculation.GetCellNumbers"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetCellNumbers">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumbers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cell numbers.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumbers</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetCellNumberAccumulatedFlowLength"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetCellNumberAccumulatedFlowLength">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberAccumulatedFlowLength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return accumulated active length of a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flowLengths</span><span class="p">[</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumbers</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetCellNumberFlowLength"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetCellNumberFlowLength">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberFlowLength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return active length of a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flowLengths</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumbers</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetCellNumberPressureDrop"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetCellNumberPressureDrop">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberPressureDrop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return pressure drop over a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PressureDrop</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetCellNumberPreviousMassDensity"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetCellNumberPreviousMassDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberPreviousMassDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return previous mass density for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2PreviousMassDensity</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetCellNumberThermalPower"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetCellNumberThermalPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberThermalPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return thermal power for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2ThermalPower</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetCellNumberLinearHeatRate"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetCellNumberLinearHeatRate">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberLinearHeatRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return linear heat rate for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberThermalPower</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberFlowLength</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetCellNumberQuality"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetCellNumberQuality">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberQuality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return quality for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2Quality</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetCellNumberVoidFraction"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetCellNumberVoidFraction">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberVoidFraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return void fraction for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2VoidFraction</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetCellNumberMassDensity"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetCellNumberMassDensity">[docs]</a>    <span class="k">def</span> <span class="nf">GetCellNumberMassDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return current mass density for a cell.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2MassDensity</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetCriticalPowerRatioLimit"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetCriticalPowerRatioLimit">[docs]</a>    <span class="k">def</span> <span class="nf">GetCriticalPowerRatioLimit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return critical power ratio limit.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">criticalPowerRatioLimit</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetFinePositionCPRs"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetFinePositionCPRs">[docs]</a>    <span class="k">def</span> <span class="nf">GetFinePositionCPRs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return list of critical power ratios.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">finePositionCPRs</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetMinimumCriticalPowerRatio"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetMinimumCriticalPowerRatio">[docs]</a>    <span class="k">def</span> <span class="nf">GetMinimumCriticalPowerRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return magnitude of minimum critical power ratio.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimumCriticalPowerRatio</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetMinimumCriticalPowerRatioLocation"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetMinimumCriticalPowerRatioLocation">[docs]</a>    <span class="k">def</span> <span class="nf">GetMinimumCriticalPowerRatioLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return location of minimum critical power ratio.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimumCriticalPowerRatioLocation</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetMinimumCriticalPowerRatioQuality"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetMinimumCriticalPowerRatioQuality">[docs]</a>    <span class="k">def</span> <span class="nf">GetMinimumCriticalPowerRatioQuality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return quality of minimum critical power ratio.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimumCriticalPowerRatioQuality</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetMultiplicationFactor"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetMultiplicationFactor">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplicationFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return multiplication factor.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactor</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetMultiplicationFactorSigma"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetMultiplicationFactorSigma">[docs]</a>    <span class="k">def</span> <span class="nf">GetMultiplicationFactorSigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return multiplication factor standard deviation.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicationFactorSigma</span><span class="p">;</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetPressureDrop"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetPressureDrop">[docs]</a>    <span class="k">def</span> <span class="nf">GetPressureDrop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return total pressure drop.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberPressureDrop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetOutletCellNumber</span><span class="p">());</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetOutletCellNumber"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetOutletCellNumber">[docs]</a>    <span class="k">def</span> <span class="nf">GetOutletCellNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return outlet cell number.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumbers</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
    <span class="c">###</span></div>
<div class="viewcode-block" id="BoilingCalculation.GetUpdateCellNumbers"><a class="viewcode-back" href="../lib.html#RbwrTh.BoilingCalculation.GetUpdateCellNumbers">[docs]</a>    <span class="k">def</span> <span class="nf">GetUpdateCellNumbers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return cells to be updated.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">cellNumber</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellNumber2MassDensity</span><span class="p">];</span>
<span class="c">###</span>
<span class="c"># Steam thermodynamic properties</span>
<span class="c">###</span></div></div>
<div class="viewcode-block" id="Steam"><a class="viewcode-back" href="../lib.html#RbwrTh.Steam">[docs]</a><span class="k">class</span> <span class="nc">Steam</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Steam thermodynamic properties.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">massFlowRate</span><span class="p">,</span> <span class="n">heatedDiameter</span><span class="p">,</span> <span class="n">hydraulicDiameter</span><span class="p">,</span> <span class="n">flowArea</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a new instance.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Import IAPWS97 steam properties library</span>
        <span class="c">###</span>
        <span class="kn">import</span> <span class="nn">iapws</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Gravitational accelration [m/s²]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span> <span class="o">=</span> <span class="mf">9.80665</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Critical pressure [MPa]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">criticalPressure</span> <span class="o">=</span> <span class="n">iapws</span><span class="o">.</span><span class="n">Pc</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Pressure [MPa]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Temperature [K]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Mass flow rate [kg/s]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">massFlowRate</span> <span class="o">=</span> <span class="n">massFlowRate</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Heated diameter [m]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heatedDiameter</span> <span class="o">=</span> <span class="n">heatedDiameter</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Hydraulic diameter [m]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hydraulicDiameter</span> <span class="o">=</span> <span class="n">hydraulicDiameter</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Cross-sectional flow area [m²]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flowArea</span> <span class="o">=</span> <span class="n">flowArea</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Mass flux [kg/m²·s]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">massFlux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">massFlowRate</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">flowArea</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Sub-cooled, saturated liquid, and saturated vapor</span>
        <span class="c">###</span>
        <span class="n">inlet</span>  <span class="o">=</span> <span class="n">iapws</span><span class="o">.</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">);</span>
        <span class="n">liquid</span> <span class="o">=</span> <span class="n">iapws</span><span class="o">.</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">vapor</span>  <span class="o">=</span> <span class="n">iapws</span><span class="o">.</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Mass density [kg/m³]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">densityInlet</span>   <span class="o">=</span> <span class="n">inlet</span><span class="o">.</span><span class="n">rho</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">densityLiquid</span>  <span class="o">=</span> <span class="n">liquid</span><span class="o">.</span><span class="n">rho</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">densityVapor</span>   <span class="o">=</span> <span class="n">vapor</span><span class="o">.</span><span class="n">rho</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Specific enthalpy [kJ/kg]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enthalpyInlet</span>  <span class="o">=</span> <span class="n">inlet</span><span class="o">.</span><span class="n">h</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enthalpyLiquid</span> <span class="o">=</span> <span class="n">liquid</span><span class="o">.</span><span class="n">h</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enthalpyVapor</span>  <span class="o">=</span> <span class="n">vapor</span><span class="o">.</span><span class="n">h</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Surface tension [N/m]</span>
        <span class="c">###</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surfaceTension</span> <span class="o">=</span> <span class="n">liquid</span><span class="o">.</span><span class="n">sigma</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Dynamic viscosity [Pa·s]</span>
        <span class="c">###</span>
        <span class="n">liquid</span> <span class="o">=</span> <span class="n">iapws</span><span class="o">.</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">liquid</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">);</span>
        <span class="n">vapor</span>  <span class="o">=</span> <span class="n">iapws</span><span class="o">.</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">vapor</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="mf">1e-9</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamicViscosityInlet</span>        <span class="o">=</span> <span class="n">inlet</span><span class="o">.</span><span class="n">mu</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamicViscosityLiquid</span>       <span class="o">=</span> <span class="n">liquid</span><span class="o">.</span><span class="n">mu</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamicViscosityVapor</span>        <span class="o">=</span> <span class="n">vapor</span><span class="o">.</span><span class="n">mu</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return summary string.&#39;&#39;&#39;</span><span class="p">;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&lt; Steam thermodynamic properties summary &gt;&#39;</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="n">attributeName</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;gravity&#39;</span><span class="p">,</span>                <span class="s">&#39;g [m/s²]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;criticalPressure&#39;</span><span class="p">,</span>       <span class="s">&#39;Pcrit [MPa]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;pressure&#39;</span><span class="p">,</span>               <span class="s">&#39;Psat [MPa]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;temperature&#39;</span><span class="p">,</span>            <span class="s">&#39;Tin [K]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;massFlowRate&#39;</span><span class="p">,</span>           <span class="s">&#39;mdot [kg/s]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;heatedDiameter&#39;</span><span class="p">,</span>         <span class="s">&#39;Dh [m]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;hydraulicDiameter&#39;</span><span class="p">,</span>      <span class="s">&#39;De [m]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;flowArea&#39;</span><span class="p">,</span>               <span class="s">&#39;A [m²]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;densityInlet&#39;</span><span class="p">,</span>           <span class="s">&#39;ρin [kg/m³]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;densityLiquid&#39;</span><span class="p">,</span>          <span class="s">&#39;ρl [kg/m³]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;densityVapor&#39;</span><span class="p">,</span>           <span class="s">&#39;ρv [kg/m³]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;enthalpyInlet&#39;</span><span class="p">,</span>          <span class="s">&#39;hin [kJ/kg]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;enthalpyLiquid&#39;</span><span class="p">,</span>         <span class="s">&#39;hl [kJ/kg]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;enthalpyVapor&#39;</span><span class="p">,</span>          <span class="s">&#39;hv [kJ/kg]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;surfaceTension&#39;</span><span class="p">,</span>         <span class="s">&#39;σ [N/m]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;dynamicViscosityInlet&#39;</span><span class="p">,</span>  <span class="s">&#39;μin [Pa·s]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;dynamicViscosityLiquid&#39;</span><span class="p">,</span> <span class="s">&#39;μl [Pa·s]&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;dynamicViscosityVapor&#39;</span><span class="p">,</span>  <span class="s">&#39;μv [Pa·s]&#39;</span><span class="p">),</span>
        <span class="p">);</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attributeName</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;{:&lt;13s} = {:&gt;13G}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)));</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;{:^59}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">);</span>

<span class="c">###</span>
<span class="c">### Custom functions</span>
<span class="c">###</span>

<span class="c">###</span>
<span class="c"># Library-specific MocDown input parameters</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="GetLibraryParametersConverters"><a class="viewcode-back" href="../lib.html#RbwrTh.GetLibraryParametersConverters">[docs]</a><span class="k">def</span> <span class="nf">GetLibraryParametersConverters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return default values and parsing functions for RBWR-Th parameters.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Default parameter values</span>
    <span class="c">###</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c"># #</span>
        <span class="s">&#39;criticalPowerRatioFallbackIndex&#39;</span> <span class="p">:</span> <span class="mi">41</span><span class="p">,</span>
        <span class="c"># #.#</span>
        <span class="c"># #</span>
        <span class="s">&#39;coolantDensityDampingCoefficient&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&#39;coolantFlowArea&#39;</span> <span class="p">:</span> <span class="mf">0.030115717</span><span class="p">,</span> <span class="c"># [m²]</span>
        <span class="s">&#39;coolantHeatedDiameter&#39;</span> <span class="p">:</span> <span class="mf">0.004692958</span><span class="p">,</span> <span class="c"># [m]</span>
        <span class="s">&#39;coolantHydraulicDiameter&#39;</span> <span class="p">:</span> <span class="mf">0.00397346</span><span class="p">,</span> <span class="c"># [m]</span>
        <span class="s">&#39;coolantInletPressure&#39;</span> <span class="p">:</span> <span class="mf">7.25</span><span class="p">,</span> <span class="c"># [MPa]</span>
        <span class="s">&#39;coolantInletTemperature&#39;</span> <span class="p">:</span> <span class="mf">555.71</span><span class="p">,</span> <span class="c"># [K]</span>
        <span class="s">&#39;coolantMassFlowRate&#39;</span> <span class="p">:</span> <span class="mf">29.68</span><span class="p">,</span> <span class="c"># [kg/s]</span>
        <span class="s">&#39;criticalPowerRatioLimit&#39;</span> <span class="p">:</span> <span class="mf">1.3</span><span class="p">,</span>
        <span class="s">&#39;thermalHydraulicConvergenceTolerance&#39;</span> <span class="p">:</span> <span class="mf">5e-2</span><span class="p">,</span>
        <span class="c"># &#39;&#39;.lower()</span>
        <span class="s">&#39;criticalPowerRatioCorrelation&#39;</span> <span class="p">:</span> <span class="s">&#39;m-cise&#39;</span><span class="p">,</span>
        <span class="s">&#39;pressureDropCorrelation&#39;</span> <span class="p">:</span> <span class="s">&#39;epri&#39;</span><span class="p">,</span>
        <span class="s">&#39;thermalHydraulicConvergenceNormType&#39;</span> <span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span>
        <span class="s">&#39;voidFractionCorrelation&#39;</span> <span class="p">:</span> <span class="s">&#39;relap&#39;</span><span class="p">,</span>
        <span class="c"># [#]</span>
        <span class="s">&#39;coolantBypassCells&#39;</span> <span class="p">:</span> <span class="p">[],</span>
        <span class="c"># [#.#]</span>
        <span class="s">&#39;coolantFlowLengths&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="c"># [m]</span>
        <span class="c"># fuels -&gt; cools</span>
        <span class="s">&#39;assemblyFuelsToCools&#39;</span> <span class="p">:</span> <span class="p">[],</span>
    <span class="p">};</span>
    <span class="c">###</span>
    <span class="c"># Default converters</span>
    <span class="c">###</span>
    <span class="n">Bool</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
    <span class="n">Float</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="n">FuelsToCools</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">({</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fuel</span><span class="p">))</span> <span class="k">for</span> <span class="n">fuel</span> <span class="ow">in</span> <span class="n">fuels</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;( )&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">cool</span><span class="p">))</span> <span class="k">for</span> <span class="n">cool</span> <span class="ow">in</span> <span class="n">cools</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;( )&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">())}</span> <span class="k">for</span> <span class="n">fuels2Cools</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">fuels</span><span class="p">,</span> <span class="n">cools</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fuels2Cools</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)])];</span>
    <span class="n">Int</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">ListInt</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s">&#39;..&#39;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span> <span class="p">:</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">2</span><span class="p">];</span>
                <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lo</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">hi</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))));</span>
        <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">ListFloat</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s">&#39;r&#39;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                <span class="n">repeat</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">);</span>
                <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">repeat</span><span class="p">)));</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)));</span>
        <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">Lower</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">();</span>
    <span class="n">Return</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">();</span>
    <span class="c">###</span>
    <span class="n">converters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c"># #</span>
        <span class="s">&#39;criticalPowerRatioFallbackIndex&#39;</span> <span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
        <span class="c"># #.#</span>
        <span class="s">&#39;coolantDensityDampingCoefficient&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
        <span class="s">&#39;coolantFlowArea&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
        <span class="s">&#39;coolantHeatedDiameter&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
        <span class="s">&#39;coolantHydraulicDiameter&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
        <span class="s">&#39;coolantInletPressure&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
        <span class="s">&#39;coolantInletTemperature&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
        <span class="s">&#39;coolantMassFlowRate&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
        <span class="s">&#39;criticalPowerRatioLimit&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
        <span class="s">&#39;thermalHydraulicConvergenceTolerance&#39;</span> <span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
        <span class="c"># &#39;&#39;.lower()</span>
        <span class="s">&#39;criticalPowerRatioCorrelation&#39;</span> <span class="p">:</span> <span class="n">Lower</span><span class="p">,</span>
        <span class="s">&#39;pressureDropCorrelation&#39;</span> <span class="p">:</span> <span class="n">Lower</span><span class="p">,</span>
        <span class="s">&#39;thermalHydraulicConvergenceNormType&#39;</span> <span class="p">:</span> <span class="n">Lower</span><span class="p">,</span>
        <span class="s">&#39;voidFractionCorrelation&#39;</span> <span class="p">:</span> <span class="n">Lower</span><span class="p">,</span>
        <span class="c"># fuels -&gt; cools</span>
        <span class="s">&#39;assemblyFuelsToCools&#39;</span> <span class="p">:</span> <span class="n">FuelsToCools</span><span class="p">,</span>
        <span class="c"># [#]</span>
        <span class="s">&#39;coolantBypassCells&#39;</span> <span class="p">:</span> <span class="n">ListInt</span><span class="p">,</span>
        <span class="c"># [#.#]</span>
        <span class="s">&#39;coolantFlowLengths&#39;</span> <span class="p">:</span> <span class="n">ListFloat</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">converters</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># RBWR-Th recycling scheme</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="RbwrThRecycle"><a class="viewcode-back" href="../lib.html#RbwrTh.RbwrThRecycle">[docs]</a><span class="k">def</span> <span class="nf">RbwrThRecycle</span><span class="p">(</span><span class="n">bocTransportFile</span><span class="p">,</span> <span class="n">eocTransportFile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Override fuel processing.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Hard code the blanket and seed cell parameters</span>
    <span class="c">###</span>
    <span class="n">numberOfUpperBlanketCells</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
    <span class="n">numberOfUpperSeedCells</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
    <span class="n">numberOfLowerSeedCells</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">numberOfLowerBlanketCells</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">lowerSeedRemovalFraction</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># This is a switch for: (True) Jeff&#39;s vanilla cell numbering and (False) Chris and George&#39;s cell numbering</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">firstCellNumber</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Define the blanket and seed cell numbers</span>
        <span class="c">###</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="n">firstCellNumber</span><span class="p">;</span>
        <span class="n">upperBlanketCellNumbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">previous</span> <span class="o">+</span> <span class="n">numberOfUpperBlanketCells</span><span class="p">));</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">upperBlanketCellNumbers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">upperSeedCellNumbers</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">previous</span> <span class="o">+</span> <span class="n">numberOfUpperSeedCells</span><span class="p">));</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">upperBlanketCellNumbers</span> <span class="o">+</span> <span class="n">upperSeedCellNumbers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">lowerSeedCellNumbers</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">previous</span> <span class="o">+</span> <span class="n">numberOfLowerSeedCells</span><span class="p">));</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">upperBlanketCellNumbers</span> <span class="o">+</span> <span class="n">upperSeedCellNumbers</span> <span class="o">+</span> <span class="n">lowerSeedCellNumbers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">lowerBlanketCellNumbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">previous</span> <span class="o">+</span> <span class="n">numberOfLowerBlanketCells</span><span class="p">));</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">firstCellNumber</span> <span class="o">=</span> <span class="mi">1001</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Define the blanket and seed cell numbers</span>
        <span class="c">###</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="n">firstCellNumber</span><span class="p">;</span>
        <span class="n">lowerBlanketCellNumbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">previous</span> <span class="o">+</span> <span class="n">numberOfLowerBlanketCells</span><span class="p">));</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lowerBlanketCellNumbers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">lowerSeedCellNumbers</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">previous</span> <span class="o">+</span> <span class="n">numberOfLowerSeedCells</span><span class="p">));</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lowerBlanketCellNumbers</span> <span class="o">+</span> <span class="n">lowerSeedCellNumbers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">upperSeedCellNumbers</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">previous</span> <span class="o">+</span> <span class="n">numberOfUpperSeedCells</span><span class="p">));</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lowerBlanketCellNumbers</span> <span class="o">+</span> <span class="n">lowerSeedCellNumbers</span> <span class="o">+</span> <span class="n">upperSeedCellNumbers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">upperBlanketCellNumbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span> <span class="n">previous</span> <span class="o">+</span> <span class="n">numberOfUpperBlanketCells</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="c"># Isotopic ZA strings</span>
    <span class="c">###</span>
    <span class="n">oxygen</span> <span class="o">=</span> <span class="mi">8016</span><span class="p">;</span>
    <span class="n">thorium</span> <span class="o">=</span> <span class="mi">90232</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Calculate the number of BOEC seed heavy-metal moles;</span>
    <span class="c"># This number is conserved across recycles</span>
    <span class="c">###</span>
    <span class="n">chargeMoles</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">moles</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">upperSeedCellNumbers</span> <span class="o">+</span> <span class="n">lowerSeedCellNumbers</span> <span class="k">for</span> <span class="n">za</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="n">bocTransportFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetZa2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">ZaIsActinide</span><span class="p">(</span><span class="n">za</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="c"># Construct the seed charge:</span>
    <span class="c"># First, EOEC heavy metal moles are accumulated;</span>
    <span class="c"># Second, any mole deficit or surplus is made up with thorium</span>
    <span class="c"># Third, add twice as many oxygen moles as heavy metal moles</span>
    <span class="c">###</span>
    <span class="n">za2ChargeMoles</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">upperBlanketCellNumbers</span> <span class="o">+</span> <span class="n">upperSeedCellNumbers</span> <span class="o">+</span> <span class="n">lowerSeedCellNumbers</span> <span class="o">+</span> <span class="n">lowerBlanketCellNumbers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">za</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="n">eocTransportFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetZa2Moles</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">ZaIsActinide</span><span class="p">(</span><span class="n">za</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">za2ChargeMoles</span><span class="p">[</span><span class="n">za</span><span class="p">]</span> <span class="o">+=</span> <span class="n">moles</span><span class="p">;</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">za2ChargeMoles</span><span class="p">[</span><span class="n">za</span><span class="p">]</span> <span class="o">=</span> <span class="n">moles</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">deviation</span> <span class="o">=</span> <span class="n">chargeMoles</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">za2ChargeMoles</span><span class="o">.</span><span class="n">values</span><span class="p">());</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">za2ChargeMoles</span><span class="p">[</span><span class="n">thorium</span><span class="p">]</span> <span class="o">+=</span> <span class="n">deviation</span><span class="p">;</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">za2ChargeMoles</span><span class="p">[</span><span class="n">thorium</span><span class="p">]</span> <span class="o">=</span> <span class="n">deviation</span><span class="p">;</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">za2ChargeMoles</span><span class="p">[</span><span class="n">thorium</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="n">za2ChargeMoles</span><span class="p">[</span><span class="n">oxygen</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">chargeMoles</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Distribute the seed charge:</span>
    <span class="c"># First, split moles evenly between (equal-volumed) seed cells</span>
    <span class="c"># Second, remove a fraction of the lower seed cell transthorium moles, replacing them with thorium</span>
    <span class="c"># Third, distribute the removed moles among the upper seed cells, displacing thorium</span>
    <span class="c"># Fourth, match BOEC moles for each cell by adjusting thoria moles</span>
    <span class="c">###</span>
    <span class="n">numberOfSeedCells</span> <span class="o">=</span> <span class="n">numberOfUpperSeedCells</span> <span class="o">+</span> <span class="n">numberOfLowerSeedCells</span><span class="p">;</span>
    <span class="n">cellNumber2Za2ChargeMoles</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="p">{</span><span class="n">za</span> <span class="p">:</span> <span class="n">moles</span> <span class="o">/</span> <span class="n">numberOfSeedCells</span> <span class="k">for</span> <span class="n">za</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="n">za2ChargeMoles</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">upperSeedCellNumbers</span> <span class="o">+</span> <span class="n">lowerSeedCellNumbers</span><span class="p">};</span>
    <span class="c">###</span>
    <span class="n">fromLowerSeed</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">lowerSeedCellNumbers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">za</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">za</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">oxygen</span><span class="p">,</span> <span class="n">thorium</span><span class="p">):</span>
                <span class="n">minusMoles</span> <span class="o">=</span> <span class="n">moles</span> <span class="o">*</span> <span class="n">lowerSeedRemovalFraction</span><span class="p">;</span>
                <span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">za</span><span class="p">]</span> <span class="o">-=</span> <span class="n">minusMoles</span><span class="p">;</span>
                <span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">thorium</span><span class="p">]</span> <span class="o">+=</span> <span class="n">minusMoles</span><span class="p">;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fromLowerSeed</span><span class="p">[</span><span class="n">za</span><span class="p">]</span> <span class="o">+=</span> <span class="n">minusMoles</span><span class="p">;</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">fromLowerSeed</span><span class="p">[</span><span class="n">za</span><span class="p">]</span> <span class="o">=</span> <span class="n">minusMoles</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">upperSeedCellNumbers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">za</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="n">fromLowerSeed</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">za</span><span class="p">]</span> <span class="o">+=</span> <span class="n">moles</span> <span class="o">/</span> <span class="n">numberOfUpperSeedCells</span><span class="p">;</span>
            <span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">thorium</span><span class="p">]</span> <span class="o">-=</span> <span class="n">moles</span> <span class="o">/</span> <span class="n">numberOfUpperSeedCells</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">upperSeedCellNumbers</span> <span class="o">+</span> <span class="n">lowerSeedCellNumbers</span><span class="p">:</span>
        <span class="n">bocCell</span> <span class="o">=</span> <span class="n">bocTransportFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
        <span class="n">deviation</span> <span class="o">=</span> <span class="n">bocCell</span><span class="o">.</span><span class="n">GetMoles</span><span class="p">()</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">());</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">thorium</span><span class="p">]</span> <span class="o">+=</span> <span class="n">deviation</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
            <span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">oxygen</span><span class="p">]</span> <span class="o">+=</span> <span class="n">deviation</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">thorium</span><span class="p">]</span> <span class="o">=</span> <span class="n">deviation</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
            <span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">oxygen</span><span class="p">]</span> <span class="o">=</span> <span class="n">deviation</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">][</span><span class="n">thorium</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Distribute the blanket charge:</span>
    <span class="c"># Simply grab the BOEC moles</span>
    <span class="c">###</span>
    <span class="n">cellNumber2Za2ChargeMoles</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">bocTransportFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetZa2Moles</span><span class="p">()</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">upperBlanketCellNumbers</span> <span class="o">+</span> <span class="n">lowerBlanketCellNumbers</span><span class="p">});</span>
    <span class="c">###</span>
    <span class="c"># Recharge cells</span>
    <span class="c">###</span>
    <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">upperBlanketCellNumbers</span> <span class="o">+</span> <span class="n">upperSeedCellNumbers</span> <span class="o">+</span> <span class="n">lowerSeedCellNumbers</span> <span class="o">+</span> <span class="n">lowerBlanketCellNumbers</span><span class="p">:</span>
        <span class="n">za2ChargeMoles</span> <span class="o">=</span> <span class="n">cellNumber2Za2ChargeMoles</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># Replace cell cards</span>
        <span class="c">###</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">eocTransportFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="n">numberDensity</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">za2ChargeMoles</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetVolume</span><span class="p">()</span> <span class="o">*</span> <span class="n">avogadrosNumber</span><span class="p">;</span>
        <span class="n">cellCard</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetMaterialDensityRegex</span><span class="p">()</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;{:+10.7f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numberDensity</span><span class="p">),</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetRaw</span><span class="p">());</span>
        <span class="c">###</span>
        <span class="n">eocTransportFile</span><span class="o">.</span><span class="n">ReplaceNewputCard</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">cellCard</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Replace material cards</span>
        <span class="c">###</span>
        <span class="n">material</span> <span class="o">=</span> <span class="n">eocTransportFile</span><span class="o">.</span><span class="n">FindCellMaterial</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetSuffix</span><span class="p">();</span>
        <span class="n">totalMoles</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">za2ChargeMoles</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
        <span class="n">zaid2AtomFraction</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;{}.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">za</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span> <span class="p">:</span> <span class="n">moles</span> <span class="o">/</span> <span class="n">totalMoles</span> <span class="k">for</span> <span class="n">za</span><span class="p">,</span> <span class="n">moles</span> <span class="ow">in</span> <span class="n">za2ChargeMoles</span><span class="o">.</span><span class="n">items</span><span class="p">()};</span>
        <span class="n">materialCard</span> <span class="o">=</span> <span class="n">WordArrange</span><span class="p">(</span><span class="n">words</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;{:&gt;10} {:+.5E}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zaid</span><span class="p">,</span> <span class="n">atomFraction</span><span class="p">)</span> <span class="k">for</span> <span class="n">zaid</span><span class="p">,</span> <span class="n">atomFraction</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">zaid2AtomFraction</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)),</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">m{:&lt;6d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">material</span><span class="o">.</span><span class="n">GetNumber</span><span class="p">()),</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">8</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="n">eocTransportFile</span><span class="o">.</span><span class="n">ReplaceNewputCard</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="n">materialCard</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">eocTransportFile</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Polynomial interpolation</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="PolynomialInterpolation"><a class="viewcode-back" href="../lib.html#RbwrTh.PolynomialInterpolation">[docs]</a><span class="k">def</span> <span class="nf">PolynomialInterpolation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform polynomial interpolation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">polyfit</span><span class="p">,</span> <span class="n">polyval</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">polyval</span><span class="p">(</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="n">order</span><span class="p">),</span> <span class="n">x</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Multi-batch core keff @ EOC</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="MultiBatchCoreKeffEoc"><a class="viewcode-back" href="../lib.html#RbwrTh.MultiBatchCoreKeffEoc">[docs]</a><span class="k">def</span> <span class="nf">MultiBatchCoreKeffEoc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return batch-averaged EOC multiplication factor.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract coarse times, keffs, and powers</span>
    <span class="c">###</span>
    <span class="n">coarseIndex</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionCalculationPickle</span><span class="p">()</span><span class="o">.</span><span class="n">multiplicationFactors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">];</span>
    <span class="c">###</span>
    <span class="n">coarseTimes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepTimeEnds&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">coarseIndex</span><span class="p">];</span>
    <span class="n">coarsePowers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;depletionStepPowers&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">coarseIndex</span><span class="p">];</span>
    <span class="n">coarseKeffs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionCalculationPickle</span><span class="p">()</span><span class="o">.</span><span class="n">multiplicationFactors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">coarseIndex</span><span class="p">];</span>
    <span class="c">###</span>
    <span class="c"># Construct core keffs from coarse keffs (which may or may not coincide with batch keffs)</span>
    <span class="c"># Right now, it is assumed that each batch produces the same power</span>
    <span class="c"># Later, we will modify this using coarseTimes/coarsePowers values interpolated</span>
    <span class="c"># Also, get rid of the E_f and nu assumptions via the memo</span>
    <span class="c">### # FIXME Address this</span>
    <span class="n">coreTimes</span><span class="p">,</span> <span class="n">coreKeffs</span> <span class="o">=</span> <span class="n">MultiBatchHarmonicMean</span><span class="p">(</span><span class="n">coarseTimes</span><span class="p">,</span> <span class="n">coarseKeffs</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">coreKeffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="c">###</span>
<span class="c"># Multi-batch harmonic mean</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="MultiBatchHarmonicMean"><a class="viewcode-back" href="../lib.html#RbwrTh.MultiBatchHarmonicMean">[docs]</a><span class="k">def</span> <span class="nf">MultiBatchHarmonicMean</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">timeSteps</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">batches</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform a harmonic mean for a time-series.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># If not provided, assume equal power fractions between batches</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="n">batches</span><span class="p">]</span> <span class="o">*</span> <span class="n">batches</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">period</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">/</span> <span class="n">batches</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c">###</span>
        <span class="c"># Reactivity is interpolated with an nth order polynomial fit</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">period</span> <span class="o">*</span> <span class="n">timeStep</span> <span class="o">/</span> <span class="n">timeSteps</span> <span class="k">for</span> <span class="n">timeStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">timeSteps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">PolynomialInterpolation</span><span class="p">(</span><span class="n">period</span> <span class="o">*</span> <span class="p">(</span><span class="n">timeStep</span> <span class="o">/</span> <span class="n">timeSteps</span> <span class="o">+</span> <span class="n">index</span><span class="p">),</span> <span class="n">times</span><span class="p">,</span> <span class="n">weights</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">/</span> <span class="n">Array</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">order</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">batches</span><span class="p">))</span> <span class="k">for</span> <span class="n">timeStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">timeSteps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)];</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">###</span>
        <span class="c"># Reactivity is interpolated with a piecewise linear fit</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">period</span> <span class="o">*</span> <span class="n">timeStep</span> <span class="o">/</span> <span class="n">timeSteps</span> <span class="k">for</span> <span class="n">timeStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">timeSteps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">LinearInterpolate</span><span class="p">(</span><span class="n">period</span> <span class="o">*</span> <span class="p">(</span><span class="n">timeStep</span> <span class="o">/</span> <span class="n">timeSteps</span> <span class="o">+</span> <span class="n">index</span><span class="p">),</span> <span class="n">times</span><span class="p">,</span> <span class="n">weights</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">/</span> <span class="n">Array</span><span class="p">(</span><span class="n">values</span><span class="p">))</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">batches</span><span class="p">))</span> <span class="k">for</span> <span class="n">timeStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">timeSteps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)];</span>
<span class="c">###</span>
<span class="c"># Multi-batch core keff(t) as a function of time</span>
<span class="c">###</span></div>
<span class="n">MultiBatchCoreKeff</span> <span class="o">=</span> <span class="n">MultiBatchHarmonicMean</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Multi-batch core keff @ EOC, with varied cycle lengths</span>
<span class="c">###</span>
<div class="viewcode-block" id="MultiBatchCoreKeffEocCycleStretch"><a class="viewcode-back" href="../lib.html#RbwrTh.MultiBatchCoreKeffEocCycleStretch">[docs]</a><span class="k">def</span> <span class="nf">MultiBatchCoreKeffEocCycleStretch</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">minimum</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">maximum</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">500</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return batch-averaged EOC multiplication factors for many batch lengths.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Linear interpolation/extrapolation</span>
    <span class="c">###</span>
    <span class="k">def</span> <span class="nf">InterpExtrap</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="bp">True</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Polynomial interpolation</span>
            <span class="c">###</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">PolynomialInterpolation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="n">order</span><span class="p">);</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># Piece-wise linear interpolation</span>
            <span class="c">###</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">LinearInterpolate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Linear extrapolation</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">y</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">yp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">xp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">yp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yp</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">xp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">y</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">xp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">yp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">xp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">xp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">xp</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">xp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">yp</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">yp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
        <span class="c">###</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">maxTime</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">times</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="n">harmonicTimes</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="n">harmonicMeans</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="c">###</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">newTime</span> <span class="o">=</span> <span class="n">maxTime</span> <span class="o">*</span> <span class="p">(</span><span class="n">minimum</span> <span class="o">+</span> <span class="p">(</span><span class="n">maximum</span> <span class="o">-</span> <span class="n">minimum</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">index</span> <span class="o">/</span> <span class="n">number</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="n">newTimes</span> <span class="o">=</span> <span class="p">[</span><span class="n">time</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span> <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="n">newTime</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">newTime</span><span class="p">];</span>
        <span class="n">newValues</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">newTimes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">InterpExtrap</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="n">newTime</span><span class="p">],</span> <span class="n">order</span><span class="p">));</span>
        <span class="c">###</span>
        <span class="n">junk</span><span class="p">,</span> <span class="n">means</span> <span class="o">=</span> <span class="n">MultiBatchHarmonicMean</span><span class="p">(</span><span class="n">newTimes</span><span class="p">,</span> <span class="n">newValues</span><span class="p">,</span> <span class="n">timeSteps</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="n">harmonicTimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newTime</span><span class="p">);</span>
        <span class="n">harmonicMeans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">harmonicTimes</span><span class="p">,</span> <span class="n">harmonicMeans</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Generic void fraction correlation (Carey, p.512)</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="VoidFractionGeneric"><a class="viewcode-back" href="../lib.html#RbwrTh.VoidFractionGeneric">[docs]</a><span class="k">def</span> <span class="nf">VoidFractionGeneric</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rhol</span><span class="p">,</span> <span class="n">rhov</span><span class="p">,</span> <span class="n">mul</span><span class="p">,</span> <span class="n">muv</span><span class="p">,</span> <span class="n">Bb</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Retrurn generic void fraction correlation (Carey, p.512).&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Bb</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="n">n1</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhov</span> <span class="o">/</span> <span class="n">rhol</span><span class="p">)</span> <span class="o">**</span> <span class="n">n2</span> <span class="o">*</span> <span class="p">(</span><span class="n">mul</span> <span class="o">/</span> <span class="n">muv</span><span class="p">)</span> <span class="o">**</span> <span class="n">n3</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Homogeneous void fraction correlation (Carey, p.512)</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="VoidFractionHomogeneous"><a class="viewcode-back" href="../lib.html#RbwrTh.VoidFractionHomogeneous">[docs]</a><span class="k">def</span> <span class="nf">VoidFractionHomogeneous</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform homogeneous void fraction correlation (Carey, p.512).&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">rhol</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
    <span class="n">rhov</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span><span class="p">;</span>
    <span class="n">mul</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityLiquid</span><span class="p">;</span>
    <span class="n">muv</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityVapor</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">VoidFractionGeneric</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">rhol</span> <span class="o">=</span> <span class="n">rhol</span><span class="p">,</span> <span class="n">rhov</span> <span class="o">=</span> <span class="n">rhov</span><span class="p">,</span> <span class="n">mul</span> <span class="o">=</span> <span class="n">mul</span><span class="p">,</span> <span class="n">muv</span> <span class="o">=</span> <span class="n">muv</span><span class="p">,</span> <span class="n">Bb</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Zivi void fraction correlation (Carey, p.512)</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="VoidFractionZivi"><a class="viewcode-back" href="../lib.html#RbwrTh.VoidFractionZivi">[docs]</a><span class="k">def</span> <span class="nf">VoidFractionZivi</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform Zivi void fraction correlation (Carey, p.512).&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">rhol</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
    <span class="n">rhov</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span><span class="p">;</span>
    <span class="n">mul</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityLiquid</span><span class="p">;</span>
    <span class="n">muv</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityVapor</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">VoidFractionGeneric</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">rhol</span> <span class="o">=</span> <span class="n">rhol</span><span class="p">,</span> <span class="n">rhov</span> <span class="o">=</span> <span class="n">rhov</span><span class="p">,</span> <span class="n">mul</span> <span class="o">=</span> <span class="n">mul</span><span class="p">,</span> <span class="n">muv</span> <span class="o">=</span> <span class="n">muv</span><span class="p">,</span> <span class="n">Bb</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Wallis void fraction correlation (Carey, p.512)</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="VoidFractionWallis"><a class="viewcode-back" href="../lib.html#RbwrTh.VoidFractionWallis">[docs]</a><span class="k">def</span> <span class="nf">VoidFractionWallis</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform Wallis void fraction correlation (Carey, p.512).&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">rhol</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
    <span class="n">rhov</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span><span class="p">;</span>
    <span class="n">mul</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityLiquid</span><span class="p">;</span>
    <span class="n">muv</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityVapor</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">VoidFractionGeneric</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">rhol</span> <span class="o">=</span> <span class="n">rhol</span><span class="p">,</span> <span class="n">rhov</span> <span class="o">=</span> <span class="n">rhov</span><span class="p">,</span> <span class="n">mul</span> <span class="o">=</span> <span class="n">mul</span><span class="p">,</span> <span class="n">muv</span> <span class="o">=</span> <span class="n">muv</span><span class="p">,</span> <span class="n">Bb</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="mf">0.72</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">n3</span> <span class="o">=</span> <span class="mf">0.08</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Lockhart and Martinelli void fraction correlation (Carey, p.512)</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="VoidFractionLM"><a class="viewcode-back" href="../lib.html#RbwrTh.VoidFractionLM">[docs]</a><span class="k">def</span> <span class="nf">VoidFractionLM</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform Lockhart and Martinelli void fraction correlation (Carey, p.512).&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">rhol</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
    <span class="n">rhov</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span><span class="p">;</span>
    <span class="n">mul</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityLiquid</span><span class="p">;</span>
    <span class="n">muv</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityVapor</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">VoidFractionGeneric</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">rhol</span> <span class="o">=</span> <span class="n">rhol</span><span class="p">,</span> <span class="n">rhov</span> <span class="o">=</span> <span class="n">rhov</span><span class="p">,</span> <span class="n">mul</span> <span class="o">=</span> <span class="n">mul</span><span class="p">,</span> <span class="n">muv</span> <span class="o">=</span> <span class="n">muv</span><span class="p">,</span> <span class="n">Bb</span> <span class="o">=</span> <span class="mf">0.28</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="mf">0.64</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="mf">0.36</span><span class="p">,</span> <span class="n">n3</span> <span class="o">=</span> <span class="mf">0.07</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Thom void fraction correlation (Carey, p.512)</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="VoidFractionThom"><a class="viewcode-back" href="../lib.html#RbwrTh.VoidFractionThom">[docs]</a><span class="k">def</span> <span class="nf">VoidFractionThom</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform Thom void fraction correlation (Carey, p.512).&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">rhol</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
    <span class="n">rhov</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span><span class="p">;</span>
    <span class="n">mul</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityLiquid</span><span class="p">;</span>
    <span class="n">muv</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityVapor</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">VoidFractionGeneric</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">rhol</span> <span class="o">=</span> <span class="n">rhol</span><span class="p">,</span> <span class="n">rhov</span> <span class="o">=</span> <span class="n">rhov</span><span class="p">,</span> <span class="n">mul</span> <span class="o">=</span> <span class="n">mul</span><span class="p">,</span> <span class="n">muv</span> <span class="o">=</span> <span class="n">muv</span><span class="p">,</span> <span class="n">Bb</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="mf">0.89</span><span class="p">,</span> <span class="n">n3</span> <span class="o">=</span> <span class="mf">0.18</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Baroczy void fraction correlation (Carey, p.512)</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="VoidFractionBaroczy"><a class="viewcode-back" href="../lib.html#RbwrTh.VoidFractionBaroczy">[docs]</a><span class="k">def</span> <span class="nf">VoidFractionBaroczy</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform Baroczy void fraction correlation (Carey, p.512).&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">rhol</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
    <span class="n">rhov</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span><span class="p">;</span>
    <span class="n">mul</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityLiquid</span><span class="p">;</span>
    <span class="n">muv</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityVapor</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">VoidFractionGeneric</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">rhol</span> <span class="o">=</span> <span class="n">rhol</span><span class="p">,</span> <span class="n">rhov</span> <span class="o">=</span> <span class="n">rhov</span><span class="p">,</span> <span class="n">mul</span> <span class="o">=</span> <span class="n">mul</span><span class="p">,</span> <span class="n">muv</span> <span class="o">=</span> <span class="n">muv</span><span class="p">,</span> <span class="n">Bb</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="mf">0.74</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="mf">0.65</span><span class="p">,</span> <span class="n">n3</span> <span class="o">=</span> <span class="mf">0.13</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Generic drift-flux void fraction correlation</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="VoidFractionDriftFlux"><a class="viewcode-back" href="../lib.html#RbwrTh.VoidFractionDriftFlux">[docs]</a><span class="k">def</span> <span class="nf">VoidFractionDriftFlux</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rhol</span><span class="p">,</span> <span class="n">rhov</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">Vvj</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform generic drift-flux void fraction correlation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">C0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span> <span class="o">*</span> <span class="n">rhov</span> <span class="o">/</span> <span class="n">rhol</span><span class="p">)</span> <span class="o">+</span> <span class="n">Vvj</span> <span class="o">*</span> <span class="n">rhov</span> <span class="o">/</span> <span class="n">x</span> <span class="o">/</span> <span class="n">G</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Bestion void fraction correlation</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="VoidFractionBestion"><a class="viewcode-back" href="../lib.html#RbwrTh.VoidFractionBestion">[docs]</a><span class="k">def</span> <span class="nf">VoidFractionBestion</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform Bestion void fraction correlation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">gravity</span><span class="p">;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">massFlux</span><span class="p">;</span>
    <span class="n">De</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">hydraulicDiameter</span><span class="p">;</span>
    <span class="n">rhol</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
    <span class="n">rhov</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span><span class="p">;</span>
    <span class="n">rholv</span> <span class="o">=</span> <span class="n">rhol</span> <span class="o">-</span> <span class="n">rhov</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Calculate intermediate variables</span>
    <span class="c">###</span>
    <span class="n">jv</span> <span class="o">=</span> <span class="n">G</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">rhov</span><span class="p">;</span>
    <span class="n">jl</span> <span class="o">=</span> <span class="n">G</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">rhol</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">jgst</span> <span class="o">=</span> <span class="n">jv</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhov</span> <span class="o">/</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">De</span> <span class="o">*</span> <span class="n">rholv</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">Vvj</span> <span class="o">=</span> <span class="mf">0.188</span> <span class="o">*</span> <span class="n">jv</span> <span class="o">/</span> <span class="n">jgst</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Return drift-flux void fraction</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">VoidFractionDriftFlux</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">rhol</span> <span class="o">=</span> <span class="n">rhol</span><span class="p">,</span> <span class="n">rhov</span> <span class="o">=</span> <span class="n">rhov</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span> <span class="n">C0</span> <span class="o">=</span> <span class="n">C0</span><span class="p">,</span> <span class="n">Vvj</span> <span class="o">=</span> <span class="n">Vvj</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># Liao/Parlos/Griffith (LPG) void fraction correlation</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="VoidFractionLPG"><a class="viewcode-back" href="../lib.html#RbwrTh.VoidFractionLPG">[docs]</a><span class="k">def</span> <span class="nf">VoidFractionLPG</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Peform Liao/Parlos/Griffith (LPG) void fraction correlation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">gravity</span><span class="p">;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">massFlux</span><span class="p">;</span>
    <span class="n">De</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">hydraulicDiameter</span><span class="p">;</span>
    <span class="n">rhol</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
    <span class="n">rhov</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span><span class="p">;</span>
    <span class="n">rholv</span> <span class="o">=</span> <span class="n">rhol</span> <span class="o">-</span> <span class="n">rhov</span><span class="p">;</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">surfaceTension</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Calculate intermediate variables</span>
    <span class="c">###</span>
    <span class="n">jv</span> <span class="o">=</span> <span class="n">G</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">rhov</span><span class="p">;</span>
    <span class="n">jl</span> <span class="o">=</span> <span class="n">G</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">rhol</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">jgst</span> <span class="o">=</span> <span class="n">jv</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhov</span> <span class="o">/</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">De</span> <span class="o">*</span> <span class="n">rholv</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">boundary</span> <span class="o">=</span> <span class="mf">2.34</span> <span class="o">-</span> <span class="mf">1.07</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">rholv</span> <span class="o">/</span> <span class="n">rhol</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.25</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Instantiate void fraction</span>
    <span class="c">###</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">Array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">quality</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="c"># Iterate over spatial regions</span>
    <span class="c">###</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="c">###</span>
        <span class="c"># Determine flow regime</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">jl</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">boundary</span><span class="p">:</span>
            <span class="n">regime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">jgst</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">regime</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">regime</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Use value of prior cell as a first guess for the void fraction, if it exists</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># Fixed-point iteration</span>
        <span class="c">###</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">;</span>
        <span class="k">while</span> <span class="n">difference</span> <span class="o">&gt;=</span> <span class="n">epsilon</span><span class="p">:</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">regime</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Bubbly</span>
                <span class="c">###</span>
                <span class="n">C0</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
                <span class="n">Vvj</span> <span class="o">=</span> <span class="mf">1.53</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">rholv</span> <span class="o">/</span> <span class="n">rhol</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.25</span><span class="p">;</span>
            <span class="k">elif</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">regime</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Annular</span>
                <span class="c">###</span>
                <span class="n">C0</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="mf">4.</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhov</span> <span class="o">/</span> <span class="n">rhol</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">);</span>
                <span class="n">Vvj</span> <span class="o">=</span> <span class="p">(</span><span class="n">C0</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">De</span> <span class="o">*</span> <span class="n">rholv</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.015</span> <span class="o">*</span> <span class="n">rhol</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
            <span class="k">elif</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">regime</span><span class="p">:</span>
                <span class="c">###</span>
                <span class="c"># Churn/slug</span>
                <span class="c">###</span>
                <span class="n">C0</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhov</span> <span class="o">/</span> <span class="n">rhol</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">Exponent</span><span class="p">(</span><span class="o">-</span><span class="mf">18.</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]));</span>
                <span class="n">Vvj</span> <span class="o">=</span> <span class="mf">0.33</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">rholv</span> <span class="o">/</span> <span class="n">rhov</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.25</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">VoidFractionDriftFlux</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">rhol</span> <span class="o">=</span> <span class="n">rhol</span><span class="p">,</span> <span class="n">rhov</span> <span class="o">=</span> <span class="n">rhov</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span> <span class="n">C0</span> <span class="o">=</span> <span class="n">C0</span><span class="p">,</span> <span class="n">Vvj</span> <span class="o">=</span> <span class="n">Vvj</span><span class="p">);</span>
            <span class="c">###</span>
            <span class="n">difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">previous</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>
        <span class="c">###</span>
        <span class="c"># Smooth discontinuities between flow-regimes</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">regime</span><span class="p">:</span>
            <span class="n">alphaBubbly</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="k">elif</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">regime</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">alphaSlug</span><span class="p">);</span>
            <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
                <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">alphaBubbly</span><span class="p">);</span>
        <span class="k">elif</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">regime</span><span class="p">:</span>
            <span class="n">alphaSlug</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
    <span class="c">###</span>
    <span class="c"># Return drift-flux void fraction</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">alpha</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Chexal-Lellouche void fraction correlation</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="VoidFractionChexalLellouche"><a class="viewcode-back" href="../lib.html#RbwrTh.VoidFractionChexalLellouche">[docs]</a><span class="k">def</span> <span class="nf">VoidFractionChexalLellouche</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">quality</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform Chexal-Lellouche void fraction correlation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">gravity</span><span class="p">;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">massFlux</span><span class="p">;</span>
    <span class="n">De</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">hydraulicDiameter</span><span class="p">;</span>
    <span class="n">rhol</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
    <span class="n">rhov</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span><span class="p">;</span>
    <span class="n">rholv</span> <span class="o">=</span> <span class="n">rhol</span> <span class="o">-</span> <span class="n">rhov</span><span class="p">;</span>
    <span class="n">rhovOl</span> <span class="o">=</span> <span class="n">rhov</span> <span class="o">/</span> <span class="n">rhol</span><span class="p">;</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">surfaceTension</span><span class="p">;</span>
    <span class="n">mul</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityLiquid</span><span class="p">;</span>
    <span class="n">muv</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityVapor</span><span class="p">;</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">pressure</span><span class="p">;</span>
    <span class="n">Pcrit</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">criticalPressure</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Calculate static variables</span>
    <span class="c">###</span>
    <span class="n">Rel</span> <span class="o">=</span> <span class="n">G</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">De</span> <span class="o">/</span> <span class="n">mul</span><span class="p">;</span>
    <span class="n">Rev</span> <span class="o">=</span> <span class="n">G</span> <span class="o">*</span>  <span class="n">x</span> <span class="o">*</span> <span class="n">De</span> <span class="o">/</span> <span class="n">muv</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="n">B1</span> <span class="o">=</span> <span class="n">Array</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Exponent</span><span class="p">(</span><span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="n">Rel</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">Rev</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">/</span> <span class="mf">6e4</span><span class="p">)))</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]);</span>
    <span class="n">K0</span> <span class="o">=</span> <span class="n">B1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">B1</span><span class="p">)</span> <span class="o">*</span> <span class="n">rhovOl</span> <span class="o">**</span> <span class="mf">0.25</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">1.57</span> <span class="o">*</span> <span class="n">rhovOl</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">B1</span><span class="p">);</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">Pcrit</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">Pcrit</span> <span class="o">-</span> <span class="n">P</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="n">C3</span> <span class="o">=</span> <span class="n">Array</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Exponent</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">Rel</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">/</span> <span class="mf">6e4</span><span class="p">))</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]);</span>
    <span class="n">C5</span> <span class="o">=</span> <span class="p">(</span><span class="mi">150</span> <span class="o">*</span> <span class="n">rhovOl</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="k">if</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">rhovOl</span> <span class="o">&lt;=</span> <span class="mi">18</span><span class="p">:</span>
        <span class="n">C2</span> <span class="o">=</span> <span class="mf">0.4757</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">NaturalLogarithm</span><span class="p">(</span><span class="n">rhovOl</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.7</span><span class="p">;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">C5</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">C2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">C2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Exponent</span><span class="p">(</span><span class="o">-</span><span class="n">C5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">C5</span><span class="p">)));</span>
    <span class="c">###</span>
    <span class="n">C7</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.09144</span> <span class="o">/</span> <span class="n">De</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.6</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">C7</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">C4</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">C4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Exponent</span><span class="p">(</span><span class="o">-</span><span class="n">C5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">C5</span><span class="p">)));</span>
    <span class="c">###</span>
    <span class="c"># Instantiate void fraction</span>
    <span class="c">###</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">Array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">quality</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="c"># Iterate over spatial regions</span>
    <span class="c">###</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="c">###</span>
        <span class="c"># Use value of prior cell as a first guess for the void fraction, if it exists</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># Fixed-point iteration</span>
        <span class="c">###</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">;</span>
        <span class="k">while</span> <span class="n">difference</span> <span class="o">&gt;=</span> <span class="n">epsilon</span><span class="p">:</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
            <span class="n">C9</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">**</span> <span class="n">B1</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
            <span class="n">Vvj</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">rholv</span> <span class="o">/</span> <span class="n">rhol</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">C2</span> <span class="o">*</span> <span class="n">C3</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">*</span> <span class="n">C4</span> <span class="o">*</span> <span class="n">C9</span><span class="p">;</span>
            <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Exponent</span><span class="p">(</span><span class="o">-</span><span class="n">C1</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Exponent</span><span class="p">(</span><span class="o">-</span><span class="n">C1</span><span class="p">));</span>
            <span class="n">C0</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">K0</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">K0</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">**</span> <span class="n">r</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>
            <span class="c">###</span>
            <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">VoidFractionDriftFlux</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">rhol</span> <span class="o">=</span> <span class="n">rhol</span><span class="p">,</span> <span class="n">rhov</span> <span class="o">=</span> <span class="n">rhov</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span> <span class="n">C0</span> <span class="o">=</span> <span class="n">C0</span><span class="p">,</span> <span class="n">Vvj</span> <span class="o">=</span> <span class="n">Vvj</span><span class="p">);</span>
            <span class="n">difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">previous</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>
    <span class="c">###</span>
    <span class="c"># Return drift-flux void fraction</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">alpha</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Chexal-Lellouche void fraction correlation</span>
<span class="c">###</span></div>
<span class="n">VoidFractionRELAP</span> <span class="o">=</span> <span class="n">VoidFractionChexalLellouche</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># MIT-modified CISE-4 critical power ratio correlation</span>
<span class="c">###</span>
<div class="viewcode-block" id="CriticalPowerRatioMITCISE4"><a class="viewcode-back" href="../lib.html#RbwrTh.CriticalPowerRatioMITCISE4">[docs]</a><span class="k">def</span> <span class="nf">CriticalPowerRatioMITCISE4</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">axialPowers</span><span class="p">,</span> <span class="n">flowLengths</span><span class="p">,</span> <span class="n">endIndex</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform MIT-modified CISE-4 critical power ratio correlation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">mdot</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">massFlowRate</span><span class="p">;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">massFlux</span><span class="p">;</span>
    <span class="n">Dh</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">heatedDiameter</span><span class="p">;</span>
    <span class="n">De</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">hydraulicDiameter</span><span class="p">;</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">pressure</span><span class="p">;</span>
    <span class="n">Pcrit</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">criticalPressure</span><span class="p">;</span>
    <span class="n">hfg</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">enthalpyVapor</span> <span class="o">-</span> <span class="n">steam</span><span class="o">.</span><span class="n">enthalpyLiquid</span><span class="p">;</span>
    <span class="n">dhsub</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">enthalpyLiquid</span> <span class="o">-</span> <span class="n">steam</span><span class="o">.</span><span class="n">enthalpyInlet</span><span class="p">;</span>
    <span class="n">Pz</span> <span class="o">=</span> <span class="n">Array</span><span class="p">([</span><span class="n">axialPower</span> <span class="k">for</span> <span class="n">axialPower</span> <span class="ow">in</span> <span class="n">axialPowers</span><span class="p">]);</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="n">flowLengths</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Define correlation limits</span>
    <span class="c">###</span>
    <span class="n">limits</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;G&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2035</span><span class="p">),</span>
        <span class="s">&#39;De&#39;</span>   <span class="p">:</span> <span class="p">(</span><span class="mf">0.00235</span><span class="p">,</span> <span class="mf">0.00703</span><span class="p">),</span>
        <span class="s">&#39;P&#39;</span>    <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">8.6</span><span class="p">),</span>
        <span class="p">};</span>
    <span class="c">###</span>
    <span class="c"># Check limits</span>
    <span class="c">###</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="s">&#39;G&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">G</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="s">&#39;G&#39;</span><span class="p">]));</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;Mass flux violates MCPR correlation limits&#39;</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="s">&#39;De&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">De</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="s">&#39;De&#39;</span><span class="p">]));</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;Hydraulic diameter violates MCPR correlation limits&#39;</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="s">&#39;P&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">P</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="s">&#39;P&#39;</span><span class="p">]));</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;System pressure violates MCPR correlation limits&#39;</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Apply safety margin</span>
    <span class="c">###</span>
    <span class="n">mdot</span> <span class="o">*=</span> <span class="mf">0.95</span><span class="p">;</span>
    <span class="n">G</span> <span class="o">*=</span> <span class="mf">0.95</span><span class="p">;</span>
    <span class="n">Pz</span> <span class="o">*=</span> <span class="mf">1.25</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Determine the location of the onset of boiling for a peaked channel</span>
    <span class="c">###</span>
    <span class="n">onsetIndex</span> <span class="o">=</span> <span class="n">NonZero</span><span class="p">(</span><span class="n">Pz</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">mdot</span> <span class="o">&gt;=</span> <span class="n">dhsub</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
    <span class="c">###</span>
    <span class="c"># Calculate static variables</span>
    <span class="c">###</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">0.199</span> <span class="o">*</span> <span class="p">(</span><span class="n">Pcrit</span> <span class="o">/</span> <span class="n">P</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">G</span> <span class="o">*</span> <span class="n">De</span> <span class="o">**</span> <span class="mf">1.2</span><span class="p">;</span>
    <span class="n">Gstar</span> <span class="o">=</span> <span class="mf">3375.</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span> <span class="o">/</span> <span class="n">Pcrit</span><span class="p">)</span> <span class="o">**</span> <span class="mf">3.</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">G</span> <span class="o">&lt;=</span> <span class="n">Gstar</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span> <span class="o">/</span> <span class="n">Pcrit</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mf">3.</span> <span class="o">*</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">G</span> <span class="o">/</span> <span class="mf">6750.</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mf">1.</span><span class="p">;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span> <span class="o">/</span> <span class="n">Pcrit</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.7</span> <span class="o">*</span> <span class="n">G</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Iterate over spatial regions</span>
    <span class="c">###</span>
    <span class="n">criticalQuality</span> <span class="o">=</span> <span class="n">Zeros</span><span class="p">(</span><span class="n">Pz</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span>
    <span class="n">criticalPowerRatio</span> <span class="o">=</span> <span class="n">Zeros</span><span class="p">(</span><span class="n">Pz</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span>
    <span class="n">boilingLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">thermalPower</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">Pz</span><span class="p">[</span> <span class="p">:</span> <span class="n">onsetIndex</span><span class="p">]);</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">onsetIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endIndex</span><span class="p">):</span>
        <span class="n">boilingLength</span> <span class="o">+=</span> <span class="n">dz</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="n">thermalPower</span> <span class="o">+=</span> <span class="n">Pz</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="n">criticalQuality</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">De</span> <span class="o">/</span> <span class="n">Dh</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">b</span> <span class="o">/</span> <span class="n">boilingLength</span><span class="p">);</span>
        <span class="n">criticalPowerRatio</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdot</span> <span class="o">*</span> <span class="n">hfg</span> <span class="o">*</span> <span class="n">criticalQuality</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">/</span> <span class="n">thermalPower</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">criticalQuality</span><span class="p">,</span> <span class="n">criticalPowerRatio</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Hitachi-modified CISE-4 critical power ratio correlation</span>
<span class="c">###</span>
<span class="c">##### FIXME: This is a proprietary correlation.  Please run hitachi.sh to patch this file.</span>
<span class="c">###</span>
<span class="c"># Generic two-phase pressure drop correlation</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="PressureDropTwoPhase"><a class="viewcode-back" href="../lib.html#RbwrTh.PressureDropTwoPhase">[docs]</a><span class="k">def</span> <span class="nf">PressureDropTwoPhase</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">quality</span><span class="p">,</span> <span class="n">voidFraction</span><span class="p">,</span> <span class="n">massDensity</span><span class="p">,</span> <span class="n">flowLengths</span><span class="p">,</span> <span class="n">twoPhaseFrictionMultiplier</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Perform generic two-phase pressure drop correlation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">voidFraction</span><span class="p">;</span>
    <span class="n">rhomix</span> <span class="o">=</span> <span class="n">massDensity</span><span class="p">;</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="n">flowLengths</span><span class="p">;</span>
    <span class="n">phi2</span> <span class="o">=</span> <span class="n">twoPhaseFrictionMultiplier</span><span class="p">;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">gravity</span><span class="p">;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">massFlux</span><span class="p">;</span>
    <span class="n">De</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">hydraulicDiameter</span><span class="p">;</span>
    <span class="n">rhol</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
    <span class="n">rhov</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span><span class="p">;</span>
    <span class="n">mul</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">dynamicViscosityLiquid</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Calculate intermediate variables;</span>
    <span class="c"># One over the dynamic density;</span>
    <span class="c"># Fanning friction factor</span>
    <span class="c">###</span>
    <span class="n">vm</span> <span class="o">=</span> <span class="n">Nan2Num</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">rhov</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">rhov</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">));</span>
    <span class="n">flo</span> <span class="o">=</span> <span class="mf">0.079</span> <span class="o">*</span> <span class="p">(</span><span class="n">G</span> <span class="o">*</span> <span class="n">De</span> <span class="o">/</span> <span class="n">mul</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Iterate over spatial regions</span>
    <span class="c">###</span>
    <span class="n">dP</span> <span class="o">=</span> <span class="n">Zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="c">###</span>
        <span class="c"># Accumulate;</span>
        <span class="c"># Acceleration;</span>
        <span class="c"># Gravitational;</span>
        <span class="c"># Frictional</span>
        <span class="c">###</span>
        <span class="n">dP</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="n">G</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">vm</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">vm</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> \
                    <span class="n">g</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dz</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dz</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhomix</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rhomix</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">+</span> \
                    <span class="mf">2.</span> <span class="o">*</span> <span class="n">flo</span> <span class="o">*</span> <span class="n">G</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">De</span> <span class="o">/</span> <span class="n">rhol</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dz</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dz</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi2</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">phi2</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">dP</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># EPRI two-phase friction multiplier correlation</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="PressureDropEPRI"><a class="viewcode-back" href="../lib.html#RbwrTh.PressureDropEPRI">[docs]</a><span class="k">def</span> <span class="nf">PressureDropEPRI</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">quality</span><span class="p">,</span> <span class="n">voidFraction</span><span class="p">,</span> <span class="n">massDensity</span><span class="p">,</span> <span class="n">flowLengths</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;EPRI pressure drop correlation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">massFlux</span><span class="p">;</span>
    <span class="n">rhol</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
    <span class="n">rhov</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span><span class="p">;</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">pressure</span><span class="p">;</span>
    <span class="n">Pcrit</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">criticalPressure</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Calculate two-phase friction multiplier</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="n">P</span> <span class="o">&gt;=</span> <span class="mf">4.14</span><span class="p">:</span>
        <span class="n">Cf</span> <span class="o">=</span> <span class="mf">1.02</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="o">-</span><span class="mf">0.175</span> <span class="o">*</span> <span class="p">(</span><span class="n">G</span> <span class="o">/</span> <span class="mf">1356.</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mf">0.45</span><span class="p">;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Cf</span> <span class="o">=</span> <span class="mf">0.357</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="o">-</span><span class="mf">0.175</span> <span class="o">*</span> <span class="p">(</span><span class="n">G</span> <span class="o">/</span> <span class="mf">1356.</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mf">0.45</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">10.</span> <span class="o">*</span> <span class="n">P</span> <span class="o">/</span> <span class="n">Pcrit</span><span class="p">);</span>
    <span class="n">twoPhaseFrictionMultiplier</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">+</span> <span class="p">(</span><span class="n">rhol</span> <span class="o">/</span> <span class="n">rhov</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">Nan2Num</span><span class="p">(</span><span class="n">Cf</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="k">return</span> <span class="n">PressureDropTwoPhase</span><span class="p">(</span><span class="n">steam</span> <span class="o">=</span> <span class="n">steam</span><span class="p">,</span> <span class="n">quality</span> <span class="o">=</span> <span class="n">quality</span><span class="p">,</span> <span class="n">voidFraction</span> <span class="o">=</span> <span class="n">voidFraction</span><span class="p">,</span> <span class="n">massDensity</span> <span class="o">=</span> <span class="n">massDensity</span><span class="p">,</span> <span class="n">flowLengths</span> <span class="o">=</span> <span class="n">flowLengths</span><span class="p">,</span> <span class="n">twoPhaseFrictionMultiplier</span> <span class="o">=</span> <span class="n">twoPhaseFrictionMultiplier</span><span class="p">);</span>
<span class="c">###</span>
<span class="c"># RBWR-Th boiling calculation</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="RbwrThBoilingCalculation"><a class="viewcode-back" href="../lib.html#RbwrTh.RbwrThBoilingCalculation">[docs]</a><span class="k">def</span> <span class="nf">RbwrThBoilingCalculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transportOutputFile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Override coolant density calculation.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Kick out if density updates are not requested</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;updateCoolantDensities&#39;</span><span class="p">):</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Kick out if decay step or transmute-only</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsDecayStep</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsPickleTransmute</span><span class="p">():</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="c"># Cell # -&gt; Wth</span>
    <span class="c">###</span>
    <span class="n">cellNumber2ThermalPower</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCellNumberThermalPower</span><span class="p">(</span><span class="n">transportOutputFile</span><span class="p">,</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">includeDecayHeat</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">GetPowerCells</span><span class="p">()};</span>
    <span class="c">###</span>
    <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Calculating coolant densities for {}: {:.2f} MWth&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionString</span><span class="p">(),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cellNumber2ThermalPower</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="c"># Fuel -&gt; Cool</span>
    <span class="c">###</span>
    <span class="n">assemblys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;assemblyFuelsToCools&#39;</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Extract steam properties</span>
    <span class="c">###</span>
    <span class="n">steam</span> <span class="o">=</span> <span class="n">Steam</span><span class="p">(</span><span class="n">pressure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantInletPressure&#39;</span><span class="p">),</span> <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantInletTemperature&#39;</span><span class="p">),</span> <span class="n">massFlowRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantMassFlowRate&#39;</span><span class="p">),</span> <span class="n">heatedDiameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantHeatedDiameter&#39;</span><span class="p">),</span> <span class="n">hydraulicDiameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantHydraulicDiameter&#39;</span><span class="p">),</span> <span class="n">flowArea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantFlowArea&#39;</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsVerbose</span><span class="p">():</span>
        <span class="n">PrintNow</span><span class="p">(</span><span class="n">steam</span><span class="p">);</span>
    <span class="c">###</span>
    <span class="c"># Iterate over assemblies</span>
    <span class="c">###</span>
    <span class="n">assemblyIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">assemblyIndex2VoidFractionCalculation</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblys</span><span class="p">:</span>
        <span class="c">###</span>
        <span class="c"># Extract original water densities</span>
        <span class="c">###</span>
        <span class="n">cellNumbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">cool</span> <span class="k">for</span> <span class="n">fuels2Cools</span> <span class="ow">in</span> <span class="n">assembly</span> <span class="k">for</span> <span class="n">cools</span> <span class="ow">in</span> <span class="n">fuels2Cools</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">cool</span> <span class="ow">in</span> <span class="n">cools</span><span class="p">];</span>
        <span class="n">cellNumber2PreviousMassDensity</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">FindCell</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="o">.</span><span class="n">GetMassDensity</span><span class="p">()</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">cellNumbers</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantBypassCells&#39;</span><span class="p">)};</span>
        <span class="c">###</span>
        <span class="c"># Build axial power list;</span>
        <span class="c"># Coolant is heated by fuels AND by cools</span>
        <span class="c">###</span>
        <span class="n">axialZones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assembly</span><span class="p">);</span>
        <span class="n">axialPowers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">cellNumber2ThermalPower</span><span class="p">[</span><span class="n">fuel</span><span class="p">]</span> <span class="k">for</span> <span class="n">fuels</span> <span class="ow">in</span> <span class="n">fuels2Cools</span> <span class="k">for</span> <span class="n">fuel</span> <span class="ow">in</span> <span class="n">fuels</span> <span class="k">if</span> <span class="n">fuel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fuels2Cools</span><span class="p">[</span><span class="n">fuels</span><span class="p">])</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cellNumber2ThermalPower</span><span class="p">[</span><span class="n">cool</span><span class="p">]</span> <span class="k">for</span> <span class="n">cools</span> <span class="ow">in</span> <span class="n">fuels2Cools</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">cool</span> <span class="ow">in</span> <span class="n">cools</span><span class="p">)</span> <span class="k">for</span> <span class="n">fuels2Cools</span> <span class="ow">in</span> <span class="n">assembly</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># Distribute missing powers</span>
        <span class="c">###</span>
        <span class="n">allFuels</span> <span class="o">=</span> <span class="p">{</span><span class="n">fuel</span> <span class="k">for</span> <span class="n">fuels2Cools</span> <span class="ow">in</span> <span class="n">assembly</span> <span class="k">for</span> <span class="n">fuels</span> <span class="ow">in</span> <span class="n">fuels2Cools</span> <span class="k">for</span> <span class="n">fuel</span> <span class="ow">in</span> <span class="n">fuels</span><span class="p">};</span>
        <span class="n">allCools</span> <span class="o">=</span> <span class="p">{</span><span class="n">cool</span> <span class="k">for</span> <span class="n">fuels2Cools</span> <span class="ow">in</span> <span class="n">assembly</span> <span class="k">for</span> <span class="n">cools</span> <span class="ow">in</span> <span class="n">fuels2Cools</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">cool</span> <span class="ow">in</span> <span class="n">cools</span><span class="p">};</span>
        <span class="n">missingCellNumbers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cellNumber2ThermalPower</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="p">(</span><span class="n">allFuels</span> <span class="o">|</span> <span class="n">allCools</span><span class="p">);</span>
        <span class="k">if</span> <span class="n">missingCellNumbers</span><span class="p">:</span>
            <span class="n">missingPower</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cellNumber2ThermalPower</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">missingCellNumbers</span><span class="p">);</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Distributing {:.0f} Wth from cell #</span><span class="se">\&#39;</span><span class="s">s {:s} among {:d} cells in assembly #{:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">missingPower</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">missingCellNumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">missingCellNumber</span> <span class="ow">in</span> <span class="n">missingCellNumbers</span><span class="p">),</span> <span class="n">axialZones</span><span class="p">,</span> <span class="n">assemblyIndex</span><span class="p">));</span>
            <span class="n">missingPower</span> <span class="o">/=</span> <span class="n">axialZones</span><span class="p">;</span>
            <span class="n">axialPowers</span> <span class="o">=</span> <span class="p">[</span><span class="n">axialPower</span> <span class="o">+</span> <span class="n">missingPower</span> <span class="k">for</span> <span class="n">axialPower</span> <span class="ow">in</span> <span class="n">axialPowers</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># Slice axial power array;</span>
        <span class="c">###</span>
        <span class="n">zoneSlices</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
        <span class="n">axialPowers</span> <span class="o">=</span> <span class="n">Array</span><span class="p">([</span><span class="n">axialPower</span> <span class="o">/</span> <span class="n">zoneSlices</span> <span class="k">for</span> <span class="n">axialPower</span> <span class="ow">in</span> <span class="n">axialPowers</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">zoneSlices</span><span class="p">)]);</span>
        <span class="c">###</span>
        <span class="c"># Convert axial powers Wth -&gt; kWth</span>
        <span class="c">###</span>
        <span class="n">axialPowers</span> <span class="o">/=</span> <span class="mf">1e3</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Initialize axial quality, void fraction, and density</span>
        <span class="c">###</span>
        <span class="n">axialQualitys</span> <span class="o">=</span> <span class="n">Zeros</span><span class="p">(</span><span class="n">axialPowers</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span>
        <span class="n">axialVoidFractions</span> <span class="o">=</span> <span class="n">Zeros</span><span class="p">(</span><span class="n">axialPowers</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span>
        <span class="n">axialMassDensitys</span> <span class="o">=</span> <span class="n">Zeros</span><span class="p">(</span><span class="n">axialPowers</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Determine the locations of the onset of boiling and end of heating</span>
        <span class="c">###</span>
        <span class="n">onsetIndex</span> <span class="o">=</span> <span class="n">NonZero</span><span class="p">(</span><span class="n">axialPowers</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">steam</span><span class="o">.</span><span class="n">massFlowRate</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">steam</span><span class="o">.</span><span class="n">enthalpyLiquid</span> <span class="o">-</span> <span class="n">steam</span><span class="o">.</span><span class="n">enthalpyInlet</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">endIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">assembly</span><span class="p">)):</span>
            <span class="n">fuels2Cools</span> <span class="o">=</span> <span class="n">assembly</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">endIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)];</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">fuels</span> <span class="k">for</span> <span class="n">fuels</span> <span class="ow">in</span> <span class="n">fuels2Cools</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">cools</span> <span class="k">for</span> <span class="n">cools</span> <span class="ow">in</span> <span class="n">fuels2Cools</span><span class="o">.</span><span class="n">values</span><span class="p">())):</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="n">endIndex</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">endIndex</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">endIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">endIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">axialZones</span> <span class="o">-</span> <span class="n">endIndex</span><span class="p">)</span> <span class="o">*</span> <span class="n">zoneSlices</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">onePhaseSlice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">onsetIndex</span><span class="p">);</span>
        <span class="n">twoPhaseSlice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">onsetIndex</span><span class="p">,</span> <span class="n">axialZones</span> <span class="o">*</span> <span class="n">zoneSlices</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Calculate axial qualities</span>
        <span class="c">###</span>
        <span class="n">latentHeat</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">enthalpyVapor</span> <span class="o">-</span> <span class="n">steam</span><span class="o">.</span><span class="n">enthalpyLiquid</span><span class="p">;</span>
        <span class="n">axialQualitys</span><span class="p">[</span><span class="n">twoPhaseSlice</span><span class="p">]</span> <span class="o">=</span> <span class="n">Array</span><span class="p">([</span><span class="n">axialPowers</span><span class="p">[</span><span class="n">twoPhaseSlice</span><span class="p">]</span> <span class="o">/</span> <span class="n">steam</span><span class="o">.</span><span class="n">massFlowRate</span> <span class="o">/</span> <span class="n">latentHeat</span><span class="p">])</span><span class="o">.</span><span class="n">cumsum</span><span class="p">();</span>
        <span class="c">###</span>
        <span class="c"># Calculate axial void fractions</span>
        <span class="c">###</span>
        <span class="n">voidFractionCorrelation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;voidFractionCorrelation&#39;</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">voidFractionCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;bestion&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">VoidFractionCorrelation</span> <span class="o">=</span> <span class="n">VoidFractionBestion</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">voidFractionCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;lpg&#39;</span><span class="p">,</span> <span class="s">&#39;bestest&#39;</span><span class="p">,</span> <span class="s">&#39;liao&#39;</span><span class="p">):</span>
            <span class="n">VoidFractionCorrelation</span> <span class="o">=</span> <span class="n">VoidFractionLPG</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">voidFractionCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;relap&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">VoidFractionCorrelation</span> <span class="o">=</span> <span class="n">VoidFractionRELAP</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">voidFractionCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;hom&#39;</span><span class="p">,</span> <span class="s">&#39;homogeneous&#39;</span><span class="p">):</span>
            <span class="n">VoidFractionCorrelation</span> <span class="o">=</span> <span class="n">VoidFractionHomogeneous</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">voidFractionCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;zivi&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">VoidFractionCorrelation</span> <span class="o">=</span> <span class="n">VoidFractionZivi</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">voidFractionCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;wallis&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">VoidFractionCorrelation</span> <span class="o">=</span> <span class="n">VoidFractionWallis</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">voidFractionCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;lm&#39;</span><span class="p">,</span> <span class="s">&#39;lockhart&#39;</span><span class="p">,</span> <span class="s">&#39;martinelli&#39;</span><span class="p">):</span>
            <span class="n">VoidFractionCorrelation</span> <span class="o">=</span> <span class="n">VoidFractionLM</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">voidFractionCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;thom&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">VoidFractionCorrelation</span> <span class="o">=</span> <span class="n">VoidFractionThom</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">voidFractionCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;baroczy&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">VoidFractionCorrelation</span> <span class="o">=</span> <span class="n">VoidFractionBaroczy</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Void fraction correlation `{}</span><span class="se">\&#39;</span><span class="s"> is unrecognized&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voidFractionCorrelation</span><span class="p">));</span>
        <span class="n">axialVoidFractions</span><span class="p">[</span><span class="n">twoPhaseSlice</span><span class="p">]</span> <span class="o">=</span> <span class="n">VoidFractionCorrelation</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">axialQualitys</span><span class="p">[</span><span class="n">twoPhaseSlice</span><span class="p">]);</span>
        <span class="c">###</span>
        <span class="c"># Calculate axial mass densitys</span>
        <span class="c"># Linearly interpolate density until boiling onset</span>
        <span class="c">###</span>
        <span class="n">axialMassDensitys</span><span class="p">[</span><span class="n">onePhaseSlice</span><span class="p">]</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityInlet</span> <span class="o">+</span> <span class="n">Array</span><span class="p">([(</span><span class="n">index</span> <span class="o">/</span> <span class="n">onsetIndex</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span> <span class="o">-</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityInlet</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">onsetIndex</span><span class="p">)]);</span>
        <span class="n">axialMassDensitys</span><span class="p">[</span><span class="n">twoPhaseSlice</span><span class="p">]</span> <span class="o">=</span> <span class="n">axialVoidFractions</span><span class="p">[</span><span class="n">twoPhaseSlice</span><span class="p">]</span> <span class="o">*</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityVapor</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">axialVoidFractions</span><span class="p">[</span><span class="n">twoPhaseSlice</span><span class="p">])</span> <span class="o">*</span> <span class="n">steam</span><span class="o">.</span><span class="n">densityLiquid</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Construct slice flow lengths</span>
        <span class="c">###</span>
        <span class="n">flowLengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">flowLength</span> <span class="o">/</span> <span class="n">zoneSlices</span> <span class="k">for</span> <span class="n">flowLength</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantFlowLengths&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">zoneSlices</span><span class="p">)];</span>
        <span class="c">###</span>
        <span class="c"># Calculate critical quality and critical power ratio</span>
        <span class="c">###</span>
        <span class="n">criticalPowerRatioCorrelation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;criticalPowerRatioCorrelation&#39;</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">criticalPowerRatioCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;m-cise&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">CriticalPowerRatioCorrelation</span> <span class="o">=</span> <span class="n">CriticalPowerRatioMITCISE4</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">criticalPowerRatioCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;h-cise&#39;</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">CriticalPowerRatioCorrelation</span> <span class="o">=</span> <span class="n">CriticalPowerRatioHitachiCISE4</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Critical power ratio correlation `{}</span><span class="se">\&#39;</span><span class="s"> is unrecognized&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">criticalPowerRatioCorrelation</span><span class="p">));</span>
        <span class="n">axialCriticalQualitys</span><span class="p">,</span> <span class="n">axialCriticalPowerRatios</span> <span class="o">=</span> <span class="n">CriticalPowerRatioCorrelation</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">axialPowers</span><span class="p">,</span> <span class="n">flowLengths</span><span class="p">,</span> <span class="n">endIndex</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Determine the minimum critical power ratio, its quality, and its location</span>
        <span class="c">###</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">nanargmin</span> <span class="k">as</span> <span class="n">NanArgMin</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">CPR</span> <span class="o">=</span> <span class="n">Array</span><span class="p">([</span><span class="n">element</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">axialCriticalPowerRatios</span><span class="p">]);</span>
        <span class="n">CPR</span><span class="p">[</span><span class="n">NonZero</span><span class="p">(</span><span class="n">CPR</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Find initial CPR peak to ignore</span>
        <span class="c">###</span>
        <span class="k">for</span> <span class="n">peakIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">CPR</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">CPR</span><span class="p">[</span><span class="n">peakIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">CPR</span><span class="p">[</span><span class="n">peakIndex</span><span class="p">]:</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="c">###</span>
            <span class="n">peakIndex</span> <span class="o">=</span> <span class="bp">None</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">peakIndex</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">###</span>
            <span class="c"># If the CPR monotonically increases, fall back onto an a priori index</span>
            <span class="c">###</span>
            <span class="ne">Warning</span><span class="p">(</span><span class="s">&#39;There is no valid MCPR ... the CPR at the fallback location is chosen instead&#39;</span><span class="p">);</span>
            <span class="n">peakIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;criticalPowerRatioFallbackIndex&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">zoneSlices</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">troughIndex</span> <span class="o">=</span> <span class="n">peakIndex</span> <span class="o">+</span> <span class="n">NanArgMin</span><span class="p">(</span><span class="n">CPR</span><span class="p">[</span><span class="n">peakIndex</span> <span class="p">:</span> <span class="p">]);</span>
        <span class="c">###</span>
        <span class="n">minimumCriticalPowerRatio</span> <span class="o">=</span> <span class="n">axialCriticalPowerRatios</span><span class="p">[</span><span class="n">troughIndex</span><span class="p">];</span>
        <span class="n">minimumCriticalPowerRatioLocation</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">flowLengths</span><span class="p">[</span> <span class="p">:</span> <span class="n">troughIndex</span><span class="p">]);</span>
        <span class="n">minimumCriticalPowerRatioQuality</span> <span class="o">=</span> <span class="n">axialCriticalQualitys</span><span class="p">[</span><span class="n">troughIndex</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># Calculate pressure drop</span>
        <span class="c">###</span>
        <span class="n">pressureDropCorrelation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;pressureDropCorrelation&#39;</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">pressureDropCorrelation</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;epri&#39;</span><span class="p">,</span> <span class="s">&#39;reddy&#39;</span><span class="p">,</span> <span class="s">&#39;vipre&#39;</span><span class="p">,</span> <span class="s">&#39;cobra&#39;</span><span class="p">):</span>
            <span class="n">PressureDropCorrelation</span> <span class="o">=</span> <span class="n">PressureDropEPRI</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Pressure drop correlation `{}</span><span class="se">\&#39;</span><span class="s"> is unrecognized&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pressureDropCorrelation</span><span class="p">));</span>
        <span class="n">axialPressureDrops</span> <span class="o">=</span> <span class="n">PressureDropCorrelation</span><span class="p">(</span><span class="n">steam</span><span class="p">,</span> <span class="n">axialQualitys</span><span class="p">,</span> <span class="n">axialVoidFractions</span><span class="p">,</span> <span class="n">axialMassDensitys</span><span class="p">,</span> <span class="n">flowLengths</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="c"># Collapse axial power, quality, void fraction, density, and pressure drop arrays</span>
        <span class="c">###</span>
        <span class="k">def</span> <span class="nf">Collapse</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">indexs</span><span class="p">,</span> <span class="n">jndexs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Array</span><span class="p">([</span><span class="n">array</span><span class="p">[(</span><span class="n">index</span><span class="p">)</span> <span class="o">*</span> <span class="n">jndexs</span> <span class="p">:</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">jndexs</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">indexs</span><span class="p">)]);</span>
        <span class="c">###</span>
        <span class="n">axialPowers</span> <span class="o">=</span> <span class="n">Collapse</span><span class="p">(</span><span class="n">axialPowers</span><span class="p">,</span> <span class="n">axialZones</span><span class="p">,</span> <span class="n">zoneSlices</span><span class="p">)</span> <span class="o">*</span> <span class="n">zoneSlices</span><span class="p">;</span>
        <span class="n">axialQualitys</span> <span class="o">=</span> <span class="n">Collapse</span><span class="p">(</span><span class="n">axialQualitys</span><span class="p">,</span> <span class="n">axialZones</span><span class="p">,</span> <span class="n">zoneSlices</span><span class="p">);</span>
        <span class="n">axialVoidFractions</span> <span class="o">=</span> <span class="n">Collapse</span><span class="p">(</span><span class="n">axialVoidFractions</span><span class="p">,</span> <span class="n">axialZones</span><span class="p">,</span> <span class="n">zoneSlices</span><span class="p">);</span>
        <span class="n">axialMassDensitys</span> <span class="o">=</span> <span class="n">Collapse</span><span class="p">(</span><span class="n">axialMassDensitys</span><span class="p">,</span> <span class="n">axialZones</span><span class="p">,</span> <span class="n">zoneSlices</span><span class="p">);</span>
        <span class="n">axialPressureDrops</span> <span class="o">=</span> <span class="n">Collapse</span><span class="p">(</span><span class="n">axialPressureDrops</span><span class="p">,</span> <span class="n">axialZones</span><span class="p">,</span> <span class="n">zoneSlices</span><span class="p">);</span>
        <span class="n">finePositionCPRs</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">sum</span><span class="p">(</span><span class="n">flowLengths</span><span class="p">[</span> <span class="p">:</span> <span class="n">index</span><span class="p">]),</span> <span class="n">axialCriticalPowerRatios</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axialCriticalPowerRatios</span><span class="p">))];</span>
        <span class="c">###</span>
        <span class="c"># Convert axial power kWth -&gt; Wth;</span>
        <span class="c"># Convert density kg/m³ -&gt; g/cc;</span>
        <span class="c"># Convert pressure drop Pa -&gt; MPa</span>
        <span class="c">###</span>
        <span class="n">axialPowers</span> <span class="o">*=</span> <span class="mf">1e3</span><span class="p">;</span>
        <span class="n">axialMassDensitys</span> <span class="o">/=</span> <span class="mf">1e3</span><span class="p">;</span>
        <span class="n">axialPressureDrops</span> <span class="o">/=</span> <span class="mf">1e6</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># Cell # -&gt; mass density</span>
        <span class="c">### # FIXME Fix for multiple coolant cells</span>
        <span class="n">cellNumber2MassDensity</span> <span class="o">=</span> <span class="p">{</span><span class="n">cellNumbers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">:</span> <span class="n">axialMassDensitys</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cellNumbers</span><span class="p">))};</span>
        <span class="c">###</span>
        <span class="c"># Average previous and current water density estimates</span>
        <span class="c">###</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantDensityDampingCoefficient&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="n">cellNumber</span><span class="p">,</span> <span class="n">massDensity</span> <span class="ow">in</span> <span class="n">cellNumber2MassDensity</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cellNumber2MassDensity</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">*</span> <span class="n">massDensity</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">cellNumber2PreviousMassDensity</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">];</span>
        <span class="c">###</span>
        <span class="c"># Set bypass density to that of the inlet</span>
        <span class="c">###</span>
        <span class="n">inletMassDensity</span> <span class="o">=</span> <span class="n">cellNumber2MassDensity</span><span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">cellNumbers</span><span class="p">))];</span>
        <span class="n">cellNumber2MassDensity</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">cellNumber</span> <span class="p">:</span> <span class="n">inletMassDensity</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantBypassCells&#39;</span><span class="p">)});</span>
        <span class="c">###</span>
        <span class="c"># Calculate convergence norm</span>
        <span class="c">###</span>
        <span class="n">relativeDifferences</span> <span class="o">=</span> <span class="n">Array</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">cellNumber2MassDensity</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">/</span> <span class="n">cellNumber2PreviousMassDensity</span><span class="p">[</span><span class="n">cellNumber</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">cellNumber</span> <span class="ow">in</span> <span class="n">cellNumbers</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantBypassCells&#39;</span><span class="p">)]);</span>
        <span class="c">###</span>
        <span class="n">normType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;thermalHydraulicConvergenceNormType&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="n">normType</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;one&#39;</span><span class="p">):</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">relativeDifferences</span><span class="o">.</span><span class="n">mean</span><span class="p">();</span>
            <span class="n">normCharacter</span> <span class="o">=</span> <span class="s">&#39;1&#39;</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">normType</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">):</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">relativeDifferences</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">;</span>
            <span class="n">normCharacter</span> <span class="o">=</span> <span class="s">&#39;2&#39;</span><span class="p">;</span>
        <span class="k">elif</span> <span class="n">normType</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">,</span> <span class="s">&#39;infinite&#39;</span><span class="p">,</span> <span class="s">&#39;infinity&#39;</span><span class="p">):</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">relativeDifferences</span><span class="o">.</span><span class="n">max</span><span class="p">();</span>
            <span class="n">normCharacter</span> <span class="o">=</span> <span class="s">&#39;∞&#39;</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="c"># If unconverged, signal transport file update</span>
        <span class="c">###</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;thermalHydraulicConvergenceTolerance&#39;</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Coolant density {}-norm {:.1%} &gt; {:.1%} ... assembly #{:d} needs updating for {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normCharacter</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">assemblyIndex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionString</span><span class="p">()));</span>
            <span class="c">###</span>
            <span class="c"># Record the need for updates</span>
            <span class="c">###</span>
            <span class="n">transportOutputFile</span><span class="o">.</span><span class="n">ResetNewput</span><span class="p">();</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="s">&#39;&gt; Coolant density {}-norm {:.1%} ≤ {:.1%} ... assembly #{:d} has converged for {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normCharacter</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">assemblyIndex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDepletionString</span><span class="p">()));</span>
        <span class="c">###</span>
        <span class="n">boilingCalculation</span> <span class="o">=</span> <span class="n">BoilingCalculation</span><span class="p">(</span><span class="n">cellNumbers</span> <span class="o">=</span> <span class="n">cellNumbers</span><span class="p">,</span> <span class="n">cellNumber2PreviousMassDensity</span> <span class="o">=</span> <span class="n">cellNumber2PreviousMassDensity</span><span class="p">,</span> <span class="n">cellNumber2MassDensity</span> <span class="o">=</span> <span class="n">cellNumber2MassDensity</span><span class="p">,</span> <span class="n">axialPowers</span> <span class="o">=</span> <span class="n">axialPowers</span><span class="p">,</span> <span class="n">axialQualitys</span> <span class="o">=</span> <span class="n">axialQualitys</span><span class="p">,</span> <span class="n">axialVoidFractions</span> <span class="o">=</span> <span class="n">axialVoidFractions</span><span class="p">,</span> <span class="n">finePositionCPRs</span> <span class="o">=</span> <span class="n">finePositionCPRs</span><span class="p">,</span> <span class="n">minimumCriticalPowerRatio</span> <span class="o">=</span> <span class="n">minimumCriticalPowerRatio</span><span class="p">,</span> <span class="n">minimumCriticalPowerRatioQuality</span> <span class="o">=</span> <span class="n">minimumCriticalPowerRatioQuality</span><span class="p">,</span> <span class="n">minimumCriticalPowerRatioLocation</span> <span class="o">=</span> <span class="n">minimumCriticalPowerRatioLocation</span><span class="p">,</span> <span class="n">criticalPowerRatioLimit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;criticalPowerRatioLimit&#39;</span><span class="p">),</span> <span class="n">flowLengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParameter</span><span class="p">(</span><span class="s">&#39;coolantFlowLengths&#39;</span><span class="p">),</span> <span class="n">axialPressureDrops</span> <span class="o">=</span> <span class="n">axialPressureDrops</span><span class="p">,</span> <span class="n">transportOutputFile</span> <span class="o">=</span> <span class="n">transportOutputFile</span><span class="p">);</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIsVerbose</span><span class="p">():</span>
            <span class="n">PrintNow</span><span class="p">(</span><span class="n">boilingCalculation</span><span class="p">);</span>
        <span class="c">###</span>
        <span class="n">assemblyIndex2VoidFractionCalculation</span><span class="p">[</span><span class="n">assemblyIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">boilingCalculation</span><span class="p">;</span>
        <span class="c">###</span>
        <span class="n">assemblyIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c">### # FIXME Multiple assemblies!?!</span>
    <span class="k">return</span> <span class="n">assemblyIndex2VoidFractionCalculation</span><span class="p">;</span>

<span class="c">###</span>
<span class="c">### Replacement for DepletionCalculation methods</span>
<span class="c">###</span>

<span class="c">###</span>
<span class="c"># DepletionCalculation.ProcessFuel()</span>
<span class="c">###</span></div>
<span class="n">ProcessFuel</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span> <span class="p">:</span> <span class="n">RbwrThRecycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetOriginalTransportFile</span><span class="p">(),</span> <span class="n">McnpInputFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">withoutTH</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)));</span>
<span class="c">###</span>
<span class="c"># DepletionCalculation.MultiplicationFactor()</span>
<span class="c">###</span>
<span class="n">MultiplicationFactor</span> <span class="o">=</span> <span class="n">MultiBatchCoreKeffEoc</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># DepletionCalculation.UpdateCoolantDensitys()</span>
<span class="c">###</span>
<span class="n">UpdateCoolantDensitys</span> <span class="o">=</span> <span class="n">RbwrThBoilingCalculation</span><span class="p">;</span>

<span class="c">###</span>
<span class="c">### Offline helper functions</span>
<span class="c">###</span>

<span class="c">###</span>
<span class="c"># Coolant density calculation</span>
<span class="c">### # FIXME Implement this?  We will probably have to strip out the meat of RbwrThBoilingCalculation and point to that</span>
<div class="viewcode-block" id="UpdateCoolantDensitysOffline"><a class="viewcode-back" href="../lib.html#RbwrTh.UpdateCoolantDensitysOffline">[docs]</a><span class="k">def</span> <span class="nf">UpdateCoolantDensitysOffline</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Offline coolant density update helper.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">UpdateCoolantDensitys</span><span class="p">;</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span>
<span class="c">###</span>
<span class="c"># Process fuel</span>
<span class="c">###</span></div>
<div class="viewcode-block" id="ProcessFuelOffline"><a class="viewcode-back" href="../lib.html#RbwrTh.ProcessFuelOffline">[docs]</a><span class="k">def</span> <span class="nf">ProcessFuelOffline</span><span class="p">(</span><span class="n">bocFileName</span><span class="p">,</span> <span class="n">eocFileName</span><span class="p">,</span> <span class="n">newFileName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Offline fuel processing helper.&#39;&#39;&#39;</span><span class="p">;</span>
    <span class="n">newInputFile</span> <span class="o">=</span> <span class="n">RbwrThRecycle</span><span class="p">(</span><span class="n">McnpInputFile</span><span class="p">(</span><span class="n">bocFileName</span><span class="p">),</span> <span class="n">McnpInputFile</span><span class="p">(</span><span class="n">eocFileName</span><span class="p">));</span>
    <span class="c">###</span>
    <span class="n">WriteFile</span><span class="p">(</span><span class="n">newFileName</span><span class="p">,</span> <span class="n">newInputFile</span><span class="o">.</span><span class="n">GetNewputRaw</span><span class="p">());</span>
    <span class="c">###</span>
    <span class="k">return</span><span class="p">;</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">MocDown 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Jeffrey Edwin Seifried.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>